{% extends 'base.html' %}
{% load static %}

{% block tool_title_inner %}🚀 PDF转换引擎{% endblock %}
{% block tool_title_display %}🚀 PDF转换引擎{% endblock %}

{% block extra_css %}
<!-- 强制刷新缓存 -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<style>
/* PDF转换器专用样式 - 支持主题切换 */
.pdf-converter-modern {
  min-height: 100vh;
  color: var(--text-color, #ffffff);
  font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'Inter', 'SF Pro Display', -apple-system, sans-serif;
  transition: all 0.3s ease;
  /* 添加有趣的背景纹理 */
  background-image: 
    radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
}

/* 极客主题样式 */
.work-theme .pdf-converter-modern {
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
  color: #00ff41;
}

/* 生活主题样式 */
.life-theme .pdf-converter-modern {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #48dbfb 100%);
  color: #2c3e50;
}

/* 狂暴主题样式 */
.training-theme .pdf-converter-modern {
  background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 50%, #ff3838 100%);
  color: #ffffff;
}

/* Emo主题样式 */
.emo-theme .pdf-converter-modern {
  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 50%, #6c5ce7 100%);
  color: #ffffff;
}

.converter-header-modern {
  text-align: center;
  padding: 4rem 0 2rem;
  position: relative;
}

.converter-header-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 4px;
  background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
  border-radius: 2px;
}

.converter-title-modern {
  font-size: 4rem;
  font-weight: 900;
  margin-bottom: 1rem;
  letter-spacing: -0.03em;
  transition: all 0.3s ease;
  text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
  position: relative;
  /* 添加打字机效果 */
  overflow: hidden;
  white-space: nowrap;
  border-right: 3px solid;
  animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
}

@keyframes typing {
  from { width: 0; }
  to { width: 100%; }
}

@keyframes blink-caret {
  from, to { border-color: transparent; }
  50% { border-color: #00d4ff; }
}

/* 极客主题 */
.work-theme .converter-title-modern {
  background: linear-gradient(135deg, #00ff41 0%, #00cc33 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* 生活主题 */
.life-theme .converter-title-modern {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* 狂暴主题 */
.training-theme .converter-title-modern {
  background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Emo主题 */
.emo-theme .converter-title-modern {
  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.converter-subtitle-modern {
  font-size: 1.3rem;
  margin-bottom: 2rem;
  font-weight: 500;
  letter-spacing: 0.02em;
  /* 添加霓虹灯效果 */
  text-shadow: 
    0 0 5px rgba(0, 212, 255, 0.8),
    0 0 10px rgba(0, 212, 255, 0.6),
    0 0 15px rgba(0, 212, 255, 0.4);
  animation: neon-pulse 2s ease-in-out infinite alternate;
}

@keyframes neon-pulse {
  from {
    text-shadow: 
      0 0 5px rgba(0, 212, 255, 0.8),
      0 0 10px rgba(0, 212, 255, 0.6),
      0 0 15px rgba(0, 212, 255, 0.4);
  }
  to {
    text-shadow: 
      0 0 10px rgba(0, 212, 255, 1),
      0 0 20px rgba(0, 212, 255, 0.8),
      0 0 30px rgba(0, 212, 255, 0.6);
  }
}

/* 快捷键帮助按钮样式 */
.shortcuts-help-btn {
  position: absolute;
  top: 2rem;
  right: 2rem;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 0.75rem 1rem;
  color: #ffffff;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  display: none !important; /* 强制隐藏快捷键帮助按钮 */
  align-items: center;
  gap: 0.5rem;
}

.shortcuts-help-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

.shortcuts-help-btn i {
  font-size: 1rem;
}

.converter-subtitle-modern {
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.6;
  transition: all 0.3s ease;
}

/* 极客主题 */
.work-theme .converter-subtitle-modern {
  color: rgba(0, 255, 65, 0.7);
}

/* 生活主题 */
.life-theme .converter-subtitle-modern {
  color: rgba(44, 62, 80, 0.8);
}

/* 狂暴主题 */
.training-theme .converter-subtitle-modern {
  color: rgba(255, 255, 255, 0.7);
}

/* Emo主题 */
.emo-theme .converter-subtitle-modern {
  color: rgba(255, 255, 255, 0.7);
}

.conversion-types-modern {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 3.5rem;
  margin: 3rem auto;
  max-width: 1400px;
  padding: 0 2rem;
}

.type-card-modern {
  border-radius: 24px;
  padding: 2.5rem 2rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(20px);
  position: relative;
  overflow: hidden;
}

/* 极客主题 */
.work-theme .type-card-modern {
  background: linear-gradient(135deg, rgba(0, 255, 65, 0.1) 0%, rgba(0, 255, 65, 0.05) 100%);
  border: 1px solid rgba(0, 255, 65, 0.2);
  color: #00ff41;
}

.work-theme .type-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.1), transparent);
  transition: left 0.8s ease;
}

.work-theme .type-card-modern:hover {
  border-color: #00ff41;
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(0, 255, 65, 0.2);
}

.work-theme .type-card-modern.selected {
  border-color: #00ff41;
  background: rgba(0, 255, 65, 0.1);
  box-shadow: 0 16px 48px rgba(0, 255, 65, 0.3);
}

/* 生活主题 */
.life-theme .type-card-modern {
  background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(254, 202, 87, 0.05) 100%);
  border: 1px solid rgba(255, 107, 107, 0.2);
  color: #2c3e50;
}

.life-theme .type-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
  transition: left 0.8s ease;
}

.life-theme .type-card-modern:hover {
  border-color: #ff6b6b;
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(255, 107, 107, 0.2);
}

.life-theme .type-card-modern.selected {
  border-color: #ff6b6b;
  background: rgba(255, 107, 107, 0.1);
  box-shadow: 0 16px 48px rgba(255, 107, 107, 0.3);
}

/* 狂暴主题 */
.training-theme .type-card-modern {
  background: linear-gradient(135deg, rgba(255, 56, 56, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
  border: 1px solid rgba(255, 56, 56, 0.2);
  color: #ffffff;
}

.training-theme .type-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 56, 56, 0.1), transparent);
  transition: left 0.8s ease;
}

.training-theme .type-card-modern:hover {
  border-color: #ff3838;
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(255, 56, 56, 0.2);
}

.training-theme .type-card-modern.selected {
  border-color: #ff3838;
  background: rgba(255, 56, 56, 0.1);
  box-shadow: 0 16px 48px rgba(255, 56, 56, 0.3);
}

/* Emo主题 */
.emo-theme .type-card-modern {
  background: linear-gradient(135deg, rgba(108, 92, 231, 0.1) 0%, rgba(162, 155, 254, 0.05) 100%);
  border: 1px solid rgba(108, 92, 231, 0.2);
  color: #ffffff;
}

.emo-theme .type-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(108, 92, 231, 0.1), transparent);
  transition: left 0.8s ease;
}

.emo-theme .type-card-modern:hover {
  border-color: #6c5ce7;
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(108, 92, 231, 0.2);
}

.emo-theme .type-card-modern.selected {
  border-color: #6c5ce7;
  background: rgba(108, 92, 231, 0.1);
  box-shadow: 0 16px 48px rgba(108, 92, 231, 0.3);
}

.type-card-modern:hover::before {
  left: 100%;
}

.type-card-modern .card-icon {
  font-size: 3rem;
  margin-bottom: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  transition: all 0.3s ease;
}

/* 极客主题 */
.work-theme .type-card-modern .card-icon {
  background: linear-gradient(135deg, #00ff41 0%, #00cc33 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* 生活主题 */
.life-theme .type-card-modern .card-icon {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* 狂暴主题 */
.training-theme .type-card-modern .card-icon {
  background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Emo主题 */
.emo-theme .type-card-modern .card-icon {
  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.type-card-modern h4 {
  font-size: 1.8rem;
  font-weight: 800;
  margin-bottom: 1rem;
  transition: all 0.3s ease;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  letter-spacing: 0.05em;
  position: relative;
  /* 添加3D文字效果 */
  text-shadow: 
    0 1px 0 #ccc,
    0 2px 0 #c9c9c9,
    0 3px 0 #bbb,
    0 4px 0 #b9b9b9,
    0 5px 0 #aaa,
    0 6px 1px rgba(0,0,0,.1),
    0 0 5px rgba(0,0,0,.1),
    0 1px 3px rgba(0,0,0,.3),
    0 3px 5px rgba(0,0,0,.2),
    0 5px 10px rgba(0,0,0,.25),
    0 10px 10px rgba(0,0,0,.2),
    0 20px 20px rgba(0,0,0,.15);
  transform: perspective(500px) rotateX(15deg);
}

/* 极客主题 */
.work-theme .type-card-modern h4 {
  color: #00ff41;
}

/* 生活主题 */
.life-theme .type-card-modern h4 {
  color: #2c3e50;
}

/* 狂暴主题 */
.training-theme .type-card-modern h4 {
  color: #ffffff;
}

/* Emo主题 */
.emo-theme .type-card-modern h4 {
  color: #ffffff;
}

.type-card-modern p {
  margin-bottom: 1.5rem;
  line-height: 1.6;
  transition: all 0.3s ease;
}

/* 极客主题 */
.work-theme .type-card-modern p {
  color: rgba(0, 255, 65, 0.7);
}

/* 生活主题 */
.life-theme .type-card-modern p {
  color: rgba(44, 62, 80, 0.8);
}

/* 狂暴主题 */
.training-theme .type-card-modern p {
  color: rgba(255, 255, 255, 0.7);
}

/* Emo主题 */
.emo-theme .type-card-modern p {
  color: rgba(255, 255, 255, 0.7);
}

.feature-tags-modern {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.feature-tag-modern {
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 500;
  transition: all 0.3s ease;
}

/* 极客主题 */
.work-theme .feature-tag-modern {
  background: rgba(0, 255, 65, 0.1);
  color: #00ff41;
  border: 1px solid rgba(0, 255, 65, 0.2);
}

/* 生活主题 */
.life-theme .feature-tag-modern {
  background: rgba(255, 107, 107, 0.1);
  color: #ff6b6b;
  border: 1px solid rgba(255, 107, 107, 0.2);
}

/* 狂暴主题 */
.training-theme .feature-tag-modern {
  background: rgba(255, 56, 56, 0.1);
  color: #ff3838;
  border: 1px solid rgba(255, 56, 56, 0.2);
}

/* Emo主题 */
.emo-theme .feature-tag-modern {
  background: rgba(108, 92, 231, 0.1);
  color: #6c5ce7;
  border: 1px solid rgba(108, 92, 231, 0.2);
}

.upload-section-modern {
  border-radius: 24px;
  padding: 3rem;
  margin: 3rem 0;
  backdrop-filter: blur(20px);
  text-align: center;
  transition: all 0.3s ease;
}

/* 极客主题 */
.work-theme .upload-section-modern {
  background: linear-gradient(135deg, rgba(0, 255, 65, 0.1) 0%, rgba(0, 255, 65, 0.05) 100%);
  border: 1px solid rgba(0, 255, 65, 0.2);
}

/* 生活主题 */
.life-theme .upload-section-modern {
  background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(254, 202, 87, 0.05) 100%);
  border: 1px solid rgba(255, 107, 107, 0.2);
}

/* 狂暴主题 */
.training-theme .upload-section-modern {
  background: linear-gradient(135deg, rgba(255, 56, 56, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
  border: 1px solid rgba(255, 56, 56, 0.2);
}

/* Emo主题 */
.emo-theme .upload-section-modern {
  background: linear-gradient(135deg, rgba(108, 92, 231, 0.1) 0%, rgba(162, 155, 254, 0.05) 100%);
  border: 1px solid rgba(108, 92, 231, 0.2);
}

.upload-area-modern {
  border: 2px dashed;
  border-radius: 20px;
  padding: 4rem 2rem;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

/* 极客主题 */
.work-theme .upload-area-modern {
  border-color: rgba(0, 255, 65, 0.2);
}

.work-theme .upload-area-modern:hover {
  border-color: #00ff41;
  background: rgba(0, 255, 65, 0.05);
}

.work-theme .upload-area-modern.dragover {
  border-color: #00ff41;
  background: rgba(0, 255, 65, 0.1);
  transform: scale(1.02);
}

/* 生活主题 */
.life-theme .upload-area-modern {
  border-color: rgba(255, 107, 107, 0.2);
}

.life-theme .upload-area-modern:hover {
  border-color: #ff6b6b;
  background: rgba(255, 107, 107, 0.05);
}

.life-theme .upload-area-modern.dragover {
  border-color: #ff6b6b;
  background: rgba(255, 107, 107, 0.1);
  transform: scale(1.02);
}

/* 狂暴主题 */
.training-theme .upload-area-modern {
  border-color: rgba(255, 56, 56, 0.2);
}

.training-theme .upload-area-modern:hover {
  border-color: #ff3838;
  background: rgba(255, 56, 56, 0.05);
}

.training-theme .upload-area-modern.dragover {
  border-color: #ff3838;
  background: rgba(255, 56, 56, 0.1);
  transform: scale(1.02);
}

/* Emo主题 */
.emo-theme .upload-area-modern {
  border-color: rgba(108, 92, 231, 0.2);
}

.emo-theme .upload-area-modern:hover {
  border-color: #6c5ce7;
  background: rgba(108, 92, 231, 0.05);
}

.emo-theme .upload-area-modern.dragover {
  border-color: #6c5ce7;
  background: rgba(108, 92, 231, 0.1);
  transform: scale(1.02);
}

.upload-icon-modern {
  font-size: 4rem;
  margin-bottom: 1.5rem;
  transition: all 0.3s ease;
}

/* 极客主题 */
.work-theme .upload-icon-modern {
  color: #00ff41;
}

/* 生活主题 */
.life-theme .upload-icon-modern {
  color: #ff6b6b;
}

/* 狂暴主题 */
.training-theme .upload-icon-modern {
  color: #ff3838;
}

/* Emo主题 */
.emo-theme .upload-icon-modern {
  color: #6c5ce7;
}

.upload-text-modern {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 1.3rem;
  margin-bottom: 0.5rem;
  font-weight: 700;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

/* 极客主题 */
.work-theme .upload-text-modern {
  color: #00ff41;
}

/* 生活主题 */
.life-theme .upload-text-modern {
  color: #2c3e50;
}

/* 狂暴主题 */
.training-theme .upload-text-modern {
  color: #ffffff;
}

/* Emo主题 */
.emo-theme .upload-text-modern {
  color: #ffffff;
}

.upload-hint-modern {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  line-height: 1.4;
}

/* 极客主题 */
.work-theme .upload-hint-modern {
  color: rgba(0, 255, 65, 0.7);
}

/* 生活主题 */
.life-theme .upload-hint-modern {
  color: rgba(44, 62, 80, 0.8);
}

/* 狂暴主题 */
.training-theme .upload-hint-modern {
  color: rgba(255, 255, 255, 0.7);
}

/* Emo主题 */
.emo-theme .upload-hint-modern {
  color: rgba(255, 255, 255, 0.7);
}

.file-info-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 1.5rem;
  margin: 1.5rem 0;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.file-icon-modern {
  font-size: 2rem;
  color: #00d4ff;
}

.file-details-modern {
  flex: 1;
}

.file-name-modern {
  color: #ffffff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.25rem;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.file-size-modern {
  color: rgba(255, 255, 255, 0.7);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 0.9rem;
  font-weight: 500;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.remove-file-modern {
  background: rgba(255, 107, 107, 0.1);
  color: #ff6b6b;
  border: 1px solid rgba(255, 107, 107, 0.2);
  border-radius: 12px;
  padding: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.remove-file-modern:hover {
  background: rgba(255, 107, 107, 0.2);
  transform: scale(1.1);
}

.convert-btn-modern {
  color: white;
  border: none;
  border-radius: 16px;
  padding: 1rem 2.5rem;
  font-size: 1.2rem;
  font-weight: 700;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  margin-top: 2rem;
  margin-bottom: 1rem;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  position: relative;
  overflow: hidden;
  /* 添加发光效果 */
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
}

/* 极客主题 */
.work-theme .convert-btn-modern {
  background: linear-gradient(135deg, #00ff41 0%, #00cc33 100%);
  box-shadow: 0 8px 24px rgba(0, 255, 65, 0.3);
}

.work-theme .convert-btn-modern:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 16px 40px rgba(0, 255, 65, 0.5);
}

/* 生活主题 */
.life-theme .convert-btn-modern {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  box-shadow: 0 8px 24px rgba(255, 107, 107, 0.3);
}

.life-theme .convert-btn-modern:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 16px 40px rgba(255, 107, 107, 0.5);
}

/* 狂暴主题 */
.training-theme .convert-btn-modern {
  background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 100%);
  box-shadow: 0 8px 24px rgba(255, 56, 56, 0.3);
}

.training-theme .convert-btn-modern:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 16px 40px rgba(255, 56, 56, 0.5);
}

/* Emo主题 */
.emo-theme .convert-btn-modern {
  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
  box-shadow: 0 8px 24px rgba(108, 92, 231, 0.3);
}

.emo-theme .convert-btn-modern:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 16px 40px rgba(108, 92, 231, 0.5);
}

.convert-btn-modern:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.progress-section-modern {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 24px;
  padding: 3rem;
  margin: 3rem 0;
  backdrop-filter: blur(20px);
  text-align: center;
}

.progress-bar-modern {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  height: 8px;
  margin: 2rem 0;
  overflow: hidden;
  position: relative;
}

.progress-fill-modern {
  background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
  height: 100%;
  border-radius: 12px;
  transition: width 0.3s ease;
  position: relative;
}

.progress-fill-modern::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  animation: progressShine 2s infinite;
}

@keyframes progressShine {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.progress-text-modern {
  color: #ffffff;
  font-weight: 600;
  margin-bottom: 1rem;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 1.1rem;
  letter-spacing: 0.02em;
  /* 添加打字机效果 */
  animation: blink 1.5s infinite;
  position: relative;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0.7; }
}

.progress-text-modern::after {
  content: '|';
  animation: cursor-blink 1s infinite;
  margin-left: 2px;
}

@keyframes cursor-blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

.result-section-modern {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 24px;
  padding: 3rem;
  margin: 3rem 0;
  backdrop-filter: blur(20px);
}

.result-item-modern {
  text-align: center;
  padding: 2rem;
}

.result-icon-modern {
  font-size: 4rem;
  color: #4ecdc4;
  margin-bottom: 1.5rem;
}

.result-title-modern {
  color: #ffffff;
  font-size: 1.8rem;
  font-weight: 800;
  margin-bottom: 1rem;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  letter-spacing: 0.05em;
  /* 添加彩虹文字效果 */
  background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff);
  background-size: 400% 400%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: rainbow 3s ease-in-out infinite;
}

@keyframes rainbow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.result-description-modern {
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 2rem;
  line-height: 1.6;
}

.result-actions-modern {
  display: flex;
  justify-content: center;  /* Centers buttons horizontally */
  gap: 1rem;  /* Adds space between buttons */
  align-items: center;  /* Vertically aligns buttons */
  margin-top: 2rem;
  min-height: 60px; /* 确保容器有足够高度 */
  flex-wrap: wrap; /* 允许按钮换行 */
  flex-direction: row; /* 确保水平排列 */
  width: 100%; /* 确保容器占满宽度 */
}

.download-btn-modern {
  background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
  color: white;
  border: none;
  border-radius: 16px;
  padding: 1rem 2rem;
  font-weight: 700;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  text-decoration: none;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  position: relative;
  overflow: hidden;
  min-height: 48px;
  min-width: 160px;
  height: 48px; /* 固定高度确保对齐 */
  line-height: 1; /* 确保文字垂直居中 */
  box-sizing: border-box; /* 确保padding和border不影响总高度 */
  /* 添加脉冲效果 */
  animation: pulse 2s infinite;
  margin: 0; /* 确保没有额外边距 */
  flex-shrink: 0; /* 防止按钮被压缩 */
}

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(0, 212, 255, 0); }
  100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0); }
}

.download-btn-modern:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(0, 212, 255, 0.4);
  color: white;
  text-decoration: none;
}

.convert-again-btn-modern {
  background: transparent;
  color: #00d4ff;
  border: 2px solid #00d4ff;
  border-radius: 16px;
  padding: 1rem 2rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  min-height: 48px;
  min-width: 160px;
  height: 48px; /* 固定高度确保对齐 */
  line-height: 1; /* 确保文字垂直居中 */
  box-sizing: border-box; /* 确保padding和border不影响总高度 */
  margin: 0; /* 确保没有额外边距 */
  flex-shrink: 0; /* 防止按钮被压缩 */
}

.convert-again-btn-modern:hover {
  background: #00d4ff;
  color: white;
  transform: translateY(-2px);
}

.image-gallery-modern {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin: 2rem 0;
}

.image-item-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 1rem;
  text-align: center;
}

.image-item-modern img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin-bottom: 0.5rem;
}

.image-item-modern .page-info {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
}

/* 功能特色区域样式 */
.features-section-modern {
  margin: 4rem 0;
  padding: 3rem 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.features-title-modern {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 3rem;
  color: #00d4ff;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
}

.features-grid-modern {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
  margin-top: 2rem;
}

.feature-card-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.feature-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
  transition: left 0.8s ease;
}

.feature-card-modern:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 60px rgba(0, 212, 255, 0.2);
  border-color: #00d4ff;
}

.feature-card-modern:hover::before {
  left: 100%;
}

.feature-icon-modern {
  font-size: 3rem;
  color: #00d4ff;
  margin-bottom: 1.5rem;
  transition: all 0.3s ease;
}

.feature-card-modern:hover .feature-icon-modern {
  transform: scale(1.1);
}

.feature-card-modern h4 {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  color: #ffffff;
}

.feature-card-modern p {
  color: rgba(255, 255, 255, 0.7);
  line-height: 1.6;
  font-size: 1rem;
}

/* 统计区域样式 */
.stats-section-modern {
  margin: 4rem 0;
  padding: 3rem 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.stats-title-modern {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 3rem;
  color: #00d4ff;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
}

.stats-grid-modern {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem;
  margin-top: 2rem;
}

.stat-card-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
}

.stat-card-modern:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 45px rgba(0, 212, 255, 0.2);
  border-color: #00d4ff;
}

.stat-number-modern {
  font-size: 2.5rem;
  font-weight: 800;
  color: #00d4ff;
  margin-bottom: 0.5rem;
  text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
}

.stat-label-modern {
  color: rgba(255, 255, 255, 0.7);
  font-size: 1rem;
  font-weight: 500;
}

/* 最近转换记录样式 */
.recent-conversions-modern {
  margin: 4rem 0;
  padding: 3rem 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.recent-title-modern {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 3rem;
  color: #00d4ff;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
}

.recent-list-modern {
  max-width: 600px;
  margin: 0 auto;
}

.recent-item-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  transition: all 0.3s ease;
}

.recent-item-modern:hover {
  transform: translateX(10px);
  box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
  border-color: #00d4ff;
}

.recent-icon-modern {
  font-size: 1.5rem;
  color: #00d4ff;
  width: 40px;
  text-align: center;
}

.recent-info-modern {
  flex: 1;
}

.recent-name-modern {
  font-size: 1.1rem;
  font-weight: 600;
  color: #ffffff;
  margin-bottom: 0.25rem;
}

.recent-time-modern {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.6);
}

.recent-details-modern {
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.4);
  margin-top: 0.1rem;
  font-style: italic;
}

.recent-status-modern {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
}

.recent-status-modern.success {
  background: rgba(0, 255, 0, 0.2);
  color: #00ff00;
  border: 1px solid rgba(0, 255, 0, 0.3);
}

.recent-status-modern.error {
  background: rgba(255, 0, 0, 0.2);
  color: #ff0000;
  border: 1px solid rgba(255, 0, 0, 0.3);
}

/* 空状态可点击样式 */
.recent-item-modern[onclick] {
  cursor: pointer;
  border-color: rgba(0, 212, 255, 0.3);
}

/* 评分星星样式 */
.rating-stars {
  display: inline-flex;
  align-items: center;
}

.rating-stars .star {
  transition: all 0.2s ease;
  cursor: pointer;
  padding: 2px;
  margin: 0 1px;
  border-radius: 2px;
  display: inline-block;
  min-width: 16px;
  text-align: center;
}

.rating-stars .star:hover {
  transform: scale(1.2);
  color: #ffd700 !important;
  text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
}

.rating-stars .star:active {
  transform: scale(0.95);
}

.rating-stars .star-readonly {
  cursor: default;
  padding: 0;
}

.rating-stars .star-readonly:hover {
  transform: none;
  text-shadow: none;
}

.rating-display {
  display: inline-flex;
  align-items: center;
}

.rating-section {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.rating-label {
  font-size: 0.8rem;
  color: rgba(255,255,255,0.7);
  margin-bottom: 0.25rem;
}

.recent-item-modern[onclick]:hover {
  background: rgba(0, 212, 255, 0.1);
  border-color: #00d4ff;
  transform: translateX(10px);
  box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
}

/* 通知样式 */
.notification-modern {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  padding: 1rem 1.5rem;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0, 212, 255, 0.2);
  display: flex;
  align-items: center;
  gap: 0.75rem;
  z-index: 10000;
  transform: translateX(400px);
  transition: all 0.3s ease;
  max-width: 350px;
}

.notification-modern.show {
  transform: translateX(0);
}

.notification-modern.success {
  border-color: rgba(0, 255, 0, 0.3);
  color: #00aa00;
}

.notification-modern.error {
  border-color: rgba(255, 0, 0, 0.3);
  color: #ff0000;
}

.notification-modern.info {
  border-color: rgba(0, 212, 255, 0.3);
  color: #00d4ff;
}

.notification-modern i {
  font-size: 1.2rem;
}

.notification-modern span {
  font-weight: 500;
  font-size: 0.95rem;
}

/* 类型切换对话框样式 */
.type-switch-dialog {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10001;
  opacity: 0;
  transition: opacity 0.3s ease;
  backdrop-filter: blur(10px);
}

.type-switch-dialog.show {
  opacity: 1;
}

.type-switch-content {
  background: var(--bg-color, #1a1a1a);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 0;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  transform: scale(0.9);
  transition: transform 0.3s ease;
}

.type-switch-dialog.show .type-switch-content {
  transform: scale(1);
}

.type-switch-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(255, 255, 255, 0.05);
  border-radius: 16px 16px 0 0;
}

.type-switch-header h3 {
  margin: 0;
  color: var(--text-color, #ffffff);
  font-size: 1.3rem;
  font-weight: 600;
}

.type-switch-header i {
  color: #ff6b6b;
  margin-right: 0.5rem;
  font-size: 1.2rem;
}

.close-btn {
  background: none;
  border: none;
  color: var(--text-color, #ffffff);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

.type-switch-body {
  padding: 1.5rem;
}

.error-message {
  color: #ff6b6b;
  margin-bottom: 1.5rem;
  line-height: 1.6;
  white-space: pre-line;
  background: rgba(255, 107, 107, 0.1);
  padding: 1rem;
  border-radius: 8px;
  border-left: 4px solid #ff6b6b;
}

.suggested-types h4 {
  color: var(--text-color, #ffffff);
  margin-bottom: 1rem;
  font-size: 1.1rem;
}

.type-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.type-btn {
  background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
  border: none;
  color: white;
  padding: 1rem;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  font-weight: 500;
  box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
}

.type-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
}

.type-btn i {
  font-size: 1.2rem;
}

.type-switch-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.cancel-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: var(--text-color, #ffffff);
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.cancel-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

.upload-new-btn {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  border: none;
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
}

.upload-new-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}

/* 拖拽上传样式 */
.upload-area-modern.dragover {
  border-color: #00d4ff;
  background: rgba(0, 212, 255, 0.1);
  transform: scale(1.02);
}

/* 转换结果样式 */
.result-header-modern {
  text-align: center;
  margin-bottom: 2rem;
}

.result-header-modern i {
  font-size: 4rem;
  color: #00ff00;
  margin-bottom: 1rem;
}

.result-header-modern h3 {
  font-size: 2rem;
  color: #ffffff;
  margin: 0;
}

.result-info-modern {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.result-info-modern p {
  margin: 0.5rem 0;
  color: rgba(255, 255, 255, 0.8);
  font-size: 1rem;
}

/* 重复的CSS已删除，使用上面的定义 */



/* 快捷键提示样式 */
.theme-switch-hint {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background: rgba(255,255,255,0.95);
  padding: 12px 16px;
  border-radius: 8px;
  border: 1px solid rgba(102, 126, 234, 0.3);
  backdrop-filter: blur(10px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.theme-switch-hint:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.hint-content {
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: 'Arial', sans-serif;
  font-size: 0.9rem;
  color: #667eea;
  font-weight: 600;
}

.hint-content i {
  font-size: 1rem;
  color: #764ba2;
}

.hint-content span {
  white-space: nowrap;
}

.help-btn {
  background: rgba(102, 126, 234, 0.1);
  border: 1px solid rgba(102, 126, 234, 0.3);
  color: #667eea;
  border-radius: 4px;
  padding: 4px 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-left: 8px;
}

.help-btn:hover {
  background: rgba(102, 126, 234, 0.2);
  transform: scale(1.1);
}

/* 快捷键帮助面板样式 */
.shortcuts-help-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: rgba(255,255,255,0.98);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(102, 126, 234, 0.2);
  z-index: 10000;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow: hidden;
  opacity: 0;
  visibility: hidden;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.shortcuts-help-panel.show {
  opacity: 1;
  visibility: visible;
  transform: translate(-50%, -50%) scale(1);
}

.help-panel-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-radius: 16px 16px 0 0;
}

.help-panel-header h3 {
  margin: 0;
  font-size: 1.2rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 10px;
}

.close-help-btn {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.close-help-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.1);
}

.help-panel-content {
  padding: 20px;
  max-height: 60vh;
  overflow-y: auto;
}

.shortcuts-section {
  margin-bottom: 25px;
}

.shortcuts-section h4 {
  color: #667eea;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 2px solid rgba(102, 126, 234, 0.2);
  padding-bottom: 8px;
}

.shortcut-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  transition: all 0.3s ease;
}

.shortcut-item:hover {
  background: rgba(102, 126, 234, 0.05);
  padding-left: 10px;
  border-radius: 6px;
}

.shortcut-key {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-weight: 600;
  font-size: 0.85rem;
  min-width: 80px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.shortcut-desc {
  color: #333;
  font-weight: 500;
  flex: 1;
  margin-left: 15px;
}

/* 遮罩层 */
.help-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.help-overlay.show {
  opacity: 1;
  visibility: visible;
}

@media (max-width: 768px) {
  .converter-title-modern {
    font-size: 2.5rem;
  }
  
  .conversion-types-modern {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .upload-section-modern {
    padding: 2rem;
  }
  
  .result-actions-modern {
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }
  
  .download-btn-modern,
  .convert-again-btn-modern {
    width: 100%;
    max-width: 280px;
    justify-content: center;
  }
  

}
</style>
{% endblock %}

{% block content %}
<div class="pdf-converter-modern">
  <div class="container">
    <!-- 标题区域 -->
    <div class="converter-header-modern">
      <h1 class="converter-title-modern">🚀 PDF转换引擎</h1>
      <p class="converter-subtitle-modern">
        ⚡ 超高速文件格式转换工具 | 🎨 支持多种格式互转 | 🛠️ 采用现代化设计
      </p>
      
      <!-- 快捷键帮助按钮 -->
      <button class="shortcuts-help-btn" id="showShortcutsHelp" title="快捷键帮助">
        <i class="fas fa-keyboard"></i>
        <span>快捷键</span>
      </button>
    </div>
    
    <!-- 快捷键帮助面板 -->
    <div class="shortcuts-help-panel" id="shortcutsHelpPanel">
      <div class="help-panel-header">
        <h3><i class="fas fa-keyboard"></i> 快捷键帮助</h3>
        <button class="close-help-btn" id="closeShortcutsHelp">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="help-panel-content">
        <div class="shortcuts-section">
          <h4><i class="fas fa-palette"></i> 主题切换</h4>
          <div class="shortcut-item">
            <span class="shortcut-key">Ctrl + 1</span>
            <span class="shortcut-desc">生活模式</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Ctrl + 2</span>
            <span class="shortcut-desc">极客模式</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Ctrl + 3</span>
            <span class="shortcut-desc">狂暴模式</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Ctrl + 4</span>
            <span class="shortcut-desc">Emo模式</span>
          </div>
        </div>
        <div class="shortcuts-section">
          <h4><i class="fas fa-tools"></i> 工具跳转</h4>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + E</span>
            <span class="shortcut-desc">情感日记</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + L</span>
            <span class="shortcut-desc">生活日记</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + F</span>
            <span class="shortcut-desc">健身中心</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + C</span>
            <span class="shortcut-desc">创意写作</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + P</span>
            <span class="shortcut-desc">PDF转换器</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + R</span>
            <span class="shortcut-desc">小红书生成器</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + T</span>
            <span class="shortcut-desc">测试用例生成器</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + W</span>
            <span class="shortcut-desc">网页爬虫</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + S</span>
            <span class="shortcut-desc">自我分析</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + B</span>
            <span class="shortcut-desc">故事板</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + M</span>
            <span class="shortcut-desc">音乐疗愈</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + D</span>
            <span class="shortcut-desc">冥想指南</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + A</span>
            <span class="shortcut-desc">运势分析</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 遮罩层 -->
    <div class="help-overlay" id="helpOverlay"></div>
    </div>
    
    <!-- 转换类型选择 -->
    <div class="conversion-types-modern">
      <div class="type-card-modern" data-type="pdf-to-word" onclick="selectType('pdf-to-word')">
        <div class="card-icon">
          <i class="fas fa-file-pdf"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-word"></i>
        </div>
        <h4>📄 PDF转Word</h4>
        <p>🚀 将PDF文档转换为可编辑的Word格式，保持原始格式和布局</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">OCR识别</span>
          <span class="feature-tag-modern">保持格式</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="word-to-pdf" onclick="selectType('word-to-pdf')">
        <div class="card-icon">
          <i class="fas fa-file-word"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-pdf"></i>
        </div>
        <h4>📝 Word转PDF</h4>
        <p>🔒 将Word文档转换为PDF格式，确保文档的安全性和一致性</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">高质量</span>
          <span class="feature-tag-modern">快速转换</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="pdf-to-image" onclick="selectType('pdf-to-image')">
        <div class="card-icon">
          <i class="fas fa-file-pdf"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-image"></i>
        </div>
        <h4>🖼️ PDF转图片</h4>
        <p>📸 将PDF页面转换为高清图片格式，支持批量处理</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">高清输出</span>
          <span class="feature-tag-modern">批量处理</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="image-to-pdf" onclick="selectType('image-to-pdf')">
        <div class="card-icon">
          <i class="fas fa-images"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-pdf"></i>
        </div>
        <h4>📷 图片转PDF</h4>
        <p>🎯 将多张图片合并为PDF文档，支持智能排序和压缩优化</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">智能排序</span>
          <span class="feature-tag-modern">压缩优化</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="pdf-to-text" onclick="selectType('pdf-to-text')">
        <div class="card-icon">
          <i class="fas fa-file-pdf"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-alt"></i>
        </div>
        <h4>📖 PDF转文本</h4>
        <p>🔍 提取PDF文档中的纯文本内容，便于编辑和搜索</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">文本提取</span>
          <span class="feature-tag-modern">快速搜索</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="text-to-pdf" onclick="selectType('text-to-pdf')">
        <div class="card-icon">
          <i class="fas fa-file-alt"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-pdf"></i>
        </div>
        <h4>📝 文本转PDF</h4>
        <p>✨ 将纯文本内容或TXT文件转换为PDF文档，支持自定义格式</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">文本输入</span>
          <span class="feature-tag-modern">TXT上传</span>
          <span class="feature-tag-modern">快速生成</span>
        </div>
      </div>
    </div>
    
    <!-- 文件上传区域 -->
    <div class="upload-section-modern" id="fileUpload" style="display: none;">
      <h3 style="color: #00d4ff; margin-bottom: 2rem; font-size: 1.5rem; font-family: 'JetBrains Mono', 'Fira Code', monospace;">
        <i class="fas fa-cloud-upload-alt"></i>
        🚀 上传文件
      </h3>
      
      <div class="upload-area-modern" onclick="safeClick('fileInput')" id="uploadArea">
        <div class="upload-icon-modern">
          <i class="fas fa-cloud-upload-alt"></i>
        </div>
        <div class="upload-text-modern">📁 拖拽文件到此处或点击选择文件</div>
        <div class="upload-hint-modern" id="uploadHint">🎯 支持多种格式文件</div>
        <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt" style="display: none;">
      </div>
      
      <!-- 文件信息显示 -->
      <div class="file-info-modern" id="fileInfo" style="display: none;">
        <div class="file-icon-modern">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="file-details-modern">
          <div class="file-name-modern" id="fileName"></div>
          <div class="file-size-modern" id="fileSize"></div>
        </div>
        <button class="remove-file-modern" onclick="removeFile()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- 转换按钮 -->
      <button class="convert-btn-modern" onclick="convertFile()" id="convertBtn" style="display: none;">
        <i class="fas fa-cogs"></i>
        <span>⚡ 开始转换</span>
      </button>
      
      <!-- 使用提示 -->
      <div id="usageHint" style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; border-left: 4px solid #00d4ff; display: none;">
        <h4 style="margin: 0 0 0.5rem 0; color: #00d4ff;">
          <i class="fas fa-info-circle"></i> 使用说明
        </h4>
        <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
          <strong>步骤1：</strong>选择转换类型<br>
          <strong>步骤2：</strong>选择要转换的文件（或输入文本）<br>
          <strong>步骤3：</strong>点击"开始转换"按钮
        </p>
      </div>
      
      <!-- 批量转换按钮 -->
      <button class="convert-btn-modern" onclick="showBatchUpload()" id="batchBtn" style="display: none; margin-left: 1rem; background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);">
        <i class="fas fa-layer-group"></i>
        <span>📦 批量转换</span>
      </button>
    </div>
    
    <!-- 转换进度区域 -->
    <div class="progress-section-modern" id="conversionProgress" style="display: none;">
      <h3 style="color: #00d4ff; margin-bottom: 2rem; font-size: 1.5rem; font-family: 'JetBrains Mono', 'Fira Code', monospace;">
        <i class="fas fa-spinner fa-spin"></i>
        🔄 正在转换
      </h3>
      <div class="progress-bar-modern">
        <div class="progress-fill-modern" id="progressFill"></div>
      </div>
      <div class="progress-text-modern" id="progressText">准备中...</div>
    </div>
    
    <!-- 转换结果区域 -->
    <div class="result-section-modern" id="conversionResult" style="display: none;">
      <div class="result-item-modern" id="resultContent">
        <!-- 结果内容将在这里显示 -->
      </div>
    </div>
    
          <!-- 系统状态检查区域 -->
      <div class="status-section-modern" style="margin-bottom: 2rem;">
        <button class="status-btn-modern" onclick="showSystemStatus()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
          <i class="fas fa-info-circle"></i>
          检查系统状态
        </button>
      </div>
      
      <!-- 功能特色区域 -->
      <div class="features-section-modern">
        <h3 class="features-title-modern">
          <i class="fas fa-star"></i>
          功能特色
        </h3>
      <div class="features-grid-modern">
        <div class="feature-card-modern">
          <div class="feature-icon-modern">
            <i class="fas fa-bolt"></i>
          </div>
          <h4>快速转换</h4>
          <p>采用先进算法，转换速度提升300%，支持批量处理</p>
        </div>
        <div class="feature-card-modern">
          <div class="feature-icon-modern">
            <i class="fas fa-shield-alt"></i>
          </div>
          <h4>安全可靠</h4>
          <p>文件本地处理，不上传服务器，保护您的隐私安全</p>
        </div>
        <div class="feature-card-modern">
          <div class="feature-icon-modern">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <h4>多端支持</h4>
          <p>支持桌面端和移动端，随时随地进行文件转换</p>
        </div>
        <div class="feature-card-modern">
          <div class="feature-icon-modern">
            <i class="fas fa-palette"></i>
          </div>
          <h4>智能优化</h4>
          <p>自动优化文件大小和质量，平衡效果与性能</p>
        </div>
      </div>
    </div>
    
    <!-- 使用统计区域 -->
    <div class="stats-section-modern">
      <h3 class="stats-title-modern">
        <i class="fas fa-chart-line"></i>
        转换统计
      </h3>
      <div class="stats-grid-modern">
        <div class="stat-card-modern">
          <div class="stat-number-modern" id="totalConversions">1,234,567</div>
          <div class="stat-label-modern">总转换次数</div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-number-modern" id="totalFiles">89,012</div>
          <div class="stat-label-modern">处理文件数</div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-number-modern" id="avgSpeed">2.3s</div>
          <div class="stat-label-modern">平均转换时间</div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-number-modern" id="userSatisfaction">95.8%</div>
          <div class="stat-label-modern">用户满意度</div>
        </div>
      </div>
    </div>
    
    <!-- 最近转换记录 -->
    <div class="recent-conversions-modern">
      <h3 class="recent-title-modern">
        <i class="fas fa-history"></i>
        最近转换
      </h3>
      <div class="recent-list-modern" id="recentConversions">
        <div class="recent-item-modern">
          <div class="recent-icon-modern">
            <i class="fas fa-file-pdf"></i>
          </div>
          <div class="recent-info-modern">
            <div class="recent-name-modern">document.pdf</div>
            <div class="recent-time-modern">2分钟前</div>
          </div>
          <div class="recent-status-modern success">
            <i class="fas fa-check"></i>
          </div>
        </div>
        <div class="recent-item-modern">
          <div class="recent-icon-modern">
            <i class="fas fa-file-word"></i>
          </div>
          <div class="recent-info-modern">
            <div class="recent-name-modern">report.docx</div>
            <div class="recent-time-modern">5分钟前</div>
          </div>
          <div class="recent-status-modern success">
            <i class="fas fa-check"></i>
          </div>
        </div>
        <div class="recent-item-modern">
          <div class="recent-icon-modern">
            <i class="fas fa-image"></i>
          </div>
          <div class="recent-info-modern">
            <div class="recent-name-modern">photos.jpg</div>
            <div class="recent-time-modern">10分钟前</div>
          </div>
          <div class="recent-status-modern success">
            <i class="fas fa-check"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let selectedType = '';
let selectedFile = null;

// 数字动画函数
function animateNumber(element, target, duration = 2000) {
  // 安全检查
  if (!element || typeof target !== 'number' || isNaN(target)) {
    console.warn('animateNumber: 无效的参数', { element, target });
    return;
  }
  
  const start = 0;
  const increment = target / (duration / 16);
  let current = start;
  
  const timer = setInterval(() => {
    current += increment;
    if (current >= target) {
      current = target;
      clearInterval(timer);
    }
    
    // 根据目标值类型选择显示格式
    if (typeof target === 'number') {
      try {
        if (target >= 1000000) {
          element.textContent = Math.floor(current).toLocaleString();
        } else if (target >= 1000) {
          element.textContent = Math.floor(current).toLocaleString();
        } else if (target >= 1) {
          element.textContent = Math.floor(current);
        } else {
          // 小数处理
          element.textContent = current.toFixed(1);
        }
      } catch (error) {
        console.warn('animateNumber: 设置textContent失败', error);
      }
    } else {
      try {
        element.textContent = current.toFixed(1);
      } catch (error) {
        console.warn('animateNumber: 设置textContent失败', error);
      }
    }
  }, 16);
}

// 选择转换类型
function selectType(type) {
  selectedType = type;
  
  // 移除所有卡片的选中状态
  document.querySelectorAll('.type-card-modern').forEach(card => {
    card.classList.remove('selected');
  });
  
  // 添加选中状态到当前卡片
  const selectedCard = document.querySelector(`[data-type="${type}"]`);
  if (selectedCard) {
    selectedCard.classList.add('selected');
  }
  
  // 显示文件上传区域
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  const conversionResult = document.getElementById('conversionResult');
  const batchBtn = document.getElementById('batchBtn');
  const convertBtn = document.getElementById('convertBtn');
  
  if (fileUpload) fileUpload.style.display = 'block';
  if (conversionProgress) conversionProgress.style.display = 'none';
  if (conversionResult) conversionResult.style.display = 'none';
  
  // 更新上传提示
  updateUploadHint(type);
  
  // 显示批量转换按钮（除了文本转PDF）
  if (batchBtn) {
    if (type !== 'text-to-pdf') {
      batchBtn.style.display = 'inline-flex';
    } else {
      batchBtn.style.display = 'none';
    }
  }
  
  // 如果是文本转PDF，立即显示转换按钮
  if (type === 'text-to-pdf') {
    if (convertBtn) {
      convertBtn.style.display = 'block';
      convertBtn.innerHTML = '<i class="fas fa-cogs"></i><span>转换为PDF</span>';
      convertBtn.onclick = function() {
        const textInput = document.getElementById('textInput');
        if (textInput && textInput.value.trim()) {
          performTextToPdfConversion(textInput.value.trim());
        } else {
          showNotification('请输入要转换的文本内容，或者上传TXT文件！', 'error');
        }
      };
    }
  } else {
    // 其他类型需要选择文件后才显示转换按钮
    if (convertBtn) convertBtn.style.display = 'none';
  }
  
  // 显示使用提示
  const usageHint = document.getElementById('usageHint');
  if (usageHint) {
    usageHint.style.display = 'block';
  }
  
  // 滚动到上传区域
  if (fileUpload) {
    fileUpload.scrollIntoView({ 
      behavior: 'smooth', 
      block: 'start' 
    });
  }
}

// 获取转换类型名称
function getTypeName(type) {
  const names = {
    'pdf-to-word': 'PDF转Word',
    'word-to-pdf': 'Word转PDF',
    'pdf-to-image': 'PDF转图片',
    'image-to-pdf': '图片转PDF',
    'pdf-to-text': 'PDF转文本',
    'text-to-pdf': '文本转PDF'
  };
  return names[type] || type;
}

// 生成输出文件名
function getOutputFileName(originalFileName, conversionType) {
  // 安全检查
  if (!originalFileName || typeof originalFileName !== 'string') {
    originalFileName = 'converted_file';
  }
  
  // 移除文件扩展名
  const nameWithoutExt = originalFileName.replace(/\.[^/.]+$/, "");
  
  // 根据转换类型添加适当的扩展名
  const extensions = {
    'pdf-to-word': '.docx',
    'word-to-pdf': '.pdf',
    'pdf-to-image': '.zip', // 图片通常打包为zip
    'image-to-pdf': '.pdf',
    'pdf-to-text': '.txt',
    'text-to-pdf': '.pdf'
  };
  
  const extension = extensions[conversionType] || '.pdf';
  
  // 添加转换标识
  const conversionSuffix = {
    'pdf-to-word': '_converted_to_word',
    'word-to-pdf': '_converted_to_pdf',
    'pdf-to-image': '_converted_to_images',
    'image-to-pdf': '_converted_to_pdf',
    'pdf-to-text': '_converted_to_text',
    'text-to-pdf': '_converted_to_pdf'
  };
  
  const suffix = conversionSuffix[conversionType] || '_converted';
  
  return `${nameWithoutExt}${suffix}${extension}`;
}

// 更新上传提示
function updateUploadHint(type) {
  const uploadHint = document.getElementById('uploadHint');
  const fileInput = document.getElementById('fileInput');
  
  // 安全地更新uploadHint
  if (uploadHint) {
    switch(type) {
      case 'pdf-to-word':
        uploadHint.textContent = '支持PDF文件，最大100MB';
        break;
      case 'word-to-pdf':
        uploadHint.textContent = '支持Word文档 (.doc, .docx)，最大100MB';
        break;
      case 'pdf-to-image':
        uploadHint.textContent = '支持PDF文件，最大100MB';
        break;
      case 'image-to-pdf':
        uploadHint.textContent = '支持图片文件 (.jpg, .jpeg, .png, .gif, .bmp, .tiff)，最大100MB';
        break;
      case 'pdf-to-text':
        uploadHint.textContent = '支持PDF文件，最大100MB';
        break;
      case 'text-to-pdf':
        uploadHint.textContent = '请输入要转换的文本内容';
        showTextInput();
        return; // 文本转PDF不需要设置fileInput
      default:
        uploadHint.textContent = '支持多种格式文件，最大100MB';
    }
  }
  
  // 安全地更新fileInput
  if (fileInput) {
    switch(type) {
      case 'pdf-to-word':
        fileInput.accept = '.pdf';
        break;
      case 'word-to-pdf':
        fileInput.accept = '.doc,.docx';
        break;
      case 'pdf-to-image':
        fileInput.accept = '.pdf';
        break;
      case 'image-to-pdf':
        fileInput.accept = '.jpg,.jpeg,.png,.gif,.bmp,.tiff';
        break;
      case 'pdf-to-text':
        fileInput.accept = '.pdf';
        break;
      case 'text-to-pdf':
        fileInput.accept = '.txt';
        break;
      default:
        fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff,.txt';
    }
  } else {
    console.warn('fileInput element not found, skipping accept attribute update');
  }
}

// 显示文本输入区域
function showTextInput() {
  const uploadArea = document.getElementById('uploadArea');
  uploadArea.innerHTML = `
    <div class="upload-icon-modern">
      <i class="fas fa-edit"></i>
    </div>
    <div class="upload-text-modern">文本转PDF</div>
    
    <!-- 文本输入区域 -->
    <textarea id="textInput" placeholder="请输入要转换为PDF的文本内容..." 
              style="width: 100%; min-height: 200px; margin: 1rem 0; padding: 1rem; 
                     border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; 
                     background: rgba(255,255,255,0.05); color: inherit; resize: vertical;"></textarea>
    
    <!-- TXT文件上传按钮 -->
    <div style="margin: 1rem 0; text-align: center;">
      <div style="margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.9rem;">
        📄 或者上传TXT文件
      </div>
      <button type="button" onclick="document.getElementById('txtFileInput').click()" 
              style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                     border: none; color: white; padding: 0.75rem 1.5rem; 
                     border-radius: 8px; cursor: pointer; font-size: 0.9rem; 
                     transition: all 0.3s ease;">
        <i class="fas fa-file-upload"></i>
        选择TXT文件
      </button>
      <input type="file" id="txtFileInput" accept=".txt" style="display: none;" onchange="handleTxtFileUpload(event)">
    </div>
    
    <div class="upload-hint-modern">支持多行文本，自动分页</div>
  `;
  
  // 移除uploadArea的onclick事件，避免冲突
  uploadArea.removeAttribute('onclick');
  
  // 移除之前添加的事件监听器
  if (uploadArea._batchClickHandler) {
    uploadArea.removeEventListener('click', uploadArea._batchClickHandler);
    delete uploadArea._batchClickHandler;
  }
  
  // 转换按钮已经在selectType函数中设置，这里不需要重复设置
  
  // 隐藏使用提示
  const usageHint = document.getElementById('usageHint');
  if (usageHint) usageHint.style.display = 'none';
}

// 处理TXT文件上传（专门用于文本转PDF）
function handleTxtFileUpload(event) {
  const file = event.target.files[0];
  if (file) {
    // 验证文件类型
    if (!file.name.toLowerCase().endsWith('.txt')) {
      showNotification('请选择TXT文件！', 'error');
      return;
    }
    
    // 验证文件大小（限制为5MB）
    if (file.size > 5 * 1024 * 1024) {
      showNotification('TXT文件大小不能超过5MB！', 'error');
      return;
    }
    
    // 读取txt文件内容
    const reader = new FileReader();
    reader.onload = function(e) {
      const textContent = e.target.result;
      const textInput = document.getElementById('textInput');
      if (textInput) {
        textInput.value = textContent;
        showNotification(`已加载TXT文件内容: ${file.name}`, 'success');
        
        // 确保转换按钮显示
        const convertBtn = document.getElementById('convertBtn');
        if (convertBtn) {
          convertBtn.style.display = 'block';
          // 更新按钮文本以提示用户可以转换
          convertBtn.innerHTML = '<i class="fas fa-cogs"></i><span>转换为PDF</span>';
        }
      }
    };
    reader.onerror = function() {
      showNotification('读取TXT文件失败，请重试！', 'error');
    };
    reader.readAsText(file, 'utf-8');
  }
}

// 文件上传处理
function handleFileUpload(event) {
  const file = event.target.files[0];
  if (file) {
    selectedFile = file;
    
    // 检查是否是txt文件且选择了文本转PDF
    if (file.name.toLowerCase().endsWith('.txt') && selectedType === 'text-to-pdf') {
      // 读取txt文件内容并显示在文本输入框中
      const reader = new FileReader();
      reader.onload = function(e) {
        const textContent = e.target.result;
        showTextInput();
        const textInput = document.getElementById('textInput');
        if (textInput) {
          textInput.value = textContent;
        }
        showNotification(`已加载txt文件内容: ${file.name}`, 'success');
      };
      reader.readAsText(file, 'utf-8');
    } else {
      displayFileInfo(file);
      const convertBtn = document.getElementById('convertBtn');
      if (convertBtn) convertBtn.style.display = 'block';
      
      // 隐藏使用提示
      const usageHint = document.getElementById('usageHint');
      if (usageHint) usageHint.style.display = 'none';
      
      showNotification(`已选择文件: ${file.name}`, 'success');
    }
  }
}

// 显示文件信息
function displayFileInfo(file) {
  const fileInfo = document.getElementById('fileInfo');
  const fileName = document.getElementById('fileName');
  const fileSize = document.getElementById('fileSize');
  
  // 限制文件名长度，超过30个字符显示省略号
  const displayName = file.name.length > 30 ? file.name.substring(0, 30) + '...' : file.name;
  fileName.textContent = displayName;
  fileName.title = file.name; // 添加完整文件名的tooltip
  
  fileSize.textContent = formatFileSize(file.size);
  
  fileInfo.style.display = 'flex';
  document.getElementById('uploadArea').style.display = 'none';
}

// 格式化文件大小
function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// 移除文件
function removeFile() {
  selectedFile = null;
  const fileInfo = document.getElementById('fileInfo');
  const uploadArea = document.getElementById('uploadArea');
  const convertBtn = document.getElementById('convertBtn');
  const fileInput = document.getElementById('fileInput');
  
  // 添加null检查，防止TypeError
  if (fileInfo) fileInfo.style.display = 'none';
  if (uploadArea) uploadArea.style.display = 'block';
  if (convertBtn) convertBtn.style.display = 'none';
  if (fileInput) fileInput.value = '';
}

// 转换文件
function convertFile() {

  if (!selectedType) {
    showNotification('请先选择转换类型！', 'error');
    return;
  }
  
  // 检查文本转PDF的特殊情况
  if (selectedType === 'text-to-pdf') {
    const textInput = document.getElementById('textInput');
    if (!textInput || !textInput.value.trim()) {
      showNotification('请输入要转换的文本内容！', 'error');
      return;
    }
    performTextToPdfConversion(textInput.value.trim());
    return;
  }
  
  if (!selectedFile) {
    showNotification('请先选择文件！', 'error');
    return;
  }
  
  // 显示转换进度
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  
  if (fileUpload) fileUpload.style.display = 'none';
  if (conversionProgress) conversionProgress.style.display = 'block';
  
  // 执行实际转换
  performConversion();
}

// 执行文件转换
function performConversion() {
  const formData = new FormData();
  formData.append('file', selectedFile);
  formData.append('type', selectedType);
  
  // 显示进度
  simulateProgress();
  
  // 发送API请求
  fetch('/tools/api/pdf-converter/', {
    method: 'POST',
    body: formData
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    // 检查响应类型，避免解析HTML为JSON
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      return response.json();
    } else {
      throw new Error('服务器返回非JSON响应，会话可能已过期，请重新登录后重试');
    }
  })
  .then(data => {
    if (data.success) {
      showConversionResult(data);
    } else {
      // 检查是否需要切换转换类型
      if (data.needs_type_switch && data.suggested_types && data.suggested_types.length > 0) {
        showTypeSwitchDialog(data.error, data.suggested_types);
      } else {
        showNotification(data.error || '转换失败', 'error');
      }
      const conversionProgress = document.getElementById('conversionProgress');
      if (conversionProgress) conversionProgress.style.display = 'none';
    }
  })
  .catch(error => {
    console.error('转换错误:', error);
    let errorMessage = error.message;
    
    // 提供更友好的错误提示
    if (error.message.includes('Unexpected token')) {
      errorMessage = '会话已过期，请重新登录后重试';
    } else if (error.message.includes('非JSON响应')) {
      errorMessage = '会话已过期，请重新登录后重试';
    }
    
    showNotification('转换过程中发生错误: ' + errorMessage, 'error');
    const conversionProgress = document.getElementById('conversionProgress');
    if (conversionProgress) conversionProgress.style.display = 'none';
  });
}

// 模拟转换进度
function simulateProgress() {
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');
  let progress = 0;
  
  const interval = setInterval(() => {
    progress += Math.random() * 15;
    if (progress > 90) progress = 90; // 保留10%给实际完成
    
    if (progressFill) progressFill.style.width = progress + '%';
    
    if (progressText) {
      if (progress < 30) {
        progressText.textContent = '正在分析文件...';
      } else if (progress < 60) {
        progressText.textContent = '正在转换格式...';
      } else {
        progressText.textContent = '正在优化输出...';
      }
    }
  }, 200);
  
  // 保存interval以便后续清除
  window.progressInterval = interval;
}

// 显示转换结果
function showConversionResult(data) {
  // 清除进度模拟
  if (window.progressInterval) {
    clearInterval(window.progressInterval);
  }
  
  const conversionProgress = document.getElementById('conversionProgress');
  const resultContent = document.getElementById('resultContent');
  const conversionResult = document.getElementById('conversionResult');
  
  if (conversionProgress) conversionProgress.style.display = 'none';
  
  // 刷新统计数据
  setTimeout(() => {
    if (typeof loadConversionStats === 'function') {
      loadConversionStats();
    }
  }, 1000);
  
  const fileName = selectedFile ? selectedFile.name : '文本内容';
  
  if (!resultContent) {
    console.error('结果内容元素未找到');
    return;
  }
  
  if (data.type === 'images') {
    // 显示图片结果
    let imagesHtml = '<div class="image-gallery-modern">';
    data.data.forEach((image, index) => {
      imagesHtml += `
        <div class="image-item-modern">
          <img src="data:image/png;base64,${image.data}" alt="页面 ${image.page}">
          <div class="page-info">第 ${image.page} 页</div>
        </div>
      `;
    });
    imagesHtml += '</div>';
    
    resultContent.innerHTML = `
      <div class="result-icon-modern">
        <i class="fas fa-images"></i>
      </div>
      <div class="result-title-modern">✅ 转换完成</div>
      <div class="result-description-modern">
        文件 <strong>${fileName}</strong> 已成功转换为图片格式，共 ${data.total_pages} 页
        <br>总大小: ${formatFileSize ? formatFileSize(data.total_size) : data.total_size}
      </div>
      ${imagesHtml}
      <div class="result-actions-modern">
        <button class="convert-again-btn-modern" onclick="convertAgain()">
          <i class="fas fa-redo"></i>
          转换其他文件
        </button>
      </div>
    `;
  } else {
    // 显示文件下载结果
    const fileSize = data.file_size ? (formatFileSize ? formatFileSize(data.file_size) : data.file_size) : '';
    // 从API响应中获取转换类型，如果没有则使用selectedType
    const conversionType = data.conversion_type || selectedType || 'unknown';
    const outputFileName = getOutputFileName ? getOutputFileName(fileName, conversionType) : fileName;
    
    resultContent.innerHTML = `
      <div class="result-icon-modern">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="result-title-modern">✅ 转换完成</div>
      <div class="result-description-modern">
        ${conversionType === 'text-to-pdf' ? '文本内容' : `文件 <strong>${fileName}</strong>`} 已成功转换为 ${getTypeName ? getTypeName(conversionType) : conversionType} 格式
        ${fileSize ? `<br>文件大小: ${fileSize}` : ''}
        <br><strong>输出文件名: ${outputFileName}</strong>
      </div>
      <div class="result-actions-modern">
        <a href="${data.download_url}" class="download-btn-modern" download="${outputFileName}" id="autoDownloadLink">
          <i class="fas fa-download"></i>
          重新下载
        </a>
        <button class="convert-again-btn-modern" onclick="convertAgain()">
          <i class="fas fa-redo"></i>
          转换其他文件
        </button>
      </div>
    `;
    
    // 检查下载URL是否存在
    if (!data.download_url) {
      console.error('API响应中缺少download_url字段:', data);
      showNotification('转换成功但无法获取下载链接，请检查API响应', 'error');
      return;
    }
    
    // 自动触发下载
    setTimeout(() => {
      if (typeof downloadFile === 'function') {
        downloadFile(data.download_url, outputFileName);
        showNotification(`文件 "${outputFileName}" 正在下载...`, 'info');
      }
    }, 1000);
  }
  
  if (conversionResult) conversionResult.style.display = 'block';
  showNotification('文件转换完成！', 'success');
}

// 重新转换
function convertAgain() {
  // 重置所有状态变量
  selectedFile = null;
  selectedType = '';
  
  // 隐藏转换结果和进度
  const conversionResult = document.getElementById('conversionResult');
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  
  if (conversionResult) conversionResult.style.display = 'none';
  if (fileUpload) fileUpload.style.display = 'none';
  if (conversionProgress) conversionProgress.style.display = 'none';
  
  // 重置文件信息显示
  const fileInfo = document.getElementById('fileInfo');
  if (fileInfo) fileInfo.style.display = 'none';
  
  // 重置转换按钮
  const convertBtn = document.getElementById('convertBtn');
  if (convertBtn) convertBtn.style.display = 'none';
  
  // 取消选择所有转换类型卡片
  document.querySelectorAll('.type-card-modern').forEach(card => {
    card.classList.remove('selected');
  });
  
  // 重置上传区域
  const uploadArea = document.getElementById('uploadArea');
  if (uploadArea) {
    uploadArea.style.display = 'block';
    uploadArea.innerHTML = `
      <div class="upload-icon-modern">
        <i class="fas fa-cloud-upload-alt"></i>
      </div>
      <div class="upload-text-modern">拖拽文件到此处或点击选择文件</div>
      <div class="upload-hint-modern" id="uploadHint">支持多种格式文件</div>
    `;
    
    // 重新创建fileInput元素并绑定事件
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.id = 'fileInput';
    fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.txt';
    fileInput.style.display = 'none';
    fileInput.addEventListener('change', handleFileUpload);
    uploadArea.appendChild(fileInput);
    
    // 恢复原始的onclick事件
    uploadArea.onclick = function() { safeClick('fileInput'); };
    
    // 移除之前添加的事件监听器
    if (uploadArea._batchClickHandler) {
      uploadArea.removeEventListener('click', uploadArea._batchClickHandler);
      delete uploadArea._batchClickHandler;
    }
  }
  
  // 显示成功通知
  showNotification('已重置转换界面，可以开始新的转换', 'success');

}

// 文本转PDF转换
function performTextToPdfConversion(textContent) {
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  
  if (fileUpload) fileUpload.style.display = 'none';
  if (conversionProgress) conversionProgress.style.display = 'block';
  
  const formData = new FormData();
  formData.append('type', 'text-to-pdf');
  formData.append('text_content', textContent);
  
  // 显示进度
  simulateProgress();
  
  // 发送API请求
  fetch('/tools/api/pdf-converter/', {
    method: 'POST',
    body: formData
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    // 检查响应类型，避免解析HTML为JSON
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      return response.json();
    } else {
      throw new Error('服务器返回非JSON响应，会话可能已过期，请重新登录后重试');
    }
  })
  .then(data => {
    if (data.success) {
      showConversionResult(data);
    } else {
      // 检查是否需要切换转换类型
      if (data.needs_type_switch && data.suggested_types && data.suggested_types.length > 0) {
        showTypeSwitchDialog(data.error, data.suggested_types);
      } else {
        showNotification(data.error || '转换失败', 'error');
      }
      if (conversionProgress) conversionProgress.style.display = 'none';
    }
  })
  .catch(error => {
    console.error('转换错误:', error);
    let errorMessage = error.message;
    
    // 提供更友好的错误提示
    if (error.message.includes('Unexpected token')) {
      errorMessage = '会话已过期，请重新登录后重试';
    } else if (error.message.includes('非JSON响应')) {
      errorMessage = '会话已过期，请重新登录后重试';
    }
    
    showNotification('转换过程中发生错误: ' + errorMessage, 'error');
    if (conversionProgress) conversionProgress.style.display = 'none';
  });
}

// 这些函数已经被更新的版本替换，删除重复代码

// 显示通知
function showNotification(message, type = 'info') {
  // 创建通知元素
  const notification = document.createElement('div');
  notification.className = `notification-modern ${type}`;
  notification.innerHTML = `
    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
    <span>${message}</span>
  `;
  
  // 添加到页面
  document.body.appendChild(notification);
  
  // 显示动画
  setTimeout(() => {
    notification.classList.add('show');
  }, 100);
  
  // 自动隐藏
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// 显示类型切换对话框
function showTypeSwitchDialog(errorMessage, suggestedTypes) {
  // 移除已存在的对话框
  const existingDialog = document.getElementById('typeSwitchDialog');
  if (existingDialog) {
    existingDialog.remove();
  }
  
  // 创建对话框
  const dialog = document.createElement('div');
  dialog.id = 'typeSwitchDialog';
  dialog.className = 'type-switch-dialog';
  dialog.innerHTML = `
    <div class="type-switch-content">
      <div class="type-switch-header">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>文件类型不兼容</h3>
        <button class="close-btn" onclick="closeTypeSwitchDialog()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="type-switch-body">
        <p class="error-message">${errorMessage}</p>
        <div class="suggested-types">
          <h4>建议的转换类型：</h4>
          <div class="type-buttons">
            ${suggestedTypes.map(type => `
              <button class="type-btn" onclick="switchConversionType('${type}')">
                <i class="fas fa-${getTypeIcon(type)}"></i>
                <span>${getTypeDisplayName(type)}</span>
              </button>
            `).join('')}
          </div>
        </div>
        <div class="type-switch-actions">
          <button class="cancel-btn" onclick="closeTypeSwitchDialog()">取消</button>
          <button class="upload-new-btn" onclick="uploadNewFile()">上传新文件</button>
        </div>
      </div>
    </div>
  `;
  
  // 添加到页面
  document.body.appendChild(dialog);
  
  // 显示动画
  setTimeout(() => {
    dialog.classList.add('show');
  }, 100);
}

// 关闭类型切换对话框
function closeTypeSwitchDialog() {
  const dialog = document.getElementById('typeSwitchDialog');
  if (dialog) {
    dialog.classList.remove('show');
    setTimeout(() => {
      dialog.remove();
    }, 300);
  }
}

// 切换转换类型
function switchConversionType(type) {
  // 更新转换类型选择
  const typeSelect = document.getElementById('conversionType');
  if (typeSelect) {
    typeSelect.value = type;
    // 触发change事件
    const event = new Event('change');
    typeSelect.dispatchEvent(event);
  }
  
  // 关闭对话框
  closeTypeSwitchDialog();
  
  // 显示成功提示
  showNotification(`已自动切换到 ${getTypeDisplayName(type)}`, 'success');
}

// 上传新文件
function uploadNewFile() {
  closeTypeSwitchDialog();
  // 触发文件选择
  const fileInput = document.getElementById('fileInput');
  if (fileInput) {
    fileInput.click();
  }
}

// 获取转换类型图标
function getTypeIcon(type) {
  const iconMap = {
    'pdf-to-word': 'file-word',
    'word-to-pdf': 'file-pdf',
    'pdf-to-image': 'images',
    'image-to-pdf': 'file-pdf'
  };
  return iconMap[type] || 'file';
}

// 获取转换类型显示名称
function getTypeDisplayName(type) {
  const nameMap = {
    'pdf-to-word': 'PDF转Word',
    'word-to-pdf': 'Word转PDF',
    'pdf-to-image': 'PDF转图片',
    'image-to-pdf': '图片转PDF'
  };
  return nameMap[type] || type;
}

// 页面加载时启动动画
document.addEventListener('DOMContentLoaded', function() {
  // 加载实际统计数据
  loadConversionStats();
  
  // 显示初始使用提示
  const usageHint = document.getElementById('usageHint');
  if (usageHint) {
    usageHint.style.display = 'block';
    usageHint.innerHTML = `
      <h4 style="margin: 0 0 0.5rem 0; color: #00d4ff;">
        <i class="fas fa-info-circle"></i> 欢迎使用PDF转换器
      </h4>
      <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
        <strong>开始使用：</strong>请先选择上方的转换类型，然后按照提示操作
      </p>
    `;
  }
  
  // 延迟启动动画，让页面先加载完成
  setTimeout(() => {
    // 这些值将在loadConversionStats中更新
  }, 1000);
  
  // 绑定文件上传事件
  const fileInput = document.getElementById('fileInput');
  if (fileInput) {
    fileInput.addEventListener('change', handleFileUpload);
  }
  
  // 绑定拖拽上传事件
  const uploadArea = document.getElementById('uploadArea');
  if (uploadArea) {
    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
          fileInput.files = files;
          handleFileUpload({ target: { files: files } });
        }
      }
    });
  }
});



// 加载转换统计数据
function loadConversionStats() {

  // 获取CSRF令牌
  const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
  
  fetch('/tools/api/pdf-converter/stats/', {
    method: 'GET',
    headers: {
      'X-CSRFToken': csrfToken,
      'Content-Type': 'application/json',
    },
    credentials: 'same-origin' // 包含cookies
  })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      // 检查响应类型，避免解析HTML为JSON
      const contentType = response.headers.get('content-type');
      if (contentType && contentType.includes('application/json')) {
        return response.json();
      } else {
        throw new Error('服务器返回非JSON响应，会话可能已过期，请重新登录后重试');
      }
    })
    .then(data => {

      if (data.success) {
        // 更新统计数据
        const stats = data.stats;
        
        // 解析数值
        const totalConversions = parseInt(stats.total_conversions) || 0;
        const totalFiles = parseInt(stats.total_files) || 0;
        
        // 处理平均速度 - 修复数据解析逻辑
        let avgSpeed = 0.0;
        
        // 优先使用数字类型的字段
        if (typeof stats.avg_speed === 'number' && stats.avg_speed > 0) {
          avgSpeed = stats.avg_speed;
        } else if (typeof stats.average_conversion_time === 'number' && stats.average_conversion_time > 0) {
          avgSpeed = stats.average_conversion_time;
        } else if (typeof stats.avg_conversion_time === 'number' && stats.avg_conversion_time > 0) {
          avgSpeed = stats.avg_conversion_time;
        } else if (typeof stats.avg_speed === 'string') {
          // 如果是字符串，直接解析数字部分（不要移除小数点）
          const parsed = parseFloat(stats.avg_speed);
          if (!isNaN(parsed) && parsed > 0) {
            avgSpeed = parsed;
          }
        }
        
        // 确保avgSpeed在合理范围内
        if (avgSpeed <= 0 || avgSpeed > 300) {
          avgSpeed = 2.5; // 默认值
        }
        
        // 处理用户满意度 - 改进数据解析逻辑
        let userSatisfaction = 95.8; // 默认满意度
        
        // 先尝试从 user_satisfaction_percentage 获取
        if (typeof stats.user_satisfaction_percentage === 'number' && stats.user_satisfaction_percentage > 0) {
          userSatisfaction = stats.user_satisfaction_percentage;
        } else if (typeof stats.user_satisfaction === 'number' && stats.user_satisfaction > 0) {
          userSatisfaction = stats.user_satisfaction;
        } else if (typeof stats.user_satisfaction === 'string') {
          // 移除所有非数字字符，只保留数字和小数点
          const parsed = parseFloat(stats.user_satisfaction.replace(/[^\d.]/g, '')) || 0.0;
          userSatisfaction = parsed > 0 ? parsed : 95.8;
        }
        
        // 确保满意度在合理范围内 (0-100)
        if (userSatisfaction < 0 || userSatisfaction > 100) {
          userSatisfaction = 95.8;
        }
        
        // 更新统计数据显示

        const totalConversionsElement = document.getElementById('totalConversions');
        const totalFilesElement = document.getElementById('totalFiles');
        const avgSpeedElement = document.getElementById('avgSpeed');
        const userSatisfactionElement = document.getElementById('userSatisfaction');
        
        if (totalConversionsElement) animateNumber(totalConversionsElement, totalConversions);
        if (totalFilesElement) animateNumber(totalFilesElement, totalFiles);
        if (avgSpeedElement) avgSpeedElement.textContent = avgSpeed.toFixed(1) + 's';
        if (userSatisfactionElement) {
          userSatisfactionElement.textContent = userSatisfaction.toFixed(1) + '%';
        }

        // 更新最近转换记录
        updateRecentConversions(stats.recent_conversions);
      } else {
        console.error('加载统计数据失败:', data.error);
        // 使用默认值
        const totalConversionsElement = document.getElementById('totalConversions');
        const totalFilesElement = document.getElementById('totalFiles');
        const avgSpeedElement = document.getElementById('avgSpeed');
        const userSatisfactionElement = document.getElementById('userSatisfaction');
        
        if (totalConversionsElement) animateNumber(totalConversionsElement, 0);
        if (totalFilesElement) animateNumber(totalFilesElement, 0);
        if (avgSpeedElement) avgSpeedElement.textContent = '2.5s';
        if (userSatisfactionElement) userSatisfactionElement.textContent = '95.8%';
      }
    })
    .catch(error => {
      console.error('请求统计数据失败:', error);
      // 使用默认值
      const totalConversionsElement = document.getElementById('totalConversions');
      const totalFilesElement = document.getElementById('totalFiles');
      const avgSpeedElement = document.getElementById('avgSpeed');
      const userSatisfactionElement = document.getElementById('userSatisfaction');
      
      if (totalConversionsElement) animateNumber(totalConversionsElement, 0);
      if (totalFilesElement) animateNumber(totalFilesElement, 0);
      if (avgSpeedElement) avgSpeedElement.textContent = '2.5s';
      if (userSatisfactionElement) userSatisfactionElement.textContent = '95.8%';
    });
}

// 更新最近转换记录
function updateRecentConversions(recentData) {



  const recentContainer = document.getElementById('recentConversions');

  if (!recentData || recentData.length === 0) {
    recentContainer.innerHTML = `
      <div class="recent-item-modern" onclick="goToConversionTypes()">
        <div class="recent-icon-modern">
          <i class="fas fa-file-pdf"></i>
        </div>
        <div class="recent-info-modern">
          <div class="recent-name-modern">暂无转换记录</div>
          <div class="recent-time-modern">开始您的第一次转换吧</div>
          <div class="recent-details-modern">点击开始转换体验</div>
        </div>
        <div class="recent-status-modern">
          <i class="fas fa-plus"></i>
        </div>
      </div>
    `;
    return;
  }
  
  recentContainer.innerHTML = '';
  
  recentData.forEach(record => {
    // 安全检查记录数据
    if (!record || typeof record !== 'object') {
      console.warn('跳过无效的记录数据:', record);
      return;
    }
    
    const item = document.createElement('div');
    item.className = 'recent-item-modern';
    
    // 根据转换类型选择图标，添加安全检查
    let icon = 'fas fa-file-pdf';
    const conversionType = record.conversion_type || '';
    if (conversionType.includes('Word')) {
      icon = 'fas fa-file-word';
    } else if (conversionType.includes('图片')) {
      icon = 'fas fa-image';
    } else if (conversionType.includes('文本')) {
      icon = 'fas fa-file-alt';
    }
    
    // 生成满意度评分HTML
    let ratingHtml = '';
    const satisfactionRating = record.satisfaction_rating;
    const recordId = record.id;
    
    if (satisfactionRating && typeof satisfactionRating === 'number') {
      // 已有评分，显示星星
      ratingHtml = `
        <div class="rating-display" style="margin-top: 0.5rem;">
          ${generateStarRating(satisfactionRating, true)}
        </div>
      `;
    } else if (recordId) {
      // 无评分，显示评分按钮
      ratingHtml = `
        <div class="rating-section" style="margin-top: 0.5rem;">
          <div class="rating-label" style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-bottom: 0.25rem;">满意度评分:</div>
          <div class="rating-stars" data-record-id="${recordId}">
            ${generateStarRating(0, false)}
          </div>
        </div>
      `;
    }
    
    item.innerHTML = `
      <div class="recent-icon-modern">
        <i class="${icon}"></i>
      </div>
      <div class="recent-info-modern">
        <div class="recent-name-modern">${record.filename || '未知文件'}</div>
        <div class="recent-time-modern">${record.time_ago || record.created_at || ''} · ${record.conversion_type || '未知类型'}</div>
        <div class="recent-details-modern">${record.file_size || ''} · ${record.conversion_time || ''}</div>
        ${ratingHtml}
      </div>
      <div class="recent-status-modern success">
        <i class="fas fa-check"></i>
      </div>
    `;
    
    recentContainer.appendChild(item);
    
    // 为评分星星添加点击事件
    if (!satisfactionRating && recordId) {
      const ratingStars = item.querySelector('.rating-stars');
      if (ratingStars) {
        // 为每个星星单独添加点击事件
        const stars = ratingStars.querySelectorAll('.star');
        stars.forEach(star => {
          star.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const rating = parseInt(this.dataset.rating);
            const recordId = ratingStars.dataset.recordId;

            if (rating && recordId) {
              // 立即更新视觉效果
              updateStarVisual(ratingStars, rating);
              // 提交评分
              submitRating(recordId, rating);
            }
          });
          
          // 添加悬停效果
          star.addEventListener('mouseenter', function() {
            const rating = parseInt(this.dataset.rating);
            updateStarVisual(ratingStars, rating, true);
          });
        });
        
        // 鼠标离开时重置视觉效果
        ratingStars.addEventListener('mouseleave', function() {
          updateStarVisual(ratingStars, 0);
        });
      }
    }
  });
}

// 更新星星视觉效果
function updateStarVisual(ratingContainer, rating, isHover = false) {
  const stars = ratingContainer.querySelectorAll('.star');
  stars.forEach((star, index) => {
    const starRating = index + 1;
    if (starRating <= rating) {
      star.style.color = '#ffd700';
    } else {
      star.style.color = 'rgba(255,255,255,0.3)';
    }
  });
}

// 生成星星评分HTML
function generateStarRating(rating, readonly = false) {
  let stars = '';
  for (let i = 1; i <= 5; i++) {
    const isFilled = i <= rating;
    const starClass = readonly ? 'star-readonly' : 'star';
    const starColor = isFilled ? '#ffd700' : 'rgba(255,255,255,0.3)';
    stars += `<i class="fas fa-star ${starClass}" data-rating="${i}" style="color: ${starColor}; cursor: ${readonly ? 'default' : 'pointer'}; margin-right: 2px; font-size: 0.9rem;"></i>`;
  }
  return stars;
}

// 提交满意度评分
function submitRating(recordId, rating) {

  // 显示加载状态
  showNotification('正在提交评分...', 'info');
  
  fetch('/tools/api/pdf-converter/rating/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify({
      record_id: recordId,
      rating: rating
    })
  })
  .then(response => {

    return response.json();
  })
  .then(data => {

    if (data.success) {
      showNotification(`✨ 评分提交成功！感谢您的反馈`, 'success');
      // 刷新统计数据以更新满意度
      loadConversionStats();
    } else {
      if (data.error === '用户未登录') {
        showNotification(`请先登录后再评分`, 'warning');
      } else {
        showNotification(`评分提交失败: ${data.error}`, 'error');
      }
    }
  })
  .catch(error => {
    console.error('评分提交错误:', error);
    showNotification('评分提交失败，请检查网络连接后重试', 'error');
  });
}

// 获取CSRF Token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// 安全的点击函数
function safeClick(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.click();
  } else {
    console.warn(`Element with id '${elementId}' not found`);
    // 不显示错误通知，避免用户体验问题
    // 尝试重新创建元素
    if (elementId === 'fileInput') {
      const uploadArea = document.getElementById('uploadArea');
      if (uploadArea) {
        // 重新创建fileInput元素
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.id = 'fileInput';
        fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff,.txt';
        fileInput.style.display = 'none';
        fileInput.addEventListener('change', handleFileUpload);
        uploadArea.appendChild(fileInput);
        
        // 现在点击新创建的元素
        fileInput.click();
      }
    } else if (elementId === 'batchFileInput') {
      // 处理batchFileInput的情况
      const uploadArea = document.getElementById('uploadArea');
      if (uploadArea) {
        // 检查是否已经在批量模式
        const existingBatchInput = document.getElementById('batchFileInput');
        if (!existingBatchInput) {
          // 如果不在批量模式，先切换到批量模式
          showBatchUpload();
        } else {
          // 如果已经在批量模式，直接点击
          existingBatchInput.click();
        }
      }
    }
  }
}

// 显示批量上传
function showBatchUpload() {
  const uploadArea = document.getElementById('uploadArea');
  if (!uploadArea) return;
  
  uploadArea.innerHTML = `
    <div class="upload-icon-modern">📦</div>
    <div class="upload-text-modern">批量文件转换</div>
    <div class="upload-hint-modern">支持同时上传多个文件进行批量转换</div>
    <input type="file" id="batchFileInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff" style="display: none;">
    <button class="convert-btn-modern" onclick="safeClick('batchFileInput')" style="margin-top: 1rem;">
      📂 选择多个文件
    </button>
    <div id="batchFileList" class="file-list-modern"></div>
  `;
  
  // 绑定批量文件选择事件
  const batchFileInput = document.getElementById('batchFileInput');
  if (batchFileInput) {
    batchFileInput.addEventListener('change', handleBatchFileUpload);
  }
  
  // 移除uploadArea的onclick事件，避免冲突
  uploadArea.removeAttribute('onclick');
  
  // 为uploadArea添加新的点击事件，直接触发批量文件选择
  const batchClickHandler = function(e) {
    // 如果点击的不是按钮，则触发文件选择
    if (!e.target.closest('button')) {
      safeClick('batchFileInput');
    }
  };
  uploadArea.addEventListener('click', batchClickHandler);
  uploadArea._batchClickHandler = batchClickHandler; // 存储引用以便后续移除
  
  showNotification('已切换到批量上传模式', 'success');
}

// 处理批量文件上传
function handleBatchFileUpload(event) {
  const files = event.target.files;
  const fileList = document.getElementById('batchFileList');
  
  if (files.length === 0) return;
  
  if (files.length > 10) {
    showNotification('一次最多只能转换10个文件', 'error');
    return;
  }
  
  let fileListHtml = '<h4 style="color: #00d4ff; margin-bottom: 1rem;">已选择的文件:</h4>';
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    fileListHtml += `
      <div style="background: rgba(255,255,255,0.05); padding: 0.5rem; margin: 0.5rem 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
        <span>${file.name} (${formatFileSize(file.size)})</span>
        <button onclick="removeBatchFile(${i})" style="background: rgba(255,107,107,0.2); border: none; color: #ff6b6b; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
    `;
  }
  
  fileList.innerHTML = fileListHtml;
  
  // 显示批量转换按钮
  const batchConvertBtn = document.createElement('button');
  batchConvertBtn.className = 'convert-btn-modern';
  batchConvertBtn.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)';
  batchConvertBtn.innerHTML = '<i class="fas fa-cogs"></i><span>开始批量转换</span>';
  batchConvertBtn.onclick = () => performBatchConversion(files);
  
  fileList.appendChild(batchConvertBtn);
  
  showNotification(`已选择 ${files.length} 个文件`, 'success');
}

// 移除批量文件
function removeBatchFile(index) {
  const input = document.getElementById('batchFileInput');
  if (!input) return;
  
  try {
    // 使用DataTransfer API
    const dt = new DataTransfer();
    
    for (let i = 0; i < input.files.length; i++) {
      if (i !== index) {
        dt.items.add(input.files[i]);
      }
    }
    
    input.files = dt.files;
    
    // 重新处理文件列表
    handleBatchFileUpload({ target: { files: input.files } });
    
  } catch (error) {
    console.error('移除文件失败:', error);
    showNotification('移除文件失败，请重新选择文件', 'error');
    
    // 重置文件输入
    input.value = '';
    const fileList = document.getElementById('batchFileList');
    if (fileList) {
      fileList.innerHTML = '';
    }
  }
}

// 执行批量转换
function performBatchConversion(files) {
  document.getElementById('fileUpload').style.display = 'none';
  document.getElementById('conversionProgress').style.display = 'block';
  
  const formData = new FormData();
  formData.append('type', selectedType);
  
  for (let i = 0; i < files.length; i++) {
    formData.append('files', files[i]);
  }
  
  // 显示进度
  simulateProgress();
  
  // 发送批量转换API请求
  fetch('/tools/api/pdf-converter/batch/', {
    method: 'POST',
    body: formData
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    // 检查响应类型，避免解析HTML为JSON
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      return response.json();
    } else {
      throw new Error('服务器返回非JSON响应，会话可能已过期，请重新登录后重试');
    }
  })
  .then(data => {
    if (data.success) {
      showBatchConversionResult(data);
    } else {
      showNotification(data.error || '批量转换失败', 'error');
      document.getElementById('conversionProgress').style.display = 'none';
    }
  })
  .catch(error => {
    console.error('批量转换错误:', error);
    let errorMessage = error.message;
    
    // 提供更友好的错误提示
    if (error.message.includes('Unexpected token')) {
      errorMessage = '会话已过期，请重新登录后重试';
    } else if (error.message.includes('非JSON响应')) {
      errorMessage = '会话已过期，请重新登录后重试';
    }
    
    showNotification('批量转换过程中发生错误: ' + errorMessage, 'error');
    document.getElementById('conversionProgress').style.display = 'none';
  });
}

// 显示批量转换结果
function showBatchConversionResult(data) {
  if (window.progressInterval) {
    clearInterval(window.progressInterval);
  }
  
  document.getElementById('conversionProgress').style.display = 'none';
  
  const resultContent = document.getElementById('resultContent');
  let resultsHtml = '<div style="text-align: left;">';
  let downloadLinks = [];
  
  data.results.forEach((result, index) => {
    if (result.success) {
      const outputFileName = getOutputFileName ? getOutputFileName(result.filename, data.conversion_type) : result.filename;
      resultsHtml += `
        <div style="background: rgba(0,255,0,0.1); border: 1px solid rgba(0,255,0,0.3); padding: 1rem; margin: 0.5rem 0; border-radius: 8px;">
          <div style="color: #00ff00; font-weight: bold;">✅ ${result.filename}</div>
          <div style="color: rgba(0,255,0,0.8); font-size: 0.9rem; margin: 0.5rem 0;">输出文件: ${outputFileName}</div>
          <div style="margin-top: 0.5rem;">
            <a href="${result.download_url}" class="download-btn-modern" download="${outputFileName}" style="font-size: 0.9rem;" data-download-url="${result.download_url}" data-filename="${outputFileName}">
              <i class="fas fa-download"></i> 下载
            </a>
          </div>
        </div>
      `;
      downloadLinks.push({url: result.download_url, filename: outputFileName});
    } else {
      resultsHtml += `
        <div style="background: rgba(255,0,0,0.1); border: 1px solid rgba(255,0,0,0.3); padding: 1rem; margin: 0.5rem 0; border-radius: 8px;">
          <div style="color: #ff0000; font-weight: bold;">❌ ${result.filename}</div>
          <div style="color: rgba(255,0,0,0.8); font-size: 0.9rem;">${result.error}</div>
        </div>
      `;
    }
  });
  
  resultsHtml += '</div>';
  
  resultContent.innerHTML = `
    <div class="result-icon-modern">
      <i class="fas fa-layer-group"></i>
    </div>
    <div class="result-title-modern">✅ 批量转换完成</div>
    <div class="result-description-modern">
      共处理 ${data.summary.total} 个文件，成功转换 ${data.summary.success} 个
    </div>
    ${resultsHtml}
    <div class="result-actions-modern">
      <button class="convert-again-btn-modern" onclick="convertAgain()">
        <i class="fas fa-redo"></i>
        转换其他文件
      </button>
    </div>
  `;
  
  document.getElementById('conversionResult').style.display = 'block';
  showNotification(`批量转换完成！成功 ${data.summary.success}/${data.summary.total}`, 'success');
  
  // 自动下载所有成功转换的文件
  if (downloadLinks.length > 0) {
    setTimeout(() => {
      downloadLinks.forEach((link, index) => {
        setTimeout(() => {
          downloadFile(link.url, link.filename);
          showNotification(`正在下载: ${link.filename}`, 'info');
        }, index * 1000); // 每个文件间隔1秒下载
      });
    }, 2000); // 2秒后开始自动下载
  }
}

// 跳转到转换类型选择
function goToConversionTypes() {
  // 重置所有状态
  selectedType = '';
  selectedFile = null;
  
  // 隐藏所有区域
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  const conversionResult = document.getElementById('conversionResult');
  
  if (fileUpload) fileUpload.style.display = 'none';
  if (conversionProgress) conversionProgress.style.display = 'none';
  if (conversionResult) conversionResult.style.display = 'none';
  
  // 移除选中状态
  document.querySelectorAll('.type-card-modern').forEach(card => {
    card.classList.remove('selected');
  });
  
  // 重置文件输入 - 添加安全检查
  const fileInput = document.getElementById('fileInput');
  if (fileInput) {
    fileInput.value = '';
  }
  
  // 重置文本输入区域
  const textInput = document.getElementById('textInput');
  if (textInput) {
    textInput.value = '';
  }
  
  // 显示转换类型选择
  const conversionTypes = document.querySelector('.conversion-types-modern');
  if (conversionTypes) conversionTypes.style.display = 'grid';
  
  // 重置上传区域显示
  const uploadArea = document.getElementById('uploadArea');
  if (uploadArea) {
    uploadArea.style.display = 'block';
    // 重置上传区域内容
    uploadArea.innerHTML = `
      <div class="upload-icon-modern">
        <i class="fas fa-cloud-upload-alt"></i>
      </div>
      <div class="upload-text-modern">拖拽文件到此处或点击选择文件</div>
      <div class="upload-hint-modern" id="uploadHint">支持多种格式文件</div>
    `;
    // 重新创建fileInput元素并绑定事件
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.id = 'fileInput';
    fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.txt';
    fileInput.style.display = 'none';
    fileInput.addEventListener('change', handleFileUpload);
    uploadArea.appendChild(fileInput);
    
    // 恢复原始的onclick事件
    uploadArea.onclick = function() { safeClick('fileInput'); };
    
    // 移除之前添加的事件监听器
    if (uploadArea._batchClickHandler) {
      uploadArea.removeEventListener('click', uploadArea._batchClickHandler);
      delete uploadArea._batchClickHandler;
    }
  }
  
  // 重置使用提示
  const usageHint = document.getElementById('usageHint');
  if (usageHint) {
    usageHint.style.display = 'block';
    usageHint.innerHTML = `
      <h4 style="margin: 0 0 0.5rem 0; color: #00d4ff;">
        <i class="fas fa-info-circle"></i> 欢迎使用PDF转换器
      </h4>
      <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
        <strong>开始使用：</strong>请先选择上方的转换类型，然后按照提示操作
      </p>
    `;
  }
  
  // 重新加载统计数据
  loadConversionStats();
  
  // 滚动到顶部
  window.scrollTo({ top: 0, behavior: 'smooth' });
  
  // 显示成功通知
  showNotification('已重置转换界面，可以开始新的转换', 'success');
}

// 快捷键支持
document.addEventListener('keydown', function(e) {
  // 只在非输入框中响应快捷键
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
    return;
  }
  
  // Ctrl/Cmd + 数字键切换主题
  if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
    switch(e.key) {
      case '1':
        e.preventDefault();
        window.location.href = '/tools/life_diary/';
        break;
      case '2':
        e.preventDefault();
        window.location.href = '/tools/creative_writer/';
        break;
      case '3':
        e.preventDefault();
        window.location.href = '/tools/fitness/';
        break;
      case '4':
        e.preventDefault();
        window.location.href = '/tools/emo_diary/';
        break;
    }
  }
  
  // Alt + 字母键跳转到工具页面
  if (e.altKey && !e.ctrlKey && !e.metaKey && !e.shiftKey) {
    switch(e.key.toLowerCase()) {
      case 'e':
        e.preventDefault();
        window.location.href = '/tools/emo_diary/';
        break;
      case 'l':
        e.preventDefault();
        window.location.href = '/tools/life_diary/';
        break;
      case 'f':
        e.preventDefault();
        window.location.href = '/tools/fitness/';
        break;
      case 'c':
        e.preventDefault();
        window.location.href = '/tools/creative_writer/';
        break;
      case 'p':
        e.preventDefault();
        window.location.href = '/tools/pdf_converter/';
        break;
      case 'r':
        e.preventDefault();
        window.location.href = '/tools/redbook_generator/';
        break;
      case 't':
        e.preventDefault();
        window.location.href = '/tools/test_case_generator/';
        break;
      case 'w':
        e.preventDefault();
        window.location.href = '/tools/web_crawler/';
        break;
      case 's':
        e.preventDefault();
        window.location.href = '{% url "tools:self_analysis" %}';
        break;
      case 'b':
        e.preventDefault();
        window.location.href = '/tools/storyboard/';
        break;
      case 'm':
        e.preventDefault();
        window.location.href = '/tools/music_healing/';
        break;
      case 'd':
        e.preventDefault();
        window.location.href = '/tools/meditation_guide/';
        break;
      case 'a':
        e.preventDefault();
        window.location.href = '/tools/fortune_analyzer/';
        break;
    }
  }
});

// 初始化快捷键帮助面板
function initShortcutsHelp() {
  const helpBtn = document.getElementById('showShortcutsHelp');
  const helpPanel = document.getElementById('shortcutsHelpPanel');
  const closeBtn = document.getElementById('closeShortcutsHelp');
  const overlay = document.getElementById('helpOverlay');
  
  // 检查元素是否存在
  if (!helpBtn || !helpPanel || !closeBtn || !overlay) {
    console.warn('快捷键帮助面板元素未找到，跳过初始化');
    return;
  }
  
  // 显示帮助面板
  helpBtn.addEventListener('click', function() {
    helpPanel.classList.add('show');
    overlay.classList.add('show');
    document.body.style.overflow = 'hidden'; // 防止背景滚动
  });
  
  // 关闭帮助面板
  function closeHelpPanel() {
    helpPanel.classList.remove('show');
    overlay.classList.remove('show');
    document.body.style.overflow = ''; // 恢复滚动
  }
  
  closeBtn.addEventListener('click', closeHelpPanel);
  overlay.addEventListener('click', closeHelpPanel);
  
  // ESC键关闭帮助面板
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && helpPanel.classList.contains('show')) {
      closeHelpPanel();
    }
  });
}

// 页面加载时初始化
document.addEventListener('DOMContentLoaded', function() {
    // 初始化快捷键帮助面板
    initShortcutsHelp();
    
    // 检查PDF转换器状态
    checkPDFConverterStatus();
});

// 检查PDF转换器状态
function checkPDFConverterStatus() {
    fetch('/tools/api/pdf-converter/status/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const status = data.status;
                const features = data.features || {};

                // 如果pdf2docx不可用，显示警告
                if (features.pdf_to_word === false) {
                    showNotification('PDF转换功能可能受限，请检查系统状态', 'warning');
                }
            }
        })
        .catch(error => {
            console.error('状态检查失败:', error);
        });
}

// 显示系统状态
function showSystemStatus() {
    fetch('/tools/api/pdf-converter/status/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const features = data.features;
                let statusHtml = '<div style="text-align: left; max-width: 500px;">';
                statusHtml += '<h4 style="color: #00d4ff; margin-bottom: 1rem;">系统状态检查</h4>';
                
                // 显示各个组件的状态
                const components = [
                    { key: 'pdf_to_word', name: 'PDF转Word', description: 'PDF转Word转换功能' },
                    { key: 'word_to_pdf', name: 'Word转PDF', description: 'Word转PDF转换功能' },
                    { key: 'pdf_processing', name: 'PDF处理', description: 'PDF文件处理功能' },
                    { key: 'word_processing', name: 'Word处理', description: 'Word文档处理功能' },
                    { key: 'image_processing', name: '图片处理', description: '图片处理功能' }
                ];
                
                // 安全检查features对象
                if (!features || typeof features !== 'object') {
                    features = {};
                }
                
                components.forEach(comp => {
                    const isAvailable = features[comp.key] || false;
                    statusHtml += `
                        <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span style="color: ${isAvailable ? '#00ff00' : '#ff0000'}; font-weight: bold;">
                                        ${isAvailable ? '✅' : '❌'}
                                    </span>
                                    <span style="color: white; margin-left: 0.5rem;">${comp.name}</span>
                                </div>
                                <span style="color: ${isAvailable ? '#00ff00' : '#ff0000'}; font-size: 0.8rem;">
                                    ${isAvailable ? '正常' : '不可用'}
                                </span>
                            </div>
                            <div style="color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-top: 0.25rem;">
                                ${comp.description}
                            </div>
                        </div>
                    `;
                });
                
                // 显示系统信息
                statusHtml += `
                    <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(0,212,255,0.1); border-radius: 8px;">
                        <div style="color: #00d4ff; font-weight: bold; margin-bottom: 0.5rem;">系统信息</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.8rem;">
                            <div>Python版本: ${features.python_version || '未知'}</div>
                            <div>服务器时间: ${features.server_time ? new Date(features.server_time).toLocaleString() : '未知'}</div>
                        </div>
                    </div>
                `;
                
                // 显示支持的文件格式
                if (features.supported_formats) {
                    statusHtml += `
                        <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(0,212,255,0.1); border-radius: 8px;">
                            <div style="color: #00d4ff; font-weight: bold; margin-bottom: 0.5rem;">支持的文件格式</div>
                            <div style="color: rgba(255,255,255,0.8); font-size: 0.8rem;">
                                ${Object.entries(features.supported_formats).map(([type, formats]) => 
                                    `<div><strong>${type}:</strong> ${formats.join(', ')}</div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                statusHtml += '</div>';
                
                // 显示状态对话框
                showStatusDialog(statusHtml);
            } else {
                showNotification('无法获取系统状态', 'error');
            }
        })
        .catch(error => {
            console.error('状态检查失败:', error);
            showNotification('系统状态检查失败', 'error');
        });
}

// 显示状态对话框
function showStatusDialog(content) {
    // 创建对话框
    const dialog = document.createElement('div');
    dialog.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 10000;
        display: flex; justify-content: center; align-items: center;
    `;
    
    const dialogContent = document.createElement('div');
    dialogContent.style.cssText = `
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        border-radius: 12px; padding: 2rem; max-width: 600px; max-height: 80vh;
        overflow-y: auto; position: relative;
    `;
    
    dialogContent.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="color: #00d4ff; margin: 0;">系统状态</h3>
            <button onclick="this.closest('.status-dialog').remove()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">×</button>
        </div>
        ${content}
        <div style="margin-top: 1.5rem; text-align: center;">
            <button onclick="this.closest('.status-dialog').remove()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                关闭
            </button>
        </div>
    `;
    
    dialog.className = 'status-dialog';
    dialog.appendChild(dialogContent);
    document.body.appendChild(dialog);
    
    // 点击背景关闭
    dialog.addEventListener('click', function(e) {
        if (e.target === dialog) {
            dialog.remove();
        }
    });
}

// 可靠的下载函数
function downloadFile(url, filename) {

    if (!url) {
        console.error('下载URL为空');
        showNotification('下载链接无效', 'error');
        return;
    }
    
    // 确保URL是完整的
    if (!url.startsWith('http')) {
        url = window.location.origin + url;
    }

    // 方法1: 使用fetch下载
    fetch(url, {
        method: 'GET',
        headers: {
            'Accept': '*/*',
        },
        credentials: 'same-origin'
    })
    .then(response => {


        if (response.ok) {
            return response.blob();
        }
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    })
    .then(blob => {

        if (blob.size === 0) {
            throw new Error('下载的文件大小为0');
        }
        
        // 创建下载链接
        const downloadUrl = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = downloadUrl;
        link.download = filename;
        link.style.display = 'none';
        document.body.appendChild(link);
        
        // 触发下载
        link.click();
        
        // 清理
        document.body.removeChild(link);
        window.URL.revokeObjectURL(downloadUrl);

        showNotification(`文件 "${filename}" 下载成功`, 'success');
    })
    .catch(error => {
        console.error(`下载失败: ${error.message}`);
        
        // 方法2: 备用下载方法 - 直接链接

        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.target = '_blank';
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showNotification(`使用备用方法下载: ${filename}`, 'info');
        
        // 方法3: 如果还是失败，提示用户手动下载
        setTimeout(() => {
            showNotification(`如果下载失败，请右键点击链接选择"另存为"`, 'warning');
        }, 2000);
    });
}

// 增强的批量下载函数
function downloadMultipleFiles(downloadLinks) {
    if (!downloadLinks || downloadLinks.length === 0) {

        return;
    }

    downloadLinks.forEach((link, index) => {
        setTimeout(() => {

            downloadFile(link.url, link.filename);
            showNotification(`正在下载: ${link.filename}`, 'info');
        }, index * 1500); // 每个文件间隔1.5秒下载
    });
}
</script>
{% endblock %} 