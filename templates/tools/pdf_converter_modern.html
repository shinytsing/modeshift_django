{% extends 'base.html' %}
{% load static %}

{% block tool_title_inner %}ğŸš€ PDFè½¬æ¢å¼•æ“{% endblock %}
{% block tool_title_display %}ğŸš€ PDFè½¬æ¢å¼•æ“{% endblock %}

{% block extra_css %}
<!-- å¼ºåˆ¶åˆ·æ–°ç¼“å­˜ -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<style>
/* PDFè½¬æ¢å™¨ä¸“ç”¨æ ·å¼ - æ”¯æŒä¸»é¢˜åˆ‡æ¢ */
.pdf-converter-modern {
  min-height: 100vh;
  color: var(--text-color, #ffffff);
  font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'Inter', 'SF Pro Display', -apple-system, sans-serif;
  transition: all 0.3s ease;
  /* æ·»åŠ æœ‰è¶£çš„èƒŒæ™¯çº¹ç† */
  background-image: 
    radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
}

/* æå®¢ä¸»é¢˜æ ·å¼ */
.work-theme .pdf-converter-modern {
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
  color: #00ff41;
}

/* ç”Ÿæ´»ä¸»é¢˜æ ·å¼ */
.life-theme .pdf-converter-modern {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #48dbfb 100%);
  color: #2c3e50;
}

/* ç‹‚æš´ä¸»é¢˜æ ·å¼ */
.training-theme .pdf-converter-modern {
  background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 50%, #ff3838 100%);
  color: #ffffff;
}

/* Emoä¸»é¢˜æ ·å¼ */
.emo-theme .pdf-converter-modern {
  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 50%, #6c5ce7 100%);
  color: #ffffff;
}

.converter-header-modern {
  text-align: center;
  padding: 4rem 0 2rem;
  position: relative;
}

.converter-header-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 4px;
  background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
  border-radius: 2px;
}

.converter-title-modern {
  font-size: 4rem;
  font-weight: 900;
  margin-bottom: 1rem;
  letter-spacing: -0.03em;
  transition: all 0.3s ease;
  text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
  position: relative;
  /* æ·»åŠ æ‰“å­—æœºæ•ˆæœ */
  overflow: hidden;
  white-space: nowrap;
  border-right: 3px solid;
  animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
}

@keyframes typing {
  from { width: 0; }
  to { width: 100%; }
}

@keyframes blink-caret {
  from, to { border-color: transparent; }
  50% { border-color: #00d4ff; }
}

/* æå®¢ä¸»é¢˜ */
.work-theme .converter-title-modern {
  background: linear-gradient(135deg, #00ff41 0%, #00cc33 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .converter-title-modern {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .converter-title-modern {
  background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Emoä¸»é¢˜ */
.emo-theme .converter-title-modern {
  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.converter-subtitle-modern {
  font-size: 1.3rem;
  margin-bottom: 2rem;
  font-weight: 500;
  letter-spacing: 0.02em;
  /* æ·»åŠ éœ“è™¹ç¯æ•ˆæœ */
  text-shadow: 
    0 0 5px rgba(0, 212, 255, 0.8),
    0 0 10px rgba(0, 212, 255, 0.6),
    0 0 15px rgba(0, 212, 255, 0.4);
  animation: neon-pulse 2s ease-in-out infinite alternate;
}

@keyframes neon-pulse {
  from {
    text-shadow: 
      0 0 5px rgba(0, 212, 255, 0.8),
      0 0 10px rgba(0, 212, 255, 0.6),
      0 0 15px rgba(0, 212, 255, 0.4);
  }
  to {
    text-shadow: 
      0 0 10px rgba(0, 212, 255, 1),
      0 0 20px rgba(0, 212, 255, 0.8),
      0 0 30px rgba(0, 212, 255, 0.6);
  }
}

/* å¿«æ·é”®å¸®åŠ©æŒ‰é’®æ ·å¼ */
.shortcuts-help-btn {
  position: absolute;
  top: 2rem;
  right: 2rem;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 0.75rem 1rem;
  color: #ffffff;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  display: none !important; /* å¼ºåˆ¶éšè—å¿«æ·é”®å¸®åŠ©æŒ‰é’® */
  align-items: center;
  gap: 0.5rem;
}

.shortcuts-help-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

.shortcuts-help-btn i {
  font-size: 1rem;
}

.converter-subtitle-modern {
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.6;
  transition: all 0.3s ease;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .converter-subtitle-modern {
  color: rgba(0, 255, 65, 0.7);
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .converter-subtitle-modern {
  color: rgba(44, 62, 80, 0.8);
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .converter-subtitle-modern {
  color: rgba(255, 255, 255, 0.7);
}

/* Emoä¸»é¢˜ */
.emo-theme .converter-subtitle-modern {
  color: rgba(255, 255, 255, 0.7);
}

.conversion-types-modern {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 3.5rem;
  margin: 3rem auto;
  max-width: 1400px;
  padding: 0 2rem;
}

.type-card-modern {
  border-radius: 24px;
  padding: 2.5rem 2rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(20px);
  position: relative;
  overflow: hidden;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .type-card-modern {
  background: linear-gradient(135deg, rgba(0, 255, 65, 0.1) 0%, rgba(0, 255, 65, 0.05) 100%);
  border: 1px solid rgba(0, 255, 65, 0.2);
  color: #00ff41;
}

.work-theme .type-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.1), transparent);
  transition: left 0.8s ease;
}

.work-theme .type-card-modern:hover {
  border-color: #00ff41;
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(0, 255, 65, 0.2);
}

.work-theme .type-card-modern.selected {
  border-color: #00ff41;
  background: rgba(0, 255, 65, 0.1);
  box-shadow: 0 16px 48px rgba(0, 255, 65, 0.3);
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .type-card-modern {
  background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(254, 202, 87, 0.05) 100%);
  border: 1px solid rgba(255, 107, 107, 0.2);
  color: #2c3e50;
}

.life-theme .type-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
  transition: left 0.8s ease;
}

.life-theme .type-card-modern:hover {
  border-color: #ff6b6b;
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(255, 107, 107, 0.2);
}

.life-theme .type-card-modern.selected {
  border-color: #ff6b6b;
  background: rgba(255, 107, 107, 0.1);
  box-shadow: 0 16px 48px rgba(255, 107, 107, 0.3);
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .type-card-modern {
  background: linear-gradient(135deg, rgba(255, 56, 56, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
  border: 1px solid rgba(255, 56, 56, 0.2);
  color: #ffffff;
}

.training-theme .type-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 56, 56, 0.1), transparent);
  transition: left 0.8s ease;
}

.training-theme .type-card-modern:hover {
  border-color: #ff3838;
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(255, 56, 56, 0.2);
}

.training-theme .type-card-modern.selected {
  border-color: #ff3838;
  background: rgba(255, 56, 56, 0.1);
  box-shadow: 0 16px 48px rgba(255, 56, 56, 0.3);
}

/* Emoä¸»é¢˜ */
.emo-theme .type-card-modern {
  background: linear-gradient(135deg, rgba(108, 92, 231, 0.1) 0%, rgba(162, 155, 254, 0.05) 100%);
  border: 1px solid rgba(108, 92, 231, 0.2);
  color: #ffffff;
}

.emo-theme .type-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(108, 92, 231, 0.1), transparent);
  transition: left 0.8s ease;
}

.emo-theme .type-card-modern:hover {
  border-color: #6c5ce7;
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(108, 92, 231, 0.2);
}

.emo-theme .type-card-modern.selected {
  border-color: #6c5ce7;
  background: rgba(108, 92, 231, 0.1);
  box-shadow: 0 16px 48px rgba(108, 92, 231, 0.3);
}

.type-card-modern:hover::before {
  left: 100%;
}

.type-card-modern .card-icon {
  font-size: 3rem;
  margin-bottom: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  transition: all 0.3s ease;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .type-card-modern .card-icon {
  background: linear-gradient(135deg, #00ff41 0%, #00cc33 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .type-card-modern .card-icon {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .type-card-modern .card-icon {
  background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Emoä¸»é¢˜ */
.emo-theme .type-card-modern .card-icon {
  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.type-card-modern h4 {
  font-size: 1.8rem;
  font-weight: 800;
  margin-bottom: 1rem;
  transition: all 0.3s ease;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  letter-spacing: 0.05em;
  position: relative;
  /* æ·»åŠ 3Dæ–‡å­—æ•ˆæœ */
  text-shadow: 
    0 1px 0 #ccc,
    0 2px 0 #c9c9c9,
    0 3px 0 #bbb,
    0 4px 0 #b9b9b9,
    0 5px 0 #aaa,
    0 6px 1px rgba(0,0,0,.1),
    0 0 5px rgba(0,0,0,.1),
    0 1px 3px rgba(0,0,0,.3),
    0 3px 5px rgba(0,0,0,.2),
    0 5px 10px rgba(0,0,0,.25),
    0 10px 10px rgba(0,0,0,.2),
    0 20px 20px rgba(0,0,0,.15);
  transform: perspective(500px) rotateX(15deg);
}

/* æå®¢ä¸»é¢˜ */
.work-theme .type-card-modern h4 {
  color: #00ff41;
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .type-card-modern h4 {
  color: #2c3e50;
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .type-card-modern h4 {
  color: #ffffff;
}

/* Emoä¸»é¢˜ */
.emo-theme .type-card-modern h4 {
  color: #ffffff;
}

.type-card-modern p {
  margin-bottom: 1.5rem;
  line-height: 1.6;
  transition: all 0.3s ease;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .type-card-modern p {
  color: rgba(0, 255, 65, 0.7);
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .type-card-modern p {
  color: rgba(44, 62, 80, 0.8);
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .type-card-modern p {
  color: rgba(255, 255, 255, 0.7);
}

/* Emoä¸»é¢˜ */
.emo-theme .type-card-modern p {
  color: rgba(255, 255, 255, 0.7);
}

.feature-tags-modern {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.feature-tag-modern {
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 500;
  transition: all 0.3s ease;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .feature-tag-modern {
  background: rgba(0, 255, 65, 0.1);
  color: #00ff41;
  border: 1px solid rgba(0, 255, 65, 0.2);
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .feature-tag-modern {
  background: rgba(255, 107, 107, 0.1);
  color: #ff6b6b;
  border: 1px solid rgba(255, 107, 107, 0.2);
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .feature-tag-modern {
  background: rgba(255, 56, 56, 0.1);
  color: #ff3838;
  border: 1px solid rgba(255, 56, 56, 0.2);
}

/* Emoä¸»é¢˜ */
.emo-theme .feature-tag-modern {
  background: rgba(108, 92, 231, 0.1);
  color: #6c5ce7;
  border: 1px solid rgba(108, 92, 231, 0.2);
}

.upload-section-modern {
  border-radius: 24px;
  padding: 3rem;
  margin: 3rem 0;
  backdrop-filter: blur(20px);
  text-align: center;
  transition: all 0.3s ease;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .upload-section-modern {
  background: linear-gradient(135deg, rgba(0, 255, 65, 0.1) 0%, rgba(0, 255, 65, 0.05) 100%);
  border: 1px solid rgba(0, 255, 65, 0.2);
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .upload-section-modern {
  background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(254, 202, 87, 0.05) 100%);
  border: 1px solid rgba(255, 107, 107, 0.2);
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .upload-section-modern {
  background: linear-gradient(135deg, rgba(255, 56, 56, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
  border: 1px solid rgba(255, 56, 56, 0.2);
}

/* Emoä¸»é¢˜ */
.emo-theme .upload-section-modern {
  background: linear-gradient(135deg, rgba(108, 92, 231, 0.1) 0%, rgba(162, 155, 254, 0.05) 100%);
  border: 1px solid rgba(108, 92, 231, 0.2);
}

.upload-area-modern {
  border: 2px dashed;
  border-radius: 20px;
  padding: 4rem 2rem;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .upload-area-modern {
  border-color: rgba(0, 255, 65, 0.2);
}

.work-theme .upload-area-modern:hover {
  border-color: #00ff41;
  background: rgba(0, 255, 65, 0.05);
}

.work-theme .upload-area-modern.dragover {
  border-color: #00ff41;
  background: rgba(0, 255, 65, 0.1);
  transform: scale(1.02);
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .upload-area-modern {
  border-color: rgba(255, 107, 107, 0.2);
}

.life-theme .upload-area-modern:hover {
  border-color: #ff6b6b;
  background: rgba(255, 107, 107, 0.05);
}

.life-theme .upload-area-modern.dragover {
  border-color: #ff6b6b;
  background: rgba(255, 107, 107, 0.1);
  transform: scale(1.02);
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .upload-area-modern {
  border-color: rgba(255, 56, 56, 0.2);
}

.training-theme .upload-area-modern:hover {
  border-color: #ff3838;
  background: rgba(255, 56, 56, 0.05);
}

.training-theme .upload-area-modern.dragover {
  border-color: #ff3838;
  background: rgba(255, 56, 56, 0.1);
  transform: scale(1.02);
}

/* Emoä¸»é¢˜ */
.emo-theme .upload-area-modern {
  border-color: rgba(108, 92, 231, 0.2);
}

.emo-theme .upload-area-modern:hover {
  border-color: #6c5ce7;
  background: rgba(108, 92, 231, 0.05);
}

.emo-theme .upload-area-modern.dragover {
  border-color: #6c5ce7;
  background: rgba(108, 92, 231, 0.1);
  transform: scale(1.02);
}

.upload-icon-modern {
  font-size: 4rem;
  margin-bottom: 1.5rem;
  transition: all 0.3s ease;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .upload-icon-modern {
  color: #00ff41;
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .upload-icon-modern {
  color: #ff6b6b;
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .upload-icon-modern {
  color: #ff3838;
}

/* Emoä¸»é¢˜ */
.emo-theme .upload-icon-modern {
  color: #6c5ce7;
}

.upload-text-modern {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 1.3rem;
  margin-bottom: 0.5rem;
  font-weight: 700;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

/* æå®¢ä¸»é¢˜ */
.work-theme .upload-text-modern {
  color: #00ff41;
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .upload-text-modern {
  color: #2c3e50;
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .upload-text-modern {
  color: #ffffff;
}

/* Emoä¸»é¢˜ */
.emo-theme .upload-text-modern {
  color: #ffffff;
}

.upload-hint-modern {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  line-height: 1.4;
}

/* æå®¢ä¸»é¢˜ */
.work-theme .upload-hint-modern {
  color: rgba(0, 255, 65, 0.7);
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .upload-hint-modern {
  color: rgba(44, 62, 80, 0.8);
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .upload-hint-modern {
  color: rgba(255, 255, 255, 0.7);
}

/* Emoä¸»é¢˜ */
.emo-theme .upload-hint-modern {
  color: rgba(255, 255, 255, 0.7);
}

.file-info-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 1.5rem;
  margin: 1.5rem 0;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.file-icon-modern {
  font-size: 2rem;
  color: #00d4ff;
}

.file-details-modern {
  flex: 1;
}

.file-name-modern {
  color: #ffffff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.25rem;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.file-size-modern {
  color: rgba(255, 255, 255, 0.7);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 0.9rem;
  font-weight: 500;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.remove-file-modern {
  background: rgba(255, 107, 107, 0.1);
  color: #ff6b6b;
  border: 1px solid rgba(255, 107, 107, 0.2);
  border-radius: 12px;
  padding: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.remove-file-modern:hover {
  background: rgba(255, 107, 107, 0.2);
  transform: scale(1.1);
}

.convert-btn-modern {
  color: white;
  border: none;
  border-radius: 16px;
  padding: 1rem 2.5rem;
  font-size: 1.2rem;
  font-weight: 700;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  margin-top: 2rem;
  margin-bottom: 1rem;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  position: relative;
  overflow: hidden;
  /* æ·»åŠ å‘å…‰æ•ˆæœ */
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
}

/* æå®¢ä¸»é¢˜ */
.work-theme .convert-btn-modern {
  background: linear-gradient(135deg, #00ff41 0%, #00cc33 100%);
  box-shadow: 0 8px 24px rgba(0, 255, 65, 0.3);
}

.work-theme .convert-btn-modern:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 16px 40px rgba(0, 255, 65, 0.5);
}

/* ç”Ÿæ´»ä¸»é¢˜ */
.life-theme .convert-btn-modern {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  box-shadow: 0 8px 24px rgba(255, 107, 107, 0.3);
}

.life-theme .convert-btn-modern:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 16px 40px rgba(255, 107, 107, 0.5);
}

/* ç‹‚æš´ä¸»é¢˜ */
.training-theme .convert-btn-modern {
  background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 100%);
  box-shadow: 0 8px 24px rgba(255, 56, 56, 0.3);
}

.training-theme .convert-btn-modern:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 16px 40px rgba(255, 56, 56, 0.5);
}

/* Emoä¸»é¢˜ */
.emo-theme .convert-btn-modern {
  background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
  box-shadow: 0 8px 24px rgba(108, 92, 231, 0.3);
}

.emo-theme .convert-btn-modern:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 16px 40px rgba(108, 92, 231, 0.5);
}

.convert-btn-modern:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.progress-section-modern {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 24px;
  padding: 3rem;
  margin: 3rem 0;
  backdrop-filter: blur(20px);
  text-align: center;
}

.progress-bar-modern {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  height: 8px;
  margin: 2rem 0;
  overflow: hidden;
  position: relative;
}

.progress-fill-modern {
  background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
  height: 100%;
  border-radius: 12px;
  transition: width 0.3s ease;
  position: relative;
}

.progress-fill-modern::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  animation: progressShine 2s infinite;
}

@keyframes progressShine {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.progress-text-modern {
  color: #ffffff;
  font-weight: 600;
  margin-bottom: 1rem;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 1.1rem;
  letter-spacing: 0.02em;
  /* æ·»åŠ æ‰“å­—æœºæ•ˆæœ */
  animation: blink 1.5s infinite;
  position: relative;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0.7; }
}

.progress-text-modern::after {
  content: '|';
  animation: cursor-blink 1s infinite;
  margin-left: 2px;
}

@keyframes cursor-blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

.result-section-modern {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 24px;
  padding: 3rem;
  margin: 3rem 0;
  backdrop-filter: blur(20px);
}

.result-item-modern {
  text-align: center;
  padding: 2rem;
}

.result-icon-modern {
  font-size: 4rem;
  color: #4ecdc4;
  margin-bottom: 1.5rem;
}

.result-title-modern {
  color: #ffffff;
  font-size: 1.8rem;
  font-weight: 800;
  margin-bottom: 1rem;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  letter-spacing: 0.05em;
  /* æ·»åŠ å½©è™¹æ–‡å­—æ•ˆæœ */
  background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff);
  background-size: 400% 400%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: rainbow 3s ease-in-out infinite;
}

@keyframes rainbow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.result-description-modern {
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 2rem;
  line-height: 1.6;
}

.result-actions-modern {
  display: flex;
  justify-content: center;  /* Centers buttons horizontally */
  gap: 1rem;  /* Adds space between buttons */
  align-items: center;  /* Vertically aligns buttons */
  margin-top: 2rem;
  min-height: 60px; /* ç¡®ä¿å®¹å™¨æœ‰è¶³å¤Ÿé«˜åº¦ */
  flex-wrap: wrap; /* å…è®¸æŒ‰é’®æ¢è¡Œ */
  flex-direction: row; /* ç¡®ä¿æ°´å¹³æ’åˆ— */
  width: 100%; /* ç¡®ä¿å®¹å™¨å æ»¡å®½åº¦ */
}

.download-btn-modern {
  background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
  color: white;
  border: none;
  border-radius: 16px;
  padding: 1rem 2rem;
  font-weight: 700;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  text-decoration: none;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  position: relative;
  overflow: hidden;
  min-height: 48px;
  min-width: 160px;
  height: 48px; /* å›ºå®šé«˜åº¦ç¡®ä¿å¯¹é½ */
  line-height: 1; /* ç¡®ä¿æ–‡å­—å‚ç›´å±…ä¸­ */
  box-sizing: border-box; /* ç¡®ä¿paddingå’Œborderä¸å½±å“æ€»é«˜åº¦ */
  /* æ·»åŠ è„‰å†²æ•ˆæœ */
  animation: pulse 2s infinite;
  margin: 0; /* ç¡®ä¿æ²¡æœ‰é¢å¤–è¾¹è· */
  flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */
}

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(0, 212, 255, 0); }
  100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0); }
}

.download-btn-modern:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(0, 212, 255, 0.4);
  color: white;
  text-decoration: none;
}

.convert-again-btn-modern {
  background: transparent;
  color: #00d4ff;
  border: 2px solid #00d4ff;
  border-radius: 16px;
  padding: 1rem 2rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  min-height: 48px;
  min-width: 160px;
  height: 48px; /* å›ºå®šé«˜åº¦ç¡®ä¿å¯¹é½ */
  line-height: 1; /* ç¡®ä¿æ–‡å­—å‚ç›´å±…ä¸­ */
  box-sizing: border-box; /* ç¡®ä¿paddingå’Œborderä¸å½±å“æ€»é«˜åº¦ */
  margin: 0; /* ç¡®ä¿æ²¡æœ‰é¢å¤–è¾¹è· */
  flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */
}

.convert-again-btn-modern:hover {
  background: #00d4ff;
  color: white;
  transform: translateY(-2px);
}

.image-gallery-modern {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin: 2rem 0;
}

.image-item-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 1rem;
  text-align: center;
}

.image-item-modern img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin-bottom: 0.5rem;
}

.image-item-modern .page-info {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
}

/* åŠŸèƒ½ç‰¹è‰²åŒºåŸŸæ ·å¼ */
.features-section-modern {
  margin: 4rem 0;
  padding: 3rem 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.features-title-modern {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 3rem;
  color: #00d4ff;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
}

.features-grid-modern {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
  margin-top: 2rem;
}

.feature-card-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.feature-card-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
  transition: left 0.8s ease;
}

.feature-card-modern:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 60px rgba(0, 212, 255, 0.2);
  border-color: #00d4ff;
}

.feature-card-modern:hover::before {
  left: 100%;
}

.feature-icon-modern {
  font-size: 3rem;
  color: #00d4ff;
  margin-bottom: 1.5rem;
  transition: all 0.3s ease;
}

.feature-card-modern:hover .feature-icon-modern {
  transform: scale(1.1);
}

.feature-card-modern h4 {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  color: #ffffff;
}

.feature-card-modern p {
  color: rgba(255, 255, 255, 0.7);
  line-height: 1.6;
  font-size: 1rem;
}

/* ç»Ÿè®¡åŒºåŸŸæ ·å¼ */
.stats-section-modern {
  margin: 4rem 0;
  padding: 3rem 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.stats-title-modern {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 3rem;
  color: #00d4ff;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
}

.stats-grid-modern {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem;
  margin-top: 2rem;
}

.stat-card-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
}

.stat-card-modern:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 45px rgba(0, 212, 255, 0.2);
  border-color: #00d4ff;
}

.stat-number-modern {
  font-size: 2.5rem;
  font-weight: 800;
  color: #00d4ff;
  margin-bottom: 0.5rem;
  text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
}

.stat-label-modern {
  color: rgba(255, 255, 255, 0.7);
  font-size: 1rem;
  font-weight: 500;
}

/* æœ€è¿‘è½¬æ¢è®°å½•æ ·å¼ */
.recent-conversions-modern {
  margin: 4rem 0;
  padding: 3rem 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.recent-title-modern {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 3rem;
  color: #00d4ff;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
}

.recent-list-modern {
  max-width: 600px;
  margin: 0 auto;
}

.recent-item-modern {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  transition: all 0.3s ease;
}

.recent-item-modern:hover {
  transform: translateX(10px);
  box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
  border-color: #00d4ff;
}

.recent-icon-modern {
  font-size: 1.5rem;
  color: #00d4ff;
  width: 40px;
  text-align: center;
}

.recent-info-modern {
  flex: 1;
}

.recent-name-modern {
  font-size: 1.1rem;
  font-weight: 600;
  color: #ffffff;
  margin-bottom: 0.25rem;
}

.recent-time-modern {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.6);
}

.recent-details-modern {
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.4);
  margin-top: 0.1rem;
  font-style: italic;
}

.recent-status-modern {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
}

.recent-status-modern.success {
  background: rgba(0, 255, 0, 0.2);
  color: #00ff00;
  border: 1px solid rgba(0, 255, 0, 0.3);
}

.recent-status-modern.error {
  background: rgba(255, 0, 0, 0.2);
  color: #ff0000;
  border: 1px solid rgba(255, 0, 0, 0.3);
}

/* ç©ºçŠ¶æ€å¯ç‚¹å‡»æ ·å¼ */
.recent-item-modern[onclick] {
  cursor: pointer;
  border-color: rgba(0, 212, 255, 0.3);
}

/* è¯„åˆ†æ˜Ÿæ˜Ÿæ ·å¼ */
.rating-stars {
  display: inline-flex;
  align-items: center;
}

.rating-stars .star {
  transition: all 0.2s ease;
  cursor: pointer;
  padding: 2px;
  margin: 0 1px;
  border-radius: 2px;
  display: inline-block;
  min-width: 16px;
  text-align: center;
}

.rating-stars .star:hover {
  transform: scale(1.2);
  color: #ffd700 !important;
  text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
}

.rating-stars .star:active {
  transform: scale(0.95);
}

.rating-stars .star-readonly {
  cursor: default;
  padding: 0;
}

.rating-stars .star-readonly:hover {
  transform: none;
  text-shadow: none;
}

.rating-display {
  display: inline-flex;
  align-items: center;
}

.rating-section {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.rating-label {
  font-size: 0.8rem;
  color: rgba(255,255,255,0.7);
  margin-bottom: 0.25rem;
}

.recent-item-modern[onclick]:hover {
  background: rgba(0, 212, 255, 0.1);
  border-color: #00d4ff;
  transform: translateX(10px);
  box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
}

/* é€šçŸ¥æ ·å¼ */
.notification-modern {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  padding: 1rem 1.5rem;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0, 212, 255, 0.2);
  display: flex;
  align-items: center;
  gap: 0.75rem;
  z-index: 10000;
  transform: translateX(400px);
  transition: all 0.3s ease;
  max-width: 350px;
}

.notification-modern.show {
  transform: translateX(0);
}

.notification-modern.success {
  border-color: rgba(0, 255, 0, 0.3);
  color: #00aa00;
}

.notification-modern.error {
  border-color: rgba(255, 0, 0, 0.3);
  color: #ff0000;
}

.notification-modern.info {
  border-color: rgba(0, 212, 255, 0.3);
  color: #00d4ff;
}

.notification-modern i {
  font-size: 1.2rem;
}

.notification-modern span {
  font-weight: 500;
  font-size: 0.95rem;
}

/* ç±»å‹åˆ‡æ¢å¯¹è¯æ¡†æ ·å¼ */
.type-switch-dialog {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10001;
  opacity: 0;
  transition: opacity 0.3s ease;
  backdrop-filter: blur(10px);
}

.type-switch-dialog.show {
  opacity: 1;
}

.type-switch-content {
  background: var(--bg-color, #1a1a1a);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 0;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  transform: scale(0.9);
  transition: transform 0.3s ease;
}

.type-switch-dialog.show .type-switch-content {
  transform: scale(1);
}

.type-switch-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(255, 255, 255, 0.05);
  border-radius: 16px 16px 0 0;
}

.type-switch-header h3 {
  margin: 0;
  color: var(--text-color, #ffffff);
  font-size: 1.3rem;
  font-weight: 600;
}

.type-switch-header i {
  color: #ff6b6b;
  margin-right: 0.5rem;
  font-size: 1.2rem;
}

.close-btn {
  background: none;
  border: none;
  color: var(--text-color, #ffffff);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

.type-switch-body {
  padding: 1.5rem;
}

.error-message {
  color: #ff6b6b;
  margin-bottom: 1.5rem;
  line-height: 1.6;
  white-space: pre-line;
  background: rgba(255, 107, 107, 0.1);
  padding: 1rem;
  border-radius: 8px;
  border-left: 4px solid #ff6b6b;
}

.suggested-types h4 {
  color: var(--text-color, #ffffff);
  margin-bottom: 1rem;
  font-size: 1.1rem;
}

.type-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.type-btn {
  background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
  border: none;
  color: white;
  padding: 1rem;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  font-weight: 500;
  box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
}

.type-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
}

.type-btn i {
  font-size: 1.2rem;
}

.type-switch-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.cancel-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: var(--text-color, #ffffff);
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.cancel-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

.upload-new-btn {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  border: none;
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
}

.upload-new-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}

/* æ‹–æ‹½ä¸Šä¼ æ ·å¼ */
.upload-area-modern.dragover {
  border-color: #00d4ff;
  background: rgba(0, 212, 255, 0.1);
  transform: scale(1.02);
}

/* è½¬æ¢ç»“æœæ ·å¼ */
.result-header-modern {
  text-align: center;
  margin-bottom: 2rem;
}

.result-header-modern i {
  font-size: 4rem;
  color: #00ff00;
  margin-bottom: 1rem;
}

.result-header-modern h3 {
  font-size: 2rem;
  color: #ffffff;
  margin: 0;
}

.result-info-modern {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.result-info-modern p {
  margin: 0.5rem 0;
  color: rgba(255, 255, 255, 0.8);
  font-size: 1rem;
}

/* é‡å¤çš„CSSå·²åˆ é™¤ï¼Œä½¿ç”¨ä¸Šé¢çš„å®šä¹‰ */



/* å¿«æ·é”®æç¤ºæ ·å¼ */
.theme-switch-hint {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background: rgba(255,255,255,0.95);
  padding: 12px 16px;
  border-radius: 8px;
  border: 1px solid rgba(102, 126, 234, 0.3);
  backdrop-filter: blur(10px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.theme-switch-hint:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.hint-content {
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: 'Arial', sans-serif;
  font-size: 0.9rem;
  color: #667eea;
  font-weight: 600;
}

.hint-content i {
  font-size: 1rem;
  color: #764ba2;
}

.hint-content span {
  white-space: nowrap;
}

.help-btn {
  background: rgba(102, 126, 234, 0.1);
  border: 1px solid rgba(102, 126, 234, 0.3);
  color: #667eea;
  border-radius: 4px;
  padding: 4px 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-left: 8px;
}

.help-btn:hover {
  background: rgba(102, 126, 234, 0.2);
  transform: scale(1.1);
}

/* å¿«æ·é”®å¸®åŠ©é¢æ¿æ ·å¼ */
.shortcuts-help-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: rgba(255,255,255,0.98);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(102, 126, 234, 0.2);
  z-index: 10000;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow: hidden;
  opacity: 0;
  visibility: hidden;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.shortcuts-help-panel.show {
  opacity: 1;
  visibility: visible;
  transform: translate(-50%, -50%) scale(1);
}

.help-panel-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-radius: 16px 16px 0 0;
}

.help-panel-header h3 {
  margin: 0;
  font-size: 1.2rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 10px;
}

.close-help-btn {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.close-help-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.1);
}

.help-panel-content {
  padding: 20px;
  max-height: 60vh;
  overflow-y: auto;
}

.shortcuts-section {
  margin-bottom: 25px;
}

.shortcuts-section h4 {
  color: #667eea;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 2px solid rgba(102, 126, 234, 0.2);
  padding-bottom: 8px;
}

.shortcut-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  transition: all 0.3s ease;
}

.shortcut-item:hover {
  background: rgba(102, 126, 234, 0.05);
  padding-left: 10px;
  border-radius: 6px;
}

.shortcut-key {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-weight: 600;
  font-size: 0.85rem;
  min-width: 80px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.shortcut-desc {
  color: #333;
  font-weight: 500;
  flex: 1;
  margin-left: 15px;
}

/* é®ç½©å±‚ */
.help-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.help-overlay.show {
  opacity: 1;
  visibility: visible;
}

@media (max-width: 768px) {
  .converter-title-modern {
    font-size: 2.5rem;
  }
  
  .conversion-types-modern {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .upload-section-modern {
    padding: 2rem;
  }
  
  .result-actions-modern {
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }
  
  .download-btn-modern,
  .convert-again-btn-modern {
    width: 100%;
    max-width: 280px;
    justify-content: center;
  }
  

}
</style>
{% endblock %}

{% block content %}
<div class="pdf-converter-modern">
  <div class="container">
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <div class="converter-header-modern">
      <h1 class="converter-title-modern">ğŸš€ PDFè½¬æ¢å¼•æ“</h1>
      <p class="converter-subtitle-modern">
        âš¡ è¶…é«˜é€Ÿæ–‡ä»¶æ ¼å¼è½¬æ¢å·¥å…· | ğŸ¨ æ”¯æŒå¤šç§æ ¼å¼äº’è½¬ | ğŸ› ï¸ é‡‡ç”¨ç°ä»£åŒ–è®¾è®¡
      </p>
      
      <!-- å¿«æ·é”®å¸®åŠ©æŒ‰é’® -->
      <button class="shortcuts-help-btn" id="showShortcutsHelp" title="å¿«æ·é”®å¸®åŠ©">
        <i class="fas fa-keyboard"></i>
        <span>å¿«æ·é”®</span>
      </button>
    </div>
    
    <!-- å¿«æ·é”®å¸®åŠ©é¢æ¿ -->
    <div class="shortcuts-help-panel" id="shortcutsHelpPanel">
      <div class="help-panel-header">
        <h3><i class="fas fa-keyboard"></i> å¿«æ·é”®å¸®åŠ©</h3>
        <button class="close-help-btn" id="closeShortcutsHelp">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="help-panel-content">
        <div class="shortcuts-section">
          <h4><i class="fas fa-palette"></i> ä¸»é¢˜åˆ‡æ¢</h4>
          <div class="shortcut-item">
            <span class="shortcut-key">Ctrl + 1</span>
            <span class="shortcut-desc">ç”Ÿæ´»æ¨¡å¼</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Ctrl + 2</span>
            <span class="shortcut-desc">æå®¢æ¨¡å¼</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Ctrl + 3</span>
            <span class="shortcut-desc">ç‹‚æš´æ¨¡å¼</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Ctrl + 4</span>
            <span class="shortcut-desc">Emoæ¨¡å¼</span>
          </div>
        </div>
        <div class="shortcuts-section">
          <h4><i class="fas fa-tools"></i> å·¥å…·è·³è½¬</h4>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + E</span>
            <span class="shortcut-desc">æƒ…æ„Ÿæ—¥è®°</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + L</span>
            <span class="shortcut-desc">ç”Ÿæ´»æ—¥è®°</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + F</span>
            <span class="shortcut-desc">å¥èº«ä¸­å¿ƒ</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + C</span>
            <span class="shortcut-desc">åˆ›æ„å†™ä½œ</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + P</span>
            <span class="shortcut-desc">PDFè½¬æ¢å™¨</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + R</span>
            <span class="shortcut-desc">å°çº¢ä¹¦ç”Ÿæˆå™¨</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + T</span>
            <span class="shortcut-desc">æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + W</span>
            <span class="shortcut-desc">ç½‘é¡µçˆ¬è™«</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + S</span>
            <span class="shortcut-desc">è‡ªæˆ‘åˆ†æ</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + B</span>
            <span class="shortcut-desc">æ•…äº‹æ¿</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + M</span>
            <span class="shortcut-desc">éŸ³ä¹ç–—æ„ˆ</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + D</span>
            <span class="shortcut-desc">å†¥æƒ³æŒ‡å—</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Alt + A</span>
            <span class="shortcut-desc">è¿åŠ¿åˆ†æ</span>
          </div>
        </div>
      </div>
    </div>

    <!-- é®ç½©å±‚ -->
    <div class="help-overlay" id="helpOverlay"></div>
    </div>
    
    <!-- è½¬æ¢ç±»å‹é€‰æ‹© -->
    <div class="conversion-types-modern">
      <div class="type-card-modern" data-type="pdf-to-word" onclick="selectType('pdf-to-word')">
        <div class="card-icon">
          <i class="fas fa-file-pdf"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-word"></i>
        </div>
        <h4>ğŸ“„ PDFè½¬Word</h4>
        <p>ğŸš€ å°†PDFæ–‡æ¡£è½¬æ¢ä¸ºå¯ç¼–è¾‘çš„Wordæ ¼å¼ï¼Œä¿æŒåŸå§‹æ ¼å¼å’Œå¸ƒå±€</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">OCRè¯†åˆ«</span>
          <span class="feature-tag-modern">ä¿æŒæ ¼å¼</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="word-to-pdf" onclick="selectType('word-to-pdf')">
        <div class="card-icon">
          <i class="fas fa-file-word"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-pdf"></i>
        </div>
        <h4>ğŸ“ Wordè½¬PDF</h4>
        <p>ğŸ”’ å°†Wordæ–‡æ¡£è½¬æ¢ä¸ºPDFæ ¼å¼ï¼Œç¡®ä¿æ–‡æ¡£çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">é«˜è´¨é‡</span>
          <span class="feature-tag-modern">å¿«é€Ÿè½¬æ¢</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="pdf-to-image" onclick="selectType('pdf-to-image')">
        <div class="card-icon">
          <i class="fas fa-file-pdf"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-image"></i>
        </div>
        <h4>ğŸ–¼ï¸ PDFè½¬å›¾ç‰‡</h4>
        <p>ğŸ“¸ å°†PDFé¡µé¢è½¬æ¢ä¸ºé«˜æ¸…å›¾ç‰‡æ ¼å¼ï¼Œæ”¯æŒæ‰¹é‡å¤„ç†</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">é«˜æ¸…è¾“å‡º</span>
          <span class="feature-tag-modern">æ‰¹é‡å¤„ç†</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="image-to-pdf" onclick="selectType('image-to-pdf')">
        <div class="card-icon">
          <i class="fas fa-images"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-pdf"></i>
        </div>
        <h4>ğŸ“· å›¾ç‰‡è½¬PDF</h4>
        <p>ğŸ¯ å°†å¤šå¼ å›¾ç‰‡åˆå¹¶ä¸ºPDFæ–‡æ¡£ï¼Œæ”¯æŒæ™ºèƒ½æ’åºå’Œå‹ç¼©ä¼˜åŒ–</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">æ™ºèƒ½æ’åº</span>
          <span class="feature-tag-modern">å‹ç¼©ä¼˜åŒ–</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="pdf-to-text" onclick="selectType('pdf-to-text')">
        <div class="card-icon">
          <i class="fas fa-file-pdf"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-alt"></i>
        </div>
        <h4>ğŸ“– PDFè½¬æ–‡æœ¬</h4>
        <p>ğŸ” æå–PDFæ–‡æ¡£ä¸­çš„çº¯æ–‡æœ¬å†…å®¹ï¼Œä¾¿äºç¼–è¾‘å’Œæœç´¢</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">æ–‡æœ¬æå–</span>
          <span class="feature-tag-modern">å¿«é€Ÿæœç´¢</span>
        </div>
      </div>
      
      <div class="type-card-modern" data-type="text-to-pdf" onclick="selectType('text-to-pdf')">
        <div class="card-icon">
          <i class="fas fa-file-alt"></i>
          <i class="fas fa-arrow-right"></i>
          <i class="fas fa-file-pdf"></i>
        </div>
        <h4>ğŸ“ æ–‡æœ¬è½¬PDF</h4>
        <p>âœ¨ å°†çº¯æ–‡æœ¬å†…å®¹æˆ–TXTæ–‡ä»¶è½¬æ¢ä¸ºPDFæ–‡æ¡£ï¼Œæ”¯æŒè‡ªå®šä¹‰æ ¼å¼</p>
        <div class="feature-tags-modern">
          <span class="feature-tag-modern">æ–‡æœ¬è¾“å…¥</span>
          <span class="feature-tag-modern">TXTä¸Šä¼ </span>
          <span class="feature-tag-modern">å¿«é€Ÿç”Ÿæˆ</span>
        </div>
      </div>
    </div>
    
    <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
    <div class="upload-section-modern" id="fileUpload" style="display: none;">
      <h3 style="color: #00d4ff; margin-bottom: 2rem; font-size: 1.5rem; font-family: 'JetBrains Mono', 'Fira Code', monospace;">
        <i class="fas fa-cloud-upload-alt"></i>
        ğŸš€ ä¸Šä¼ æ–‡ä»¶
      </h3>
      
      <div class="upload-area-modern" onclick="safeClick('fileInput')" id="uploadArea">
        <div class="upload-icon-modern">
          <i class="fas fa-cloud-upload-alt"></i>
        </div>
        <div class="upload-text-modern">ğŸ“ æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
        <div class="upload-hint-modern" id="uploadHint">ğŸ¯ æ”¯æŒå¤šç§æ ¼å¼æ–‡ä»¶</div>
        <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt" style="display: none;">
      </div>
      
      <!-- æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º -->
      <div class="file-info-modern" id="fileInfo" style="display: none;">
        <div class="file-icon-modern">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="file-details-modern">
          <div class="file-name-modern" id="fileName"></div>
          <div class="file-size-modern" id="fileSize"></div>
        </div>
        <button class="remove-file-modern" onclick="removeFile()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- è½¬æ¢æŒ‰é’® -->
      <button class="convert-btn-modern" onclick="convertFile()" id="convertBtn" style="display: none;">
        <i class="fas fa-cogs"></i>
        <span>âš¡ å¼€å§‹è½¬æ¢</span>
      </button>
      
      <!-- ä½¿ç”¨æç¤º -->
      <div id="usageHint" style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; border-left: 4px solid #00d4ff; display: none;">
        <h4 style="margin: 0 0 0.5rem 0; color: #00d4ff;">
          <i class="fas fa-info-circle"></i> ä½¿ç”¨è¯´æ˜
        </h4>
        <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
          <strong>æ­¥éª¤1ï¼š</strong>é€‰æ‹©è½¬æ¢ç±»å‹<br>
          <strong>æ­¥éª¤2ï¼š</strong>é€‰æ‹©è¦è½¬æ¢çš„æ–‡ä»¶ï¼ˆæˆ–è¾“å…¥æ–‡æœ¬ï¼‰<br>
          <strong>æ­¥éª¤3ï¼š</strong>ç‚¹å‡»"å¼€å§‹è½¬æ¢"æŒ‰é’®
        </p>
      </div>
      
      <!-- æ‰¹é‡è½¬æ¢æŒ‰é’® -->
      <button class="convert-btn-modern" onclick="showBatchUpload()" id="batchBtn" style="display: none; margin-left: 1rem; background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);">
        <i class="fas fa-layer-group"></i>
        <span>ğŸ“¦ æ‰¹é‡è½¬æ¢</span>
      </button>
    </div>
    
    <!-- è½¬æ¢è¿›åº¦åŒºåŸŸ -->
    <div class="progress-section-modern" id="conversionProgress" style="display: none;">
      <h3 style="color: #00d4ff; margin-bottom: 2rem; font-size: 1.5rem; font-family: 'JetBrains Mono', 'Fira Code', monospace;">
        <i class="fas fa-spinner fa-spin"></i>
        ğŸ”„ æ­£åœ¨è½¬æ¢
      </h3>
      <div class="progress-bar-modern">
        <div class="progress-fill-modern" id="progressFill"></div>
      </div>
      <div class="progress-text-modern" id="progressText">å‡†å¤‡ä¸­...</div>
    </div>
    
    <!-- è½¬æ¢ç»“æœåŒºåŸŸ -->
    <div class="result-section-modern" id="conversionResult" style="display: none;">
      <div class="result-item-modern" id="resultContent">
        <!-- ç»“æœå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
      </div>
    </div>
    
          <!-- ç³»ç»ŸçŠ¶æ€æ£€æŸ¥åŒºåŸŸ -->
      <div class="status-section-modern" style="margin-bottom: 2rem;">
        <button class="status-btn-modern" onclick="showSystemStatus()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
          <i class="fas fa-info-circle"></i>
          æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        </button>
      </div>
      
      <!-- åŠŸèƒ½ç‰¹è‰²åŒºåŸŸ -->
      <div class="features-section-modern">
        <h3 class="features-title-modern">
          <i class="fas fa-star"></i>
          åŠŸèƒ½ç‰¹è‰²
        </h3>
      <div class="features-grid-modern">
        <div class="feature-card-modern">
          <div class="feature-icon-modern">
            <i class="fas fa-bolt"></i>
          </div>
          <h4>å¿«é€Ÿè½¬æ¢</h4>
          <p>é‡‡ç”¨å…ˆè¿›ç®—æ³•ï¼Œè½¬æ¢é€Ÿåº¦æå‡300%ï¼Œæ”¯æŒæ‰¹é‡å¤„ç†</p>
        </div>
        <div class="feature-card-modern">
          <div class="feature-icon-modern">
            <i class="fas fa-shield-alt"></i>
          </div>
          <h4>å®‰å…¨å¯é </h4>
          <p>æ–‡ä»¶æœ¬åœ°å¤„ç†ï¼Œä¸ä¸Šä¼ æœåŠ¡å™¨ï¼Œä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨</p>
        </div>
        <div class="feature-card-modern">
          <div class="feature-icon-modern">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <h4>å¤šç«¯æ”¯æŒ</h4>
          <p>æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯ï¼Œéšæ—¶éšåœ°è¿›è¡Œæ–‡ä»¶è½¬æ¢</p>
        </div>
        <div class="feature-card-modern">
          <div class="feature-icon-modern">
            <i class="fas fa-palette"></i>
          </div>
          <h4>æ™ºèƒ½ä¼˜åŒ–</h4>
          <p>è‡ªåŠ¨ä¼˜åŒ–æ–‡ä»¶å¤§å°å’Œè´¨é‡ï¼Œå¹³è¡¡æ•ˆæœä¸æ€§èƒ½</p>
        </div>
      </div>
    </div>
    
    <!-- ä½¿ç”¨ç»Ÿè®¡åŒºåŸŸ -->
    <div class="stats-section-modern">
      <h3 class="stats-title-modern">
        <i class="fas fa-chart-line"></i>
        è½¬æ¢ç»Ÿè®¡
      </h3>
      <div class="stats-grid-modern">
        <div class="stat-card-modern">
          <div class="stat-number-modern" id="totalConversions">1,234,567</div>
          <div class="stat-label-modern">æ€»è½¬æ¢æ¬¡æ•°</div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-number-modern" id="totalFiles">89,012</div>
          <div class="stat-label-modern">å¤„ç†æ–‡ä»¶æ•°</div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-number-modern" id="avgSpeed">2.3s</div>
          <div class="stat-label-modern">å¹³å‡è½¬æ¢æ—¶é—´</div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-number-modern" id="userSatisfaction">95.8%</div>
          <div class="stat-label-modern">ç”¨æˆ·æ»¡æ„åº¦</div>
        </div>
      </div>
    </div>
    
    <!-- æœ€è¿‘è½¬æ¢è®°å½• -->
    <div class="recent-conversions-modern">
      <h3 class="recent-title-modern">
        <i class="fas fa-history"></i>
        æœ€è¿‘è½¬æ¢
      </h3>
      <div class="recent-list-modern" id="recentConversions">
        <div class="recent-item-modern">
          <div class="recent-icon-modern">
            <i class="fas fa-file-pdf"></i>
          </div>
          <div class="recent-info-modern">
            <div class="recent-name-modern">document.pdf</div>
            <div class="recent-time-modern">2åˆ†é’Ÿå‰</div>
          </div>
          <div class="recent-status-modern success">
            <i class="fas fa-check"></i>
          </div>
        </div>
        <div class="recent-item-modern">
          <div class="recent-icon-modern">
            <i class="fas fa-file-word"></i>
          </div>
          <div class="recent-info-modern">
            <div class="recent-name-modern">report.docx</div>
            <div class="recent-time-modern">5åˆ†é’Ÿå‰</div>
          </div>
          <div class="recent-status-modern success">
            <i class="fas fa-check"></i>
          </div>
        </div>
        <div class="recent-item-modern">
          <div class="recent-icon-modern">
            <i class="fas fa-image"></i>
          </div>
          <div class="recent-info-modern">
            <div class="recent-name-modern">photos.jpg</div>
            <div class="recent-time-modern">10åˆ†é’Ÿå‰</div>
          </div>
          <div class="recent-status-modern success">
            <i class="fas fa-check"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let selectedType = '';
let selectedFile = null;

// æ•°å­—åŠ¨ç”»å‡½æ•°
function animateNumber(element, target, duration = 2000) {
  // å®‰å…¨æ£€æŸ¥
  if (!element || typeof target !== 'number' || isNaN(target)) {
    console.warn('animateNumber: æ— æ•ˆçš„å‚æ•°', { element, target });
    return;
  }
  
  const start = 0;
  const increment = target / (duration / 16);
  let current = start;
  
  const timer = setInterval(() => {
    current += increment;
    if (current >= target) {
      current = target;
      clearInterval(timer);
    }
    
    // æ ¹æ®ç›®æ ‡å€¼ç±»å‹é€‰æ‹©æ˜¾ç¤ºæ ¼å¼
    if (typeof target === 'number') {
      try {
        if (target >= 1000000) {
          element.textContent = Math.floor(current).toLocaleString();
        } else if (target >= 1000) {
          element.textContent = Math.floor(current).toLocaleString();
        } else if (target >= 1) {
          element.textContent = Math.floor(current);
        } else {
          // å°æ•°å¤„ç†
          element.textContent = current.toFixed(1);
        }
      } catch (error) {
        console.warn('animateNumber: è®¾ç½®textContentå¤±è´¥', error);
      }
    } else {
      try {
        element.textContent = current.toFixed(1);
      } catch (error) {
        console.warn('animateNumber: è®¾ç½®textContentå¤±è´¥', error);
      }
    }
  }, 16);
}

// é€‰æ‹©è½¬æ¢ç±»å‹
function selectType(type) {
  selectedType = type;
  
  // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„é€‰ä¸­çŠ¶æ€
  document.querySelectorAll('.type-card-modern').forEach(card => {
    card.classList.remove('selected');
  });
  
  // æ·»åŠ é€‰ä¸­çŠ¶æ€åˆ°å½“å‰å¡ç‰‡
  const selectedCard = document.querySelector(`[data-type="${type}"]`);
  if (selectedCard) {
    selectedCard.classList.add('selected');
  }
  
  // æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ åŒºåŸŸ
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  const conversionResult = document.getElementById('conversionResult');
  const batchBtn = document.getElementById('batchBtn');
  const convertBtn = document.getElementById('convertBtn');
  
  if (fileUpload) fileUpload.style.display = 'block';
  if (conversionProgress) conversionProgress.style.display = 'none';
  if (conversionResult) conversionResult.style.display = 'none';
  
  // æ›´æ–°ä¸Šä¼ æç¤º
  updateUploadHint(type);
  
  // æ˜¾ç¤ºæ‰¹é‡è½¬æ¢æŒ‰é’®ï¼ˆé™¤äº†æ–‡æœ¬è½¬PDFï¼‰
  if (batchBtn) {
    if (type !== 'text-to-pdf') {
      batchBtn.style.display = 'inline-flex';
    } else {
      batchBtn.style.display = 'none';
    }
  }
  
  // å¦‚æœæ˜¯æ–‡æœ¬è½¬PDFï¼Œç«‹å³æ˜¾ç¤ºè½¬æ¢æŒ‰é’®
  if (type === 'text-to-pdf') {
    if (convertBtn) {
      convertBtn.style.display = 'block';
      convertBtn.innerHTML = '<i class="fas fa-cogs"></i><span>è½¬æ¢ä¸ºPDF</span>';
      convertBtn.onclick = function() {
        const textInput = document.getElementById('textInput');
        if (textInput && textInput.value.trim()) {
          performTextToPdfConversion(textInput.value.trim());
        } else {
          showNotification('è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬å†…å®¹ï¼Œæˆ–è€…ä¸Šä¼ TXTæ–‡ä»¶ï¼', 'error');
        }
      };
    }
  } else {
    // å…¶ä»–ç±»å‹éœ€è¦é€‰æ‹©æ–‡ä»¶åæ‰æ˜¾ç¤ºè½¬æ¢æŒ‰é’®
    if (convertBtn) convertBtn.style.display = 'none';
  }
  
  // æ˜¾ç¤ºä½¿ç”¨æç¤º
  const usageHint = document.getElementById('usageHint');
  if (usageHint) {
    usageHint.style.display = 'block';
  }
  
  // æ»šåŠ¨åˆ°ä¸Šä¼ åŒºåŸŸ
  if (fileUpload) {
    fileUpload.scrollIntoView({ 
      behavior: 'smooth', 
      block: 'start' 
    });
  }
}

// è·å–è½¬æ¢ç±»å‹åç§°
function getTypeName(type) {
  const names = {
    'pdf-to-word': 'PDFè½¬Word',
    'word-to-pdf': 'Wordè½¬PDF',
    'pdf-to-image': 'PDFè½¬å›¾ç‰‡',
    'image-to-pdf': 'å›¾ç‰‡è½¬PDF',
    'pdf-to-text': 'PDFè½¬æ–‡æœ¬',
    'text-to-pdf': 'æ–‡æœ¬è½¬PDF'
  };
  return names[type] || type;
}

// ç”Ÿæˆè¾“å‡ºæ–‡ä»¶å
function getOutputFileName(originalFileName, conversionType) {
  // å®‰å…¨æ£€æŸ¥
  if (!originalFileName || typeof originalFileName !== 'string') {
    originalFileName = 'converted_file';
  }
  
  // ç§»é™¤æ–‡ä»¶æ‰©å±•å
  const nameWithoutExt = originalFileName.replace(/\.[^/.]+$/, "");
  
  // æ ¹æ®è½¬æ¢ç±»å‹æ·»åŠ é€‚å½“çš„æ‰©å±•å
  const extensions = {
    'pdf-to-word': '.docx',
    'word-to-pdf': '.pdf',
    'pdf-to-image': '.zip', // å›¾ç‰‡é€šå¸¸æ‰“åŒ…ä¸ºzip
    'image-to-pdf': '.pdf',
    'pdf-to-text': '.txt',
    'text-to-pdf': '.pdf'
  };
  
  const extension = extensions[conversionType] || '.pdf';
  
  // æ·»åŠ è½¬æ¢æ ‡è¯†
  const conversionSuffix = {
    'pdf-to-word': '_converted_to_word',
    'word-to-pdf': '_converted_to_pdf',
    'pdf-to-image': '_converted_to_images',
    'image-to-pdf': '_converted_to_pdf',
    'pdf-to-text': '_converted_to_text',
    'text-to-pdf': '_converted_to_pdf'
  };
  
  const suffix = conversionSuffix[conversionType] || '_converted';
  
  return `${nameWithoutExt}${suffix}${extension}`;
}

// æ›´æ–°ä¸Šä¼ æç¤º
function updateUploadHint(type) {
  const uploadHint = document.getElementById('uploadHint');
  const fileInput = document.getElementById('fileInput');
  
  // å®‰å…¨åœ°æ›´æ–°uploadHint
  if (uploadHint) {
    switch(type) {
      case 'pdf-to-word':
        uploadHint.textContent = 'æ”¯æŒPDFæ–‡ä»¶ï¼Œæœ€å¤§100MB';
        break;
      case 'word-to-pdf':
        uploadHint.textContent = 'æ”¯æŒWordæ–‡æ¡£ (.doc, .docx)ï¼Œæœ€å¤§100MB';
        break;
      case 'pdf-to-image':
        uploadHint.textContent = 'æ”¯æŒPDFæ–‡ä»¶ï¼Œæœ€å¤§100MB';
        break;
      case 'image-to-pdf':
        uploadHint.textContent = 'æ”¯æŒå›¾ç‰‡æ–‡ä»¶ (.jpg, .jpeg, .png, .gif, .bmp, .tiff)ï¼Œæœ€å¤§100MB';
        break;
      case 'pdf-to-text':
        uploadHint.textContent = 'æ”¯æŒPDFæ–‡ä»¶ï¼Œæœ€å¤§100MB';
        break;
      case 'text-to-pdf':
        uploadHint.textContent = 'è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬å†…å®¹';
        showTextInput();
        return; // æ–‡æœ¬è½¬PDFä¸éœ€è¦è®¾ç½®fileInput
      default:
        uploadHint.textContent = 'æ”¯æŒå¤šç§æ ¼å¼æ–‡ä»¶ï¼Œæœ€å¤§100MB';
    }
  }
  
  // å®‰å…¨åœ°æ›´æ–°fileInput
  if (fileInput) {
    switch(type) {
      case 'pdf-to-word':
        fileInput.accept = '.pdf';
        break;
      case 'word-to-pdf':
        fileInput.accept = '.doc,.docx';
        break;
      case 'pdf-to-image':
        fileInput.accept = '.pdf';
        break;
      case 'image-to-pdf':
        fileInput.accept = '.jpg,.jpeg,.png,.gif,.bmp,.tiff';
        break;
      case 'pdf-to-text':
        fileInput.accept = '.pdf';
        break;
      case 'text-to-pdf':
        fileInput.accept = '.txt';
        break;
      default:
        fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff,.txt';
    }
  } else {
    console.warn('fileInput element not found, skipping accept attribute update');
  }
}

// æ˜¾ç¤ºæ–‡æœ¬è¾“å…¥åŒºåŸŸ
function showTextInput() {
  const uploadArea = document.getElementById('uploadArea');
  uploadArea.innerHTML = `
    <div class="upload-icon-modern">
      <i class="fas fa-edit"></i>
    </div>
    <div class="upload-text-modern">æ–‡æœ¬è½¬PDF</div>
    
    <!-- æ–‡æœ¬è¾“å…¥åŒºåŸŸ -->
    <textarea id="textInput" placeholder="è¯·è¾“å…¥è¦è½¬æ¢ä¸ºPDFçš„æ–‡æœ¬å†…å®¹..." 
              style="width: 100%; min-height: 200px; margin: 1rem 0; padding: 1rem; 
                     border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; 
                     background: rgba(255,255,255,0.05); color: inherit; resize: vertical;"></textarea>
    
    <!-- TXTæ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->
    <div style="margin: 1rem 0; text-align: center;">
      <div style="margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.9rem;">
        ğŸ“„ æˆ–è€…ä¸Šä¼ TXTæ–‡ä»¶
      </div>
      <button type="button" onclick="document.getElementById('txtFileInput').click()" 
              style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                     border: none; color: white; padding: 0.75rem 1.5rem; 
                     border-radius: 8px; cursor: pointer; font-size: 0.9rem; 
                     transition: all 0.3s ease;">
        <i class="fas fa-file-upload"></i>
        é€‰æ‹©TXTæ–‡ä»¶
      </button>
      <input type="file" id="txtFileInput" accept=".txt" style="display: none;" onchange="handleTxtFileUpload(event)">
    </div>
    
    <div class="upload-hint-modern">æ”¯æŒå¤šè¡Œæ–‡æœ¬ï¼Œè‡ªåŠ¨åˆ†é¡µ</div>
  `;
  
  // ç§»é™¤uploadAreaçš„onclickäº‹ä»¶ï¼Œé¿å…å†²çª
  uploadArea.removeAttribute('onclick');
  
  // ç§»é™¤ä¹‹å‰æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨
  if (uploadArea._batchClickHandler) {
    uploadArea.removeEventListener('click', uploadArea._batchClickHandler);
    delete uploadArea._batchClickHandler;
  }
  
  // è½¬æ¢æŒ‰é’®å·²ç»åœ¨selectTypeå‡½æ•°ä¸­è®¾ç½®ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤è®¾ç½®
  
  // éšè—ä½¿ç”¨æç¤º
  const usageHint = document.getElementById('usageHint');
  if (usageHint) usageHint.style.display = 'none';
}

// å¤„ç†TXTæ–‡ä»¶ä¸Šä¼ ï¼ˆä¸“é—¨ç”¨äºæ–‡æœ¬è½¬PDFï¼‰
function handleTxtFileUpload(event) {
  const file = event.target.files[0];
  if (file) {
    // éªŒè¯æ–‡ä»¶ç±»å‹
    if (!file.name.toLowerCase().endsWith('.txt')) {
      showNotification('è¯·é€‰æ‹©TXTæ–‡ä»¶ï¼', 'error');
      return;
    }
    
    // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º5MBï¼‰
    if (file.size > 5 * 1024 * 1024) {
      showNotification('TXTæ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MBï¼', 'error');
      return;
    }
    
    // è¯»å–txtæ–‡ä»¶å†…å®¹
    const reader = new FileReader();
    reader.onload = function(e) {
      const textContent = e.target.result;
      const textInput = document.getElementById('textInput');
      if (textInput) {
        textInput.value = textContent;
        showNotification(`å·²åŠ è½½TXTæ–‡ä»¶å†…å®¹: ${file.name}`, 'success');
        
        // ç¡®ä¿è½¬æ¢æŒ‰é’®æ˜¾ç¤º
        const convertBtn = document.getElementById('convertBtn');
        if (convertBtn) {
          convertBtn.style.display = 'block';
          // æ›´æ–°æŒ‰é’®æ–‡æœ¬ä»¥æç¤ºç”¨æˆ·å¯ä»¥è½¬æ¢
          convertBtn.innerHTML = '<i class="fas fa-cogs"></i><span>è½¬æ¢ä¸ºPDF</span>';
        }
      }
    };
    reader.onerror = function() {
      showNotification('è¯»å–TXTæ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•ï¼', 'error');
    };
    reader.readAsText(file, 'utf-8');
  }
}

// æ–‡ä»¶ä¸Šä¼ å¤„ç†
function handleFileUpload(event) {
  const file = event.target.files[0];
  if (file) {
    selectedFile = file;
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯txtæ–‡ä»¶ä¸”é€‰æ‹©äº†æ–‡æœ¬è½¬PDF
    if (file.name.toLowerCase().endsWith('.txt') && selectedType === 'text-to-pdf') {
      // è¯»å–txtæ–‡ä»¶å†…å®¹å¹¶æ˜¾ç¤ºåœ¨æ–‡æœ¬è¾“å…¥æ¡†ä¸­
      const reader = new FileReader();
      reader.onload = function(e) {
        const textContent = e.target.result;
        showTextInput();
        const textInput = document.getElementById('textInput');
        if (textInput) {
          textInput.value = textContent;
        }
        showNotification(`å·²åŠ è½½txtæ–‡ä»¶å†…å®¹: ${file.name}`, 'success');
      };
      reader.readAsText(file, 'utf-8');
    } else {
      displayFileInfo(file);
      const convertBtn = document.getElementById('convertBtn');
      if (convertBtn) convertBtn.style.display = 'block';
      
      // éšè—ä½¿ç”¨æç¤º
      const usageHint = document.getElementById('usageHint');
      if (usageHint) usageHint.style.display = 'none';
      
      showNotification(`å·²é€‰æ‹©æ–‡ä»¶: ${file.name}`, 'success');
    }
  }
}

// æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
function displayFileInfo(file) {
  const fileInfo = document.getElementById('fileInfo');
  const fileName = document.getElementById('fileName');
  const fileSize = document.getElementById('fileSize');
  
  // é™åˆ¶æ–‡ä»¶åé•¿åº¦ï¼Œè¶…è¿‡30ä¸ªå­—ç¬¦æ˜¾ç¤ºçœç•¥å·
  const displayName = file.name.length > 30 ? file.name.substring(0, 30) + '...' : file.name;
  fileName.textContent = displayName;
  fileName.title = file.name; // æ·»åŠ å®Œæ•´æ–‡ä»¶åçš„tooltip
  
  fileSize.textContent = formatFileSize(file.size);
  
  fileInfo.style.display = 'flex';
  document.getElementById('uploadArea').style.display = 'none';
}

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// ç§»é™¤æ–‡ä»¶
function removeFile() {
  selectedFile = null;
  const fileInfo = document.getElementById('fileInfo');
  const uploadArea = document.getElementById('uploadArea');
  const convertBtn = document.getElementById('convertBtn');
  const fileInput = document.getElementById('fileInput');
  
  // æ·»åŠ nullæ£€æŸ¥ï¼Œé˜²æ­¢TypeError
  if (fileInfo) fileInfo.style.display = 'none';
  if (uploadArea) uploadArea.style.display = 'block';
  if (convertBtn) convertBtn.style.display = 'none';
  if (fileInput) fileInput.value = '';
}

// è½¬æ¢æ–‡ä»¶
function convertFile() {

  if (!selectedType) {
    showNotification('è¯·å…ˆé€‰æ‹©è½¬æ¢ç±»å‹ï¼', 'error');
    return;
  }
  
  // æ£€æŸ¥æ–‡æœ¬è½¬PDFçš„ç‰¹æ®Šæƒ…å†µ
  if (selectedType === 'text-to-pdf') {
    const textInput = document.getElementById('textInput');
    if (!textInput || !textInput.value.trim()) {
      showNotification('è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬å†…å®¹ï¼', 'error');
      return;
    }
    performTextToPdfConversion(textInput.value.trim());
    return;
  }
  
  if (!selectedFile) {
    showNotification('è¯·å…ˆé€‰æ‹©æ–‡ä»¶ï¼', 'error');
    return;
  }
  
  // æ˜¾ç¤ºè½¬æ¢è¿›åº¦
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  
  if (fileUpload) fileUpload.style.display = 'none';
  if (conversionProgress) conversionProgress.style.display = 'block';
  
  // æ‰§è¡Œå®é™…è½¬æ¢
  performConversion();
}

// æ‰§è¡Œæ–‡ä»¶è½¬æ¢
function performConversion() {
  const formData = new FormData();
  formData.append('file', selectedFile);
  formData.append('type', selectedType);
  
  // æ˜¾ç¤ºè¿›åº¦
  simulateProgress();
  
  // å‘é€APIè¯·æ±‚
  fetch('/tools/api/pdf-converter/', {
    method: 'POST',
    body: formData
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    // æ£€æŸ¥å“åº”ç±»å‹ï¼Œé¿å…è§£æHTMLä¸ºJSON
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      return response.json();
    } else {
      throw new Error('æœåŠ¡å™¨è¿”å›éJSONå“åº”ï¼Œä¼šè¯å¯èƒ½å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•');
    }
  })
  .then(data => {
    if (data.success) {
      showConversionResult(data);
    } else {
      // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢è½¬æ¢ç±»å‹
      if (data.needs_type_switch && data.suggested_types && data.suggested_types.length > 0) {
        showTypeSwitchDialog(data.error, data.suggested_types);
      } else {
        showNotification(data.error || 'è½¬æ¢å¤±è´¥', 'error');
      }
      const conversionProgress = document.getElementById('conversionProgress');
      if (conversionProgress) conversionProgress.style.display = 'none';
    }
  })
  .catch(error => {
    console.error('è½¬æ¢é”™è¯¯:', error);
    let errorMessage = error.message;
    
    // æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º
    if (error.message.includes('Unexpected token')) {
      errorMessage = 'ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•';
    } else if (error.message.includes('éJSONå“åº”')) {
      errorMessage = 'ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•';
    }
    
    showNotification('è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + errorMessage, 'error');
    const conversionProgress = document.getElementById('conversionProgress');
    if (conversionProgress) conversionProgress.style.display = 'none';
  });
}

// æ¨¡æ‹Ÿè½¬æ¢è¿›åº¦
function simulateProgress() {
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');
  let progress = 0;
  
  const interval = setInterval(() => {
    progress += Math.random() * 15;
    if (progress > 90) progress = 90; // ä¿ç•™10%ç»™å®é™…å®Œæˆ
    
    if (progressFill) progressFill.style.width = progress + '%';
    
    if (progressText) {
      if (progress < 30) {
        progressText.textContent = 'æ­£åœ¨åˆ†ææ–‡ä»¶...';
      } else if (progress < 60) {
        progressText.textContent = 'æ­£åœ¨è½¬æ¢æ ¼å¼...';
      } else {
        progressText.textContent = 'æ­£åœ¨ä¼˜åŒ–è¾“å‡º...';
      }
    }
  }, 200);
  
  // ä¿å­˜intervalä»¥ä¾¿åç»­æ¸…é™¤
  window.progressInterval = interval;
}

// æ˜¾ç¤ºè½¬æ¢ç»“æœ
function showConversionResult(data) {
  // æ¸…é™¤è¿›åº¦æ¨¡æ‹Ÿ
  if (window.progressInterval) {
    clearInterval(window.progressInterval);
  }
  
  const conversionProgress = document.getElementById('conversionProgress');
  const resultContent = document.getElementById('resultContent');
  const conversionResult = document.getElementById('conversionResult');
  
  if (conversionProgress) conversionProgress.style.display = 'none';
  
  // åˆ·æ–°ç»Ÿè®¡æ•°æ®
  setTimeout(() => {
    if (typeof loadConversionStats === 'function') {
      loadConversionStats();
    }
  }, 1000);
  
  const fileName = selectedFile ? selectedFile.name : 'æ–‡æœ¬å†…å®¹';
  
  if (!resultContent) {
    console.error('ç»“æœå†…å®¹å…ƒç´ æœªæ‰¾åˆ°');
    return;
  }
  
  if (data.type === 'images') {
    // æ˜¾ç¤ºå›¾ç‰‡ç»“æœ
    let imagesHtml = '<div class="image-gallery-modern">';
    data.data.forEach((image, index) => {
      imagesHtml += `
        <div class="image-item-modern">
          <img src="data:image/png;base64,${image.data}" alt="é¡µé¢ ${image.page}">
          <div class="page-info">ç¬¬ ${image.page} é¡µ</div>
        </div>
      `;
    });
    imagesHtml += '</div>';
    
    resultContent.innerHTML = `
      <div class="result-icon-modern">
        <i class="fas fa-images"></i>
      </div>
      <div class="result-title-modern">âœ… è½¬æ¢å®Œæˆ</div>
      <div class="result-description-modern">
        æ–‡ä»¶ <strong>${fileName}</strong> å·²æˆåŠŸè½¬æ¢ä¸ºå›¾ç‰‡æ ¼å¼ï¼Œå…± ${data.total_pages} é¡µ
        <br>æ€»å¤§å°: ${formatFileSize ? formatFileSize(data.total_size) : data.total_size}
      </div>
      ${imagesHtml}
      <div class="result-actions-modern">
        <button class="convert-again-btn-modern" onclick="convertAgain()">
          <i class="fas fa-redo"></i>
          è½¬æ¢å…¶ä»–æ–‡ä»¶
        </button>
      </div>
    `;
  } else {
    // æ˜¾ç¤ºæ–‡ä»¶ä¸‹è½½ç»“æœ
    const fileSize = data.file_size ? (formatFileSize ? formatFileSize(data.file_size) : data.file_size) : '';
    // ä»APIå“åº”ä¸­è·å–è½¬æ¢ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨selectedType
    const conversionType = data.conversion_type || selectedType || 'unknown';
    const outputFileName = getOutputFileName ? getOutputFileName(fileName, conversionType) : fileName;
    
    resultContent.innerHTML = `
      <div class="result-icon-modern">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="result-title-modern">âœ… è½¬æ¢å®Œæˆ</div>
      <div class="result-description-modern">
        ${conversionType === 'text-to-pdf' ? 'æ–‡æœ¬å†…å®¹' : `æ–‡ä»¶ <strong>${fileName}</strong>`} å·²æˆåŠŸè½¬æ¢ä¸º ${getTypeName ? getTypeName(conversionType) : conversionType} æ ¼å¼
        ${fileSize ? `<br>æ–‡ä»¶å¤§å°: ${fileSize}` : ''}
        <br><strong>è¾“å‡ºæ–‡ä»¶å: ${outputFileName}</strong>
      </div>
      <div class="result-actions-modern">
        <a href="${data.download_url}" class="download-btn-modern" download="${outputFileName}" id="autoDownloadLink">
          <i class="fas fa-download"></i>
          é‡æ–°ä¸‹è½½
        </a>
        <button class="convert-again-btn-modern" onclick="convertAgain()">
          <i class="fas fa-redo"></i>
          è½¬æ¢å…¶ä»–æ–‡ä»¶
        </button>
      </div>
    `;
    
    // æ£€æŸ¥ä¸‹è½½URLæ˜¯å¦å­˜åœ¨
    if (!data.download_url) {
      console.error('APIå“åº”ä¸­ç¼ºå°‘download_urlå­—æ®µ:', data);
      showNotification('è½¬æ¢æˆåŠŸä½†æ— æ³•è·å–ä¸‹è½½é“¾æ¥ï¼Œè¯·æ£€æŸ¥APIå“åº”', 'error');
      return;
    }
    
    // è‡ªåŠ¨è§¦å‘ä¸‹è½½
    setTimeout(() => {
      if (typeof downloadFile === 'function') {
        downloadFile(data.download_url, outputFileName);
        showNotification(`æ–‡ä»¶ "${outputFileName}" æ­£åœ¨ä¸‹è½½...`, 'info');
      }
    }, 1000);
  }
  
  if (conversionResult) conversionResult.style.display = 'block';
  showNotification('æ–‡ä»¶è½¬æ¢å®Œæˆï¼', 'success');
}

// é‡æ–°è½¬æ¢
function convertAgain() {
  // é‡ç½®æ‰€æœ‰çŠ¶æ€å˜é‡
  selectedFile = null;
  selectedType = '';
  
  // éšè—è½¬æ¢ç»“æœå’Œè¿›åº¦
  const conversionResult = document.getElementById('conversionResult');
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  
  if (conversionResult) conversionResult.style.display = 'none';
  if (fileUpload) fileUpload.style.display = 'none';
  if (conversionProgress) conversionProgress.style.display = 'none';
  
  // é‡ç½®æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
  const fileInfo = document.getElementById('fileInfo');
  if (fileInfo) fileInfo.style.display = 'none';
  
  // é‡ç½®è½¬æ¢æŒ‰é’®
  const convertBtn = document.getElementById('convertBtn');
  if (convertBtn) convertBtn.style.display = 'none';
  
  // å–æ¶ˆé€‰æ‹©æ‰€æœ‰è½¬æ¢ç±»å‹å¡ç‰‡
  document.querySelectorAll('.type-card-modern').forEach(card => {
    card.classList.remove('selected');
  });
  
  // é‡ç½®ä¸Šä¼ åŒºåŸŸ
  const uploadArea = document.getElementById('uploadArea');
  if (uploadArea) {
    uploadArea.style.display = 'block';
    uploadArea.innerHTML = `
      <div class="upload-icon-modern">
        <i class="fas fa-cloud-upload-alt"></i>
      </div>
      <div class="upload-text-modern">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
      <div class="upload-hint-modern" id="uploadHint">æ”¯æŒå¤šç§æ ¼å¼æ–‡ä»¶</div>
    `;
    
    // é‡æ–°åˆ›å»ºfileInputå…ƒç´ å¹¶ç»‘å®šäº‹ä»¶
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.id = 'fileInput';
    fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.txt';
    fileInput.style.display = 'none';
    fileInput.addEventListener('change', handleFileUpload);
    uploadArea.appendChild(fileInput);
    
    // æ¢å¤åŸå§‹çš„onclickäº‹ä»¶
    uploadArea.onclick = function() { safeClick('fileInput'); };
    
    // ç§»é™¤ä¹‹å‰æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨
    if (uploadArea._batchClickHandler) {
      uploadArea.removeEventListener('click', uploadArea._batchClickHandler);
      delete uploadArea._batchClickHandler;
    }
  }
  
  // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
  showNotification('å·²é‡ç½®è½¬æ¢ç•Œé¢ï¼Œå¯ä»¥å¼€å§‹æ–°çš„è½¬æ¢', 'success');

}

// æ–‡æœ¬è½¬PDFè½¬æ¢
function performTextToPdfConversion(textContent) {
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  
  if (fileUpload) fileUpload.style.display = 'none';
  if (conversionProgress) conversionProgress.style.display = 'block';
  
  const formData = new FormData();
  formData.append('type', 'text-to-pdf');
  formData.append('text_content', textContent);
  
  // æ˜¾ç¤ºè¿›åº¦
  simulateProgress();
  
  // å‘é€APIè¯·æ±‚
  fetch('/tools/api/pdf-converter/', {
    method: 'POST',
    body: formData
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    // æ£€æŸ¥å“åº”ç±»å‹ï¼Œé¿å…è§£æHTMLä¸ºJSON
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      return response.json();
    } else {
      throw new Error('æœåŠ¡å™¨è¿”å›éJSONå“åº”ï¼Œä¼šè¯å¯èƒ½å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•');
    }
  })
  .then(data => {
    if (data.success) {
      showConversionResult(data);
    } else {
      // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢è½¬æ¢ç±»å‹
      if (data.needs_type_switch && data.suggested_types && data.suggested_types.length > 0) {
        showTypeSwitchDialog(data.error, data.suggested_types);
      } else {
        showNotification(data.error || 'è½¬æ¢å¤±è´¥', 'error');
      }
      if (conversionProgress) conversionProgress.style.display = 'none';
    }
  })
  .catch(error => {
    console.error('è½¬æ¢é”™è¯¯:', error);
    let errorMessage = error.message;
    
    // æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º
    if (error.message.includes('Unexpected token')) {
      errorMessage = 'ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•';
    } else if (error.message.includes('éJSONå“åº”')) {
      errorMessage = 'ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•';
    }
    
    showNotification('è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + errorMessage, 'error');
    if (conversionProgress) conversionProgress.style.display = 'none';
  });
}

// è¿™äº›å‡½æ•°å·²ç»è¢«æ›´æ–°çš„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ é™¤é‡å¤ä»£ç 

// æ˜¾ç¤ºé€šçŸ¥
function showNotification(message, type = 'info') {
  // åˆ›å»ºé€šçŸ¥å…ƒç´ 
  const notification = document.createElement('div');
  notification.className = `notification-modern ${type}`;
  notification.innerHTML = `
    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
    <span>${message}</span>
  `;
  
  // æ·»åŠ åˆ°é¡µé¢
  document.body.appendChild(notification);
  
  // æ˜¾ç¤ºåŠ¨ç”»
  setTimeout(() => {
    notification.classList.add('show');
  }, 100);
  
  // è‡ªåŠ¨éšè—
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// æ˜¾ç¤ºç±»å‹åˆ‡æ¢å¯¹è¯æ¡†
function showTypeSwitchDialog(errorMessage, suggestedTypes) {
  // ç§»é™¤å·²å­˜åœ¨çš„å¯¹è¯æ¡†
  const existingDialog = document.getElementById('typeSwitchDialog');
  if (existingDialog) {
    existingDialog.remove();
  }
  
  // åˆ›å»ºå¯¹è¯æ¡†
  const dialog = document.createElement('div');
  dialog.id = 'typeSwitchDialog';
  dialog.className = 'type-switch-dialog';
  dialog.innerHTML = `
    <div class="type-switch-content">
      <div class="type-switch-header">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>æ–‡ä»¶ç±»å‹ä¸å…¼å®¹</h3>
        <button class="close-btn" onclick="closeTypeSwitchDialog()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="type-switch-body">
        <p class="error-message">${errorMessage}</p>
        <div class="suggested-types">
          <h4>å»ºè®®çš„è½¬æ¢ç±»å‹ï¼š</h4>
          <div class="type-buttons">
            ${suggestedTypes.map(type => `
              <button class="type-btn" onclick="switchConversionType('${type}')">
                <i class="fas fa-${getTypeIcon(type)}"></i>
                <span>${getTypeDisplayName(type)}</span>
              </button>
            `).join('')}
          </div>
        </div>
        <div class="type-switch-actions">
          <button class="cancel-btn" onclick="closeTypeSwitchDialog()">å–æ¶ˆ</button>
          <button class="upload-new-btn" onclick="uploadNewFile()">ä¸Šä¼ æ–°æ–‡ä»¶</button>
        </div>
      </div>
    </div>
  `;
  
  // æ·»åŠ åˆ°é¡µé¢
  document.body.appendChild(dialog);
  
  // æ˜¾ç¤ºåŠ¨ç”»
  setTimeout(() => {
    dialog.classList.add('show');
  }, 100);
}

// å…³é—­ç±»å‹åˆ‡æ¢å¯¹è¯æ¡†
function closeTypeSwitchDialog() {
  const dialog = document.getElementById('typeSwitchDialog');
  if (dialog) {
    dialog.classList.remove('show');
    setTimeout(() => {
      dialog.remove();
    }, 300);
  }
}

// åˆ‡æ¢è½¬æ¢ç±»å‹
function switchConversionType(type) {
  // æ›´æ–°è½¬æ¢ç±»å‹é€‰æ‹©
  const typeSelect = document.getElementById('conversionType');
  if (typeSelect) {
    typeSelect.value = type;
    // è§¦å‘changeäº‹ä»¶
    const event = new Event('change');
    typeSelect.dispatchEvent(event);
  }
  
  // å…³é—­å¯¹è¯æ¡†
  closeTypeSwitchDialog();
  
  // æ˜¾ç¤ºæˆåŠŸæç¤º
  showNotification(`å·²è‡ªåŠ¨åˆ‡æ¢åˆ° ${getTypeDisplayName(type)}`, 'success');
}

// ä¸Šä¼ æ–°æ–‡ä»¶
function uploadNewFile() {
  closeTypeSwitchDialog();
  // è§¦å‘æ–‡ä»¶é€‰æ‹©
  const fileInput = document.getElementById('fileInput');
  if (fileInput) {
    fileInput.click();
  }
}

// è·å–è½¬æ¢ç±»å‹å›¾æ ‡
function getTypeIcon(type) {
  const iconMap = {
    'pdf-to-word': 'file-word',
    'word-to-pdf': 'file-pdf',
    'pdf-to-image': 'images',
    'image-to-pdf': 'file-pdf'
  };
  return iconMap[type] || 'file';
}

// è·å–è½¬æ¢ç±»å‹æ˜¾ç¤ºåç§°
function getTypeDisplayName(type) {
  const nameMap = {
    'pdf-to-word': 'PDFè½¬Word',
    'word-to-pdf': 'Wordè½¬PDF',
    'pdf-to-image': 'PDFè½¬å›¾ç‰‡',
    'image-to-pdf': 'å›¾ç‰‡è½¬PDF'
  };
  return nameMap[type] || type;
}

// é¡µé¢åŠ è½½æ—¶å¯åŠ¨åŠ¨ç”»
document.addEventListener('DOMContentLoaded', function() {
  // åŠ è½½å®é™…ç»Ÿè®¡æ•°æ®
  loadConversionStats();
  
  // æ˜¾ç¤ºåˆå§‹ä½¿ç”¨æç¤º
  const usageHint = document.getElementById('usageHint');
  if (usageHint) {
    usageHint.style.display = 'block';
    usageHint.innerHTML = `
      <h4 style="margin: 0 0 0.5rem 0; color: #00d4ff;">
        <i class="fas fa-info-circle"></i> æ¬¢è¿ä½¿ç”¨PDFè½¬æ¢å™¨
      </h4>
      <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
        <strong>å¼€å§‹ä½¿ç”¨ï¼š</strong>è¯·å…ˆé€‰æ‹©ä¸Šæ–¹çš„è½¬æ¢ç±»å‹ï¼Œç„¶åæŒ‰ç…§æç¤ºæ“ä½œ
      </p>
    `;
  }
  
  // å»¶è¿Ÿå¯åŠ¨åŠ¨ç”»ï¼Œè®©é¡µé¢å…ˆåŠ è½½å®Œæˆ
  setTimeout(() => {
    // è¿™äº›å€¼å°†åœ¨loadConversionStatsä¸­æ›´æ–°
  }, 1000);
  
  // ç»‘å®šæ–‡ä»¶ä¸Šä¼ äº‹ä»¶
  const fileInput = document.getElementById('fileInput');
  if (fileInput) {
    fileInput.addEventListener('change', handleFileUpload);
  }
  
  // ç»‘å®šæ‹–æ‹½ä¸Šä¼ äº‹ä»¶
  const uploadArea = document.getElementById('uploadArea');
  if (uploadArea) {
    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
          fileInput.files = files;
          handleFileUpload({ target: { files: files } });
        }
      }
    });
  }
});



// åŠ è½½è½¬æ¢ç»Ÿè®¡æ•°æ®
function loadConversionStats() {

  // è·å–CSRFä»¤ç‰Œ
  const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
  
  fetch('/tools/api/pdf-converter/stats/', {
    method: 'GET',
    headers: {
      'X-CSRFToken': csrfToken,
      'Content-Type': 'application/json',
    },
    credentials: 'same-origin' // åŒ…å«cookies
  })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      // æ£€æŸ¥å“åº”ç±»å‹ï¼Œé¿å…è§£æHTMLä¸ºJSON
      const contentType = response.headers.get('content-type');
      if (contentType && contentType.includes('application/json')) {
        return response.json();
      } else {
        throw new Error('æœåŠ¡å™¨è¿”å›éJSONå“åº”ï¼Œä¼šè¯å¯èƒ½å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•');
      }
    })
    .then(data => {

      if (data.success) {
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        const stats = data.stats;
        
        // è§£ææ•°å€¼
        const totalConversions = parseInt(stats.total_conversions) || 0;
        const totalFiles = parseInt(stats.total_files) || 0;
        
        // å¤„ç†å¹³å‡é€Ÿåº¦ - ä¿®å¤æ•°æ®è§£æé€»è¾‘
        let avgSpeed = 0.0;
        
        // ä¼˜å…ˆä½¿ç”¨æ•°å­—ç±»å‹çš„å­—æ®µ
        if (typeof stats.avg_speed === 'number' && stats.avg_speed > 0) {
          avgSpeed = stats.avg_speed;
        } else if (typeof stats.average_conversion_time === 'number' && stats.average_conversion_time > 0) {
          avgSpeed = stats.average_conversion_time;
        } else if (typeof stats.avg_conversion_time === 'number' && stats.avg_conversion_time > 0) {
          avgSpeed = stats.avg_conversion_time;
        } else if (typeof stats.avg_speed === 'string') {
          // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥è§£ææ•°å­—éƒ¨åˆ†ï¼ˆä¸è¦ç§»é™¤å°æ•°ç‚¹ï¼‰
          const parsed = parseFloat(stats.avg_speed);
          if (!isNaN(parsed) && parsed > 0) {
            avgSpeed = parsed;
          }
        }
        
        // ç¡®ä¿avgSpeedåœ¨åˆç†èŒƒå›´å†…
        if (avgSpeed <= 0 || avgSpeed > 300) {
          avgSpeed = 2.5; // é»˜è®¤å€¼
        }
        
        // å¤„ç†ç”¨æˆ·æ»¡æ„åº¦ - æ”¹è¿›æ•°æ®è§£æé€»è¾‘
        let userSatisfaction = 95.8; // é»˜è®¤æ»¡æ„åº¦
        
        // å…ˆå°è¯•ä» user_satisfaction_percentage è·å–
        if (typeof stats.user_satisfaction_percentage === 'number' && stats.user_satisfaction_percentage > 0) {
          userSatisfaction = stats.user_satisfaction_percentage;
        } else if (typeof stats.user_satisfaction === 'number' && stats.user_satisfaction > 0) {
          userSatisfaction = stats.user_satisfaction;
        } else if (typeof stats.user_satisfaction === 'string') {
          // ç§»é™¤æ‰€æœ‰éæ•°å­—å­—ç¬¦ï¼Œåªä¿ç•™æ•°å­—å’Œå°æ•°ç‚¹
          const parsed = parseFloat(stats.user_satisfaction.replace(/[^\d.]/g, '')) || 0.0;
          userSatisfaction = parsed > 0 ? parsed : 95.8;
        }
        
        // ç¡®ä¿æ»¡æ„åº¦åœ¨åˆç†èŒƒå›´å†… (0-100)
        if (userSatisfaction < 0 || userSatisfaction > 100) {
          userSatisfaction = 95.8;
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®æ˜¾ç¤º

        const totalConversionsElement = document.getElementById('totalConversions');
        const totalFilesElement = document.getElementById('totalFiles');
        const avgSpeedElement = document.getElementById('avgSpeed');
        const userSatisfactionElement = document.getElementById('userSatisfaction');
        
        if (totalConversionsElement) animateNumber(totalConversionsElement, totalConversions);
        if (totalFilesElement) animateNumber(totalFilesElement, totalFiles);
        if (avgSpeedElement) avgSpeedElement.textContent = avgSpeed.toFixed(1) + 's';
        if (userSatisfactionElement) {
          userSatisfactionElement.textContent = userSatisfaction.toFixed(1) + '%';
        }

        // æ›´æ–°æœ€è¿‘è½¬æ¢è®°å½•
        updateRecentConversions(stats.recent_conversions);
      } else {
        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', data.error);
        // ä½¿ç”¨é»˜è®¤å€¼
        const totalConversionsElement = document.getElementById('totalConversions');
        const totalFilesElement = document.getElementById('totalFiles');
        const avgSpeedElement = document.getElementById('avgSpeed');
        const userSatisfactionElement = document.getElementById('userSatisfaction');
        
        if (totalConversionsElement) animateNumber(totalConversionsElement, 0);
        if (totalFilesElement) animateNumber(totalFilesElement, 0);
        if (avgSpeedElement) avgSpeedElement.textContent = '2.5s';
        if (userSatisfactionElement) userSatisfactionElement.textContent = '95.8%';
      }
    })
    .catch(error => {
      console.error('è¯·æ±‚ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
      // ä½¿ç”¨é»˜è®¤å€¼
      const totalConversionsElement = document.getElementById('totalConversions');
      const totalFilesElement = document.getElementById('totalFiles');
      const avgSpeedElement = document.getElementById('avgSpeed');
      const userSatisfactionElement = document.getElementById('userSatisfaction');
      
      if (totalConversionsElement) animateNumber(totalConversionsElement, 0);
      if (totalFilesElement) animateNumber(totalFilesElement, 0);
      if (avgSpeedElement) avgSpeedElement.textContent = '2.5s';
      if (userSatisfactionElement) userSatisfactionElement.textContent = '95.8%';
    });
}

// æ›´æ–°æœ€è¿‘è½¬æ¢è®°å½•
function updateRecentConversions(recentData) {



  const recentContainer = document.getElementById('recentConversions');

  if (!recentData || recentData.length === 0) {
    recentContainer.innerHTML = `
      <div class="recent-item-modern" onclick="goToConversionTypes()">
        <div class="recent-icon-modern">
          <i class="fas fa-file-pdf"></i>
        </div>
        <div class="recent-info-modern">
          <div class="recent-name-modern">æš‚æ— è½¬æ¢è®°å½•</div>
          <div class="recent-time-modern">å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡è½¬æ¢å§</div>
          <div class="recent-details-modern">ç‚¹å‡»å¼€å§‹è½¬æ¢ä½“éªŒ</div>
        </div>
        <div class="recent-status-modern">
          <i class="fas fa-plus"></i>
        </div>
      </div>
    `;
    return;
  }
  
  recentContainer.innerHTML = '';
  
  recentData.forEach(record => {
    // å®‰å…¨æ£€æŸ¥è®°å½•æ•°æ®
    if (!record || typeof record !== 'object') {
      console.warn('è·³è¿‡æ— æ•ˆçš„è®°å½•æ•°æ®:', record);
      return;
    }
    
    const item = document.createElement('div');
    item.className = 'recent-item-modern';
    
    // æ ¹æ®è½¬æ¢ç±»å‹é€‰æ‹©å›¾æ ‡ï¼Œæ·»åŠ å®‰å…¨æ£€æŸ¥
    let icon = 'fas fa-file-pdf';
    const conversionType = record.conversion_type || '';
    if (conversionType.includes('Word')) {
      icon = 'fas fa-file-word';
    } else if (conversionType.includes('å›¾ç‰‡')) {
      icon = 'fas fa-image';
    } else if (conversionType.includes('æ–‡æœ¬')) {
      icon = 'fas fa-file-alt';
    }
    
    // ç”Ÿæˆæ»¡æ„åº¦è¯„åˆ†HTML
    let ratingHtml = '';
    const satisfactionRating = record.satisfaction_rating;
    const recordId = record.id;
    
    if (satisfactionRating && typeof satisfactionRating === 'number') {
      // å·²æœ‰è¯„åˆ†ï¼Œæ˜¾ç¤ºæ˜Ÿæ˜Ÿ
      ratingHtml = `
        <div class="rating-display" style="margin-top: 0.5rem;">
          ${generateStarRating(satisfactionRating, true)}
        </div>
      `;
    } else if (recordId) {
      // æ— è¯„åˆ†ï¼Œæ˜¾ç¤ºè¯„åˆ†æŒ‰é’®
      ratingHtml = `
        <div class="rating-section" style="margin-top: 0.5rem;">
          <div class="rating-label" style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-bottom: 0.25rem;">æ»¡æ„åº¦è¯„åˆ†:</div>
          <div class="rating-stars" data-record-id="${recordId}">
            ${generateStarRating(0, false)}
          </div>
        </div>
      `;
    }
    
    item.innerHTML = `
      <div class="recent-icon-modern">
        <i class="${icon}"></i>
      </div>
      <div class="recent-info-modern">
        <div class="recent-name-modern">${record.filename || 'æœªçŸ¥æ–‡ä»¶'}</div>
        <div class="recent-time-modern">${record.time_ago || record.created_at || ''} Â· ${record.conversion_type || 'æœªçŸ¥ç±»å‹'}</div>
        <div class="recent-details-modern">${record.file_size || ''} Â· ${record.conversion_time || ''}</div>
        ${ratingHtml}
      </div>
      <div class="recent-status-modern success">
        <i class="fas fa-check"></i>
      </div>
    `;
    
    recentContainer.appendChild(item);
    
    // ä¸ºè¯„åˆ†æ˜Ÿæ˜Ÿæ·»åŠ ç‚¹å‡»äº‹ä»¶
    if (!satisfactionRating && recordId) {
      const ratingStars = item.querySelector('.rating-stars');
      if (ratingStars) {
        // ä¸ºæ¯ä¸ªæ˜Ÿæ˜Ÿå•ç‹¬æ·»åŠ ç‚¹å‡»äº‹ä»¶
        const stars = ratingStars.querySelectorAll('.star');
        stars.forEach(star => {
          star.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const rating = parseInt(this.dataset.rating);
            const recordId = ratingStars.dataset.recordId;

            if (rating && recordId) {
              // ç«‹å³æ›´æ–°è§†è§‰æ•ˆæœ
              updateStarVisual(ratingStars, rating);
              // æäº¤è¯„åˆ†
              submitRating(recordId, rating);
            }
          });
          
          // æ·»åŠ æ‚¬åœæ•ˆæœ
          star.addEventListener('mouseenter', function() {
            const rating = parseInt(this.dataset.rating);
            updateStarVisual(ratingStars, rating, true);
          });
        });
        
        // é¼ æ ‡ç¦»å¼€æ—¶é‡ç½®è§†è§‰æ•ˆæœ
        ratingStars.addEventListener('mouseleave', function() {
          updateStarVisual(ratingStars, 0);
        });
      }
    }
  });
}

// æ›´æ–°æ˜Ÿæ˜Ÿè§†è§‰æ•ˆæœ
function updateStarVisual(ratingContainer, rating, isHover = false) {
  const stars = ratingContainer.querySelectorAll('.star');
  stars.forEach((star, index) => {
    const starRating = index + 1;
    if (starRating <= rating) {
      star.style.color = '#ffd700';
    } else {
      star.style.color = 'rgba(255,255,255,0.3)';
    }
  });
}

// ç”Ÿæˆæ˜Ÿæ˜Ÿè¯„åˆ†HTML
function generateStarRating(rating, readonly = false) {
  let stars = '';
  for (let i = 1; i <= 5; i++) {
    const isFilled = i <= rating;
    const starClass = readonly ? 'star-readonly' : 'star';
    const starColor = isFilled ? '#ffd700' : 'rgba(255,255,255,0.3)';
    stars += `<i class="fas fa-star ${starClass}" data-rating="${i}" style="color: ${starColor}; cursor: ${readonly ? 'default' : 'pointer'}; margin-right: 2px; font-size: 0.9rem;"></i>`;
  }
  return stars;
}

// æäº¤æ»¡æ„åº¦è¯„åˆ†
function submitRating(recordId, rating) {

  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  showNotification('æ­£åœ¨æäº¤è¯„åˆ†...', 'info');
  
  fetch('/tools/api/pdf-converter/rating/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify({
      record_id: recordId,
      rating: rating
    })
  })
  .then(response => {

    return response.json();
  })
  .then(data => {

    if (data.success) {
      showNotification(`âœ¨ è¯„åˆ†æäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„åé¦ˆ`, 'success');
      // åˆ·æ–°ç»Ÿè®¡æ•°æ®ä»¥æ›´æ–°æ»¡æ„åº¦
      loadConversionStats();
    } else {
      if (data.error === 'ç”¨æˆ·æœªç™»å½•') {
        showNotification(`è¯·å…ˆç™»å½•åå†è¯„åˆ†`, 'warning');
      } else {
        showNotification(`è¯„åˆ†æäº¤å¤±è´¥: ${data.error}`, 'error');
      }
    }
  })
  .catch(error => {
    console.error('è¯„åˆ†æäº¤é”™è¯¯:', error);
    showNotification('è¯„åˆ†æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•', 'error');
  });
}

// è·å–CSRF Token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// å®‰å…¨çš„ç‚¹å‡»å‡½æ•°
function safeClick(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.click();
  } else {
    console.warn(`Element with id '${elementId}' not found`);
    // ä¸æ˜¾ç¤ºé”™è¯¯é€šçŸ¥ï¼Œé¿å…ç”¨æˆ·ä½“éªŒé—®é¢˜
    // å°è¯•é‡æ–°åˆ›å»ºå…ƒç´ 
    if (elementId === 'fileInput') {
      const uploadArea = document.getElementById('uploadArea');
      if (uploadArea) {
        // é‡æ–°åˆ›å»ºfileInputå…ƒç´ 
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.id = 'fileInput';
        fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff,.txt';
        fileInput.style.display = 'none';
        fileInput.addEventListener('change', handleFileUpload);
        uploadArea.appendChild(fileInput);
        
        // ç°åœ¨ç‚¹å‡»æ–°åˆ›å»ºçš„å…ƒç´ 
        fileInput.click();
      }
    } else if (elementId === 'batchFileInput') {
      // å¤„ç†batchFileInputçš„æƒ…å†µ
      const uploadArea = document.getElementById('uploadArea');
      if (uploadArea) {
        // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨æ‰¹é‡æ¨¡å¼
        const existingBatchInput = document.getElementById('batchFileInput');
        if (!existingBatchInput) {
          // å¦‚æœä¸åœ¨æ‰¹é‡æ¨¡å¼ï¼Œå…ˆåˆ‡æ¢åˆ°æ‰¹é‡æ¨¡å¼
          showBatchUpload();
        } else {
          // å¦‚æœå·²ç»åœ¨æ‰¹é‡æ¨¡å¼ï¼Œç›´æ¥ç‚¹å‡»
          existingBatchInput.click();
        }
      }
    }
  }
}

// æ˜¾ç¤ºæ‰¹é‡ä¸Šä¼ 
function showBatchUpload() {
  const uploadArea = document.getElementById('uploadArea');
  if (!uploadArea) return;
  
  uploadArea.innerHTML = `
    <div class="upload-icon-modern">ğŸ“¦</div>
    <div class="upload-text-modern">æ‰¹é‡æ–‡ä»¶è½¬æ¢</div>
    <div class="upload-hint-modern">æ”¯æŒåŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰¹é‡è½¬æ¢</div>
    <input type="file" id="batchFileInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff" style="display: none;">
    <button class="convert-btn-modern" onclick="safeClick('batchFileInput')" style="margin-top: 1rem;">
      ğŸ“‚ é€‰æ‹©å¤šä¸ªæ–‡ä»¶
    </button>
    <div id="batchFileList" class="file-list-modern"></div>
  `;
  
  // ç»‘å®šæ‰¹é‡æ–‡ä»¶é€‰æ‹©äº‹ä»¶
  const batchFileInput = document.getElementById('batchFileInput');
  if (batchFileInput) {
    batchFileInput.addEventListener('change', handleBatchFileUpload);
  }
  
  // ç§»é™¤uploadAreaçš„onclickäº‹ä»¶ï¼Œé¿å…å†²çª
  uploadArea.removeAttribute('onclick');
  
  // ä¸ºuploadAreaæ·»åŠ æ–°çš„ç‚¹å‡»äº‹ä»¶ï¼Œç›´æ¥è§¦å‘æ‰¹é‡æ–‡ä»¶é€‰æ‹©
  const batchClickHandler = function(e) {
    // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯æŒ‰é’®ï¼Œåˆ™è§¦å‘æ–‡ä»¶é€‰æ‹©
    if (!e.target.closest('button')) {
      safeClick('batchFileInput');
    }
  };
  uploadArea.addEventListener('click', batchClickHandler);
  uploadArea._batchClickHandler = batchClickHandler; // å­˜å‚¨å¼•ç”¨ä»¥ä¾¿åç»­ç§»é™¤
  
  showNotification('å·²åˆ‡æ¢åˆ°æ‰¹é‡ä¸Šä¼ æ¨¡å¼', 'success');
}

// å¤„ç†æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 
function handleBatchFileUpload(event) {
  const files = event.target.files;
  const fileList = document.getElementById('batchFileList');
  
  if (files.length === 0) return;
  
  if (files.length > 10) {
    showNotification('ä¸€æ¬¡æœ€å¤šåªèƒ½è½¬æ¢10ä¸ªæ–‡ä»¶', 'error');
    return;
  }
  
  let fileListHtml = '<h4 style="color: #00d4ff; margin-bottom: 1rem;">å·²é€‰æ‹©çš„æ–‡ä»¶:</h4>';
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    fileListHtml += `
      <div style="background: rgba(255,255,255,0.05); padding: 0.5rem; margin: 0.5rem 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
        <span>${file.name} (${formatFileSize(file.size)})</span>
        <button onclick="removeBatchFile(${i})" style="background: rgba(255,107,107,0.2); border: none; color: #ff6b6b; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
    `;
  }
  
  fileList.innerHTML = fileListHtml;
  
  // æ˜¾ç¤ºæ‰¹é‡è½¬æ¢æŒ‰é’®
  const batchConvertBtn = document.createElement('button');
  batchConvertBtn.className = 'convert-btn-modern';
  batchConvertBtn.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)';
  batchConvertBtn.innerHTML = '<i class="fas fa-cogs"></i><span>å¼€å§‹æ‰¹é‡è½¬æ¢</span>';
  batchConvertBtn.onclick = () => performBatchConversion(files);
  
  fileList.appendChild(batchConvertBtn);
  
  showNotification(`å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`, 'success');
}

// ç§»é™¤æ‰¹é‡æ–‡ä»¶
function removeBatchFile(index) {
  const input = document.getElementById('batchFileInput');
  if (!input) return;
  
  try {
    // ä½¿ç”¨DataTransfer API
    const dt = new DataTransfer();
    
    for (let i = 0; i < input.files.length; i++) {
      if (i !== index) {
        dt.items.add(input.files[i]);
      }
    }
    
    input.files = dt.files;
    
    // é‡æ–°å¤„ç†æ–‡ä»¶åˆ—è¡¨
    handleBatchFileUpload({ target: { files: input.files } });
    
  } catch (error) {
    console.error('ç§»é™¤æ–‡ä»¶å¤±è´¥:', error);
    showNotification('ç§»é™¤æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©æ–‡ä»¶', 'error');
    
    // é‡ç½®æ–‡ä»¶è¾“å…¥
    input.value = '';
    const fileList = document.getElementById('batchFileList');
    if (fileList) {
      fileList.innerHTML = '';
    }
  }
}

// æ‰§è¡Œæ‰¹é‡è½¬æ¢
function performBatchConversion(files) {
  document.getElementById('fileUpload').style.display = 'none';
  document.getElementById('conversionProgress').style.display = 'block';
  
  const formData = new FormData();
  formData.append('type', selectedType);
  
  for (let i = 0; i < files.length; i++) {
    formData.append('files', files[i]);
  }
  
  // æ˜¾ç¤ºè¿›åº¦
  simulateProgress();
  
  // å‘é€æ‰¹é‡è½¬æ¢APIè¯·æ±‚
  fetch('/tools/api/pdf-converter/batch/', {
    method: 'POST',
    body: formData
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    // æ£€æŸ¥å“åº”ç±»å‹ï¼Œé¿å…è§£æHTMLä¸ºJSON
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      return response.json();
    } else {
      throw new Error('æœåŠ¡å™¨è¿”å›éJSONå“åº”ï¼Œä¼šè¯å¯èƒ½å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•');
    }
  })
  .then(data => {
    if (data.success) {
      showBatchConversionResult(data);
    } else {
      showNotification(data.error || 'æ‰¹é‡è½¬æ¢å¤±è´¥', 'error');
      document.getElementById('conversionProgress').style.display = 'none';
    }
  })
  .catch(error => {
    console.error('æ‰¹é‡è½¬æ¢é”™è¯¯:', error);
    let errorMessage = error.message;
    
    // æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º
    if (error.message.includes('Unexpected token')) {
      errorMessage = 'ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•';
    } else if (error.message.includes('éJSONå“åº”')) {
      errorMessage = 'ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•';
    }
    
    showNotification('æ‰¹é‡è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + errorMessage, 'error');
    document.getElementById('conversionProgress').style.display = 'none';
  });
}

// æ˜¾ç¤ºæ‰¹é‡è½¬æ¢ç»“æœ
function showBatchConversionResult(data) {
  if (window.progressInterval) {
    clearInterval(window.progressInterval);
  }
  
  document.getElementById('conversionProgress').style.display = 'none';
  
  const resultContent = document.getElementById('resultContent');
  let resultsHtml = '<div style="text-align: left;">';
  let downloadLinks = [];
  
  data.results.forEach((result, index) => {
    if (result.success) {
      const outputFileName = getOutputFileName ? getOutputFileName(result.filename, data.conversion_type) : result.filename;
      resultsHtml += `
        <div style="background: rgba(0,255,0,0.1); border: 1px solid rgba(0,255,0,0.3); padding: 1rem; margin: 0.5rem 0; border-radius: 8px;">
          <div style="color: #00ff00; font-weight: bold;">âœ… ${result.filename}</div>
          <div style="color: rgba(0,255,0,0.8); font-size: 0.9rem; margin: 0.5rem 0;">è¾“å‡ºæ–‡ä»¶: ${outputFileName}</div>
          <div style="margin-top: 0.5rem;">
            <a href="${result.download_url}" class="download-btn-modern" download="${outputFileName}" style="font-size: 0.9rem;" data-download-url="${result.download_url}" data-filename="${outputFileName}">
              <i class="fas fa-download"></i> ä¸‹è½½
            </a>
          </div>
        </div>
      `;
      downloadLinks.push({url: result.download_url, filename: outputFileName});
    } else {
      resultsHtml += `
        <div style="background: rgba(255,0,0,0.1); border: 1px solid rgba(255,0,0,0.3); padding: 1rem; margin: 0.5rem 0; border-radius: 8px;">
          <div style="color: #ff0000; font-weight: bold;">âŒ ${result.filename}</div>
          <div style="color: rgba(255,0,0,0.8); font-size: 0.9rem;">${result.error}</div>
        </div>
      `;
    }
  });
  
  resultsHtml += '</div>';
  
  resultContent.innerHTML = `
    <div class="result-icon-modern">
      <i class="fas fa-layer-group"></i>
    </div>
    <div class="result-title-modern">âœ… æ‰¹é‡è½¬æ¢å®Œæˆ</div>
    <div class="result-description-modern">
      å…±å¤„ç† ${data.summary.total} ä¸ªæ–‡ä»¶ï¼ŒæˆåŠŸè½¬æ¢ ${data.summary.success} ä¸ª
    </div>
    ${resultsHtml}
    <div class="result-actions-modern">
      <button class="convert-again-btn-modern" onclick="convertAgain()">
        <i class="fas fa-redo"></i>
        è½¬æ¢å…¶ä»–æ–‡ä»¶
      </button>
    </div>
  `;
  
  document.getElementById('conversionResult').style.display = 'block';
  showNotification(`æ‰¹é‡è½¬æ¢å®Œæˆï¼æˆåŠŸ ${data.summary.success}/${data.summary.total}`, 'success');
  
  // è‡ªåŠ¨ä¸‹è½½æ‰€æœ‰æˆåŠŸè½¬æ¢çš„æ–‡ä»¶
  if (downloadLinks.length > 0) {
    setTimeout(() => {
      downloadLinks.forEach((link, index) => {
        setTimeout(() => {
          downloadFile(link.url, link.filename);
          showNotification(`æ­£åœ¨ä¸‹è½½: ${link.filename}`, 'info');
        }, index * 1000); // æ¯ä¸ªæ–‡ä»¶é—´éš”1ç§’ä¸‹è½½
      });
    }, 2000); // 2ç§’åå¼€å§‹è‡ªåŠ¨ä¸‹è½½
  }
}

// è·³è½¬åˆ°è½¬æ¢ç±»å‹é€‰æ‹©
function goToConversionTypes() {
  // é‡ç½®æ‰€æœ‰çŠ¶æ€
  selectedType = '';
  selectedFile = null;
  
  // éšè—æ‰€æœ‰åŒºåŸŸ
  const fileUpload = document.getElementById('fileUpload');
  const conversionProgress = document.getElementById('conversionProgress');
  const conversionResult = document.getElementById('conversionResult');
  
  if (fileUpload) fileUpload.style.display = 'none';
  if (conversionProgress) conversionProgress.style.display = 'none';
  if (conversionResult) conversionResult.style.display = 'none';
  
  // ç§»é™¤é€‰ä¸­çŠ¶æ€
  document.querySelectorAll('.type-card-modern').forEach(card => {
    card.classList.remove('selected');
  });
  
  // é‡ç½®æ–‡ä»¶è¾“å…¥ - æ·»åŠ å®‰å…¨æ£€æŸ¥
  const fileInput = document.getElementById('fileInput');
  if (fileInput) {
    fileInput.value = '';
  }
  
  // é‡ç½®æ–‡æœ¬è¾“å…¥åŒºåŸŸ
  const textInput = document.getElementById('textInput');
  if (textInput) {
    textInput.value = '';
  }
  
  // æ˜¾ç¤ºè½¬æ¢ç±»å‹é€‰æ‹©
  const conversionTypes = document.querySelector('.conversion-types-modern');
  if (conversionTypes) conversionTypes.style.display = 'grid';
  
  // é‡ç½®ä¸Šä¼ åŒºåŸŸæ˜¾ç¤º
  const uploadArea = document.getElementById('uploadArea');
  if (uploadArea) {
    uploadArea.style.display = 'block';
    // é‡ç½®ä¸Šä¼ åŒºåŸŸå†…å®¹
    uploadArea.innerHTML = `
      <div class="upload-icon-modern">
        <i class="fas fa-cloud-upload-alt"></i>
      </div>
      <div class="upload-text-modern">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
      <div class="upload-hint-modern" id="uploadHint">æ”¯æŒå¤šç§æ ¼å¼æ–‡ä»¶</div>
    `;
    // é‡æ–°åˆ›å»ºfileInputå…ƒç´ å¹¶ç»‘å®šäº‹ä»¶
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.id = 'fileInput';
    fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.txt';
    fileInput.style.display = 'none';
    fileInput.addEventListener('change', handleFileUpload);
    uploadArea.appendChild(fileInput);
    
    // æ¢å¤åŸå§‹çš„onclickäº‹ä»¶
    uploadArea.onclick = function() { safeClick('fileInput'); };
    
    // ç§»é™¤ä¹‹å‰æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨
    if (uploadArea._batchClickHandler) {
      uploadArea.removeEventListener('click', uploadArea._batchClickHandler);
      delete uploadArea._batchClickHandler;
    }
  }
  
  // é‡ç½®ä½¿ç”¨æç¤º
  const usageHint = document.getElementById('usageHint');
  if (usageHint) {
    usageHint.style.display = 'block';
    usageHint.innerHTML = `
      <h4 style="margin: 0 0 0.5rem 0; color: #00d4ff;">
        <i class="fas fa-info-circle"></i> æ¬¢è¿ä½¿ç”¨PDFè½¬æ¢å™¨
      </h4>
      <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
        <strong>å¼€å§‹ä½¿ç”¨ï¼š</strong>è¯·å…ˆé€‰æ‹©ä¸Šæ–¹çš„è½¬æ¢ç±»å‹ï¼Œç„¶åæŒ‰ç…§æç¤ºæ“ä½œ
      </p>
    `;
  }
  
  // é‡æ–°åŠ è½½ç»Ÿè®¡æ•°æ®
  loadConversionStats();
  
  // æ»šåŠ¨åˆ°é¡¶éƒ¨
  window.scrollTo({ top: 0, behavior: 'smooth' });
  
  // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
  showNotification('å·²é‡ç½®è½¬æ¢ç•Œé¢ï¼Œå¯ä»¥å¼€å§‹æ–°çš„è½¬æ¢', 'success');
}

// å¿«æ·é”®æ”¯æŒ
document.addEventListener('keydown', function(e) {
  // åªåœ¨éè¾“å…¥æ¡†ä¸­å“åº”å¿«æ·é”®
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
    return;
  }
  
  // Ctrl/Cmd + æ•°å­—é”®åˆ‡æ¢ä¸»é¢˜
  if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
    switch(e.key) {
      case '1':
        e.preventDefault();
        window.location.href = '/tools/life_diary/';
        break;
      case '2':
        e.preventDefault();
        window.location.href = '/tools/creative_writer/';
        break;
      case '3':
        e.preventDefault();
        window.location.href = '/tools/fitness/';
        break;
      case '4':
        e.preventDefault();
        window.location.href = '/tools/emo_diary/';
        break;
    }
  }
  
  // Alt + å­—æ¯é”®è·³è½¬åˆ°å·¥å…·é¡µé¢
  if (e.altKey && !e.ctrlKey && !e.metaKey && !e.shiftKey) {
    switch(e.key.toLowerCase()) {
      case 'e':
        e.preventDefault();
        window.location.href = '/tools/emo_diary/';
        break;
      case 'l':
        e.preventDefault();
        window.location.href = '/tools/life_diary/';
        break;
      case 'f':
        e.preventDefault();
        window.location.href = '/tools/fitness/';
        break;
      case 'c':
        e.preventDefault();
        window.location.href = '/tools/creative_writer/';
        break;
      case 'p':
        e.preventDefault();
        window.location.href = '/tools/pdf_converter/';
        break;
      case 'r':
        e.preventDefault();
        window.location.href = '/tools/redbook_generator/';
        break;
      case 't':
        e.preventDefault();
        window.location.href = '/tools/test_case_generator/';
        break;
      case 'w':
        e.preventDefault();
        window.location.href = '/tools/web_crawler/';
        break;
      case 's':
        e.preventDefault();
        window.location.href = '{% url "tools:self_analysis" %}';
        break;
      case 'b':
        e.preventDefault();
        window.location.href = '/tools/storyboard/';
        break;
      case 'm':
        e.preventDefault();
        window.location.href = '/tools/music_healing/';
        break;
      case 'd':
        e.preventDefault();
        window.location.href = '/tools/meditation_guide/';
        break;
      case 'a':
        e.preventDefault();
        window.location.href = '/tools/fortune_analyzer/';
        break;
    }
  }
});

// åˆå§‹åŒ–å¿«æ·é”®å¸®åŠ©é¢æ¿
function initShortcutsHelp() {
  const helpBtn = document.getElementById('showShortcutsHelp');
  const helpPanel = document.getElementById('shortcutsHelpPanel');
  const closeBtn = document.getElementById('closeShortcutsHelp');
  const overlay = document.getElementById('helpOverlay');
  
  // æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
  if (!helpBtn || !helpPanel || !closeBtn || !overlay) {
    console.warn('å¿«æ·é”®å¸®åŠ©é¢æ¿å…ƒç´ æœªæ‰¾åˆ°ï¼Œè·³è¿‡åˆå§‹åŒ–');
    return;
  }
  
  // æ˜¾ç¤ºå¸®åŠ©é¢æ¿
  helpBtn.addEventListener('click', function() {
    helpPanel.classList.add('show');
    overlay.classList.add('show');
    document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
  });
  
  // å…³é—­å¸®åŠ©é¢æ¿
  function closeHelpPanel() {
    helpPanel.classList.remove('show');
    overlay.classList.remove('show');
    document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨
  }
  
  closeBtn.addEventListener('click', closeHelpPanel);
  overlay.addEventListener('click', closeHelpPanel);
  
  // ESCé”®å…³é—­å¸®åŠ©é¢æ¿
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && helpPanel.classList.contains('show')) {
      closeHelpPanel();
    }
  });
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // åˆå§‹åŒ–å¿«æ·é”®å¸®åŠ©é¢æ¿
    initShortcutsHelp();
    
    // æ£€æŸ¥PDFè½¬æ¢å™¨çŠ¶æ€
    checkPDFConverterStatus();
});

// æ£€æŸ¥PDFè½¬æ¢å™¨çŠ¶æ€
function checkPDFConverterStatus() {
    fetch('/tools/api/pdf-converter/status/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const status = data.status;
                const features = data.features || {};

                // å¦‚æœpdf2docxä¸å¯ç”¨ï¼Œæ˜¾ç¤ºè­¦å‘Š
                if (features.pdf_to_word === false) {
                    showNotification('PDFè½¬æ¢åŠŸèƒ½å¯èƒ½å—é™ï¼Œè¯·æ£€æŸ¥ç³»ç»ŸçŠ¶æ€', 'warning');
                }
            }
        })
        .catch(error => {
            console.error('çŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
        });
}

// æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€
function showSystemStatus() {
    fetch('/tools/api/pdf-converter/status/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const features = data.features;
                let statusHtml = '<div style="text-align: left; max-width: 500px;">';
                statusHtml += '<h4 style="color: #00d4ff; margin-bottom: 1rem;">ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h4>';
                
                // æ˜¾ç¤ºå„ä¸ªç»„ä»¶çš„çŠ¶æ€
                const components = [
                    { key: 'pdf_to_word', name: 'PDFè½¬Word', description: 'PDFè½¬Wordè½¬æ¢åŠŸèƒ½' },
                    { key: 'word_to_pdf', name: 'Wordè½¬PDF', description: 'Wordè½¬PDFè½¬æ¢åŠŸèƒ½' },
                    { key: 'pdf_processing', name: 'PDFå¤„ç†', description: 'PDFæ–‡ä»¶å¤„ç†åŠŸèƒ½' },
                    { key: 'word_processing', name: 'Wordå¤„ç†', description: 'Wordæ–‡æ¡£å¤„ç†åŠŸèƒ½' },
                    { key: 'image_processing', name: 'å›¾ç‰‡å¤„ç†', description: 'å›¾ç‰‡å¤„ç†åŠŸèƒ½' }
                ];
                
                // å®‰å…¨æ£€æŸ¥featureså¯¹è±¡
                if (!features || typeof features !== 'object') {
                    features = {};
                }
                
                components.forEach(comp => {
                    const isAvailable = features[comp.key] || false;
                    statusHtml += `
                        <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span style="color: ${isAvailable ? '#00ff00' : '#ff0000'}; font-weight: bold;">
                                        ${isAvailable ? 'âœ…' : 'âŒ'}
                                    </span>
                                    <span style="color: white; margin-left: 0.5rem;">${comp.name}</span>
                                </div>
                                <span style="color: ${isAvailable ? '#00ff00' : '#ff0000'}; font-size: 0.8rem;">
                                    ${isAvailable ? 'æ­£å¸¸' : 'ä¸å¯ç”¨'}
                                </span>
                            </div>
                            <div style="color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-top: 0.25rem;">
                                ${comp.description}
                            </div>
                        </div>
                    `;
                });
                
                // æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
                statusHtml += `
                    <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(0,212,255,0.1); border-radius: 8px;">
                        <div style="color: #00d4ff; font-weight: bold; margin-bottom: 0.5rem;">ç³»ç»Ÿä¿¡æ¯</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.8rem;">
                            <div>Pythonç‰ˆæœ¬: ${features.python_version || 'æœªçŸ¥'}</div>
                            <div>æœåŠ¡å™¨æ—¶é—´: ${features.server_time ? new Date(features.server_time).toLocaleString() : 'æœªçŸ¥'}</div>
                        </div>
                    </div>
                `;
                
                // æ˜¾ç¤ºæ”¯æŒçš„æ–‡ä»¶æ ¼å¼
                if (features.supported_formats) {
                    statusHtml += `
                        <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(0,212,255,0.1); border-radius: 8px;">
                            <div style="color: #00d4ff; font-weight: bold; margin-bottom: 0.5rem;">æ”¯æŒçš„æ–‡ä»¶æ ¼å¼</div>
                            <div style="color: rgba(255,255,255,0.8); font-size: 0.8rem;">
                                ${Object.entries(features.supported_formats).map(([type, formats]) => 
                                    `<div><strong>${type}:</strong> ${formats.join(', ')}</div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                statusHtml += '</div>';
                
                // æ˜¾ç¤ºçŠ¶æ€å¯¹è¯æ¡†
                showStatusDialog(statusHtml);
            } else {
                showNotification('æ— æ³•è·å–ç³»ç»ŸçŠ¶æ€', 'error');
            }
        })
        .catch(error => {
            console.error('çŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
            showNotification('ç³»ç»ŸçŠ¶æ€æ£€æŸ¥å¤±è´¥', 'error');
        });
}

// æ˜¾ç¤ºçŠ¶æ€å¯¹è¯æ¡†
function showStatusDialog(content) {
    // åˆ›å»ºå¯¹è¯æ¡†
    const dialog = document.createElement('div');
    dialog.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 10000;
        display: flex; justify-content: center; align-items: center;
    `;
    
    const dialogContent = document.createElement('div');
    dialogContent.style.cssText = `
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        border-radius: 12px; padding: 2rem; max-width: 600px; max-height: 80vh;
        overflow-y: auto; position: relative;
    `;
    
    dialogContent.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="color: #00d4ff; margin: 0;">ç³»ç»ŸçŠ¶æ€</h3>
            <button onclick="this.closest('.status-dialog').remove()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">Ã—</button>
        </div>
        ${content}
        <div style="margin-top: 1.5rem; text-align: center;">
            <button onclick="this.closest('.status-dialog').remove()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                å…³é—­
            </button>
        </div>
    `;
    
    dialog.className = 'status-dialog';
    dialog.appendChild(dialogContent);
    document.body.appendChild(dialog);
    
    // ç‚¹å‡»èƒŒæ™¯å…³é—­
    dialog.addEventListener('click', function(e) {
        if (e.target === dialog) {
            dialog.remove();
        }
    });
}

// å¯é çš„ä¸‹è½½å‡½æ•°
function downloadFile(url, filename) {

    if (!url) {
        console.error('ä¸‹è½½URLä¸ºç©º');
        showNotification('ä¸‹è½½é“¾æ¥æ— æ•ˆ', 'error');
        return;
    }
    
    // ç¡®ä¿URLæ˜¯å®Œæ•´çš„
    if (!url.startsWith('http')) {
        url = window.location.origin + url;
    }

    // æ–¹æ³•1: ä½¿ç”¨fetchä¸‹è½½
    fetch(url, {
        method: 'GET',
        headers: {
            'Accept': '*/*',
        },
        credentials: 'same-origin'
    })
    .then(response => {


        if (response.ok) {
            return response.blob();
        }
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    })
    .then(blob => {

        if (blob.size === 0) {
            throw new Error('ä¸‹è½½çš„æ–‡ä»¶å¤§å°ä¸º0');
        }
        
        // åˆ›å»ºä¸‹è½½é“¾æ¥
        const downloadUrl = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = downloadUrl;
        link.download = filename;
        link.style.display = 'none';
        document.body.appendChild(link);
        
        // è§¦å‘ä¸‹è½½
        link.click();
        
        // æ¸…ç†
        document.body.removeChild(link);
        window.URL.revokeObjectURL(downloadUrl);

        showNotification(`æ–‡ä»¶ "${filename}" ä¸‹è½½æˆåŠŸ`, 'success');
    })
    .catch(error => {
        console.error(`ä¸‹è½½å¤±è´¥: ${error.message}`);
        
        // æ–¹æ³•2: å¤‡ç”¨ä¸‹è½½æ–¹æ³• - ç›´æ¥é“¾æ¥

        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.target = '_blank';
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showNotification(`ä½¿ç”¨å¤‡ç”¨æ–¹æ³•ä¸‹è½½: ${filename}`, 'info');
        
        // æ–¹æ³•3: å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œæç¤ºç”¨æˆ·æ‰‹åŠ¨ä¸‹è½½
        setTimeout(() => {
            showNotification(`å¦‚æœä¸‹è½½å¤±è´¥ï¼Œè¯·å³é”®ç‚¹å‡»é“¾æ¥é€‰æ‹©"å¦å­˜ä¸º"`, 'warning');
        }, 2000);
    });
}

// å¢å¼ºçš„æ‰¹é‡ä¸‹è½½å‡½æ•°
function downloadMultipleFiles(downloadLinks) {
    if (!downloadLinks || downloadLinks.length === 0) {

        return;
    }

    downloadLinks.forEach((link, index) => {
        setTimeout(() => {

            downloadFile(link.url, link.filename);
            showNotification(`æ­£åœ¨ä¸‹è½½: ${link.filename}`, 'info');
        }, index * 1500); // æ¯ä¸ªæ–‡ä»¶é—´éš”1.5ç§’ä¸‹è½½
    });
}
</script>
{% endblock %} 