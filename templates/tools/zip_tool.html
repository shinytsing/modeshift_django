{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
.zip-tool-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.zip-header {
    text-align: center;
    margin-bottom: 40px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.zip-header h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
    font-weight: 300;
}

.zip-header p {
    font-size: 1.2em;
    opacity: 0.9;
}

.zip-tabs {
    display: flex;
    background: #f8f9fa;
    border-radius: 10px;
    padding: 5px;
    margin-bottom: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.zip-tab {
    flex: 1;
    padding: 15px 20px;
    text-align: center;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-weight: 600;
    color: #2c3e50;
    font-size: 16px;
}

.zip-tab.active {
    background: white;
    color: #667eea;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.input-method-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.method-tab {
    padding: 12px 22px;
    border: 2px solid #d1d9e0;
    background: white;
    color: #2c3e50;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 15px;
}

.method-tab:hover {
    border-color: #667eea;
    color: #667eea;
    transform: translateY(-1px);
}

.method-tab.active {
    background: #667eea;
    border-color: #667eea;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.zip-tab:hover {
    background: rgba(102, 126, 234, 0.1);
}

.zip-content {
    display: none;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.zip-content.active {
    display: block;
}

.form-group {
    margin-bottom: 25px;
}

.form-group label {
    display: block;
    margin-bottom: 10px;
    font-weight: 700;
    color: #1a252f;
    font-size: 16px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.form-control {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #d1d9e0;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #ffffff;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    color: #1a252f;
    font-weight: 600;
    line-height: 1.5;
}

.form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1), inset 0 1px 3px rgba(0,0,0,0.1);
    background: #ffffff;
    transform: translateY(-1px);
    color: #333333;
}

.form-control:hover {
    border-color: #5a6fd8;
    background: #f8f9fa;
    color: #333333;
}

        /* é€‰æ‹©æ¡†ç‰¹æ®Šæ ·å¼ */
        select.form-control {
            background-color: #ffffff;
            color: #1a252f;
            font-weight: 700;
            padding-right: 45px; /* ä¸ºä¸‹æ‹‰ç®­å¤´ç•™å‡ºæ›´å¤šç©ºé—´ */
            font-size: 16px;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px 16px;
        }

select.form-control:focus {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235a6fd8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px 16px;
    background-color: #ffffff;
    color: #333333;
}

select.form-control:hover {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px 16px;
    background-color: #f8f9fa;
    color: #333333;
}

/* è¾“å…¥æ¡†å ä½ç¬¦æ ·å¼ */
.form-control::placeholder {
    color: #5a6c7d;
    opacity: 1;
    font-style: italic;
    font-weight: 500;
}

.file-input-container {
    position: relative;
    display: inline-block;
    width: 100%;
}

.file-input {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.file-input-label {
    display: block;
    padding: 20px;
    border: 2px dashed #667eea;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(102, 126, 234, 0.1) 100%);
    position: relative;
    overflow: hidden;
}

.file-input-label::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
}

.file-input-label:hover::before {
    left: 100%;
}

.file-input-label:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.15) 100%);
    border-color: #5a6fd8;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
}

.file-list {
    margin-top: 15px;
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #e1e5e9;
    border-radius: 8px;
    padding: 10px;
}

.file-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 14px;
    margin-bottom: 6px;
    background: #f1f4f6;
    border-radius: 6px;
    font-size: 15px;
    color: #2c3e50;
    font-weight: 500;
    border: 1px solid #e6ebef;
}

.file-item:last-child {
    margin-bottom: 0;
}

.remove-file {
    color: #dc3545;
    cursor: pointer;
    font-weight: bold;
}

.compression-slider {
    width: 100%;
    margin: 10px 0;
}

.compression-value {
    text-align: center;
    font-weight: 700;
    color: #1a252f;
    margin-top: 6px;
    font-size: 18px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.btn {
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-success:hover {
    background: #218838;
    transform: translateY(-2px);
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-danger:hover {
    background: #c82333;
    transform: translateY(-2px);
}

.result-container {
    margin-top: 30px;
    padding: 20px;
    border-radius: 10px;
    display: none;
}

.result-success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
}

.result-error {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
}

.zip-info {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-top: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.zip-info h4 {
    margin-bottom: 15px;
    color: #333;
}

.info-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    padding: 5px 0;
    border-bottom: 1px solid #eee;
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    font-weight: 700;
    color: #2c3e50;
    font-size: 15px;
}

.info-value {
    color: #1a252f;
    font-weight: 600;
    font-size: 15px;
}

.progress-container {
    margin: 20px 0;
    display: none;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e1e5e9;
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    width: 0%;
    transition: width 0.3s ease;
}

.progress-text {
    text-align: center;
    margin-top: 10px;
    font-size: 16px;
    color: #2c3e50;
    font-weight: 600;
}

.feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.feature-card {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    text-align: center;
    transition: transform 0.3s ease;
}

.feature-card:hover {
    transform: translateY(-5px);
}

.feature-icon {
    font-size: 3em;
    margin-bottom: 15px;
    color: #667eea;
}

.feature-title {
    font-size: 1.3em;
    font-weight: 600;
    margin-bottom: 10px;
    color: #333;
}

 .feature-description {
     color: #4a5568;
     line-height: 1.6;
     font-size: 15px;
     font-weight: 500;
 }
 
 /* å…¨å±€æ“ä½œæŒ‰é’® */
 .global-actions {
     position: fixed;
     bottom: 30px;
     right: 30px;
     display: flex;
     gap: 15px;
     z-index: 1000;
     background: rgba(255, 255, 255, 0.95);
     padding: 15px;
     border-radius: 15px;
     box-shadow: 0 10px 30px rgba(0,0,0,0.2);
     backdrop-filter: blur(10px);
 }
 
 .global-btn {
     padding: 12px 20px;
     border: none;
     border-radius: 10px;
     font-weight: 600;
     cursor: pointer;
     transition: all 0.3s ease;
     display: flex;
     align-items: center;
     gap: 8px;
     font-size: 14px;
     text-decoration: none;
 }
 
 .global-btn.primary {
     background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
     color: white;
 }
 
 .global-btn.primary:hover {
     transform: translateY(-3px);
     box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
 }
 
 .global-btn.secondary {
     background: #4a90e2;
     color: white;
 }
 
 .global-btn.secondary:hover {
     background: #357abd;
     transform: translateY(-3px);
     box-shadow: 0 8px 25px rgba(74, 144, 226, 0.4);
 }
 
 .global-btn.danger {
     background: #e74c3c;
     color: white;
 }
 
 .global-btn.danger:hover {
     background: #c0392b;
     transform: translateY(-3px);
     box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
 }

@media (max-width: 768px) {
    .zip-tool-container {
        padding: 10px;
    }
    
    .zip-header h1 {
        font-size: 2em;
    }
    
    .zip-tabs {
        flex-direction: column;
    }
    
    .zip-content {
        padding: 20px;
    }
    
    .feature-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="zip-tool-container">
    <div class="zip-header">
        <h1>ğŸ“¦ ZIPæ–‡ä»¶å¤„ç†å·¥å…·</h1>
        <p>{{ description }}</p>
    </div>

    <div class="zip-tabs">
        <div class="zip-tab active" data-tab="multi-files">
            ğŸ“ å¤šæ–‡ä»¶æ‰“åŒ…
        </div>
        <div class="zip-tab" data-tab="directory">
            ğŸ“‚ ç›®å½•æ‰“åŒ…
        </div>
        <div class="zip-tab" data-tab="single-file">
            ğŸ“„ å•æ–‡ä»¶å‹ç¼©
        </div>
        <div class="zip-tab" data-tab="extract">
            ğŸ”“ è§£å‹æ–‡ä»¶
        </div>
    </div>

    <!-- å¤šæ–‡ä»¶æ‰“åŒ… -->
    <div class="zip-content active" id="multi-files">
        <h3>ğŸ“ å¤šæ–‡ä»¶æ‰“åŒ…</h3>
        <p>é€‰æ‹©å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰“åŒ…å‹ç¼©</p>
        
        <div class="form-group">
            <label>é€‰æ‹©æ–‡ä»¶ï¼š</label>
            <div class="file-input-container">
                <input type="file" class="file-input" id="multiFileInput" multiple>
                <label for="multiFileInput" class="file-input-label">
                    ğŸ“ ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„
                </label>
            </div>
            <div class="file-list" id="multiFileList"></div>
        </div>

        <div class="form-group">
            <label>ZIPæ–‡ä»¶åï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <input type="text" class="form-control" id="multiZipName" placeholder="ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å">
        </div>

        <div class="form-group">
            <label>å‹ç¼©çº§åˆ«ï¼š<span id="multiCompressionValue">6</span></label>
            <input type="range" class="compression-slider" id="multiCompressionLevel" min="0" max="9" value="6">
        </div>

        <div class="form-group">
            <label>å‹ç¼©æ–¹æ³•ï¼š</label>
            <select class="form-control" id="multiCompressionMethod">
                <option value="auto">è‡ªåŠ¨é€‰æ‹©ï¼ˆæ¨èï¼‰</option>
                <option value="zip">ZIP - é€šç”¨å‹ç¼©</option>
                <option value="gz">GZIP - æ–‡æœ¬æ–‡ä»¶ä¼˜åŒ–</option>
                <option value="bz2">BZIP2 - é«˜å‹ç¼©æ¯”</option>
                <option value="xz">XZ - æœ€é«˜å‹ç¼©æ¯”</option>
                <option value="7z">7Z - ä¸“ä¸šå‹ç¼©</option>
                <option value="tar.gz">TAR+GZ - å½’æ¡£å‹ç¼©</option>
            </select>
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" id="multiIncludePaths" checked>
                åŒ…å«æ–‡ä»¶è·¯å¾„ç»“æ„
            </label>
        </div>

        <button class="btn btn-primary" onclick="createMultiFileZip()">
            ğŸ“¦ åˆ›å»ºZIPåŒ…
        </button>

        <div class="progress-container" id="multiProgress">
            <div class="progress-bar">
                <div class="progress-fill" id="multiProgressFill"></div>
            </div>
            <div class="progress-text" id="multiProgressText">å¤„ç†ä¸­...</div>
        </div>

        <div class="result-container" id="multiResult"></div>
    </div>

    <!-- ç›®å½•æ‰“åŒ… -->
    <div class="zip-content" id="directory">
        <h3>ğŸ“‚ ç›®å½•æ‰“åŒ…</h3>
        <p>å°†æ•´ä¸ªç›®å½•æ‰“åŒ…æˆZIPæ–‡ä»¶</p>
        
        <div class="form-group">
            <label>ç›®å½•è·¯å¾„ï¼š</label>
            <input type="text" class="form-control" id="directoryPath" placeholder="è¯·è¾“å…¥ç›®å½•è·¯å¾„ï¼Œå¦‚ï¼š/path/to/directory">
        </div>

        <div class="form-group">
            <label>ZIPæ–‡ä»¶åï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <input type="text" class="form-control" id="dirZipName" placeholder="ç•™ç©ºå°†ä½¿ç”¨ç›®å½•å">
        </div>

        <div class="form-group">
            <label>å‹ç¼©çº§åˆ«ï¼š<span id="dirCompressionValue">6</span></label>
            <input type="range" class="compression-slider" id="dirCompressionLevel" min="0" max="9" value="6">
        </div>

        <div class="form-group">
            <label>æ’é™¤æ¨¡å¼ï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <input type="text" class="form-control" id="excludePatterns" placeholder="ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼š*.log,*.tmp,__pycache__">
        </div>

        <button class="btn btn-primary" onclick="createDirectoryZip()">
            ğŸ“¦ åˆ›å»ºç›®å½•ZIPåŒ…
        </button>

        <div class="progress-container" id="dirProgress">
            <div class="progress-bar">
                <div class="progress-fill" id="dirProgressFill"></div>
            </div>
            <div class="progress-text" id="dirProgressText">å¤„ç†ä¸­...</div>
        </div>

        <div class="result-container" id="dirResult"></div>
    </div>

    <!-- å•æ–‡ä»¶å‹ç¼© -->
    <div class="zip-content" id="single-file">
        <h3>ğŸ“„ å•æ–‡ä»¶å‹ç¼©</h3>
        <p>å‹ç¼©å•ä¸ªæ–‡ä»¶</p>
        
        <div class="form-group">
            <label>é€‰æ‹©æ–‡ä»¶ï¼š</label>
            <div class="file-input-container">
                <input type="file" class="file-input" id="singleFileInput">
                <label for="singleFileInput" class="file-input-label">
                    ğŸ“„ ç‚¹å‡»é€‰æ‹©è¦å‹ç¼©çš„æ–‡ä»¶
                </label>
            </div>
            <div class="file-list" id="singleFileList"></div>
        </div>

        <div class="form-group">
            <label>å‹ç¼©çº§åˆ«ï¼š<span id="singleCompressionValue">9</span></label>
            <input type="range" class="compression-slider" id="singleCompressionLevel" min="0" max="9" value="9">
        </div>

        <div class="form-group">
            <label>å‹ç¼©æ–¹æ³•ï¼š</label>
            <select class="form-control" id="singleCompressionMethod">
                <option value="auto">è‡ªåŠ¨é€‰æ‹©ï¼ˆæ¨èï¼‰</option>
                <option value="zip">ZIP - é€šç”¨å‹ç¼©</option>
                <option value="gz">GZIP - æ–‡æœ¬æ–‡ä»¶ä¼˜åŒ–</option>
                <option value="bz2">BZIP2 - é«˜å‹ç¼©æ¯”</option>
                <option value="xz">XZ - æœ€é«˜å‹ç¼©æ¯”</option>
                <option value="7z">7Z - ä¸“ä¸šå‹ç¼©</option>
            </select>
        </div>

        <button class="btn btn-primary" onclick="compressSingleFile()">
            ğŸ“¦ å‹ç¼©æ–‡ä»¶
        </button>

        <div class="progress-container" id="singleProgress">
            <div class="progress-bar">
                <div class="progress-fill" id="singleProgressFill"></div>
            </div>
            <div class="progress-text" id="singleProgressText">å‹ç¼©ä¸­...</div>
        </div>

        <div class="result-container" id="singleResult"></div>
    </div>

    <!-- è§£å‹æ–‡ä»¶ -->
    <div class="zip-content" id="extract">
        <h3>ğŸ”“ è§£å‹ZIPæ–‡ä»¶</h3>
        <p>è§£å‹ZIPæ–‡ä»¶åˆ°æŒ‡å®šç›®å½•</p>
        
        <div class="form-group">
            <label>ZIPæ–‡ä»¶è·¯å¾„ï¼š</label>
            <input type="text" class="form-control" id="extractZipPath" placeholder="è¯·è¾“å…¥ZIPæ–‡ä»¶è·¯å¾„">
        </div>

        <div class="form-group">
            <label>è§£å‹ç›®æ ‡ç›®å½•ï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <input type="text" class="form-control" id="extractToPath" placeholder="ç•™ç©ºå°†è§£å‹åˆ°ä¸´æ—¶ç›®å½•">
        </div>

        <button class="btn btn-success" onclick="extractZip()">
            ğŸ”“ è§£å‹æ–‡ä»¶
        </button>

        <div class="progress-container" id="extractProgress">
            <div class="progress-bar">
                <div class="progress-fill" id="extractProgressFill"></div>
            </div>
            <div class="progress-text" id="extractProgressText">è§£å‹ä¸­...</div>
        </div>

        <div class="result-container" id="extractResult"></div>
    </div>

         <!-- å…¨å±€æ“ä½œæŒ‰é’® -->
     <div class="global-actions" id="globalActions" style="display: none;">
         <button class="global-btn primary" id="downloadZipBtn">
             <i class="fas fa-download"></i>
             ä¸‹è½½ZIPæ–‡ä»¶
         </button>
         <button class="global-btn secondary" id="createNewZipBtn">
             <i class="fas fa-plus"></i>
             åˆ›å»ºæ–°ZIP
         </button>
         <button class="global-btn danger" id="clearAllBtn">
             <i class="fas fa-trash"></i>
             æ¸…ç©ºæ‰€æœ‰
         </button>
     </div>

     <!-- åŠŸèƒ½ç‰¹æ€§å±•ç¤º -->
     <div class="feature-grid">
         <div class="feature-card">
             <div class="feature-icon">ğŸ“¦</div>
             <div class="feature-title">å¤šæ–‡ä»¶æ‰“åŒ…</div>
             <div class="feature-description">
                 æ”¯æŒåŒæ—¶é€‰æ‹©å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰“åŒ…ï¼Œä¿æŒæ–‡ä»¶ç»“æ„æˆ–æ‰å¹³åŒ–å­˜å‚¨
             </div>
         </div>
         
         <div class="feature-card">
             <div class="feature-icon">ğŸ“‚</div>
             <div class="feature-title">ç›®å½•æ‰“åŒ…</div>
             <div class="feature-description">
                 å°†æ•´ä¸ªç›®å½•åŠå…¶å­ç›®å½•æ‰“åŒ…ï¼Œæ”¯æŒæ’é™¤ç‰¹å®šæ–‡ä»¶ç±»å‹
             </div>
         </div>
         
         <div class="feature-card">
             <div class="feature-icon">ğŸ“„</div>
             <div class="feature-title">å•æ–‡ä»¶å‹ç¼©</div>
             <div class="feature-description">
                 å¯¹å•ä¸ªæ–‡ä»¶è¿›è¡Œé«˜å‹ç¼©æ¯”å‹ç¼©ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
             </div>
         </div>
         
         <div class="feature-card">
             <div class="feature-icon">ğŸ”“</div>
             <div class="feature-title">æ–‡ä»¶è§£å‹</div>
             <div class="feature-description">
                 è§£å‹ZIPæ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ï¼Œæ”¯æŒæŸ¥çœ‹å‹ç¼©ä¿¡æ¯
             </div>
         </div>
         
         <div class="feature-card">
             <div class="feature-icon">âš™ï¸</div>
             <div class="feature-title">å‹ç¼©çº§åˆ«</div>
             <div class="feature-description">
                 æ”¯æŒ0-9çº§å‹ç¼©ï¼Œå¹³è¡¡å‹ç¼©æ¯”å’Œå¤„ç†é€Ÿåº¦
             </div>
         </div>
         
         <div class="feature-card">
             <div class="feature-icon">ğŸ“Š</div>
             <div class="feature-title">è¯¦ç»†ä¿¡æ¯</div>
             <div class="feature-description">
                 æ˜¾ç¤ºæ–‡ä»¶æ•°é‡ã€å¤§å°ã€å‹ç¼©æ¯”ç­‰è¯¦ç»†ä¿¡æ¯
             </div>
         </div>
     </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// å…¨å±€å˜é‡
let selectedFiles = {
    multi: [],
    single: null
};

// æ ‡ç­¾é¡µåˆ‡æ¢
document.querySelectorAll('.zip-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
        document.querySelectorAll('.zip-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.zip-content').forEach(c => c.classList.remove('active'));
        
        // æ·»åŠ æ´»åŠ¨çŠ¶æ€
        this.classList.add('active');
        document.getElementById(this.dataset.tab).classList.add('active');
    });
});

// å‹ç¼©çº§åˆ«æ»‘å—
document.querySelectorAll('.compression-slider').forEach(slider => {
    slider.addEventListener('input', function() {
        const value = this.value;
        const valueDisplay = this.parentElement.querySelector('.compression-value') || 
                           this.parentElement.querySelector('span');
        if (valueDisplay) {
            valueDisplay.textContent = value;
        }
    });
});

// å¤šæ–‡ä»¶é€‰æ‹©
document.getElementById('multiFileInput').addEventListener('change', function(e) {
    selectedFiles.multi = Array.from(e.target.files);
    displayFileList('multiFileList', selectedFiles.multi);
});

// å•æ–‡ä»¶é€‰æ‹©
document.getElementById('singleFileInput').addEventListener('change', function(e) {
    selectedFiles.single = e.target.files[0];
    displayFileList('singleFileList', selectedFiles.single ? [selectedFiles.single] : []);
});

// æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨
function displayFileList(containerId, files) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    files.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.innerHTML = `
            <span>${file.name} (${formatFileSize(file.size)})</span>
            <span class="remove-file" onclick="removeFile('${containerId}', ${index})">Ã—</span>
        `;
        container.appendChild(fileItem);
    });
}

// ç§»é™¤æ–‡ä»¶
function removeFile(containerId, index) {
    if (containerId === 'multiFileList') {
        selectedFiles.multi.splice(index, 1);
        displayFileList(containerId, selectedFiles.multi);
    } else if (containerId === 'singleFileList') {
        selectedFiles.single = null;
        displayFileList(containerId, []);
    }
}

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// æ˜¾ç¤ºè¿›åº¦æ¡
function showProgress(progressId, textId, fillId) {
    document.getElementById(progressId).style.display = 'block';
    document.getElementById(textId).textContent = 'å¤„ç†ä¸­...';
    document.getElementById(fillId).style.width = '0%';
    
    // æ¨¡æ‹Ÿè¿›åº¦
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        document.getElementById(fillId).style.width = progress + '%';
    }, 200);
    
    return interval;
}

// éšè—è¿›åº¦æ¡
function hideProgress(progressId) {
    document.getElementById(progressId).style.display = 'none';
}

 // æ˜¾ç¤ºç»“æœ
 function showResult(containerId, success, message, data = null) {
     const container = document.getElementById(containerId);
     container.style.display = 'block';
     container.className = `result-container ${success ? 'result-success' : 'result-error'}`;
     
     let html = `<h4>${success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}</h4><p>${message}</p>`;
     
     if (success && data) {
         if (data.file_url) {
             html += `<p><a href="${data.file_url}" class="btn btn-success" download>ğŸ“¥ ä¸‹è½½å‹ç¼©æ–‡ä»¶</a></p>`;
             
             // ä¿å­˜å½“å‰å‹ç¼©æ–‡ä»¶ä¿¡æ¯å¹¶æ˜¾ç¤ºå…¨å±€æŒ‰é’®
             currentZipFile = {
                 file_url: data.file_url,
                 file_name: data.file_path ? data.file_path.split('/').pop() : 'download.zip',
                 compression_info: data.compression_info
             };
             showGlobalActions();
         }
         
         if (data.compression_info && typeof data.compression_info === 'object') {
             const info = data.compression_info;

             html += `
                 <div class="zip-info">
                     <h4>ğŸ“Š å‹ç¼©æ–‡ä»¶ä¿¡æ¯</h4>
                     <div class="info-item">
                         <span class="info-label">å‹ç¼©æ–¹æ³•ï¼š</span>
                         <span class="info-value">${info.compression_method || 'æœªçŸ¥'}</span>
                     </div>
                     ${info.file_count ? `
                     <div class="info-item">
                         <span class="info-label">æ–‡ä»¶æ•°é‡ï¼š</span>
                         <span class="info-value">${info.file_count}</span>
                     </div>
                     ` : ''}
                     ${info.original_size ? `
                     <div class="info-item">
                         <span class="info-label">åŸå§‹å¤§å°ï¼š</span>
                         <span class="info-value">${formatFileSize(info.original_size)}</span>
                     </div>
                     ` : ''}
                     ${info.compressed_size ? `
                     <div class="info-item">
                         <span class="info-label">å‹ç¼©åå¤§å°ï¼š</span>
                         <span class="info-value">${formatFileSize(info.compressed_size)}</span>
                     </div>
                     ` : ''}
                     ${info.compression_ratio !== undefined && info.compression_ratio !== null ? `
                     <div class="info-item">
                         <span class="info-label">å‹ç¼©ç‡ï¼š</span>
                         <span class="info-value">${parseFloat(info.compression_ratio).toFixed(1)}%</span>
                     </div>
                     ` : ''}
                     <div class="info-item">
                         <span class="info-label">æ–‡ä»¶å¤§å°ï¼š</span>
                         <span class="info-value">${formatFileSize(info.file_size)}</span>
                     </div>
                     ${info.files && info.files.length > 0 ? `
                     <div class="info-item">
                         <span class="info-label">åŒ…å«æ–‡ä»¶ï¼š</span>
                         <span class="info-value">${info.files.slice(0, 5).join(', ')}${info.files.length > 5 ? '...' : ''}</span>
                     </div>
                     ` : ''}
                 </div>
             `;
         }
     }
     
     container.innerHTML = html;
     
     // æ˜¾ç¤ºé€šçŸ¥
     if (success) {
         showNotification(message, 'success');
     } else {
         showNotification(message, 'error');
     }
 }

// åˆ›å»ºå¤šæ–‡ä»¶ZIP
async function createMultiFileZip() {
    if (selectedFiles.multi.length === 0) {
        alert('è¯·é€‰æ‹©è¦æ‰“åŒ…çš„æ–‡ä»¶');
        return;
    }
    
    const zipName = document.getElementById('multiZipName').value;
    const compressionLevel = parseInt(document.getElementById('multiCompressionLevel').value);
    const compressionMethod = document.getElementById('multiCompressionMethod').value;
    const includePaths = document.getElementById('multiIncludePaths').checked;
    
    // æ˜¾ç¤ºè¿›åº¦æ¡
    const progressInterval = showProgress('multiProgress', 'multiProgressText', 'multiProgressFill');
    
    try {
        // åˆ›å»ºFormDataå¯¹è±¡
        const formData = new FormData();
        
        // æ·»åŠ æ–‡ä»¶
        selectedFiles.multi.forEach(file => {
            formData.append('files', file);
        });
        
        // æ·»åŠ å…¶ä»–å‚æ•°
        formData.append('zip_name', zipName);
        formData.append('compression_level', compressionLevel);
        formData.append('compression_method', compressionMethod);
        formData.append('include_paths', includePaths);
        
        // å‘é€è¯·æ±‚
        const response = await fetch('/tools/api/zip/create-from-uploaded-files/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: formData
        });
        
        const result = await response.json();
        
        // éšè—è¿›åº¦æ¡
        clearInterval(progressInterval);
        hideProgress('multiProgress');
        
        // æ˜¾ç¤ºç»“æœ
        showResult('multiResult', result.success, result.message, result);
        
    } catch (error) {
        clearInterval(progressInterval);
        hideProgress('multiProgress');
        showResult('multiResult', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
    }
}

// åˆ›å»ºç›®å½•ZIP
async function createDirectoryZip() {
    const directoryPath = document.getElementById('directoryPath').value.trim();
    if (!directoryPath) {
        alert('è¯·è¾“å…¥ç›®å½•è·¯å¾„');
        return;
    }
    
    const zipName = document.getElementById('dirZipName').value;
    const compressionLevel = parseInt(document.getElementById('dirCompressionLevel').value);
    const excludePatterns = document.getElementById('excludePatterns').value
        .split(',').map(p => p.trim()).filter(p => p);
    
    // æ˜¾ç¤ºè¿›åº¦æ¡
    const progressInterval = showProgress('dirProgress', 'dirProgressText', 'dirProgressFill');
    
    try {
                 const response = await fetch('/tools/api/zip/create-from-directory/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                directory_path: directoryPath,
                zip_name: zipName,
                compression_level: compressionLevel,
                exclude_patterns: excludePatterns
            })
        });
        
        const result = await response.json();
        
        // éšè—è¿›åº¦æ¡
        clearInterval(progressInterval);
        hideProgress('dirProgress');
        
        // æ˜¾ç¤ºç»“æœ
        showResult('dirResult', result.success, result.message, result);
        
    } catch (error) {
        clearInterval(progressInterval);
        hideProgress('dirProgress');
        showResult('dirResult', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
    }
}

// å‹ç¼©å•ä¸ªæ–‡ä»¶
async function compressSingleFile() {
    if (!selectedFiles.single) {
        alert('è¯·é€‰æ‹©è¦å‹ç¼©çš„æ–‡ä»¶');
        return;
    }
    
    const compressionLevel = parseInt(document.getElementById('singleCompressionLevel').value);
    const compressionMethod = document.getElementById('singleCompressionMethod').value;
    
    // æ˜¾ç¤ºè¿›åº¦æ¡
    const progressInterval = showProgress('singleProgress', 'singleProgressText', 'singleProgressFill');
    
    try {
        // åˆ›å»ºFormDataå¯¹è±¡
        const formData = new FormData();
        
        // æ·»åŠ æ–‡ä»¶
        formData.append('file', selectedFiles.single);
        formData.append('compression_level', compressionLevel);
        formData.append('compression_method', compressionMethod);
        
        // å‘é€è¯·æ±‚
        const response = await fetch('/tools/api/zip/compress-uploaded-file/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: formData
        });
        
        const result = await response.json();
        
        // éšè—è¿›åº¦æ¡
        clearInterval(progressInterval);
        hideProgress('singleProgress');
        
        // æ˜¾ç¤ºç»“æœ
        showResult('singleResult', result.success, result.message, result);
        
    } catch (error) {
        clearInterval(progressInterval);
        hideProgress('singleProgress');
        showResult('singleResult', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
    }
}

// è§£å‹ZIPæ–‡ä»¶
async function extractZip() {
    const zipPath = document.getElementById('extractZipPath').value.trim();
    if (!zipPath) {
        alert('è¯·è¾“å…¥ZIPæ–‡ä»¶è·¯å¾„');
        return;
    }
    
    const extractTo = document.getElementById('extractToPath').value.trim();
    
    // æ˜¾ç¤ºè¿›åº¦æ¡
    const progressInterval = showProgress('extractProgress', 'extractProgressText', 'extractProgressFill');
    
    try {
                 const response = await fetch('/tools/api/zip/extract/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                zip_path: zipPath,
                extract_to: extractTo
            })
        });
        
        const result = await response.json();
        
        // éšè—è¿›åº¦æ¡
        clearInterval(progressInterval);
        hideProgress('extractProgress');
        
        // æ˜¾ç¤ºç»“æœ
        showResult('extractResult', result.success, result.message, result);
        
    } catch (error) {
        clearInterval(progressInterval);
        hideProgress('extractProgress');
        showResult('extractResult', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
    }
}

 // è·å–CSRF Token
 function getCookie(name) {
     let cookieValue = null;
     if (document.cookie && document.cookie !== '') {
         const cookies = document.cookie.split(';');
         for (let i = 0; i < cookies.length; i++) {
             const cookie = cookies[i].trim();
             if (cookie.substring(0, name.length + 1) === (name + '=')) {
                 cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                 break;
             }
         }
     }
     return cookieValue;
 }
 
 // å…¨å±€æŒ‰é’®åŠŸèƒ½
 let currentZipFile = null;
 
 // æ˜¾ç¤ºå…¨å±€æŒ‰é’®
 function showGlobalActions() {
     document.getElementById('globalActions').style.display = 'flex';
 }
 
 // éšè—å…¨å±€æŒ‰é’®
 function hideGlobalActions() {
     document.getElementById('globalActions').style.display = 'none';
 }
 
 // ä¸‹è½½ZIPæ–‡ä»¶
 document.getElementById('downloadZipBtn').addEventListener('click', function() {
     if (currentZipFile && currentZipFile.file_url) {
         const link = document.createElement('a');
         link.href = currentZipFile.file_url;
         link.download = currentZipFile.file_name || 'download.zip';
         document.body.appendChild(link);
         link.click();
         document.body.removeChild(link);
     } else {
         alert('æ²¡æœ‰å¯ä¸‹è½½çš„ZIPæ–‡ä»¶');
     }
 });
 
 // åˆ›å»ºæ–°ZIP
 document.getElementById('createNewZipBtn').addEventListener('click', function() {
     // æ¸…ç©ºæ‰€æœ‰è¡¨å•
     clearAllForms();
     // éšè—å…¨å±€æŒ‰é’®
     hideGlobalActions();
     // é‡ç½®å½“å‰ZIPæ–‡ä»¶
     currentZipFile = null;
     // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
     showNotification('å·²æ¸…ç©ºè¡¨å•ï¼Œå¯ä»¥åˆ›å»ºæ–°çš„ZIPæ–‡ä»¶', 'success');
 });
 
 // æ¸…ç©ºæ‰€æœ‰
 document.getElementById('clearAllBtn').addEventListener('click', function() {
     if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
         clearAllForms();
         hideGlobalActions();
         currentZipFile = null;
         showNotification('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹', 'success');
     }
 });
 
 // æ¸…ç©ºæ‰€æœ‰è¡¨å•
 function clearAllForms() {
     // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
     selectedFiles.multi = [];
     selectedFiles.single = null;
     displayFileList('multiFileList', []);
     displayFileList('singleFileList', []);
     
     // æ¸…ç©ºè¾“å…¥æ¡†
     document.getElementById('multiZipName').value = '';
     document.getElementById('directoryPath').value = '';
     document.getElementById('dirZipName').value = '';
     document.getElementById('excludePatterns').value = '';
     document.getElementById('extractZipPath').value = '';
     document.getElementById('extractToPath').value = '';
     
     // é‡ç½®æ»‘å—
     document.getElementById('multiCompressionLevel').value = 6;
     document.getElementById('dirCompressionLevel').value = 6;
     document.getElementById('singleCompressionLevel').value = 9;
     document.querySelectorAll('.compression-slider').forEach(slider => {
         const valueDisplay = slider.parentElement.querySelector('.compression-value') || 
                            slider.parentElement.querySelector('span');
         if (valueDisplay) {
             valueDisplay.textContent = slider.value;
         }
     });
     
     // æ¸…ç©ºç»“æœå®¹å™¨
     document.querySelectorAll('.result-container').forEach(container => {
         container.style.display = 'none';
         container.innerHTML = '';
     });
     
     // é‡ç½®å¤é€‰æ¡†
     document.getElementById('multiIncludePaths').checked = true;
 }
 
 // æ˜¾ç¤ºé€šçŸ¥
 function showNotification(message, type = 'info') {
     const notification = document.createElement('div');
     notification.className = `notification notification-${type}`;
     notification.innerHTML = `
         <div class="notification-content">
             <span class="notification-message">${message}</span>
             <button class="notification-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
         </div>
     `;
     
     // æ·»åŠ é€šçŸ¥æ ·å¼
     notification.style.cssText = `
         position: fixed;
         top: 20px;
         right: 20px;
         background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1'};
         color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460'};
         padding: 15px 20px;
         border-radius: 8px;
         box-shadow: 0 4px 12px rgba(0,0,0,0.15);
         z-index: 1001;
         max-width: 300px;
         animation: slideIn 0.3s ease;
     `;
     
     document.body.appendChild(notification);
     
     // è‡ªåŠ¨ç§»é™¤é€šçŸ¥
     setTimeout(() => {
         if (notification.parentElement) {
             notification.remove();
         }
     }, 5000);
 }
 
 // æ·»åŠ é€šçŸ¥åŠ¨ç”»æ ·å¼
 const style = document.createElement('style');
 style.textContent = `
     @keyframes slideIn {
         from {
             transform: translateX(100%);
             opacity: 0;
         }
         to {
             transform: translateX(0);
             opacity: 1;
         }
     }
     
     .notification-content {
         display: flex;
         justify-content: space-between;
         align-items: center;
     }
     
     .notification-close {
         background: none;
         border: none;
         font-size: 18px;
         cursor: pointer;
         margin-left: 10px;
         opacity: 0.7;
     }
     
     .notification-close:hover {
         opacity: 1;
     }
 `;
 document.head.appendChild(style);

// æ‹–æ‹½ä¸Šä¼ æ”¯æŒ
document.addEventListener('DOMContentLoaded', function() {
    const dropZones = document.querySelectorAll('.file-input-label');
    
    dropZones.forEach(zone => {
        zone.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.background = 'rgba(102, 126, 234, 0.2)';
        });
        
        zone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.background = 'rgba(102, 126, 234, 0.05)';
        });
        
        zone.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.background = 'rgba(102, 126, 234, 0.05)';
            
            const files = Array.from(e.dataTransfer.files);
            const input = this.previousElementSibling;
            
            if (input.id === 'multiFileInput') {
                selectedFiles.multi = files;
                displayFileList('multiFileList', files);
            } else if (input.id === 'singleFileInput') {
                selectedFiles.single = files[0];
                displayFileList('singleFileList', files[0] ? [files[0]] : []);
            }
        });
    });
});
</script>
{% endblock %}
