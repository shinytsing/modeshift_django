{% extends 'base.html' %}
{% load static %}

{% block tool_title_inner %}Ê¨≤Êúõ‰ª£ÂäûÁ≥ªÁªü{% endblock %}
{% block tool_title_display %}Ê¨≤Êúõ‰ª£ÂäûÁ≥ªÁªü{% endblock %}

{% block extra_css %}
<style>
.desire-todo-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
  color: #ffffff;
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  padding: 2rem;
  position: relative;
  overflow-x: hidden;
}

.desire-todo-container::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(255, 68, 68, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
  z-index: -1;
  animation: desirePulse 8s ease-in-out infinite;
}

@keyframes desirePulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

.desire-header {
  text-align: center;
  margin-bottom: 3rem;
  padding: 2rem 0;
}

.desire-title {
  font-size: 3.5rem;
  font-weight: 900;
  background: linear-gradient(135deg, #ff4444, #ff6b35, #ffd700, #ff4444);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 1rem;
  text-shadow: 0 0 40px rgba(255, 68, 68, 0.5);
  animation: desireGlow 3s ease-in-out infinite alternate;
}

@keyframes desireGlow {
  from { filter: brightness(1) hue-rotate(0deg); }
  to { filter: brightness(1.2) hue-rotate(10deg); }
}

.desire-subtitle {
  font-size: 1.3rem;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 1rem;
  font-weight: 600;
}

.desire-motto {
  font-size: 1rem;
  color: rgba(255, 215, 0, 0.8);
  font-style: italic;
  margin-bottom: 2rem;
}

.desire-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
  max-width: 1600px;
  margin: 0 auto;
}

.desire-card {
  background: rgba(26, 26, 26, 0.9);
  border: 3px solid rgba(255, 68, 68, 0.4);
  border-radius: 15px;
  padding: 2rem;
  backdrop-filter: blur(15px);
  transition: all 0.4s ease;
  position: relative;
  overflow: hidden;
}

.desire-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(135deg, #ff4444, #ff6b35, #ffd700);
  transform: scaleX(0);
  transition: transform 0.4s ease;
}

.desire-card:hover::before {
  transform: scaleX(1);
}

.desire-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 50px rgba(255, 68, 68, 0.3);
  border-color: #ff4444;
}

.card-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #ff4444;
  margin-bottom: 1.5rem;
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 2px;
}

/* Ê¨≤Êúõ‰ª£ÂäûÂàÜÁ±ª */
.desire-categories {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.category-btn {
  background: rgba(255, 68, 68, 0.1);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 10px;
  padding: 1rem;
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
  color: #ffffff;
  font-weight: 600;
}

.category-btn:hover {
  background: rgba(255, 68, 68, 0.2);
  border-color: #ff4444;
  transform: translateY(-3px);
}

.category-btn.active {
  background: rgba(255, 68, 68, 0.3);
  border-color: #ff4444;
  box-shadow: 0 0 20px rgba(255, 68, 68, 0.3);
}

.category-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  display: block;
}

/* Ê¨≤Êúõ‰ª£ÂäûÂàóË°® */
.desire-todo-list {
  max-height: 400px;
  overflow-y: auto;
}

.todo-item {
  background: rgba(255, 68, 68, 0.1);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 10px;
  padding: 1.5rem;
  margin-bottom: 1rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.todo-item:hover {
  background: rgba(255, 68, 68, 0.15);
  border-color: #ff4444;
  transform: translateX(5px);
}

.todo-item.completed {
  background: rgba(40, 167, 69, 0.1);
  border-color: #28a745;
  opacity: 0.7;
}

.todo-item.completed .todo-title {
  text-decoration: line-through;
  color: #28a745;
}

.todo-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.todo-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #ff6b35;
  flex: 1;
}

.todo-priority {
  padding: 0.3rem 0.8rem;
  border-radius: 15px;
  font-size: 0.8rem;
  font-weight: 600;
  margin-left: 1rem;
}

.priority-high {
  background: rgba(255, 68, 68, 0.3);
  color: #ff4444;
}

.priority-medium {
  background: rgba(255, 193, 7, 0.3);
  color: #ffc107;
}

.priority-low {
  background: rgba(40, 167, 69, 0.3);
  color: #28a745;
}

.todo-description {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 1rem;
  line-height: 1.5;
}

.todo-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
}

.todo-reward {
  color: #ffd700;
  font-weight: 600;
}

.todo-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
}

.todo-btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 5px;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-complete {
  background: #28a745;
  color: white;
}

.btn-complete:hover {
  background: #218838;
  transform: scale(1.05);
}

.btn-edit {
  background: #ffc107;
  color: #000;
}

.btn-edit:hover {
  background: #e0a800;
  transform: scale(1.05);
}

.btn-delete {
  background: #dc3545;
  color: white;
}

.btn-delete:hover {
  background: #c82333;
  transform: scale(1.05);
}

/* Ê∑ªÂä†Êñ∞‰ª£Âäû */
.add-todo-form {
  background: rgba(26, 26, 26, 0.8);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 10px;
  padding: 2rem;
  margin-bottom: 2rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-label {
  display: block;
  font-size: 0.9rem;
  font-weight: 600;
  color: #ff6b35;
  margin-bottom: 0.5rem;
}

.form-input {
  width: 100%;
  padding: 0.8rem;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 5px;
  color: #ffffff;
  font-family: inherit;
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: #ff4444;
  box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
}

.form-select {
  width: 100%;
  padding: 0.8rem;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 5px;
  color: #ffffff;
  font-family: inherit;
}

.form-textarea {
  width: 100%;
  padding: 0.8rem;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 5px;
  color: #ffffff;
  font-family: inherit;
  min-height: 100px;
  resize: vertical;
}

.submit-btn {
  background: linear-gradient(135deg, #ff4444, #ff6b35);
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(255, 68, 68, 0.4);
}

/* Ê¨≤ÊúõÁªüËÆ° */
.desire-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-item {
  background: rgba(255, 68, 68, 0.1);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 10px;
  padding: 1.5rem;
  text-align: center;
  transition: all 0.3s ease;
}

.stat-item:hover {
  background: rgba(255, 68, 68, 0.2);
  border-color: #ff4444;
  transform: translateY(-3px);
}

.stat-value {
  font-size: 2rem;
  font-weight: 900;
  color: #ffd700;
  margin-bottom: 0.5rem;
}

.stat-label {
  font-size: 0.9rem;
  color: #ff6b35;
  font-weight: 600;
}

/* Ê¨≤ÊúõÂ•ñÂä±Á≥ªÁªü */
.desire-rewards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-top: 1.5rem;
}

.reward-item {
  background: rgba(255, 215, 0, 0.1);
  border: 2px solid rgba(255, 215, 0, 0.3);
  border-radius: 10px;
  padding: 1.5rem;
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
}

.reward-item:hover {
  background: rgba(255, 215, 0, 0.2);
  border-color: #ffd700;
  transform: translateY(-3px);
}

.reward-item.unlocked {
  background: rgba(255, 215, 0, 0.3);
  border-color: #ffd700;
  animation: rewardGlow 2s ease-in-out infinite;
}

@keyframes rewardGlow {
  0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
  50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
}

.reward-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.reward-name {
  font-size: 1rem;
  font-weight: 600;
  color: #ffd700;
  margin-bottom: 0.5rem;
}

.reward-desc {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.7);
}

.reward-cost {
  font-size: 0.9rem;
  color: #ff6b35;
  font-weight: 600;
  margin-top: 0.5rem;
}

/* ÈÄöÁü•Âä®Áîª */
@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .desire-title {
    font-size: 2.5rem;
  }
  
  .desire-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .desire-card {
    padding: 1.5rem;
  }
  
  .todo-actions {
    flex-direction: column;
  }
  
  .todo-btn {
    width: 100%;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="desire-todo-container">
  <div class="desire-header">
    <h1 class="desire-title">üî• Ê¨≤Êúõ‰ª£ÂäûÁ≥ªÁªü</h1>
    <p class="desire-subtitle">Â∞ÜÊ¨≤ÊúõËΩ¨Âåñ‰∏∫Âä®ÂäõÔºåËÆ©ÊØè‰∏™‰ªªÂä°ÈÉΩÊúâÊÑè‰πâ</p>
    <p class="desire-motto">"ÂÆåÊàê‰∏Ä‰∏™‰ªªÂä°ÔºåÂÆûÁé∞‰∏Ä‰∏™Ê¨≤Êúõ"</p>
  </div>

  <!-- Ê¨≤ÊúõÁªüËÆ° -->
  <div class="desire-stats">
    <div class="stat-item">
      <div class="stat-value" id="totalTodos">12</div>
      <div class="stat-label">ÊÄª‰ª£ÂäûÊï∞</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="completedTodos">8</div>
      <div class="stat-label">Â∑≤ÂÆåÊàê</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="pendingTodos">4</div>
      <div class="stat-label">ÂæÖÂÆåÊàê</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="totalRewards">¬•2,450</div>
      <div class="stat-label">ÊÄªÂ•ñÂä±</div>
    </div>
  </div>

  <div class="desire-grid">
    <!-- Ê∑ªÂä†Êñ∞‰ª£Âäû -->
    <div class="desire-card">
      <h2 class="card-title">Ê∑ªÂä†Êñ∞Ê¨≤Êúõ‰ª£Âäû</h2>
      <form class="add-todo-form" id="addTodoForm">
        <div class="form-group">
          <label class="form-label">‰ª£ÂäûÊ†áÈ¢ò</label>
          <input type="text" class="form-input" id="todoTitle" placeholder="ËæìÂÖ•‰Ω†ÁöÑÊ¨≤Êúõ‰ª£Âäû..." required>
        </div>
        <div class="form-group">
          <label class="form-label">ÊèèËø∞</label>
          <textarea class="form-textarea" id="todoDescription" placeholder="ËØ¶ÁªÜÊèèËø∞Ëøô‰∏™Ê¨≤Êúõ‰ª£Âäû..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">ÂàÜÁ±ª</label>
          <select class="form-select" id="todoCategory" required>
            <option value="">ÈÄâÊã©ÂàÜÁ±ª</option>
            <option value="work">Â∑•‰ΩúÁõ∏ÂÖ≥</option>
            <option value="personal">‰∏™‰∫∫ÊàêÈïø</option>
            <option value="health">ÂÅ•Â∫∑ÁîüÊ¥ª</option>
            <option value="social">Á§æ‰∫§ÂÖ≥Á≥ª</option>
            <option value="entertainment">Â®±‰πêÊîæÊùæ</option>
            <option value="finance">Ë¥¢Âä°ÁõÆÊ†á</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">‰ºòÂÖàÁ∫ß</label>
          <select class="form-select" id="todoPriority" required>
            <option value="">ÈÄâÊã©‰ºòÂÖàÁ∫ß</option>
            <option value="high">È´ò‰ºòÂÖàÁ∫ß</option>
            <option value="medium">‰∏≠‰ºòÂÖàÁ∫ß</option>
            <option value="low">‰Ωé‰ºòÂÖàÁ∫ß</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Ê¨≤ÊúõÂ•ñÂä±</label>
          <input type="text" class="form-input" id="todoReward" placeholder="ÂÆåÊàêÂêéÁöÑÂ•ñÂä±ÔºåÂ¶ÇÔºö‰π∞‰∏ÄÂèåÊñ∞Èûã ¬•500">
        </div>
        <button type="submit" class="submit-btn">Ê∑ªÂä†Ê¨≤Êúõ‰ª£Âäû</button>
      </form>
    </div>

    <!-- ‰ª£ÂäûÂàÜÁ±ª -->
    <div class="desire-card">
      <h2 class="card-title">Ê¨≤Êúõ‰ª£ÂäûÂàÜÁ±ª</h2>
      <div class="desire-categories">
        <button class="category-btn active" data-category="all">
          <span class="category-icon">üìã</span>
          ÂÖ®ÈÉ®‰ª£Âäû
        </button>
        <button class="category-btn" data-category="work">
          <span class="category-icon">üíº</span>
          Â∑•‰ΩúÁõ∏ÂÖ≥
        </button>
        <button class="category-btn" data-category="personal">
          <span class="category-icon">üéØ</span>
          ‰∏™‰∫∫ÊàêÈïø
        </button>
        <button class="category-btn" data-category="health">
          <span class="category-icon">üí™</span>
          ÂÅ•Â∫∑ÁîüÊ¥ª
        </button>
        <button class="category-btn" data-category="social">
          <span class="category-icon">üë•</span>
          Á§æ‰∫§ÂÖ≥Á≥ª
        </button>
        <button class="category-btn" data-category="entertainment">
          <span class="category-icon">üéÆ</span>
          Â®±‰πêÊîæÊùæ
        </button>
        <button class="category-btn" data-category="finance">
          <span class="category-icon">üí∞</span>
          Ë¥¢Âä°ÁõÆÊ†á
        </button>
      </div>
    </div>

    <!-- ‰ª£ÂäûÂàóË°® -->
    <div class="desire-card">
      <h2 class="card-title">Ê¨≤Êúõ‰ª£ÂäûÂàóË°®</h2>
      <div class="desire-todo-list" id="todoList">
        <div class="todo-item" data-category="work">
          <div class="todo-header">
            <div class="todo-title">ÂÆåÊàêÈ°πÁõÆÈáçÊûÑ</div>
            <div class="todo-priority priority-high">È´ò‰ºòÂÖàÁ∫ß</div>
          </div>
          <div class="todo-description">ÈáçÊûÑÁé∞Êúâ‰ª£Á†ÅÊû∂ÊûÑÔºåÊèêÈ´òÁ≥ªÁªüÊÄßËÉΩÂíåÂèØÁª¥Êä§ÊÄß</div>
          <div class="todo-meta">
            <span>ÂàÜÁ±ª: Â∑•‰ΩúÁõ∏ÂÖ≥</span>
            <span class="todo-reward">Â•ñÂä±: ¬•1,000</span>
          </div>
          <div class="todo-actions">
            <button class="todo-btn btn-complete" onclick="completeTodo(this)">ÂÆåÊàê</button>
            <button class="todo-btn btn-edit" onclick="editTodo(this)">ÁºñËæë</button>
            <button class="todo-btn btn-delete" onclick="deleteTodo(this)">Âà†Èô§</button>
          </div>
        </div>

        <div class="todo-item completed" data-category="personal">
          <div class="todo-header">
            <div class="todo-title">Â≠¶‰π†Êñ∞ÁºñÁ®ãËØ≠Ë®Ä</div>
            <div class="todo-priority priority-medium">‰∏≠‰ºòÂÖàÁ∫ß</div>
          </div>
          <div class="todo-description">Â≠¶‰π†RustÁºñÁ®ãËØ≠Ë®ÄÔºåÊéåÊè°Á≥ªÁªüÁ∫ßÁºñÁ®ãÊäÄËÉΩ</div>
          <div class="todo-meta">
            <span>ÂàÜÁ±ª: ‰∏™‰∫∫ÊàêÈïø</span>
            <span class="todo-reward">Â•ñÂä±: ¬•500</span>
          </div>
          <div class="todo-actions">
            <button class="todo-btn btn-complete" disabled>Â∑≤ÂÆåÊàê</button>
            <button class="todo-btn btn-edit" onclick="editTodo(this)">ÁºñËæë</button>
            <button class="todo-btn btn-delete" onclick="deleteTodo(this)">Âà†Èô§</button>
          </div>
        </div>

        <div class="todo-item" data-category="health">
          <div class="todo-header">
            <div class="todo-title">ÂÅ•Ë∫´30Â§©</div>
            <div class="todo-priority priority-medium">‰∏≠‰ºòÂÖàÁ∫ß</div>
          </div>
          <div class="todo-description">ËøûÁª≠30Â§©ËøõË°åÂÅ•Ë∫´ÈîªÁÇºÔºåÊîπÂñÑË∫´‰ΩìÁä∂ÂÜµ</div>
          <div class="todo-meta">
            <span>ÂàÜÁ±ª: ÂÅ•Â∫∑ÁîüÊ¥ª</span>
            <span class="todo-reward">Â•ñÂä±: ‰π∞‰∏ÄÂèåÊñ∞Ë∑ëÈûã</span>
          </div>
          <div class="todo-actions">
            <button class="todo-btn btn-complete" onclick="completeTodo(this)">ÂÆåÊàê</button>
            <button class="todo-btn btn-edit" onclick="editTodo(this)">ÁºñËæë</button>
            <button class="todo-btn btn-delete" onclick="deleteTodo(this)">Âà†Èô§</button>
          </div>
        </div>

        <div class="todo-item" data-category="entertainment">
          <div class="todo-header">
            <div class="todo-title">Áúã‰∏ÄÈÉ®ÁªèÂÖ∏ÁîµÂΩ±</div>
            <div class="todo-priority priority-low">‰Ωé‰ºòÂÖàÁ∫ß</div>
          </div>
          <div class="todo-description">ËßÇÁúã„ÄäËÇñÁî≥ÂÖãÁöÑÊïëËµé„ÄãÔºåÊÑüÂèóÁªèÂÖ∏ÁîµÂΩ±ÁöÑÈ≠ÖÂäõ</div>
          <div class="todo-meta">
            <span>ÂàÜÁ±ª: Â®±‰πêÊîæÊùæ</span>
            <span class="todo-reward">Â•ñÂä±: ‰π∞‰∏ÄÂåÖÈõ∂È£ü</span>
          </div>
          <div class="todo-actions">
            <button class="todo-btn btn-complete" onclick="completeTodo(this)">ÂÆåÊàê</button>
            <button class="todo-btn btn-edit" onclick="editTodo(this)">ÁºñËæë</button>
            <button class="todo-btn btn-delete" onclick="deleteTodo(this)">Âà†Èô§</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ê¨≤ÊúõÂ•ñÂä±Á≥ªÁªü -->
    <div class="desire-card">
      <h2 class="card-title">Ê¨≤ÊúõÂ•ñÂä±Á≥ªÁªü</h2>
      <div class="desire-rewards">
        <div class="reward-item unlocked">
          <div class="reward-icon">üéÆ</div>
          <div class="reward-name">Ê∏∏ÊàèÊó∂Èó¥</div>
          <div class="reward-desc">ÂÆåÊàê3‰∏™‰ª£ÂäûÂêéËé∑Âæó1Â∞èÊó∂Ê∏∏ÊàèÊó∂Èó¥</div>
          <div class="reward-cost">ÈúÄË¶Å: 3‰∏™‰ª£Âäû</div>
        </div>
        <div class="reward-item">
          <div class="reward-icon">üçï</div>
          <div class="reward-name">ÁæéÈ£üÂ•ñÂä±</div>
          <div class="reward-desc">ÂÆåÊàê5‰∏™‰ª£ÂäûÂêé‰∫´Âèó‰∏ÄÈ°øÁæéÈ£ü</div>
          <div class="reward-cost">ÈúÄË¶Å: 5‰∏™‰ª£Âäû</div>
        </div>
        <div class="reward-item">
          <div class="reward-icon">üõçÔ∏è</div>
          <div class="reward-name">Ë¥≠Áâ©Â•ñÂä±</div>
          <div class="reward-desc">ÂÆåÊàê10‰∏™‰ª£ÂäûÂêéË¥≠‰π∞ÂøÉ‰ª™Áâ©ÂìÅ</div>
          <div class="reward-cost">ÈúÄË¶Å: 10‰∏™‰ª£Âäû</div>
        </div>
        <div class="reward-item">
          <div class="reward-icon">‚úàÔ∏è</div>
          <div class="reward-name">ÊóÖË°åÂ•ñÂä±</div>
          <div class="reward-desc">ÂÆåÊàê20‰∏™‰ª£ÂäûÂêéÂÆâÊéí‰∏ÄÊ¨°ÊóÖË°å</div>
          <div class="reward-cost">ÈúÄË¶Å: 20‰∏™‰ª£Âäû</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Ê¨≤Êúõ‰ª£ÂäûÁ≥ªÁªü‰∫§‰∫íÂäüËÉΩ
class DesireTodoSystem {
  constructor() {
    this.todos = [];
    this.currentCategory = 'all';
    this.init();
  }
  
  init() {
    this.bindEvents();
    this.loadTodos();
    this.loadStats();
  }
  
  bindEvents() {
    // ÂàÜÁ±ªÁ≠õÈÄâ
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        this.filterByCategory(e.target.getAttribute('data-category'));
      });
    });
    
    // Ê∑ªÂä†Êñ∞‰ª£Âäû
    document.getElementById('addTodoForm').addEventListener('submit', (e) => {
      e.preventDefault();
      this.addNewTodo();
    });
  }
  
  async loadTodos() {
    try {
      const response = await fetch('/tools/api/desire_todos/');
      const data = await response.json();
      
      if (data.success) {
        this.todos = data.todos;
        this.renderTodos();
      }
    } catch (error) {

    }
  }
  
  async loadStats() {
    try {
      const response = await fetch('/tools/api/desire_todos/stats/');
      const data = await response.json();
      
      if (data.success) {
        this.updateStatsDisplay(data.stats);
      }
    } catch (error) {

    }
  }
  
  filterByCategory(category) {
    this.currentCategory = category;
    
    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`[data-category="${category}"]`).classList.add('active');
    
    // Á≠õÈÄâ‰ª£Âäû
    const todos = document.querySelectorAll('.todo-item');
    todos.forEach(todo => {
      if (category === 'all' || todo.getAttribute('data-category') === category) {
        todo.style.display = 'block';
      } else {
        todo.style.display = 'none';
      }
    });
  }
  
  async addNewTodo() {
    const title = document.getElementById('todoTitle').value;
    const description = document.getElementById('todoDescription').value;
    const category = document.getElementById('todoCategory').value;
    const priority = document.getElementById('todoPriority').value;
    const reward = document.getElementById('todoReward').value;
    
    try {
      const response = await fetch('/tools/api/desire_todos/add/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': this.getCSRFToken()
        },
        body: JSON.stringify({
          title,
          description,
          category,
          priority,
          reward
        })
      });
      
      const data = await response.json();
      
      if (data.success) {
        const todoItem = this.createTodoItem({
          id: data.todo_id,
          title,
          description,
          category,
          priority,
          reward,
          is_completed: false,
          created_at: new Date().toLocaleString()
        });
        
        document.getElementById('todoList').prepend(todoItem);
        document.getElementById('addTodoForm').reset();
        
        this.showNotification('Ê¨≤Êúõ‰ª£ÂäûÊ∑ªÂä†ÊàêÂäüÔºÅ', 'success');
        this.loadStats();
      } else {
        this.showNotification('Ê∑ªÂä†Â§±Ë¥•: ' + data.error, 'error');
      }
    } catch (error) {
      this.showNotification('Ê∑ªÂä†Â§±Ë¥•: ' + error.message, 'error');
    }
  }
  
  createTodoItem(todo) {
    const categoryNames = {
      'work': 'Â∑•‰ΩúÁõ∏ÂÖ≥',
      'personal': '‰∏™‰∫∫ÊàêÈïø',
      'health': 'ÂÅ•Â∫∑ÁîüÊ¥ª',
      'social': 'Á§æ‰∫§ÂÖ≥Á≥ª',
      'entertainment': 'Â®±‰πêÊîæÊùæ',
      'finance': 'Ë¥¢Âä°ÁõÆÊ†á'
    };
    
    const priorityClasses = {
      'high': 'priority-high',
      'medium': 'priority-medium',
      'low': 'priority-low'
    };
    
    const todoItem = document.createElement('div');
    todoItem.className = `todo-item ${todo.is_completed ? 'completed' : ''}`;
    todoItem.setAttribute('data-category', todo.category);
    todoItem.setAttribute('data-id', todo.id);
    
    todoItem.innerHTML = `
      <div class="todo-header">
        <div class="todo-title">${todo.title}</div>
        <div class="todo-priority ${priorityClasses[todo.priority]}">${todo.priority === 'high' ? 'È´ò' : todo.priority === 'medium' ? '‰∏≠' : '‰Ωé'}‰ºòÂÖàÁ∫ß</div>
      </div>
      <div class="todo-description">${todo.description}</div>
      <div class="todo-meta">
        <span>ÂàÜÁ±ª: ${categoryNames[todo.category]}</span>
        <span class="todo-reward">Â•ñÂä±: ${todo.reward}</span>
      </div>
      <div class="todo-actions">
        <button class="todo-btn btn-complete" onclick="desireTodoSystem.completeTodo(${todo.id})" ${todo.is_completed ? 'disabled' : ''}>
          ${todo.is_completed ? 'Â∑≤ÂÆåÊàê' : 'ÂÆåÊàê'}
        </button>
        <button class="todo-btn btn-edit" onclick="desireTodoSystem.editTodo(${todo.id})">ÁºñËæë</button>
        <button class="todo-btn btn-delete" onclick="desireTodoSystem.deleteTodo(${todo.id})">Âà†Èô§</button>
      </div>
    `;
    
    return todoItem;
  }
  
  renderTodos() {
    const todoList = document.getElementById('todoList');
    todoList.innerHTML = '';
    
    this.todos.forEach(todo => {
      const todoItem = this.createTodoItem(todo);
      todoList.appendChild(todoItem);
    });
  }
  
  async completeTodo(todoId) {
    try {
      const response = await fetch('/tools/api/desire_todos/complete/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': this.getCSRFToken()
        },
        body: JSON.stringify({ todo_id: todoId })
      });
      
      const data = await response.json();
      
      if (data.success) {
        const todoItem = document.querySelector(`[data-id="${todoId}"]`);
        todoItem.classList.add('completed');
        const completeBtn = todoItem.querySelector('.btn-complete');
        completeBtn.textContent = 'Â∑≤ÂÆåÊàê';
        completeBtn.disabled = true;
        
        this.showNotification('Ê¨≤Êúõ‰ª£ÂäûÂÆåÊàêÔºÅ', 'success');
        this.loadStats();
        this.checkRewards();
      } else {
        this.showNotification('ÂÆåÊàêÂ§±Ë¥•: ' + data.error, 'error');
      }
    } catch (error) {
      this.showNotification('ÂÆåÊàêÂ§±Ë¥•: ' + error.message, 'error');
    }
  }
  
  async deleteTodo(todoId) {
    if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰ª£ÂäûÂêóÔºü')) return;
    
    try {
      const response = await fetch('/tools/api/desire_todos/delete/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': this.getCSRFToken()
        },
        body: JSON.stringify({ todo_id: todoId })
      });
      
      const data = await response.json();
      
      if (data.success) {
        const todoItem = document.querySelector(`[data-id="${todoId}"]`);
        todoItem.remove();
        
        this.showNotification('Ê¨≤Êúõ‰ª£ÂäûÂà†Èô§ÊàêÂäü', 'success');
        this.loadStats();
      } else {
        this.showNotification('Âà†Èô§Â§±Ë¥•: ' + data.error, 'error');
      }
    } catch (error) {
      this.showNotification('Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
    }
  }
  
  editTodo(todoId) {
    const todoItem = document.querySelector(`[data-id="${todoId}"]`);
    const title = todoItem.querySelector('.todo-title').textContent;
    const description = todoItem.querySelector('.todo-description').textContent;
    
    // ËøôÈáåÂèØ‰ª•ÂÆûÁé∞ÁºñËæëÂäüËÉΩ
    this.showNotification('ÁºñËæëÂäüËÉΩÂºÄÂèë‰∏≠...', 'info');
  }
  
  updateStatsDisplay(stats) {
    document.getElementById('totalTodos').textContent = stats.total_todos;
    document.getElementById('completedTodos').textContent = stats.completed_todos;
    document.getElementById('pendingTodos').textContent = stats.pending_todos;
    document.getElementById('totalRewards').textContent = stats.total_rewards;
  }
  
  checkRewards() {
    const completedTodos = document.querySelectorAll('.todo-item.completed').length;
    const rewards = document.querySelectorAll('.reward-item');
    
    rewards.forEach((reward, index) => {
      const required = [3, 5, 10, 20][index];
      if (completedTodos >= required) {
        reward.classList.add('unlocked');
      }
    });
  }
  
  getCSRFToken() {
    const token = document.querySelector('[name=csrfmiddlewaretoken]');
    return token ? token.value : '';
  }
  
  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 2rem;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
};

// ÂÖ®Â±ÄÂáΩÊï∞
function completeTodo(btn) {
  const todoItem = btn.closest('.todo-item');
  const todoId = todoItem.getAttribute('data-id');
  desireTodoSystem.completeTodo(todoId);
}

function editTodo(btn) {
  const todoItem = btn.closest('.todo-item');
  const todoId = todoItem.getAttribute('data-id');
  desireTodoSystem.editTodo(todoId);
}

function deleteTodo(btn) {
  const todoItem = btn.closest('.todo-item');
  const todoId = todoItem.getAttribute('data-id');
  desireTodoSystem.deleteTodo(todoId);
}

// ÂàùÂßãÂåñÊ¨≤Êúõ‰ª£ÂäûÁ≥ªÁªü
let desireTodoSystem;
document.addEventListener('DOMContentLoaded', function() {
  desireTodoSystem = new DesireTodoSystem();
});


</script>
{% endblock %} 