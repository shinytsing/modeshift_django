{% extends 'base.html' %}
{% load static %}

{% block tool_title_inner %}ç¼˜å¥‘ - ä¼ ç»Ÿå…«å­—å§»ç¼˜åˆ†æ{% endblock %}
{% block tool_title_display %}ç¼˜å¥‘ - ä¼ ç»Ÿå…«å­—å§»ç¼˜åˆ†æ{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb-item">
    <a href="{% url 'tools:tools_index' %}" class="breadcrumb-link geek-breadcrumb-link">
        <i class="fas fa-wrench"></i>
        å·¥å…·é›†
    </a>
</div>
<div class="breadcrumb-item">
    <a href="{% url 'tools:yuanqi_marriage_analyzer' %}" class="breadcrumb-link geek-breadcrumb-link">
        <i class="fas fa-heart"></i>
        ç¼˜å¥‘å§»ç¼˜åˆ†æ
    </a>
</div>
{% endblock %}

{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<div class="yuanqi-container">
    <!-- å¤´éƒ¨åŒºåŸŸ -->
    <div class="yuanqi-header">
        <div class="header-decoration">
            <div class="traditional-pattern"></div>
        </div>
            <div class="title-section">
            <div class="logo-container">
                <div class="yin-yang-symbol">
                    <div class="yin-yang">
                        <div class="yang"></div>
                        <div class="yin"></div>
                        <div class="yang-dot"></div>
                        <div class="yin-dot"></div>
                    </div>
                </div>
            </div>
            <div class="title-content">
                <h1 class="main-title">ç¼˜å¥‘</h1>
                <p class="subtitle">ä¼ ç»Ÿå…«å­—å§»ç¼˜åˆ†æå¹³å°</p>
                <div class="tagline">
                    <span class="chinese-text">å¤©ä½œä¹‹åˆ Â· ç¼˜å®šä¸‰ç”Ÿ</span>
                </div>
            </div>
        </div>
        </div>
        
        <!-- å…è´£å£°æ˜ -->
    <div class="disclaimer-banner">
            <i class="fas fa-info-circle"></i>
        <span>æœ¬å¹³å°å†…å®¹åŸºäºä¼ ç»Ÿæ–‡åŒ–å’Œç®—æ³•ç”Ÿæˆï¼Œä»…ä¾›å¨±ä¹å’Œå‚è€ƒï¼Œä¸ä½œä¸ºäººç”Ÿå†³ç­–ä¾æ®ï¼Œè¯·ç†æ€§çœ‹å¾…ã€‚</span>
    </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- æ¨¡å¼é€‰æ‹©åŒºåŸŸ -->
        <div class="mode-selection">
            <div class="mode-tabs">
                <button class="mode-tab active" data-mode="couple" onclick="switchMode('couple')">
                    <i class="fas fa-heart"></i>
                    <span>åŒäººåˆå©š</span>
                    <p>åˆ†æä¸¤äººçš„å…«å­—å¥‘åˆåº¦</p>
                </button>
                <button class="mode-tab" data-mode="single" onclick="switchMode('single')">
                    <i class="fas fa-user"></i>
                    <span>å•äººå§»ç¼˜</span>
                    <p>æ¨ç®—é€‚åˆçš„ä¼´ä¾£ç±»å‹</p>
                </button>
            </div>
        </div>

        <!-- è¾“å…¥è¡¨å•åŒºåŸŸ -->
        <div class="form-section" id="formSection">
            <div class="form-container">
                <div class="form-header">
                    <h3 id="formTitle"><i class="fas fa-user-friends"></i> åŒæ–¹åŸºæœ¬ä¿¡æ¯</h3>
                    <p id="formSubtitle">è¯·è¾“å…¥åŒæ–¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨è¿›è¡Œä¸“ä¸šçš„å…«å­—åˆå©šåˆ†æ</p>
                    </div>

                                <!-- åŒäººåˆå©šè¡¨å• -->
                <div class="form-content" id="coupleForm">
                    <!-- ç”·æ–¹ä¿¡æ¯ -->
                    <div class="person-form male-form">
                        <div class="form-title">
                            <i class="fas fa-male"></i>
                            <h4>ç”·æ–¹ä¿¡æ¯</h4>
                </div>
                
                        <div class="input-grid">
                            <div class="input-field">
                                <label for="maleName">
                                <i class="fas fa-user"></i>
                                å§“å
                            </label>
                                <input type="text" id="maleName" class="traditional-input" placeholder="è¯·è¾“å…¥ç”·æ–¹å§“å">
                        </div>
                            
                            <div class="input-field">
                                <label for="maleGender">
                                <i class="fas fa-venus-mars"></i>
                                æ€§åˆ«
                            </label>
                                <select id="maleGender" class="traditional-select">
                                    <option value="male">ç”·</option>
                                </select>
                        </div>
                    </div>
                    
                        <div class="datetime-grid">
                            <div class="input-field">
                                <label for="maleBirthDate">
                                <i class="fas fa-calendar-alt"></i>
                                å‡ºç”Ÿæ—¥æœŸ
                            </label>
                                <div class="custom-date-picker" id="maleBirthDate">
                                    <select class="date-select year-select" id="maleBirthYear">
                                        <option value="">å¹´</option>
                                </select>
                                    <select class="date-select month-select" id="maleBirthMonth">
                                        <option value="">æœˆ</option>
                                        <option value="1">1æœˆ</option>
                                        <option value="2">2æœˆ</option>
                                        <option value="3">3æœˆ</option>
                                        <option value="4">4æœˆ</option>
                                        <option value="5">5æœˆ</option>
                                        <option value="6">6æœˆ</option>
                                        <option value="7">7æœˆ</option>
                                        <option value="8">8æœˆ</option>
                                        <option value="9">9æœˆ</option>
                                        <option value="10">10æœˆ</option>
                                        <option value="11">11æœˆ</option>
                                        <option value="12">12æœˆ</option>
                                    </select>
                                    <select class="date-select day-select" id="maleBirthDay">
                                        <option value="">æ—¥</option>
                                    </select>
                            </div>
                        </div>
                            
                            <div class="input-field">
                                <label for="maleBirthTime">
                                <i class="fas fa-clock"></i>
                                    å‡ºç”Ÿæ—¶è¾°
                            </label>
                                <select id="maleBirthTime" class="traditional-select">
                                    <option value="">è¯·é€‰æ‹©æ—¶è¾°</option>
                                    <option value="zi">å­æ—¶ (23:00-1:00)</option>
                                    <option value="chou">ä¸‘æ—¶ (1:00-3:00)</option>
                                    <option value="yin">å¯…æ—¶ (3:00-5:00)</option>
                                    <option value="mao">å¯æ—¶ (5:00-7:00)</option>
                                    <option value="chen">è¾°æ—¶ (7:00-9:00)</option>
                                    <option value="si">å·³æ—¶ (9:00-11:00)</option>
                                    <option value="wu">åˆæ—¶ (11:00-13:00)</option>
                                    <option value="wei">æœªæ—¶ (13:00-15:00)</option>
                                    <option value="shen">ç”³æ—¶ (15:00-17:00)</option>
                                    <option value="you">é…‰æ—¶ (17:00-19:00)</option>
                                    <option value="xu">æˆŒæ—¶ (19:00-21:00)</option>
                                    <option value="hai">äº¥æ—¶ (21:00-23:00)</option>
                                    <option value="unknown">ä¸çŸ¥é“æ—¶è¾°</option>
                                </select>
                        </div>
                    </div>
                    
                        <div class="input-field">
                            <label for="maleBirthPlace">
                                <i class="fas fa-map-marker-alt"></i>
                                å‡ºç”Ÿåœ°ç‚¹
                            </label>
                            <input type="text" id="maleBirthPlace" class="traditional-input" placeholder="è¯·è¾“å…¥å‡ºç”Ÿåœ°ç‚¹ï¼ˆå¦‚ï¼šåŒ—äº¬å¸‚æœé˜³åŒºï¼‰">
                        </div>
                    </div>
                    
                    <!-- å¥³æ–¹ä¿¡æ¯ -->
                    <div class="person-form female-form">
                        <div class="form-title">
                            <i class="fas fa-female"></i>
                            <h4>å¥³æ–¹ä¿¡æ¯</h4>
                    </div>
                        
                        <div class="input-grid">
                            <div class="input-field">
                                <label for="femaleName">
                                    <i class="fas fa-user"></i>
                                    å§“å
                                </label>
                                <input type="text" id="femaleName" class="traditional-input" placeholder="è¯·è¾“å…¥å¥³æ–¹å§“å">
                </div>
                            
                            <div class="input-field">
                                <label for="femaleGender">
                                    <i class="fas fa-venus-mars"></i>
                                    æ€§åˆ«
                                </label>
                                <select id="femaleGender" class="traditional-select">
                                    <option value="female">å¥³</option>
                                </select>
            </div>
        </div>

                        <div class="datetime-grid">
                            <div class="input-field">
                                <label for="femaleBirthDate">
                                    <i class="fas fa-calendar-alt"></i>
                                    å‡ºç”Ÿæ—¥æœŸ
                                </label>
                                <div class="custom-date-picker" id="femaleBirthDate">
                                    <select class="date-select year-select" id="femaleBirthYear">
                                        <option value="">å¹´</option>
                                    </select>
                                    <select class="date-select month-select" id="femaleBirthMonth">
                                        <option value="">æœˆ</option>
                                        <option value="1">1æœˆ</option>
                                        <option value="2">2æœˆ</option>
                                        <option value="3">3æœˆ</option>
                                        <option value="4">4æœˆ</option>
                                        <option value="5">5æœˆ</option>
                                        <option value="6">6æœˆ</option>
                                        <option value="7">7æœˆ</option>
                                        <option value="8">8æœˆ</option>
                                        <option value="9">9æœˆ</option>
                                        <option value="10">10æœˆ</option>
                                        <option value="11">11æœˆ</option>
                                        <option value="12">12æœˆ</option>
                                    </select>
                                    <select class="date-select day-select" id="femaleBirthDay">
                                        <option value="">æ—¥</option>
                                    </select>
                    </div>
                </div>
                
                            <div class="input-field">
                                <label for="femaleBirthTime">
                                    <i class="fas fa-clock"></i>
                                    å‡ºç”Ÿæ—¶è¾°
                                </label>
                                <select id="femaleBirthTime" class="traditional-select">
                                    <option value="">è¯·é€‰æ‹©æ—¶è¾°</option>
                                    <option value="zi">å­æ—¶ (23:00-1:00)</option>
                                    <option value="chou">ä¸‘æ—¶ (1:00-3:00)</option>
                                    <option value="yin">å¯…æ—¶ (3:00-5:00)</option>
                                    <option value="mao">å¯æ—¶ (5:00-7:00)</option>
                                    <option value="chen">è¾°æ—¶ (7:00-9:00)</option>
                                    <option value="si">å·³æ—¶ (9:00-11:00)</option>
                                    <option value="wu">åˆæ—¶ (11:00-13:00)</option>
                                    <option value="wei">æœªæ—¶ (13:00-15:00)</option>
                                    <option value="shen">ç”³æ—¶ (15:00-17:00)</option>
                                    <option value="you">é…‰æ—¶ (17:00-19:00)</option>
                                    <option value="xu">æˆŒæ—¶ (19:00-21:00)</option>
                                    <option value="hai">äº¥æ—¶ (21:00-23:00)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="input-field">
                            <label for="femaleBirthPlace">
                                <i class="fas fa-map-marker-alt"></i>
                                å‡ºç”Ÿåœ°ç‚¹
                            </label>
                            <input type="text" id="femaleBirthPlace" class="traditional-input" placeholder="è¯·è¾“å…¥å‡ºç”Ÿåœ°ç‚¹ï¼ˆå¦‚ï¼šä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºï¼‰">
                                </div>
                                    </div>
                                </div>
                        
                <!-- å•äººå§»ç¼˜è¡¨å• -->
                <div class="form-content single-content" id="singleForm" style="display: none;">
                    <div class="person-form single-person-form">
                        <div class="form-title">
                            <i class="fas fa-user"></i>
                            <h4>ä¸ªäººä¿¡æ¯</h4>
                            </div>
                        
                        <div class="input-grid">
                            <div class="input-field">
                                <label for="singleName">
                                    <i class="fas fa-user"></i>
                                    å§“å
                                </label>
                                <input type="text" id="singleName" class="traditional-input" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                            </div>
                            
                            <div class="input-field">
                                <label for="singleGender">
                                    <i class="fas fa-venus-mars"></i>
                                    æ€§åˆ«
                                </label>
                                <select id="singleGender" class="traditional-select">
                                    <option value="">è¯·é€‰æ‹©æ€§åˆ«</option>
                                    <option value="male">ç”·</option>
                                    <option value="female">å¥³</option>
                                    </select>
                                </div>
                                </div>
                        
                        <div class="datetime-grid">
                            <div class="input-field">
                                <label for="singleBirthDate">
                                    <i class="fas fa-calendar-alt"></i>
                                    å‡ºç”Ÿæ—¥æœŸ
                                </label>
                                <div class="custom-date-picker" id="singleBirthDate">
                                    <select class="date-select year-select" id="singleBirthYear">
                                        <option value="">å¹´</option>
                                    </select>
                                    <select class="date-select month-select" id="singleBirthMonth">
                                        <option value="">æœˆ</option>
                                        <option value="1">1æœˆ</option>
                                        <option value="2">2æœˆ</option>
                                        <option value="3">3æœˆ</option>
                                        <option value="4">4æœˆ</option>
                                        <option value="5">5æœˆ</option>
                                        <option value="6">6æœˆ</option>
                                        <option value="7">7æœˆ</option>
                                        <option value="8">8æœˆ</option>
                                        <option value="9">9æœˆ</option>
                                        <option value="10">10æœˆ</option>
                                        <option value="11">11æœˆ</option>
                                        <option value="12">12æœˆ</option>
                                    </select>
                                    <select class="date-select day-select" id="singleBirthDay">
                                        <option value="">æ—¥</option>
                                    </select>
                        </div>
                    </div>

                            <div class="input-field">
                                <label for="singleBirthTime">
                                    <i class="fas fa-clock"></i>
                                    å‡ºç”Ÿæ—¶è¾°
                                </label>
                                <select id="singleBirthTime" class="traditional-select">
                                        <option value="">è¯·é€‰æ‹©æ—¶è¾°</option>
                                    <option value="zi">å­æ—¶ (23:00-1:00)</option>
                                    <option value="chou">ä¸‘æ—¶ (1:00-3:00)</option>
                                    <option value="yin">å¯…æ—¶ (3:00-5:00)</option>
                                    <option value="mao">å¯æ—¶ (5:00-7:00)</option>
                                    <option value="chen">è¾°æ—¶ (7:00-9:00)</option>
                                    <option value="si">å·³æ—¶ (9:00-11:00)</option>
                                    <option value="wu">åˆæ—¶ (11:00-13:00)</option>
                                    <option value="wei">æœªæ—¶ (13:00-15:00)</option>
                                    <option value="shen">ç”³æ—¶ (15:00-17:00)</option>
                                    <option value="you">é…‰æ—¶ (17:00-19:00)</option>
                                    <option value="xu">æˆŒæ—¶ (19:00-21:00)</option>
                                    <option value="hai">äº¥æ—¶ (21:00-23:00)</option>
                                    </select>
                            </div>
                        </div>
                        
                        <div class="input-field">
                            <label for="singleBirthPlace">
                                <i class="fas fa-map-marker-alt"></i>
                                å‡ºç”Ÿåœ°ç‚¹
                            </label>
                            <input type="text" id="singleBirthPlace" class="traditional-input" placeholder="è¯·è¾“å…¥å‡ºç”Ÿåœ°ç‚¹ï¼ˆå¦‚ï¼šå¹¿å·å¸‚å¤©æ²³åŒºï¼‰">
                                </div>
                        
                        <!-- æœŸæœ›æ¡ä»¶ -->
                        <div class="expectation-section">
                            <h5><i class="fas fa-heart"></i> ç†æƒ³ä¼´ä¾£æœŸæœ›ï¼ˆå¯é€‰ï¼‰</h5>
                            <div class="input-grid">
                                <div class="input-field">
                                    <label for="expectedAge">
                                        <i class="fas fa-birthday-cake"></i>
                                        æœŸæœ›å¹´é¾„èŒƒå›´
                                    </label>
                                    <select id="expectedAge" class="traditional-select">
                                        <option value="">ä¸é™</option>
                                        <option value="younger">æ¯”æˆ‘å¹´è½»</option>
                                        <option value="similar">åŒé¾„</option>
                                        <option value="older">æ¯”æˆ‘å¹´é•¿</option>
                                        </select>
                                    </div>
                                
                                <div class="input-field">
                                    <label for="expectedPersonality">
                                        <i class="fas fa-smile"></i>
                                        æœŸæœ›æ€§æ ¼
                                    </label>
                                    <select id="expectedPersonality" class="traditional-select">
                                        <option value="">ä¸é™</option>
                                        <option value="gentle">æ¸©å’Œä½“è´´</option>
                                        <option value="active">æ´»æ³¼å¼€æœ—</option>
                                        <option value="stable">ç¨³é‡è¸å®</option>
                                        <option value="creative">å¯Œæœ‰åˆ›æ„</option>
                                    </select>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                    <button class="analyze-btn" id="analyzeBtn" onclick="analyzeMarriage()">
                            <i class="fas fa-heart"></i>
                        <span id="analyzeBtnText">å¼€å§‹åˆå©šåˆ†æ</span>
                        <div class="btn-ripple"></div>
                        </button>
                </div>
            </div>
        </div>

        <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
        <div class="result-section" id="resultSection" style="display: none;">
            <div class="result-container">
                <div class="result-header">
                    <h3><i class="fas fa-scroll"></i> å§»ç¼˜åˆ†ææŠ¥å‘Š</h3>
                    <p>æ ¹æ®å…«å­—ä¿¡æ¯ï¼Œä¸ºæ‚¨å‘ˆç°è¯¦ç»†çš„åˆå©šåˆ†æ</p>
                </div>
                
            <div class="result-content" id="resultContent">
                    <!-- ç»“æœå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="result-actions">
                    <button class="secondary-btn" onclick="resetForm()">
                        <i class="fas fa-redo"></i>
                        é‡æ–°åˆ†æ
                    </button>
                    <button class="ai-btn" onclick="generateAIAnalysis()">
                        <i class="fas fa-brain"></i>
                        AIæ™ºèƒ½åˆ†æ
                    </button>
                    <button class="primary-btn" onclick="generateReport()">
                        <i class="fas fa-file-pdf"></i>
                        ç”ŸæˆPDFæŠ¥å‘Š
                    </button>
                    <button class="tertiary-btn" onclick="generateImageReport()">
                        <i class="fas fa-image"></i>
                        å¯¼å‡ºå›¾ç‰‡
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="traditional-spinner">
                <div class="bagua-symbol">
                    <div class="bagua-line"></div>
                    <div class="bagua-line"></div>
                    <div class="bagua-line"></div>
                    <div class="bagua-line"></div>
                    <div class="bagua-line"></div>
                    <div class="bagua-line"></div>
                    <div class="bagua-line"></div>
                    <div class="bagua-line"></div>
                </div>
            </div>
            <p>æ­£åœ¨è§£æå…«å­—ï¼Œè¯·ç¨å€™...</p>
            </div>
        </div>

    <!-- ä¼ ç»Ÿè£…é¥°å…ƒç´  -->
    <div class="decoration-elements">
        <div class="floating-element dragon"></div>
        <div class="floating-element phoenix"></div>
        <div class="floating-element cloud"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let isAnalyzing = false;
let currentMode = 'couple'; // 'couple' or 'single'

// ç”Ÿè‚–é…å¯¹æ•°æ®
const zodiacCompatibility = {
    'é¼ ': { best: ['é¾™', 'çŒ´', 'ç‰›'], good: ['é¼ ', 'è™', 'å…”', 'è›‡', 'çŒª'], bad: ['é©¬', 'ç¾Š', 'é¸¡', 'ç‹—'] },
    'ç‰›': { best: ['è›‡', 'é¸¡', 'é¼ '], good: ['ç‰›', 'å…”', 'é¾™', 'çŒ´', 'çŒª'], bad: ['è™', 'é©¬', 'ç¾Š', 'ç‹—'] },
    'è™': { best: ['é©¬', 'ç‹—', 'çŒª'], good: ['è™', 'é¾™', 'è›‡', 'é¸¡'], bad: ['ç‰›', 'å…”', 'è›‡', 'çŒ´'] },
    'å…”': { best: ['ç¾Š', 'çŒª', 'ç‹—'], good: ['ç‰›', 'è™', 'é¾™', 'è›‡', 'é©¬', 'é¸¡'], bad: ['é¼ ', 'å…”', 'é¸¡'] },
    'é¾™': { best: ['é¼ ', 'çŒ´', 'é¸¡'], good: ['ç‰›', 'è™', 'å…”', 'è›‡', 'é©¬', 'ç¾Š'], bad: ['é¾™', 'ç‹—', 'çŒª'] },
    'è›‡': { best: ['ç‰›', 'é¸¡'], good: ['è™', 'å…”', 'é¾™', 'é©¬', 'ç¾Š', 'çŒ´', 'çŒª'], bad: ['é¼ ', 'è›‡', 'ç‹—'] },
    'é©¬': { best: ['è™', 'ç¾Š', 'ç‹—'], good: ['å…”', 'é¾™', 'è›‡', 'é©¬', 'çŒ´', 'é¸¡'], bad: ['é¼ ', 'ç‰›', 'çŒª'] },
    'ç¾Š': { best: ['å…”', 'é©¬', 'çŒª'], good: ['é¾™', 'è›‡', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—'], bad: ['é¼ ', 'ç‰›', 'è™'] },
    'çŒ´': { best: ['é¼ ', 'é¾™'], good: ['ç‰›', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'], bad: ['è™', 'è›‡'] },
    'é¸¡': { best: ['ç‰›', 'é¾™', 'è›‡'], good: ['å…”', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—'], bad: ['é¼ ', 'è™', 'çŒª'] },
    'ç‹—': { best: ['è™', 'å…”', 'é©¬'], good: ['ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'], bad: ['ç‰›', 'é¾™', 'è›‡', 'é¸¡'] },
    'çŒª': { best: ['è™', 'å…”', 'ç¾Š'], good: ['é¼ ', 'ç‰›', 'è›‡', 'çŒ´', 'ç‹—', 'çŒª'], bad: ['é¾™', 'é©¬', 'é¸¡'] }
};

// äº”è¡Œç›¸ç”Ÿç›¸å…‹å…³ç³»
const wuxingRelations = {
    'é‡‘': { generates: 'æ°´', destroys: 'æœ¨', generatedBy: 'åœŸ', destroyedBy: 'ç«' },
    'æœ¨': { generates: 'ç«', destroys: 'åœŸ', generatedBy: 'æ°´', destroyedBy: 'é‡‘' },
    'æ°´': { generates: 'æœ¨', destroys: 'ç«', generatedBy: 'é‡‘', destroyedBy: 'åœŸ' },
    'ç«': { generates: 'åœŸ', destroys: 'é‡‘', generatedBy: 'æœ¨', destroyedBy: 'æ°´' },
    'åœŸ': { generates: 'é‡‘', destroys: 'æ°´', generatedBy: 'ç«', destroyedBy: 'æœ¨' }
};

// å¤©å¹²åœ°æ”¯æ•°æ®
const tianGan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
const diZhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
const zodiacAnimals = ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'];

// æ¨¡å¼åˆ‡æ¢å‡½æ•°
function switchMode(mode) {
    currentMode = mode;
    
    // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
    document.querySelectorAll('.mode-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
    
    // æ›´æ–°è¡¨å•æ˜¾ç¤º
    if (mode === 'couple') {
        document.getElementById('coupleForm').style.display = 'grid';
        document.getElementById('singleForm').style.display = 'none';
        document.getElementById('formTitle').innerHTML = '<i class="fas fa-user-friends"></i> åŒæ–¹åŸºæœ¬ä¿¡æ¯';
        document.getElementById('formSubtitle').textContent = 'è¯·è¾“å…¥åŒæ–¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨è¿›è¡Œä¸“ä¸šçš„å…«å­—åˆå©šåˆ†æ';
        document.getElementById('analyzeBtnText').textContent = 'å¼€å§‹åˆå©šåˆ†æ';
    } else {
        document.getElementById('coupleForm').style.display = 'none';
        document.getElementById('singleForm').style.display = 'block';
        document.getElementById('formTitle').innerHTML = '<i class="fas fa-user"></i> ä¸ªäººåŸºæœ¬ä¿¡æ¯';
        document.getElementById('formSubtitle').textContent = 'è¯·è¾“å…¥æ‚¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨æ¨ç®—é€‚åˆçš„ä¼´ä¾£ç±»å‹';
        document.getElementById('analyzeBtnText').textContent = 'å¼€å§‹å§»ç¼˜åˆ†æ';
    }
    
    // éšè—ç»“æœåŒºåŸŸ
    document.getElementById('resultSection').style.display = 'none';
}

function analyzeMarriage() {

    if (isAnalyzing) return;
    
    try {
        if (currentMode === 'couple') {
            analyzeCoupleMarriage();
        } else {
            analyzeSingleDestiny();
        }
    } catch (error) {
        console.error('Error in analyzeMarriage:', error);
        showNotification('åˆ†æè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•', 'warning');
    }
}

function analyzeCoupleMarriage() {
    // è·å–è¾“å…¥æ•°æ®
    const maleData = {
        name: document.getElementById('maleName').value.trim(),
        birthDate: getDateFromSelects('male'),
        birthTime: document.getElementById('maleBirthTime').value,
        birthPlace: document.getElementById('maleBirthPlace').value.trim()
    };
    
    const femaleData = {
        name: document.getElementById('femaleName').value.trim(),
        birthDate: getDateFromSelects('female'),
        birthTime: document.getElementById('femaleBirthTime').value,
        birthPlace: document.getElementById('femaleBirthPlace').value.trim()
    };
    
    // éªŒè¯è¾“å…¥
    if (!maleData.name || !maleData.birthDate || !femaleData.name || !femaleData.birthDate) {
        showNotification('è¯·å¡«å†™åŒæ–¹çš„å§“åå’Œå‡ºç”Ÿæ—¥æœŸ', 'warning');
        return;
    }
    
    isAnalyzing = true;
    showLoading();
    
    // æ¨¡æ‹Ÿåˆ†æè¿‡ç¨‹
    setTimeout(() => {
        hideLoading();
        generateMarriageResult(maleData, femaleData);
        isAnalyzing = false;
    }, 4000);
}

function analyzeSingleDestiny() {

    // è·å–è¾“å…¥æ•°æ®
    const singleData = {
        name: document.getElementById('singleName').value.trim(),
        gender: document.getElementById('singleGender').value,
        birthDate: getDateFromSelects('single'),
        birthTime: document.getElementById('singleBirthTime').value,
        birthPlace: document.getElementById('singleBirthPlace').value.trim(),
        expectedAge: document.getElementById('expectedAge').value,
        expectedPersonality: document.getElementById('expectedPersonality').value
    };

    // éªŒè¯è¾“å…¥
    if (!singleData.name || !singleData.gender || !singleData.birthDate) {
        showNotification('è¯·å¡«å†™å§“åã€æ€§åˆ«å’Œå‡ºç”Ÿæ—¥æœŸ', 'warning');
        return;
    }
    
    isAnalyzing = true;
    showLoading();
    
    // æ¨¡æ‹Ÿåˆ†æè¿‡ç¨‹
    setTimeout(() => {
        hideLoading();
        generateSingleDestinyResult(singleData);
        isAnalyzing = false;
    }, 4000);
}

function generateMarriageResult(maleData, femaleData) {
    // è®¡ç®—ç”Ÿè‚–
    const maleZodiac = getZodiacAnimal(maleData.birthDate);
    const femaleZodiac = getZodiacAnimal(femaleData.birthDate);
    
    // åˆ†æç”Ÿè‚–é…å¯¹
    const zodiacCompatibilityResult = analyzeZodiacCompatibility(maleZodiac, femaleZodiac);
    
    // ç”Ÿæˆå…«å­—ï¼ˆç®€åŒ–ç‰ˆï¼‰
    const maleBazi = generateSimpleBazi(maleData.birthDate, maleData.birthTime);
    const femaleBazi = generateSimpleBazi(femaleData.birthDate, femaleData.birthTime);
    
    // äº”è¡Œåˆ†æ
    const wuxingAnalysis = analyzeWuxing(maleBazi, femaleBazi);
    
    // ç»¼åˆè¯„åˆ†
    const overallScore = calculateOverallScore(zodiacCompatibilityResult, wuxingAnalysis);
    
    const resultContent = document.getElementById('resultContent');
    resultContent.innerHTML = `
        <div class="analysis-summary">
            <div class="couple-info">
                <div class="person-card male-card">
                    <div class="card-header">
                        <i class="fas fa-male"></i>
                        <h4>${maleData.name}</h4>
                    </div>
                    <div class="card-content">
                        <div class="zodiac-info">
                            <span class="zodiac-label">ç”Ÿè‚–ï¼š</span>
                            <span class="zodiac-value">${maleZodiac}</span>
                </div>
                        <div class="bazi-info">
                            <span class="bazi-label">å…«å­—ï¼š</span>
                            <div class="bazi-pillars">
                                ${maleBazi.map(pillar => `<span class="pillar">${pillar}</span>`).join('')}
            </div>
                </div>
                    </div>
                    </div>
                
                    <div class="compatibility-score">
                    <div class="score-circle">
                        <div class="score-inner">
                            <span class="score-number">${overallScore}</span>
                            <span class="score-label">åˆ†</span>
                    </div>
                        <svg class="score-progress" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" stroke="#f0f0f0" stroke-width="8" fill="none"/>
                            <circle cx="50" cy="50" r="45" stroke="#d4af37" stroke-width="8" fill="none"
                                    stroke-dasharray="283" stroke-dashoffset="${283 - (283 * overallScore / 100)}"
                                    stroke-linecap="round" transform="rotate(-90 50 50)"/>
                        </svg>
                </div>
                    <div class="score-description">
                        <h4>å§»ç¼˜å¥‘åˆåº¦</h4>
                        <p>${getScoreDescription(overallScore)}</p>
            </div>
                    </div>
                    
                <div class="person-card female-card">
                    <div class="card-header">
                        <i class="fas fa-female"></i>
                        <h4>${femaleData.name}</h4>
                    </div>
                    <div class="card-content">
                        <div class="zodiac-info">
                            <span class="zodiac-label">ç”Ÿè‚–ï¼š</span>
                            <span class="zodiac-value">${femaleZodiac}</span>
                        </div>
                        <div class="bazi-info">
                            <span class="bazi-label">å…«å­—ï¼š</span>
                            <div class="bazi-pillars">
                                ${femaleBazi.map(pillar => `<span class="pillar">${pillar}</span>`).join('')}
                    </div>
                </div>
                </div>
                    </div>
                </div>
                    </div>
                    
        <div class="analysis-details">
            <div class="analysis-card zodiac-analysis">
                        <div class="card-header">
                            <i class="fas fa-paw"></i>
                    <h4>ç”Ÿè‚–é…å¯¹åˆ†æ</h4>
                    </div>
                <div class="card-content">
                    <div class="compatibility-result ${zodiacCompatibilityResult.level}">
                        <div class="result-icon">
                            ${zodiacCompatibilityResult.level === 'excellent' ? 'ğŸ’–' : 
                              zodiacCompatibilityResult.level === 'good' ? 'ğŸ’•' : 'ğŸ’”'}
                    </div>
                        <div class="result-text">
                            <h5>${zodiacCompatibilityResult.title}</h5>
                            <p>${zodiacCompatibilityResult.description}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-card wuxing-analysis">
                        <div class="card-header">
                    <i class="fas fa-yin-yang"></i>
                    <h4>äº”è¡Œäº’è¡¥åˆ†æ</h4>
                </div>
                <div class="card-content">
                    <div class="wuxing-chart">
                        ${generateWuxingChart(wuxingAnalysis)}
                    </div>
                    <div class="wuxing-description">
                        <p>${wuxingAnalysis.description}</p>
                    </div>
                    </div>
                </div>
            
            <div class="analysis-card suggestions">
                <div class="card-header">
                    <i class="fas fa-lightbulb"></i>
                    <h4>å§»ç¼˜å»ºè®®</h4>
                </div>
                <div class="card-content">
                    <div class="suggestions-list">
                        ${generateSuggestions(overallScore, zodiacCompatibilityResult, wuxingAnalysis)}
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
    document.getElementById('resultSection').style.display = 'block';
    
    // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
    setTimeout(() => {
        document.getElementById('resultSection').scrollIntoView({ 
            behavior: 'smooth' 
        });
    }, 100);
    
    showNotification('å§»ç¼˜åˆ†æå®Œæˆï¼', 'success');
}

function generateSingleDestinyResult(singleData) {
    // è®¡ç®—ä¸ªäººä¿¡æ¯
    const userZodiac = getZodiacAnimal(singleData.birthDate);
    const userBazi = generateSimpleBazi(singleData.birthDate, singleData.birthTime);
    const userElement = getPersonElement(userBazi);
    
    // æ¨ç®—é€‚åˆçš„ä¼´ä¾£
    const idealPartner = calculateIdealPartner(userZodiac, userElement, singleData.gender, singleData.expectedAge, singleData.expectedPersonality);
    
    // å§»ç¼˜è¿åŠ¿åˆ†æ
    const destinyAnalysis = analyzeSingleDestinyDetails(userZodiac, userElement, singleData.birthDate);
    
    const resultContent = document.getElementById('resultContent');
    resultContent.innerHTML = `
        <div class="single-analysis-summary">
            <div class="user-profile">
                <div class="profile-card">
                    <div class="card-header">
                        <i class="fas fa-${singleData.gender === 'male' ? 'male' : 'female'}"></i>
                        <h4>${singleData.name}</h4>
                    </div>
                    <div class="card-content">
                        <div class="zodiac-info">
                            <span class="zodiac-label">ç”Ÿè‚–ï¼š</span>
                            <span class="zodiac-value">${userZodiac}</span>
                </div>
                        <div class="bazi-info">
                            <span class="bazi-label">å…«å­—ï¼š</span>
                            <div class="bazi-pillars">
                                ${userBazi.map(pillar => `<span class="pillar">${pillar}</span>`).join('')}
            </div>
                    </div>
                        <div class="element-info">
                            <span class="element-label">ä¸»è¦äº”è¡Œï¼š</span>
                            <span class="element-value">${userElement}</span>
                        </div>
                    </div>
                </div>
            </div>
                </div>
                
        <div class="single-analysis-details">
            <div class="analysis-card ideal-partner">
                <div class="card-header">
                    <i class="fas fa-heart"></i>
                    <h4>ç†æƒ³ä¼´ä¾£åˆ†æ</h4>
                    </div>
                <div class="card-content">
                    <div class="partner-recommendations">
                        <div class="recommendation-item best">
                            <div class="rec-header">
                                <i class="fas fa-star"></i>
                                <h5>æœ€ä½³é…å¯¹ç”Ÿè‚–</h5>
                        </div>
                            <div class="rec-content">
                                <div class="zodiac-list">
                                    ${idealPartner.bestZodiacs.map(zodiac => 
                                        `<span class="zodiac-tag best">${zodiac}</span>`
                                    ).join('')}
                    </div>
                                <p>${idealPartner.bestDescription}</p>
                </div>
            </div>
            
                        <div class="recommendation-item good">
                            <div class="rec-header">
                                <i class="fas fa-heart"></i>
                                <h5>é€‚åˆçš„ä¼´ä¾£ç‰¹è´¨</h5>
                        </div>
                            <div class="rec-content">
                                <div class="trait-list">
                                    ${idealPartner.traits.map(trait => 
                                        `<div class="trait-item">
                                            <i class="fas fa-check-circle"></i>
                                            <span>${trait}</span>
                                        </div>`
                                    ).join('')}
                    </div>
                        </div>
                    </div>
                        </div>
                </div>
                    </div>
                    
            <div class="analysis-card destiny-analysis">
                        <div class="card-header">
                    <i class="fas fa-crystal-ball"></i>
                    <h4>å§»ç¼˜è¿åŠ¿</h4>
                        </div>
                <div class="card-content">
                    <div class="destiny-timeline">
                        ${destinyAnalysis.timeline.map(period => 
                            `<div class="timeline-item">
                                <div class="timeline-dot ${period.level}"></div>
                                <div class="timeline-content">
                                    <h6>${period.period}</h6>
                                    <p>${period.description}</p>
                                </div>
                            </div>`
                        ).join('')}
                    </div>
                </div>
            </div>
            
            <div class="analysis-card suggestions">
                <div class="card-header">
                    <i class="fas fa-lightbulb"></i>
                    <h4>å§»ç¼˜å»ºè®®</h4>
                </div>
                <div class="card-content">
                    <div class="suggestions-list">
                        ${destinyAnalysis.suggestions.map(suggestion => 
                            `<div class="suggestion-item">
                    <i class="fas fa-heart"></i>
                                ${suggestion}
                            </div>`
                        ).join('')}
                </div>
                </div>
            </div>
        </div>
    `;
    
    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
    document.getElementById('resultSection').style.display = 'block';
    
    // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
    setTimeout(() => {
        document.getElementById('resultSection').scrollIntoView({ 
            behavior: 'smooth' 
        });
    }, 100);
    
    showNotification('å§»ç¼˜åˆ†æå®Œæˆï¼', 'success');
}

function getZodiacAnimal(dateString) {
    const year = new Date(dateString).getFullYear();
    // ç®€åŒ–è®¡ç®—ï¼Œå®é™…åº”è¯¥è€ƒè™‘å†œå†
    const zodiacIndex = (year - 1900) % 12;
    return zodiacAnimals[zodiacIndex];
}

function analyzeZodiacCompatibility(maleZodiac, femaleZodiac) {
    const compatibility = zodiacCompatibility[maleZodiac];
    
    if (compatibility.best.includes(femaleZodiac)) {
        return {
            level: 'excellent',
            title: 'å¤©ä½œä¹‹åˆ',
            description: `${maleZodiac}ä¸${femaleZodiac}å±äºæœ€ä½³é…å¯¹ï¼Œæ€§æ ¼äº’è¡¥ï¼Œèƒ½å¤Ÿç›¸äº’æ‰¶æŒï¼Œå…±åŒæˆé•¿ã€‚è¿™æ ·çš„ç»„åˆå¾€å¾€èƒ½å¤Ÿå»ºç«‹ç¨³å®šå¹¸ç¦çš„å©šå§»å…³ç³»ã€‚`
        };
    } else if (compatibility.good.includes(femaleZodiac)) {
        return {
            level: 'good',
            title: 'è‰¯ç¼˜ä½³é…',
            description: `${maleZodiac}ä¸${femaleZodiac}å±äºè¾ƒå¥½é…å¯¹ï¼Œè™½ç„¶å¶æœ‰å°æ‘©æ“¦ï¼Œä½†æ€»ä½“å’Œè°ã€‚åªè¦åŒæ–¹å¤šæ²Ÿé€šç†è§£ï¼Œå¿…èƒ½ç™½å¤´å•è€ã€‚`
        };
    } else {
        return {
            level: 'challenging',
            title: 'éœ€è¦ç£¨åˆ',
            description: `${maleZodiac}ä¸${femaleZodiac}çš„é…å¯¹éœ€è¦æ›´å¤šçš„ç†è§£å’ŒåŒ…å®¹ã€‚è™½ç„¶æŒ‘æˆ˜è¾ƒå¤šï¼Œä½†çœŸçˆ±èƒ½å¤Ÿå…‹æœä¸€åˆ‡å›°éš¾ã€‚`
        };
    }
}

function generateSimpleBazi(dateString, timeString) {
    // è¿™é‡Œæ˜¯ç®€åŒ–çš„å…«å­—ç”Ÿæˆï¼Œå®é™…åº”è¯¥ä½¿ç”¨ä¸“ä¸šçš„ä¸‡å¹´å†ç®—æ³•
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    
    // ç®€åŒ–çš„å¤©å¹²åœ°æ”¯è®¡ç®—
    const yearGan = tianGan[(year - 4) % 10];
    const yearZhi = diZhi[(year - 4) % 12];
    const monthGan = tianGan[(month - 1) % 10];
    const monthZhi = diZhi[(month - 1) % 12];
    const dayGan = tianGan[(day - 1) % 10];
    const dayZhi = diZhi[(day - 1) % 12];
    
    let timeGan = 'ç”²', timeZhi = 'å­';
    if (timeString) {
        const timeIndex = ['zi', 'chou', 'yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai'].indexOf(timeString);
        if (timeIndex !== -1) {
            timeGan = tianGan[timeIndex % 10];
            timeZhi = diZhi[timeIndex];
        }
    }
    
    return [
        `${yearGan}${yearZhi}`,
        `${monthGan}${monthZhi}`,
        `${dayGan}${dayZhi}`,
        `${timeGan}${timeZhi}`
    ];
}

function analyzeWuxing(maleBazi, femaleBazi) {
    // ç®€åŒ–çš„äº”è¡Œåˆ†æ
    const elements = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
    const maleElements = elements[Math.floor(Math.random() * elements.length)];
    const femaleElements = elements[Math.floor(Math.random() * elements.length)];
    
    let relationship = 'å¹³è¡¡';
    let description = 'åŒæ–¹äº”è¡Œå¹³è¡¡ï¼Œç›¸å¤„å’Œè°ã€‚';
    
    if (wuxingRelations[maleElements].generates === femaleElements) {
        relationship = 'ç›¸ç”Ÿ';
        description = `ç”·æ–¹${maleElements}è¡Œç”Ÿå¥³æ–¹${femaleElements}è¡Œï¼Œç”·æ–¹èƒ½å¤Ÿç»™äºˆå¥³æ–¹æ”¯æŒå’Œå¸®åŠ©ï¼Œå…³ç³»èæ´½ã€‚`;
    } else if (wuxingRelations[maleElements].destroys === femaleElements) {
        relationship = 'ç›¸å…‹';
        description = `ç”·æ–¹${maleElements}è¡Œå…‹å¥³æ–¹${femaleElements}è¡Œï¼Œéœ€è¦æ›´å¤šç†è§£å’ŒåŒ…å®¹ï¼Œå»ºè®®é€šè¿‡è°ƒå’ŒåŒ–è§£ã€‚`;
    }
    
    return {
        maleElement: maleElements,
        femaleElement: femaleElements,
        relationship: relationship,
        description: description
    };
}

function calculateOverallScore(zodiacResult, wuxingResult) {
    let score = 60; // åŸºç¡€åˆ†
    
    if (zodiacResult.level === 'excellent') score += 25;
    else if (zodiacResult.level === 'good') score += 15;
    else score += 5;
    
    if (wuxingResult.relationship === 'ç›¸ç”Ÿ') score += 15;
    else if (wuxingResult.relationship === 'å¹³è¡¡') score += 10;
    else score += 0;
    
    return Math.min(score, 99); // æœ€é«˜99åˆ†
}

function getScoreDescription(score) {
    if (score >= 90) return 'å¤©ä½œä¹‹åˆï¼Œç™¾å¹´å¥½åˆ';
    else if (score >= 80) return 'è‰¯ç¼˜ä½³é…ï¼Œç›¸å¾—ç›Šå½°';
    else if (score >= 70) return 'ç¼˜åˆ†ä¸æµ…ï¼Œéœ€è¦ç»è¥';
    else if (score >= 60) return 'æœ‰ç¼˜æ— åˆ†ï¼Œéœ€è¦åŠªåŠ›';
    else return 'ç¼˜åˆ†è¾ƒæµ…ï¼Œéœ€è¦æ…é‡';
}

function generateWuxingChart(wuxingAnalysis) {
    return `
        <div class="wuxing-elements">
                            <div class="element-pair">
                    <div class="element male-element">
                        <div class="element-symbol">${wuxingAnalysis.maleElement}</div>
                        <div class="element-label">ç”·æ–¹</div>
                    </div>
                    <div class="relationship-indicator ${wuxingAnalysis.relationship}">
                        <span class="relationship-text">${wuxingAnalysis.relationship}</span>
                    </div>
                    <div class="element female-element">
                        <div class="element-symbol">${wuxingAnalysis.femaleElement}</div>
                        <div class="element-label">å¥³æ–¹</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function generateSuggestions(score, zodiacResult, wuxingResult) {
    const suggestions = [];
    
    if (score >= 80) {
        suggestions.push('ä½ ä»¬çš„ç¼˜åˆ†å¾ˆæ·±ï¼Œè¦çæƒœå½¼æ­¤ï¼Œå…±åŒç»è¥è¿™ä»½ç¾å¥½çš„æ„Ÿæƒ…ã€‚');
        suggestions.push('å»ºè®®é€‰æ‹©å‰æ—¥è‰¯è¾°ä¸¾åŠå©šç¤¼ï¼Œè®©å¤©æ—¶åœ°åˆ©äººå’Œéƒ½ä¸ºä½ ä»¬åŠ©åŠ›ã€‚');
    } else if (score >= 60) {
        suggestions.push('è™½ç„¶æœ‰äº›å°æŒ‘æˆ˜ï¼Œä½†çœŸè¯šçš„æ²Ÿé€šèƒ½åŒ–è§£æ‰€æœ‰é—®é¢˜ã€‚');
        suggestions.push('å»ºè®®å¤šå‚åŠ ä¸€äº›ä¼ ç»Ÿæ–‡åŒ–æ´»åŠ¨ï¼Œå¢è¿›å½¼æ­¤äº†è§£ã€‚');
    } else {
        suggestions.push('æ„Ÿæƒ…éœ€è¦æ›´å¤šçš„è€å¿ƒå’ŒåŒ…å®¹ï¼Œä¸è¦æ€¥äºæ±‚æˆã€‚');
        suggestions.push('å»ºè®®å¯»æ±‚é•¿è¾ˆçš„å»ºè®®å’Œç¥ç¦ï¼Œè·å¾—æ›´å¤šçš„æ”¯æŒã€‚');
    }
    
    if (wuxingResult.relationship === 'ç›¸å…‹') {
        suggestions.push('å¯ä»¥é€šè¿‡ä½©æˆ´ç›¸åº”çš„é¥°å“æ¥è°ƒå’Œäº”è¡Œï¼ŒåŒ–è§£ç›¸å…‹ä¹‹åŠ¿ã€‚');
    }
    
    return suggestions.map(suggestion => `<div class="suggestion-item"><i class="fas fa-heart"></i> ${suggestion}</div>`).join('');
}

function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

function resetForm() {
    document.getElementById('maleName').value = '';
    document.getElementById('maleBirthDate').value = '';
    document.getElementById('maleBirthTime').value = '';
    document.getElementById('maleBirthPlace').value = '';
    document.getElementById('femaleName').value = '';
    document.getElementById('femaleBirthDate').value = '';
    document.getElementById('femaleBirthTime').value = '';
    document.getElementById('femaleBirthPlace').value = '';
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('formSection').scrollIntoView({ 
        behavior: 'smooth' 
    });
}

// å•äººåˆ†æè¾…åŠ©å‡½æ•°
function getPersonElement(bazi) {
    const elements = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
    return elements[Math.floor(Math.random() * elements.length)];
}

function calculateIdealPartner(userZodiac, userElement, userGender, expectedAge, expectedPersonality) {
    const compatibility = zodiacCompatibility[userZodiac];
    
    // åŸºäºç”Ÿè‚–çš„æœ€ä½³é…å¯¹
    const bestZodiacs = compatibility.best;
    
    // åŸºäºäº”è¡Œçš„ç‰¹è´¨åŒ¹é…
    const elementTraits = {
        'é‡‘': ['åšæ¯…æœæ–­', 'ç†æ€§åŠ¡å®', 'è¿½æ±‚å®Œç¾', 'è´£ä»»å¿ƒå¼º'],
        'æœ¨': ['æ¸©å’Œå–„è‰¯', 'å¯Œæœ‰åˆ›æ„', 'ä¹è§‚å‘ä¸Š', 'åŒ…å®¹æ€§å¼º'],
        'æ°´': ['èªæ˜æ™ºæ…§', 'é€‚åº”èƒ½åŠ›å¼º', 'ç›´è§‰æ•é”', 'å–„äºæ²Ÿé€š'],
        'ç«': ['çƒ­æƒ…æ´»æ³¼', 'ç§¯æä¸»åŠ¨', 'å¯Œæœ‰æ¿€æƒ…', 'é¢†å¯¼èƒ½åŠ›å¼º'],
        'åœŸ': ['ç¨³é‡è¸å®', 'å¿ è¯šå¯é ', 'è„šè¸å®åœ°', 'è€å¿ƒç»†è‡´']
    };
    
    let traits = [...elementTraits[userElement]];
    
    // æ ¹æ®æœŸæœ›æ·»åŠ ç‰¹è´¨
    if (expectedPersonality) {
        const personalityTraits = {
            'gentle': ['æ¸©å’Œä½“è´´', 'å–„è§£äººæ„', 'åŒ…å®¹å®½å®¹'],
            'active': ['æ´»æ³¼å¼€æœ—', 'ç§¯æä¹è§‚', 'å–„äºäº¤é™…'],
            'stable': ['ç¨³é‡è¸å®', 'å¯é è´Ÿè´£', 'æˆç†Ÿç¨³å¥'],
            'creative': ['å¯Œæœ‰åˆ›æ„', 'æ€ç»´æ•æ·', 'è‰ºæœ¯æ°”è´¨']
        };
        traits.push(...personalityTraits[expectedPersonality] || []);
    }
    
    // å¹´é¾„æœŸæœ›æè¿°
    let ageDescription = '';
    if (expectedAge === 'younger') {
        ageDescription = 'å»ºè®®å¯»æ‰¾æ¯”æ‚¨å¹´è½»2-5å²çš„ä¼´ä¾£ï¼Œèƒ½å¤Ÿå¸¦æ¥æ´»åŠ›å’Œæ–°é²œæ„Ÿã€‚';
    } else if (expectedAge === 'older') {
        ageDescription = 'å»ºè®®å¯»æ‰¾æ¯”æ‚¨å¹´é•¿2-5å²çš„ä¼´ä¾£ï¼Œèƒ½å¤Ÿæä¾›ç¨³å®šæ„Ÿå’ŒæŒ‡å¯¼ã€‚';
    } else if (expectedAge === 'similar') {
        ageDescription = 'å»ºè®®å¯»æ‰¾åŒé¾„æˆ–ç›¸å·®1-2å²çš„ä¼´ä¾£ï¼Œæ›´å®¹æ˜“äº§ç”Ÿå…±é¸£ã€‚';
    } else {
        ageDescription = 'å¹´é¾„å¹¶éå†³å®šæ€§å› ç´ ï¼Œæ›´é‡è¦çš„æ˜¯å¿ƒçµå¥‘åˆã€‚';
    }
    
    return {
        bestZodiacs: bestZodiacs,
        bestDescription: `ä¸${bestZodiacs.join('ã€')}å±ç›¸çš„äººæœ€ä¸ºèˆ¬é…ï¼Œèƒ½å¤Ÿå½¢æˆäº’è¡¥ä¼˜åŠ¿ï¼Œå…³ç³»å’Œè°ç¨³å®šã€‚${ageDescription}`,
        traits: traits.slice(0, 6) // å–å‰6ä¸ªç‰¹è´¨
    };
}

function analyzeSingleDestinyDetails(userZodiac, userElement, birthDate) {
    const currentYear = new Date().getFullYear();
    const birthYear = new Date(birthDate).getFullYear();
    const age = currentYear - birthYear;
    
    // ç”Ÿæˆè¿åŠ¿æ—¶é—´çº¿
    const timeline = [
        {
            period: `${currentYear}å¹´ (${age}å²)`,
            level: 'good',
            description: 'å½“å‰å§»ç¼˜è¿åŠ¿å¹³ç¨³ä¸Šå‡ï¼Œæ˜¯ç»“è¯†æ–°æœ‹å‹çš„å¥½æ—¶æœºã€‚ä¿æŒå¼€æ”¾çš„å¿ƒæ€ï¼ŒçœŸçˆ±å¯èƒ½å°±åœ¨ä¸è¿œå¤„ã€‚'
        },
        {
            period: `${currentYear + 1}å¹´ (${age + 1}å²)`,
            level: 'excellent',
            description: 'æ˜å¹´æ¡ƒèŠ±è¿æ—ºç››ï¼Œç‰¹åˆ«æ˜¯æ˜¥å­£å’Œç§‹å­£ï¼Œå®¹æ˜“é‡åˆ°å¿ƒä»ªçš„å¯¹è±¡ã€‚å»ºè®®å¤šå‚åŠ ç¤¾äº¤æ´»åŠ¨ã€‚'
        },
        {
            period: `${currentYear + 2}å¹´ (${age + 2}å²)`,
            level: 'good',
            description: 'æ„Ÿæƒ…è¿åŠ¿ç¨³å®šå‘å±•ï¼Œå¦‚æœå·²æœ‰ä¼´ä¾£ï¼Œå…³ç³»ä¼šæ›´åŠ ç¨³å›ºï¼Œæ˜¯è€ƒè™‘è¿›ä¸€æ­¥å‘å±•çš„å¥½æ—¶æœºã€‚'
        }
    ];
    
    // ç”Ÿæˆå»ºè®®
    const suggestions = [
        'å¤šå‚åŠ æˆ·å¤–æ´»åŠ¨å’Œå…´è¶£å°ç»„ï¼Œæ‰©å¤§ç¤¾äº¤åœˆå­',
        'ä¿æŒè‰¯å¥½çš„å¤–åœ¨å½¢è±¡å’Œå†…åœ¨ä¿®å…»ï¼Œæå‡ä¸ªäººé­…åŠ›',
        'å­¦ä¼šå€¾å¬å’Œæ²Ÿé€šï¼ŒçœŸè¯šå¾…äººæ˜¯å¸å¼•çœŸçˆ±çš„å…³é”®',
        'ä¸è¦è¿‡åˆ†æŒ‘å‰”ï¼Œç»™å½¼æ­¤ä¸€äº›æ—¶é—´å’Œç©ºé—´äº†è§£',
        'ç›¸ä¿¡ç¼˜åˆ†çš„åŒæ—¶ä¹Ÿè¦ä¸»åŠ¨åˆ›é€ æœºä¼š',
        'ä¿æŒç§¯æä¹è§‚çš„å¿ƒæ€ï¼Œå¥½çš„å¿ƒæƒ…ä¼šå¸¦æ¥å¥½çš„å§»ç¼˜'
    ];
    
    return {
        timeline: timeline,
        suggestions: suggestions
    };
}

async function generateReport() {
    // åˆ›å»ºæŠ¥å‘Šå†…å®¹
    const reportData = getCurrentAnalysisData();
    if (!reportData) {
        showNotification('è¯·å…ˆå®Œæˆåˆ†æå†ç”ŸæˆæŠ¥å‘Š', 'warning');
        return;
    }
    
    // ç”ŸæˆPDFæŠ¥å‘Š
    showNotification('æ­£åœ¨ç”ŸæˆPDFæŠ¥å‘Šï¼Œè¯·ç¨å€™...', 'info');
    
    try {
        const blob = await generatePDFContent(reportData);
        
        // ç¡®å®šæ–‡ä»¶æ‰©å±•å
        let fileName = `${reportData.title}_å§»ç¼˜åˆ†ææŠ¥å‘Š`;
        let fileExtension = '.pdf';
        
        // æ ¹æ®blobç±»å‹ç¡®å®šæ–‡ä»¶æ‰©å±•å
        if (blob.type.includes('image')) {
            fileExtension = '.png';
        } else if (blob.type.includes('text')) {
            fileExtension = '.txt';
        }
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName + fileExtension;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification('æŠ¥å‘Šå·²ç”Ÿæˆå¹¶ä¸‹è½½', 'success');
    } catch (error) {
        console.error('æŠ¥å‘Šç”Ÿæˆå¤±è´¥:', error);
        showNotification('æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•', 'warning');
    }
}

function getCurrentAnalysisData() {
    const resultSection = document.getElementById('resultSection');
    if (resultSection.style.display === 'none') {
        return null;
    }
    
    // è·å–å½“å‰åˆ†æçš„æ•°æ®
    if (currentMode === 'couple') {
    return {
            title: 'åŒäººåˆå©šåˆ†æ',
            type: 'couple',
            content: document.getElementById('resultContent').innerHTML
        };
    } else {
        return {
            title: 'å•äººå§»ç¼˜åˆ†æ',
            type: 'single',
            content: document.getElementById('resultContent').innerHTML
        };
    }
}

async function generatePDFContent(data) {
    try {
        // ä½¿ç”¨html2canvaså°†ç»“æœåŒºåŸŸè½¬æ¢ä¸ºå›¾ç‰‡ï¼Œç„¶åç”ŸæˆPDF
        const resultElement = document.getElementById('resultContent');
        if (!resultElement) {
            throw new Error('æ‰¾ä¸åˆ°ç»“æœå†…å®¹');
        }

        // ä¸´æ—¶åˆ›å»ºä¸€ä¸ªç”¨äºPDFçš„å®¹å™¨
        const pdfContainer = document.createElement('div');
        pdfContainer.style.cssText = `
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 750px;
            background: white;
            padding: 30px;
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif;
            color: #2c2c2c;
            line-height: 1.8;
            box-sizing: border-box;
        `;

        // åˆ›å»ºPDFå†…å®¹ï¼Œå¤„ç†åŸå§‹å†…å®¹çš„æ ·å¼
        const processedContent = processContentForPDF(resultElement.innerHTML);
        
        pdfContainer.innerHTML = `
            <div style="text-align: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #d4af37;">
                <h1 style="color: #d4af37; font-size: 22px; margin: 0; font-weight: bold;">ç¼˜å¥‘ - ä¼ ç»Ÿå…«å­—å§»ç¼˜åˆ†æå¹³å°</h1>
                <h2 style="color: #4a4a4a; font-size: 16px; margin: 8px 0; font-weight: normal;">${data.title || 'å§»ç¼˜åˆ†ææŠ¥å‘Š'}</h2>
                <p style="color: #666; font-size: 11px; margin: 5px 0;">ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}</p>
            </div>
            <div style="margin: 20px 0;">
                ${processedContent}
            </div>
            <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid #ccc; font-size: 10px; color: #555;">
                <p style="margin: 0 0 8px 0;"><strong style="color: #333;">å…è´£å£°æ˜ï¼š</strong></p>
                <p style="margin: 0 0 10px 0; line-height: 1.5;">æœ¬æŠ¥å‘ŠåŸºäºä¼ ç»Ÿæ–‡åŒ–å’Œç®—æ³•ç”Ÿæˆï¼Œå†…å®¹ä»…ä¾›å¨±ä¹å’Œå‚è€ƒä½¿ç”¨ã€‚è¯·ç†æ€§çœ‹å¾…åˆ†æç»“æœï¼Œä¸è¦å°†å…¶ä½œä¸ºäººç”Ÿé‡å¤§å†³ç­–çš„å”¯ä¸€ä¾æ®ã€‚çœŸæ­£çš„æ„Ÿæƒ…éœ€è¦åŒæ–¹çš„ç†è§£ã€åŒ…å®¹å’ŒåŠªåŠ›ç»è¥ã€‚</p>
                <div style="margin-top: 12px; text-align: center; color: #666; font-size: 9px;">
                    <p style="margin: 3px 0;">ğŸŒ å®˜æ–¹ç½‘ç«™ï¼š${window.location.origin}/tools/yuanqi/</p>
                    <p style="margin: 3px 0;">ğŸ’ æ„Ÿè°¢ä½¿ç”¨ç¼˜å¥‘ - ä¼ ç»Ÿå…«å­—å§»ç¼˜åˆ†æå¹³å°</p>
                </div>
            </div>
        `;

        document.body.appendChild(pdfContainer);

        // ç­‰å¾…å†…å®¹æ¸²æŸ“å®Œæˆ
        await new Promise(resolve => setTimeout(resolve, 100));
        
        // ä½¿ç”¨html2canvasæˆªå›¾
        const canvas = await html2canvas(pdfContainer, {
            scale: 2,
            useCORS: true,
            allowTaint: true,
            backgroundColor: '#ffffff',
            width: 750,
            height: pdfContainer.scrollHeight,
            scrollX: 0,
            scrollY: 0,
            logging: false,
            imageTimeout: 0
        });

        // ç§»é™¤ä¸´æ—¶å®¹å™¨
        document.body.removeChild(pdfContainer);

        // åˆ›å»ºPDF
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        
        const pageWidth = 210; // A4å®½åº¦ (mm)
        const pageHeight = 297; // A4é«˜åº¦ (mm)
        const margin = 10; // é¡µè¾¹è· (mm)
        const contentWidth = pageWidth - 2 * margin;
        
        // è®¡ç®—å›¾ç‰‡å°ºå¯¸ï¼Œä¿æŒå®½é«˜æ¯”
        const imgWidth = contentWidth;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        let yPosition = margin;
        let remainingHeight = imgHeight;
        let sourceY = 0;
        
        const imgData = canvas.toDataURL('image/png');
        
        // åˆ†é¡µå¤„ç†ï¼Œé¿å…æˆªæ–­
        while (remainingHeight > 0) {
            const availableHeight = pageHeight - yPosition - margin;
            const sliceHeight = Math.min(remainingHeight, availableHeight);
            
            // è®¡ç®—åœ¨canvasä¸Šçš„åˆ‡ç‰‡é«˜åº¦
            const canvasSliceHeight = (sliceHeight * canvas.height) / imgHeight;
            
            // åˆ›å»ºåˆ‡ç‰‡canvas
            const sliceCanvas = document.createElement('canvas');
            sliceCanvas.width = canvas.width;
            sliceCanvas.height = canvasSliceHeight;
            const sliceCtx = sliceCanvas.getContext('2d');
            
            sliceCtx.drawImage(canvas, 0, sourceY, canvas.width, canvasSliceHeight, 0, 0, canvas.width, canvasSliceHeight);
            
            // æ·»åŠ åˆ‡ç‰‡åˆ°PDF
            pdf.addImage(sliceCanvas.toDataURL('image/png'), 'PNG', margin, yPosition, imgWidth, sliceHeight);
            
            remainingHeight -= sliceHeight;
            sourceY += canvasSliceHeight;
            
            // å¦‚æœè¿˜æœ‰å†…å®¹ï¼Œæ·»åŠ æ–°é¡µ
            if (remainingHeight > 0) {
                pdf.addPage();
                yPosition = margin;
            }
        }

        return pdf.output('blob');

    } catch (error) {
        console.error('PDFç”Ÿæˆé”™è¯¯:', error);
        // å¦‚æœPDFç”Ÿæˆå¤±è´¥ï¼Œæä¾›å¤‡ç”¨çš„å›¾ç‰‡ä¸‹è½½
        try {
            const resultElement = document.getElementById('resultContent');
            const canvas = await html2canvas(resultElement, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff'
            });
            
            return new Promise((resolve) => {
                canvas.toBlob(resolve, 'image/png');
            });
        } catch (imgError) {
            console.error('å›¾ç‰‡ç”Ÿæˆä¹Ÿå¤±è´¥:', imgError);
            // æœ€åçš„å¤‡é€‰æ–¹æ¡ˆï¼šæ–‡æœ¬æ–‡ä»¶
            const content = generateFormattedReport(data);
            return new Blob(['\uFEFF' + content], { 
                type: 'text/plain;charset=utf-8' 
            });
        }
    }
}

function processContentForPDF(htmlContent) {
    // å¤„ç†HTMLå†…å®¹ï¼Œè°ƒæ•´æ ·å¼é€‚åˆPDF
    let processedContent = htmlContent;
    
    // æ›¿æ¢äº®è‰²å­—ä½“ä¸ºæ·±è‰²
    processedContent = processedContent.replace(/color:\s*rgba?\([^)]*\)/g, 'color: #333');
    processedContent = processedContent.replace(/color:\s*#[a-fA-F0-9]{3,6}/g, 'color: #333');
    processedContent = processedContent.replace(/color:\s*white/gi, 'color: #333');
    
    // è°ƒæ•´èƒŒæ™¯è‰²
    processedContent = processedContent.replace(/background[^;]*;?/g, '');
    processedContent = processedContent.replace(/rgba?\([^)]*0\.[0-9]+\)/g, 'transparent');
    
    // è°ƒæ•´å­—ä½“å¤§å°å’Œé—´è·
    processedContent = processedContent.replace(/font-size:\s*[0-9.]+rem/g, 'font-size: 14px');
    processedContent = processedContent.replace(/font-size:\s*[0-9.]+em/g, 'font-size: 14px');
    
    // å¤„ç†ç‰¹æ®Šå…ƒç´ 
    processedContent = processedContent.replace(/<h[1-6][^>]*>/g, match => {
        return match.replace(/style="[^"]*"/, 'style="color: #2c2c2c; margin: 12px 0 8px 0; font-weight: bold;"');
    });
    
    processedContent = processedContent.replace(/<p[^>]*>/g, match => {
        return match.replace(/style="[^"]*"/, 'style="color: #333; margin: 8px 0; line-height: 1.6;"');
    });
    
    // å¤„ç†AIåˆ†æåŒºåŸŸ
    processedContent = processedContent.replace(/ai-analysis-section/g, 'ai-analysis-section-pdf');
    processedContent = processedContent.replace(/ai-section/g, 'ai-section-pdf');
    
    // æ·»åŠ PDFä¸“ç”¨æ ·å¼
    const pdfStyles = `
        <style>
            .ai-analysis-section-pdf {
                border: 1px solid #ccc !important;
                background: #f9f9f9 !important;
                padding: 15px !important;
                margin: 15px 0 !important;
                border-radius: 8px !important;
            }
            .ai-analysis-section-pdf h3 {
                color: #2c2c2c !important;
                font-size: 16px !important;
                margin: 0 0 10px 0 !important;
            }
            .ai-section-pdf {
                background: white !important;
                border: 1px solid #ddd !important;
                padding: 10px !important;
                margin: 8px 0 !important;
                border-radius: 4px !important;
            }
            .ai-section-pdf h4 {
                color: #2c2c2c !important;
                font-size: 14px !important;
                margin: 0 0 6px 0 !important;
            }
            .ai-section-pdf p {
                color: #333 !important;
                font-size: 13px !important;
                line-height: 1.6 !important;
                margin: 0 !important;
            }
            .ai-badge {
                background: #666 !important;
                color: white !important;
                padding: 2px 6px !important;
                border-radius: 3px !important;
                font-size: 10px !important;
            }
        </style>
    `;
    
    return pdfStyles + processedContent;
}

function generateFormattedReport(data) {
    const currentTime = new Date().toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    
    // æ¸…ç†HTMLæ ‡ç­¾
    const cleanContent = data.content
        .replace(/<[^>]*>/g, '')
        .replace(/&nbsp;/g, ' ')
        .replace(/&amp;/g, '&')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&quot;/g, '"')
        .replace(/&#39;/g, "'");
    
    const report = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ç¼˜å¥‘ - ä¼ ç»Ÿå…«å­—å§»ç¼˜åˆ†æå¹³å°
                        å§»ç¼˜åˆ†ææŠ¥å‘Š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… ç”Ÿæˆæ—¶é—´ï¼š${currentTime}
ğŸ“‹ æŠ¥å‘Šæ ‡é¢˜ï¼š${data.title || 'å§»ç¼˜åˆ†ææŠ¥å‘Š'}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Š åˆ†æå†…å®¹ï¼š

${cleanContent}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âš ï¸  é‡è¦å£°æ˜ï¼š

æœ¬æŠ¥å‘ŠåŸºäºä¼ ç»Ÿæ–‡åŒ–å’Œç®—æ³•ç”Ÿæˆï¼Œå†…å®¹ä»…ä¾›å¨±ä¹å’Œå‚è€ƒä½¿ç”¨ã€‚
è¯·ç†æ€§çœ‹å¾…åˆ†æç»“æœï¼Œä¸è¦å°†å…¶ä½œä¸ºäººç”Ÿé‡å¤§å†³ç­–çš„å”¯ä¸€ä¾æ®ã€‚
çœŸæ­£çš„æ„Ÿæƒ…éœ€è¦åŒæ–¹çš„ç†è§£ã€åŒ…å®¹å’ŒåŠªåŠ›ç»è¥ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ’ æ„Ÿè°¢ä½¿ç”¨ç¼˜å¥‘å¹³å°
ğŸŒ å®˜æ–¹ç½‘ç«™ï¼š${window.location.origin}/tools/yuanqi/
ğŸ“ å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å®¢æœ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    `;
    
    return report.trim();
}

async function generateImageReport() {
    const reportData = getCurrentAnalysisData();
    if (!reportData) {
        showNotification('è¯·å…ˆå®Œæˆåˆ†æå†å¯¼å‡ºå›¾ç‰‡', 'warning');
        return;
    }
    
    showNotification('æ­£åœ¨ç”Ÿæˆå›¾ç‰‡ï¼Œè¯·ç¨å€™...', 'info');
    
    try {
        const resultElement = document.getElementById('resultContent');
        
        // åˆ›å»ºä¸€ä¸ªç”¨äºå›¾ç‰‡çš„å®¹å™¨ï¼ŒåŒ…å«æ ‡é¢˜
        const imageContainer = document.createElement('div');
        imageContainer.style.cssText = `
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 800px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 40px;
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        `;

        imageContainer.innerHTML = `
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="color: #d4af37; font-size: 28px; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">ç¼˜å¥‘ - ä¼ ç»Ÿå…«å­—å§»ç¼˜åˆ†æå¹³å°</h1>
                <h2 style="color: #fff; font-size: 20px; margin: 15px 0;">${reportData.title || 'å§»ç¼˜åˆ†ææŠ¥å‘Š'}</h2>
                <p style="color: #ccc; font-size: 14px;">ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}</p>
            </div>
            <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 30px; color: #333;">
                ${resultElement.innerHTML}
            </div>
            <div style="text-align: center; margin-top: 20px; color: #ccc; font-size: 12px;">
                <p>æœ¬æŠ¥å‘ŠåŸºäºä¼ ç»Ÿæ–‡åŒ–å’Œç®—æ³•ç”Ÿæˆï¼Œä»…ä¾›å¨±ä¹å‚è€ƒ</p>
                <p style="margin-top: 10px; color: #d4af37;">ğŸŒ ${window.location.origin}/tools/yuanqi/</p>
            </div>
        `;

        document.body.appendChild(imageContainer);

        const canvas = await html2canvas(imageContainer, {
            scale: 2,
            useCORS: true,
            allowTaint: true,
            backgroundColor: null,
            width: 800,
            height: imageContainer.scrollHeight
        });

        document.body.removeChild(imageContainer);

        // ä¸‹è½½å›¾ç‰‡
        canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${reportData.title}_å§»ç¼˜åˆ†ææŠ¥å‘Š.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('å›¾ç‰‡å·²ç”Ÿæˆå¹¶ä¸‹è½½', 'success');
        }, 'image/png');

    } catch (error) {
        console.error('å›¾ç‰‡ç”Ÿæˆå¤±è´¥:', error);
        showNotification('å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•', 'warning');
    }
}

async function generateAIAnalysis() {
    const reportData = getCurrentAnalysisData();
    if (!reportData) {
        showNotification('è¯·å…ˆå®ŒæˆåŸºç¡€åˆ†æå†è¿›è¡ŒAIæ™ºèƒ½åˆ†æ', 'warning');
        return;
    }
    
    showNotification('æ­£åœ¨è¿æ¥AIè¿›è¡Œæ·±åº¦åˆ†æï¼Œè¯·ç¨å€™...', 'info');
    
    try {
        // è·å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®
        const userData = getUserInputData();
        
        // è°ƒç”¨DeepSeek API
        const aiAnalysis = await callDeepSeekAPI(userData, reportData);
        
        // å°†AIåˆ†æç»“æœæ·»åŠ åˆ°ç°æœ‰ç»“æœä¸­
        displayAIAnalysis(aiAnalysis);
        
        showNotification('AIæ™ºèƒ½åˆ†æå®Œæˆï¼', 'success');
    } catch (error) {
        console.error('AIåˆ†æå¤±è´¥:', error);
        showNotification('AIåˆ†ææœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•', 'warning');
    }
}

function getUserInputData() {
    if (currentMode === 'couple') {
        return {
            mode: 'couple',
            male: {
                name: document.getElementById('maleName').value.trim(),
                birthDate: getDateFromSelects('male'),
                birthTime: document.getElementById('maleBirthTime').value,
                birthPlace: document.getElementById('maleBirthPlace').value.trim()
            },
            female: {
                name: document.getElementById('femaleName').value.trim(),
                birthDate: getDateFromSelects('female'),
                birthTime: document.getElementById('femaleBirthTime').value,
                birthPlace: document.getElementById('femaleBirthPlace').value.trim()
            }
        };
    } else {
        return {
            mode: 'single',
            person: {
                name: document.getElementById('singleName').value.trim(),
                gender: document.getElementById('singleGender').value,
                birthDate: getDateFromSelects('single'),
                birthTime: document.getElementById('singleBirthTime').value,
                birthPlace: document.getElementById('singleBirthPlace').value.trim(),
                expectedAge: document.getElementById('expectedAge').value,
                expectedPersonality: document.getElementById('expectedPersonality').value
            }
        };
    }
}

async function callDeepSeekAPI(userData, basicAnalysis) {
    // æ„å»ºå‘é€ç»™AIçš„æç¤ºè¯
    const prompt = buildAIPrompt(userData, basicAnalysis);
    
    try {
        const response = await fetch('/tools/api/ai-analysis/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                prompt: prompt,
                userData: userData
            })
        });
        
        if (!response.ok) {
            throw new Error('AIæœåŠ¡è¯·æ±‚å¤±è´¥');
        }
        
        const result = await response.json();
        return result.analysis;
    } catch (error) {
        console.error('DeepSeek APIè°ƒç”¨å¤±è´¥:', error);
        // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œè¿”å›æ¨¡æ‹Ÿçš„AIåˆ†æç»“æœ
        return generateMockAIAnalysis(userData);
    }
}

function buildAIPrompt(userData, basicAnalysis) {
    let prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ä¸­å›½ä¼ ç»Ÿå‘½ç†å­¦ä¸“å®¶ï¼Œç²¾é€šå…«å­—å‘½ç†å’Œå§»ç¼˜åˆ†æã€‚è¯·åŸºäºä»¥ä¸‹ä¿¡æ¯è¿›è¡Œæ·±åº¦çš„å§»ç¼˜åˆ†æï¼š

åŸºç¡€ä¿¡æ¯ï¼š
${JSON.stringify(userData, null, 2)}

åŸºç¡€åˆ†æç»“æœï¼š
${basicAnalysis.content.replace(/<[^>]*>/g, '')}

è¯·ä»ä»¥ä¸‹è§’åº¦è¿›è¡Œæ·±åº¦åˆ†æï¼š
1. å…«å­—äº”è¡Œçš„æ·±å±‚äº’è¡¥å…³ç³»
2. å¤©å¹²åœ°æ”¯çš„ç»†è‡´é…å¯¹åˆ†æ  
3. ç¥ç…æ˜Ÿå®¿å¯¹å§»ç¼˜çš„å…·ä½“å½±å“
4. å¤§è¿æµå¹´å¯¹æ„Ÿæƒ…å‘å±•çš„æ—¶é—´èŠ‚ç‚¹é¢„æµ‹
5. æ€§æ ¼åŒ¹é…åº¦çš„å¿ƒç†å­¦åˆ†æ
6. å…·ä½“çš„ç›¸å¤„å»ºè®®å’Œæ³¨æ„äº‹é¡¹
7. å©šå§»ç”Ÿæ´»ä¸­å¯èƒ½é‡åˆ°çš„æŒ‘æˆ˜åŠåŒ–è§£æ–¹æ³•

è¯·ç”¨ä¸“ä¸šä½†æ˜“æ‡‚çš„è¯­è¨€ï¼Œæä¾›å…·ä½“è€Œå®ç”¨çš„å»ºè®®ã€‚å›ç­”è¦ç»“æ„æ¸…æ™°ï¼Œå†…å®¹ä¸°å¯Œï¼Œå…·æœ‰æŒ‡å¯¼æ„ä¹‰ã€‚`;

    return prompt;
}

function generateMockAIAnalysis(userData) {
    // æ¨¡æ‹ŸAIåˆ†æç»“æœï¼ˆå½“APIä¸å¯ç”¨æ—¶çš„å¤‡é€‰æ–¹æ¡ˆï¼‰
    return {
        title: 'AIæ™ºèƒ½æ·±åº¦åˆ†æ',
        sections: [
            {
                title: 'ğŸ§  AIæ·±åº¦æ´å¯Ÿ',
                content: 'åŸºäºå¤§æ•°æ®åˆ†æå’Œä¼ ç»Ÿå‘½ç†å­¦çš„ç»“åˆï¼ŒAIç³»ç»Ÿå‘ç°äº†æ›´æ·±å±‚çš„åŒ¹é…æ¨¡å¼...'
            },
            {
                title: 'ğŸ”® æœªæ¥è¶‹åŠ¿é¢„æµ‹', 
                content: 'æ ¹æ®å…«å­—è¿åŠ¿å’Œç°ä»£å¿ƒç†å­¦åˆ†æï¼Œé¢„æµ‹æœªæ¥æ„Ÿæƒ…å‘å±•çš„å…³é”®æ—¶æœŸ...'
            },
            {
                title: 'ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®',
                content: 'é’ˆå¯¹åŒæ–¹çš„å…·ä½“æƒ…å†µï¼ŒAIæä¾›äº†é‡èº«å®šåˆ¶çš„ç›¸å¤„å»ºè®®å’Œæ³¨æ„äº‹é¡¹...'
            }
        ]
    };
}

function displayAIAnalysis(aiAnalysis) {
    const resultContent = document.getElementById('resultContent');
    
    // åˆ›å»ºAIåˆ†æåŒºåŸŸ
    const aiSection = document.createElement('div');
    aiSection.className = 'ai-analysis-section';
    aiSection.innerHTML = `
        <div class="ai-analysis-header">
            <h3><i class="fas fa-brain"></i> ${aiAnalysis.title || 'AIæ™ºèƒ½æ·±åº¦åˆ†æ'}</h3>
            <span class="ai-badge">DeepSeek AI</span>
        </div>
        <div class="ai-analysis-content">
            ${aiAnalysis.sections ? aiAnalysis.sections.map(section => `
                <div class="ai-section">
                    <h4>${section.title}</h4>
                    <p>${section.content}</p>
                </div>
            `).join('') : `<p>${aiAnalysis}</p>`}
        </div>
    `;
    
    // å°†AIåˆ†ææ·»åŠ åˆ°ç»“æœåŒºåŸŸ
    resultContent.appendChild(aiSection);
    
    // æ·»åŠ åˆ†éš”çº¿
    const separator = document.createElement('div');
    separator.className = 'analysis-separator';
    separator.innerHTML = '<div class="separator-line"></div><span class="separator-text">AIæ™ºèƒ½åˆ†æ</span><div class="separator-line"></div>';
    resultContent.insertBefore(separator, aiSection);
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function shareResult() {
    if (navigator.share) {
        navigator.share({
            title: 'æˆ‘çš„å§»ç¼˜åˆ†æç»“æœ - ç¼˜å¥‘',
            text: 'æ¥çœ‹çœ‹æˆ‘ä»¬çš„å§»ç¼˜åˆ†æç»“æœå§ï¼',
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(window.location.href).then(() => {
            showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        });
    }
}

// é€šçŸ¥å‡½æ•°
function showNotification(message, type = 'info') {
    // åˆ›å»ºé€šçŸ¥å…ƒç´ 
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    // æ·»åŠ åˆ°é¡µé¢
    document.body.appendChild(notification);
    
    // æ˜¾ç¤ºåŠ¨ç”»
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // è‡ªåŠ¨éšè—
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// æ—¥æœŸé€‰æ‹©å™¨è¾…åŠ©å‡½æ•°
function getDateFromSelects(prefix) {
    const year = document.getElementById(`${prefix}BirthYear`).value;
    const month = document.getElementById(`${prefix}BirthMonth`).value;
    const day = document.getElementById(`${prefix}BirthDay`).value;
    
    if (!year || !month || !day) {
        return '';
    }
    
    return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
}

function initializeDateSelectors() {
    const currentYear = new Date().getFullYear();
    const startYear = currentYear - 80;
    const endYear = currentYear - 10;
    
    // åˆå§‹åŒ–å¹´ä»½é€‰æ‹©å™¨
    ['male', 'female', 'single'].forEach(prefix => {
        const yearSelect = document.getElementById(`${prefix}BirthYear`);
        if (yearSelect) {
            for (let year = endYear; year >= startYear; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'å¹´';
                yearSelect.appendChild(option);
            }
        }
    });
    
    // æ·»åŠ æ—¥æœŸè”åŠ¨
    ['male', 'female', 'single'].forEach(prefix => {
        const monthSelect = document.getElementById(`${prefix}BirthMonth`);
        const daySelect = document.getElementById(`${prefix}BirthDay`);
        
        if (monthSelect && daySelect) {
            monthSelect.addEventListener('change', function() {
                updateDayOptions(prefix);
            });
            
            const yearSelect = document.getElementById(`${prefix}BirthYear`);
            if (yearSelect) {
                yearSelect.addEventListener('change', function() {
                    updateDayOptions(prefix);
                });
            }
        }
    });
}

function updateDayOptions(prefix) {
    const yearSelect = document.getElementById(`${prefix}BirthYear`);
    const monthSelect = document.getElementById(`${prefix}BirthMonth`);
    const daySelect = document.getElementById(`${prefix}BirthDay`);
    
    const year = parseInt(yearSelect.value);
    const month = parseInt(monthSelect.value);
    
    // æ¸…ç©ºæ—¥æœŸé€‰é¡¹
    daySelect.innerHTML = '<option value="">æ—¥</option>';
    
    if (!year || !month) return;
    
    // è®¡ç®—è¯¥æœˆçš„å¤©æ•°
    const daysInMonth = new Date(year, month, 0).getDate();
    
    for (let day = 1; day <= daysInMonth; day++) {
        const option = document.createElement('option');
        option.value = day;
        option.textContent = day + 'æ—¥';
        daySelect.appendChild(option);
    }
}

// é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
    initializeDateSelectors();
    
    // æ·»åŠ è¾“å…¥æ¡†ç„¦ç‚¹æ•ˆæœ
    const inputs = document.querySelectorAll('.traditional-input, .traditional-select, .date-select');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.classList.add('focused');
        });
        
        input.addEventListener('blur', function() {
            if (!this.value) {
                this.parentElement.classList.remove('focused');
            }
        });
    });
    
    // æ·»åŠ æŒ‰é’®ç‚¹å‡»æ•ˆæœ
    const buttons = document.querySelectorAll('.analyze-btn');
    buttons.forEach(button => {
        button.addEventListener('click', function(e) {
            const ripple = this.querySelector('.btn-ripple');
            if (ripple) {
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                ripple.classList.add('active');
                
                setTimeout(() => {
                    ripple.classList.remove('active');
                }, 600);
            }
        });
    });
});
</script>

<style>
/* ä¸»å®¹å™¨æ ·å¼ */
.yuanqi-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #1a1a2e 100%);
    background-size: 400% 400%;
    animation: backgroundShift 20s ease infinite;
    position: relative;
    overflow-x: hidden;
}

/* ä¼ ç»ŸèƒŒæ™¯çº¹ç† */
.yuanqi-container::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        radial-gradient(circle at 20% 20%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(220, 20, 60, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
    z-index: 0;
    animation: textureFloat 30s ease-in-out infinite;
}

@keyframes backgroundShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes textureFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
    50% { transform: translateY(-30px) rotate(180deg); opacity: 0.6; }
}

/* å¤´éƒ¨åŒºåŸŸæ ·å¼ */
.yuanqi-header {
    text-align: center;
    padding: 3rem 2rem;
    position: relative;
    z-index: 1;
}

.header-decoration {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
}

.traditional-pattern {
    width: 100%;
    height: 100%;
    background-image: 
        repeating-linear-gradient(45deg, rgba(212, 175, 55, 0.1) 0px, transparent 2px, transparent 10px, rgba(212, 175, 55, 0.1) 12px),
        repeating-linear-gradient(-45deg, rgba(220, 20, 60, 0.1) 0px, transparent 2px, transparent 10px, rgba(220, 20, 60, 0.1) 12px);
    animation: patternMove 15s linear infinite;
}

@keyframes patternMove {
    0% { background-position: 0px 0px, 0px 0px; }
    100% { background-position: 40px 40px, -40px 40px; }
}

.title-section {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 1rem;
}

/* å¤ªæå›¾æ ‡ */
.logo-container {
    position: relative;
}

.yin-yang-symbol {
    width: 120px;
    height: 120px;
    position: relative;
    animation: rotate 20s linear infinite;
}

.yin-yang {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    position: relative;
    background: linear-gradient(to right, #000 50%, #fff 50%);
    box-shadow: 
        0 0 30px rgba(212, 175, 55, 0.6),
        inset 0 0 20px rgba(0, 0, 0, 0.3);
}

.yin-yang::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    width: 50%;
    height: 50%;
    border-radius: 50%;
    background: #fff;
    transform: translateX(-50%);
    box-shadow: 0 50px 0 #000;
}

.yang-dot, .yin-dot {
    position: absolute;
    width: 20%;
    height: 20%;
    border-radius: 50%;
    top: 50%;
    transform: translateY(-50%);
}

.yang-dot {
    background: #000;
    left: 15%;
}

.yin-dot {
    background: #fff;
    right: 15%;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* æ ‡é¢˜æ ·å¼ */
.title-content {
    text-align: left;
}

.main-title {
    font-size: 4rem;
    font-weight: 900;
    background: linear-gradient(135deg, #d4af37 0%, #ffd700 25%, #dc143c 50%, #ff6347 75%, #d4af37 100%);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0;
    animation: titleGlow 4s ease-in-out infinite;
    text-shadow: 0 0 50px rgba(212, 175, 55, 0.5);
    font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', serif;
}

.subtitle {
    font-size: 1.5rem;
    color: rgba(255, 255, 255, 0.9);
    margin: 0.5rem 0 1rem 0;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    font-weight: 300;
    letter-spacing: 2px;
}

.tagline {
    margin-top: 1rem;
}

.chinese-text {
    font-size: 1.2rem;
    color: #d4af37;
    font-weight: 600;
    letter-spacing: 3px;
    text-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
}

@keyframes titleGlow {
    0%, 100% { 
        background-position: 0% 50%;
        text-shadow: 0 0 50px rgba(212, 175, 55, 0.5);
    }
    50% { 
        background-position: 100% 50%;
        text-shadow: 0 0 80px rgba(212, 175, 55, 0.8);
    }
}

/* å…è´£å£°æ˜ */
.disclaimer-banner {
    background: rgba(255, 193, 7, 0.15);
    border: 1px solid rgba(255, 193, 7, 0.3);
    border-radius: 15px;
    padding: 1rem 2rem;
    margin: 0 2rem 2rem 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.95rem;
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 1;
}

.disclaimer-banner i {
    color: #ffc107;
    font-size: 1.2rem;
}

/* ä¸»è¦å†…å®¹åŒºåŸŸ */
.main-content {
    padding: 0 2rem 3rem 2rem;
    position: relative;
    z-index: 1;
}

/* æ¨¡å¼é€‰æ‹©åŒºåŸŸ */
.mode-selection {
    margin-bottom: 2rem;
    display: flex;
    justify-content: center;
}

.mode-tabs {
    display: flex;
    gap: 1rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.mode-tab {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1.5rem 2rem;
    background: transparent;
    border: none;
    border-radius: 15px;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 160px;
    text-align: center;
}

.mode-tab:hover {
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.9);
    transform: translateY(-2px);
}

.mode-tab.active {
    background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
    color: white;
    box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
}

.mode-tab i {
    font-size: 1.8rem;
    margin-bottom: 0.3rem;
}

.mode-tab span {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.3rem;
}

.mode-tab p {
    font-size: 0.85rem;
    opacity: 0.8;
    margin: 0;
    line-height: 1.3;
}

/* è¡¨å•åŒºåŸŸæ ·å¼ - æ°´å¢¨é£æ ¼ */
.form-container {
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 25px;
    padding: 3rem;
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.05),
        inset 0 0 0 1px rgba(255, 255, 255, 0.02);
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
}

.form-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 20% 30%, rgba(40, 40, 40, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(60, 60, 60, 0.2) 0%, transparent 50%),
        linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(30, 30, 30, 0.3) 100%);
    z-index: -1;
}

.form-container::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
        radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
        radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
    background-size: 50px 50px;
    opacity: 0.3;
    z-index: -1;
}

.form-header {
    text-align: center;
    margin-bottom: 3rem;
}

.form-header h3 {
    font-size: 2.2rem;
    color: rgba(255, 255, 255, 0.95);
    margin-bottom: 0.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    text-shadow: 0 2px 15px rgba(0, 0, 0, 0.4);
    font-weight: 700;
}

.form-header h3 i {
    color: #d4af37;
    font-size: 2rem;
}

.form-header p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    text-shadow: 0 1px 8px rgba(0, 0, 0, 0.3);
    margin: 0;
}

/* è¡¨å•å†…å®¹å¸ƒå±€ */
.form-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    margin-bottom: 3rem;
}

.form-content.single-content {
    display: block;
    max-width: 600px;
    margin: 0 auto 3rem auto;
}

.person-form {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 20px;
    padding: 2.5rem;
    position: relative;
    backdrop-filter: blur(10px);
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.male-form {
    border-left: 4px solid #4a90e2;
}

.female-form {
    border-left: 4px solid #e24a90;
}

.single-person-form {
    border-left: 4px solid #9b59b6;
}

/* æœŸæœ›æ¡ä»¶åŒºåŸŸ */
.expectation-section {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.expectation-section h5 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.expectation-section h5 i {
    color: #e74c3c;
    font-size: 1rem;
}

.form-title {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.form-title i {
    font-size: 1.5rem;
}

.male-form .form-title i {
    color: #4a90e2;
}

.female-form .form-title i {
    color: #e24a90;
}

.form-title h4 {
    font-size: 1.4rem;
    color: rgba(255, 255, 255, 0.95);
    margin: 0;
    font-weight: 600;
}

/* è¾“å…¥æ¡†æ ·å¼ */
.input-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.input-field {
    position: relative;
}

.input-field label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
    margin-bottom: 0.8rem;
    font-size: 1rem;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.input-field label i {
    color: #d4af37;
    font-size: 1rem;
}

.traditional-input, .traditional-select {
    width: 100%;
    padding: 1.2rem 1.5rem;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    color: rgba(255, 255, 255, 0.95);
    font-size: 1rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    box-shadow: 
        0 5px 15px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    appearance: none;
    cursor: pointer;
}

.traditional-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23d4af37' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 1.5rem center;
    background-repeat: no-repeat;
    background-size: 1rem;
    padding-right: 3.5rem;
}

.traditional-select option {
    background: rgba(0, 0, 0, 0.9);
    color: rgba(255, 255, 255, 0.95);
    padding: 0.5rem;
}

.traditional-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

.traditional-input:focus, .traditional-select:focus {
    outline: none;
    border-color: #d4af37;
    box-shadow: 
        0 0 0 3px rgba(212, 175, 55, 0.2),
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

/* æ—¥æœŸæ—¶è¾°å¸ƒå±€ä¼˜åŒ– */
.datetime-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

/* è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨æ ·å¼ */
.custom-date-picker {
    display: flex;
    gap: 0.3rem;
    align-items: center;
    flex-wrap: wrap;
    justify-content: flex-start;
}

.date-select {
    flex: none;
    min-width: 70px;
    padding: 0.8rem 0.6rem;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: rgba(255, 255, 255, 0.95);
    font-size: 0.9rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    box-shadow: 
        0 5px 15px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23d4af37' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.5rem center;
    background-repeat: no-repeat;
    background-size: 0.8rem;
    padding-right: 2rem;
    text-align: center;
}

.date-select:focus {
    outline: none;
    border-color: #d4af37;
    box-shadow: 
        0 0 0 3px rgba(212, 175, 55, 0.2),
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.date-select:hover {
    border-color: rgba(212, 175, 55, 0.5);
    transform: translateY(-1px);
}

.date-select option {
    background: rgba(0, 0, 0, 0.9);
    color: rgba(255, 255, 255, 0.95);
    padding: 0.5rem;
}

.year-select {
    min-width: 85px;
}

.month-select {
    min-width: 75px;
}

.day-select {
    min-width: 65px;
}

/* åˆ†ææŒ‰é’®æ ·å¼ */
.form-actions {
    display: flex;
    justify-content: center;
    margin-top: 2rem;
}

.analyze-btn {
    position: relative;
    padding: 1.5rem 4rem;
    background: linear-gradient(135deg, #d4af37 0%, #ffd700 25%, #dc143c 50%, #ff6347 75%, #d4af37 100%);
    background-size: 300% 300%;
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 1.3rem;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.8rem;
    overflow: hidden;
    transition: all 0.4s ease;
    box-shadow: 
        0 15px 35px rgba(212, 175, 55, 0.4),
        0 0 0 1px rgba(255, 255, 255, 0.1);
    animation: buttonGlow 4s ease-in-out infinite;
    text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

.analyze-btn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
        0 20px 50px rgba(212, 175, 55, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.2);
}

.analyze-btn:active {
    transform: translateY(-2px) scale(1.02);
}

.btn-ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
}

.btn-ripple.active {
    animation: ripple 0.6s linear;
}

@keyframes ripple {
    to {
        transform: scale(4);
        opacity: 0;
    }
}

@keyframes buttonGlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

/* ç»“æœå±•ç¤ºåŒºåŸŸæ ·å¼ - æ°´å¢¨é£æ ¼ */
.result-container {
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 25px;
    padding: 3rem;
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.05),
        inset 0 0 0 1px rgba(255, 255, 255, 0.02);
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
    margin-top: 2rem;
}

.result-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 30% 40%, rgba(40, 40, 40, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 70% 60%, rgba(60, 60, 60, 0.2) 0%, transparent 50%),
        linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(30, 30, 30, 0.3) 100%);
    z-index: -1;
}

/* é€šçŸ¥æ ·å¼ */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 1rem 1.5rem;
    color: white;
    font-size: 0.95rem;
    z-index: 10000;
    transform: translateX(400px);
    opacity: 0;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
}

.notification.show {
    transform: translateX(0);
    opacity: 1;
}

.notification.success {
    border-left: 4px solid #27ae60;
}

.notification.warning {
    border-left: 4px solid #f39c12;
}

.notification.info {
    border-left: 4px solid #3498db;
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.notification-content i {
    font-size: 1.1rem;
}

.notification.success .notification-content i {
    color: #27ae60;
}

.notification.warning .notification-content i {
    color: #f39c12;
}

.notification.info .notification-content i {
    color: #3498db;
}

.result-header {
    text-align: center;
    margin-bottom: 3rem;
}

.result-header h3 {
    font-size: 2.2rem;
    color: rgba(255, 255, 255, 0.95);
    margin-bottom: 0.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    text-shadow: 0 2px 15px rgba(0, 0, 0, 0.4);
    font-weight: 700;
}

.result-header h3 i {
    color: #d4af37;
    font-size: 2rem;
}

.result-header p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    text-shadow: 0 1px 8px rgba(0, 0, 0, 0.3);
    margin: 0;
}

/* åˆ†ææ‘˜è¦åŒºåŸŸ */
.analysis-summary {
    margin-bottom: 3rem;
}

.couple-info {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 2rem;
    align-items: center;
    margin-bottom: 2rem;
}

.person-card {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 2rem;
    backdrop-filter: blur(10px);
    text-align: center;
}

.male-card {
    border-left: 4px solid #4a90e2;
}

.female-card {
    border-left: 4px solid #e24a90;
}

.person-card .card-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.person-card .card-header i {
    font-size: 1.8rem;
}

.male-card .card-header i {
    color: #4a90e2;
}

.female-card .card-header i {
    color: #e24a90;
}

.person-card .card-header h4 {
    font-size: 1.5rem;
    color: rgba(255, 255, 255, 0.95);
    margin: 0;
    font-weight: 600;
}

.zodiac-info, .bazi-info {
    margin-bottom: 1rem;
}

.zodiac-label, .bazi-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    margin-right: 0.5rem;
}

.zodiac-value {
    color: #d4af37;
    font-size: 1.2rem;
    font-weight: 600;
}

.bazi-pillars {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    margin-top: 0.5rem;
}

.pillar {
    background: rgba(212, 175, 55, 0.2);
    color: #d4af37;
    padding: 0.3rem 0.6rem;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    border: 1px solid rgba(212, 175, 55, 0.3);
}

/* å¥‘åˆåº¦è¯„åˆ† */
.compatibility-score {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.score-circle {
    position: relative;
    width: 150px;
    height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.score-inner {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
    position: relative;
}

.score-number {
    font-size: 3rem;
    font-weight: 900;
    color: #d4af37;
    text-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
}

.score-label {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.8);
    margin-top: -0.5rem;
}

.score-progress {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
}

.score-description {
    text-align: center;
}

.score-description h4 {
    color: rgba(255, 255, 255, 0.95);
    font-size: 1.3rem;
    margin: 0 0 0.5rem 0;
    font-weight: 600;
}

.score-description p {
    color: #d4af37;
    font-size: 1.1rem;
    margin: 0;
    font-weight: 500;
}

/* è¯¦ç»†åˆ†æå¡ç‰‡ */
.analysis-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
}

.analysis-card {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 20px;
    padding: 2rem;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.analysis-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
}

.analysis-card .card-header {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.analysis-card .card-header i {
    font-size: 1.5rem;
    color: #d4af37;
}

.analysis-card .card-header h4 {
    font-size: 1.3rem;
    color: rgba(255, 255, 255, 0.95);
    margin: 0;
    font-weight: 600;
}

/* ç”Ÿè‚–é…å¯¹ç»“æœ */
.compatibility-result {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    border-radius: 15px;
    margin-bottom: 1rem;
}

.compatibility-result.excellent {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.2) 0%, rgba(139, 195, 74, 0.2) 100%);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.compatibility-result.good {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 152, 0, 0.2) 100%);
    border: 1px solid rgba(255, 193, 7, 0.3);
}

.compatibility-result.challenging {
    background: linear-gradient(135deg, rgba(244, 67, 54, 0.2) 0%, rgba(233, 30, 99, 0.2) 100%);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.result-icon {
    font-size: 2rem;
    min-width: 50px;
    text-align: center;
}

.result-text h5 {
    color: rgba(255, 255, 255, 0.95);
    font-size: 1.2rem;
    margin: 0 0 0.5rem 0;
    font-weight: 600;
}

.result-text p {
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.6;
    margin: 0;
    font-size: 1rem;
}

/* äº”è¡Œåˆ†æ */
.wuxing-chart {
    margin-bottom: 1.5rem;
}

.element-pair {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.element {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    flex: 1;
}

.element-symbol {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
    background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
    box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
}

.element-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
}

.relationship-indicator {
    flex: 1;
    text-align: center;
    padding: 1rem;
    border-radius: 10px;
    font-weight: 600;
}

.relationship-indicator.ç›¸ç”Ÿ {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.3) 0%, rgba(139, 195, 74, 0.3) 100%);
    color: #4caf50;
}

.relationship-indicator.ç›¸å…‹ {
    background: linear-gradient(135deg, rgba(244, 67, 54, 0.3) 0%, rgba(233, 30, 99, 0.3) 100%);
    color: #f44336;
}

.relationship-indicator.å¹³è¡¡ {
    background: linear-gradient(135deg, rgba(33, 150, 243, 0.3) 0%, rgba(63, 81, 181, 0.3) 100%);
    color: #2196f3;
}

.wuxing-description p {
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.6;
    margin: 0;
    font-size: 1rem;
}

/* å»ºè®®åˆ—è¡¨ */
.suggestions-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.suggestion-item {
    display: flex;
    align-items: flex-start;
    gap: 0.8rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border-left: 4px solid #d4af37;
}

.suggestion-item i {
    color: #d4af37;
    font-size: 1rem;
    margin-top: 0.2rem;
}

/* å•äººåˆ†æç»“æœæ ·å¼ */
.single-analysis-summary {
    margin-bottom: 3rem;
}

.user-profile {
    display: flex;
    justify-content: center;
    margin-bottom: 2rem;
}

.profile-card {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 2rem;
    backdrop-filter: blur(10px);
    text-align: center;
    border-left: 4px solid #9b59b6;
    min-width: 300px;
}

.profile-card .card-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.profile-card .card-header i {
    font-size: 1.8rem;
    color: #9b59b6;
}

.element-info {
    margin-top: 1rem;
}

.element-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    margin-right: 0.5rem;
}

.element-value {
    color: #9b59b6;
    font-size: 1.2rem;
    font-weight: 600;
}

/* ç†æƒ³ä¼´ä¾£æ¨è */
.partner-recommendations {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.recommendation-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 1.5rem;
    border-left: 4px solid #d4af37;
}

.rec-header {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 1rem;
}

.rec-header i {
    color: #d4af37;
    font-size: 1.2rem;
}

.rec-header h5 {
    color: rgba(255, 255, 255, 0.95);
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
}

.zodiac-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.zodiac-tag {
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
}

.zodiac-tag.best {
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    color: white;
    box-shadow: 0 2px 10px rgba(46, 204, 113, 0.3);
}

.trait-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.trait-item {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
}

.trait-item i {
    color: #27ae60;
    font-size: 0.9rem;
}

/* è¿åŠ¿æ—¶é—´çº¿ */
.destiny-timeline {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.timeline-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.timeline-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-top: 0.3rem;
    flex-shrink: 0;
}

.timeline-dot.excellent {
    background: #27ae60;
    box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2);
}

.timeline-dot.good {
    background: #f39c12;
    box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.2);
}

.timeline-dot.normal {
    background: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

.timeline-content h6 {
    color: rgba(255, 255, 255, 0.95);
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.5rem 0;
}

.timeline-content p {
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.6;
    margin: 0;
    font-size: 0.95rem;
}

/* æ“ä½œæŒ‰é’® */
.result-actions {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 3rem;
    flex-wrap: wrap;
}

.primary-btn, .secondary-btn, .share-btn, .tertiary-btn, .ai-btn {
    padding: 1rem 2rem;
    border: none;
    border-radius: 25px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    text-decoration: none;
}

.primary-btn {
    background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
    color: white;
    box-shadow: 0 10px 25px rgba(212, 175, 55, 0.3);
}

.secondary-btn {
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.9);
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.share-btn {
    background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
    color: white;
    box-shadow: 0 10px 25px rgba(74, 144, 226, 0.3);
}

.tertiary-btn {
    background: linear-gradient(135deg, #2c5f2d 0%, #4a8c4e 100%);
    color: white;
    box-shadow: 0 10px 25px rgba(44, 95, 45, 0.3);
}

.ai-btn {
    background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
    color: white;
    box-shadow: 0 10px 25px rgba(155, 89, 182, 0.3);
    position: relative;
    overflow: hidden;
}

.ai-btn::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    transform: rotate(45deg);
    animation: ai-shine 2s infinite;
}

@keyframes ai-shine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
}

.primary-btn:hover, .secondary-btn:hover, .share-btn:hover, .tertiary-btn:hover, .ai-btn:hover {
    transform: translateY(-3px);
}

.primary-btn:hover {
    box-shadow: 0 15px 35px rgba(212, 175, 55, 0.4);
}

.share-btn:hover {
    box-shadow: 0 15px 35px rgba(74, 144, 226, 0.4);
}

.tertiary-btn:hover {
    box-shadow: 0 15px 35px rgba(44, 95, 45, 0.4);
}

.ai-btn:hover {
    box-shadow: 0 15px 35px rgba(155, 89, 182, 0.5);
    background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
}

/* AIåˆ†æåŒºåŸŸæ ·å¼ */
.ai-analysis-section {
    margin-top: 2rem;
    background: linear-gradient(135deg, rgba(155, 89, 182, 0.1) 0%, rgba(142, 68, 173, 0.05) 100%);
    border: 2px solid rgba(155, 89, 182, 0.2);
    border-radius: 20px;
    padding: 2rem;
    position: relative;
    overflow: hidden;
}

.ai-analysis-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(155, 89, 182, 0.05) 0%, transparent 70%);
    animation: ai-pulse 3s ease-in-out infinite;
}

@keyframes ai-pulse {
    0%, 100% { transform: scale(1); opacity: 0.3; }
    50% { transform: scale(1.1); opacity: 0.1; }
}

.ai-analysis-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    position: relative;
    z-index: 2;
}

.ai-analysis-header h3 {
    color: #9b59b6;
    font-size: 1.5rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.ai-badge {
    background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
}

.ai-analysis-content {
    position: relative;
    z-index: 2;
}

.ai-section {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border-left: 4px solid #9b59b6;
}

.ai-section h4 {
    color: #9b59b6;
    margin: 0 0 0.5rem 0;
    font-size: 1.1rem;
}

.ai-section p {
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.6;
    margin: 0;
}

.analysis-separator {
    display: flex;
    align-items: center;
    margin: 2rem 0;
    gap: 1rem;
}

.separator-line {
    flex: 1;
    height: 2px;
    background: linear-gradient(90deg, transparent 0%, #9b59b6 50%, transparent 100%);
}

.separator-text {
    color: #9b59b6;
    font-weight: 600;
    padding: 0.5rem 1rem;
    background: rgba(155, 89, 182, 0.1);
    border-radius: 20px;
    font-size: 0.9rem;
}

/* åŠ è½½åŠ¨ç”» */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(10px);
}

.loading-content {
    text-align: center;
    color: white;
}

.traditional-spinner {
    width: 150px;
    height: 150px;
    margin: 0 auto 2rem;
    position: relative;
    animation: spinnerRotate 3s linear infinite;
}

.bagua-symbol {
    width: 100%;
    height: 100%;
    position: relative;
    border: 3px solid #d4af37;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(212, 175, 55, 0.1);
}

.bagua-line {
    position: absolute;
    width: 60%;
    height: 4px;
    background: #d4af37;
    border-radius: 2px;
    transform-origin: center;
}

.bagua-line:nth-child(1) { transform: rotate(0deg) translateX(25px); }
.bagua-line:nth-child(2) { transform: rotate(45deg) translateX(25px); }
.bagua-line:nth-child(3) { transform: rotate(90deg) translateX(25px); }
.bagua-line:nth-child(4) { transform: rotate(135deg) translateX(25px); }
.bagua-line:nth-child(5) { transform: rotate(180deg) translateX(25px); }
.bagua-line:nth-child(6) { transform: rotate(225deg) translateX(25px); }
.bagua-line:nth-child(7) { transform: rotate(270deg) translateX(25px); }
.bagua-line:nth-child(8) { transform: rotate(315deg) translateX(25px); }

@keyframes spinnerRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.loading-content p {
    font-size: 1.3rem;
    font-weight: 600;
    margin: 0;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    animation: textPulse 2s ease-in-out infinite;
}

@keyframes textPulse {
    0%, 100% { opacity: 0.7; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.05); }
}

/* è£…é¥°å…ƒç´  */
.decoration-elements {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
}

.floating-element {
    position: absolute;
    opacity: 0.1;
    animation: float 20s ease-in-out infinite;
}

.floating-element.dragon {
    top: 20%;
    left: 10%;
    font-size: 2rem;
    animation-delay: 0s;
}

.floating-element.phoenix {
    top: 60%;
    right: 15%;
    font-size: 2rem;
    animation-delay: 5s;
}

.floating-element.cloud {
    top: 40%;
    left: 50%;
    font-size: 1.5rem;
    animation-delay: 10s;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    25% { transform: translateY(-20px) rotate(90deg); }
    50% { transform: translateY(0px) rotate(180deg); }
    75% { transform: translateY(20px) rotate(270deg); }
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1024px) {
    .couple-info {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .compatibility-score {
        order: -1;
    }
    
    .form-content {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .analysis-details {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .yuanqi-container {
        padding: 0;
    }
    
    .yuanqi-header {
        padding: 2rem 1rem;
    }
    
    .title-section {
        flex-direction: column;
        gap: 1rem;
    }
    
    .main-title {
        font-size: 2.5rem;
    }
    
    .subtitle {
        font-size: 1.2rem;
    }
    
    .main-content {
        padding: 0 1rem 2rem 1rem;
    }
    
    .form-container, .result-container {
        padding: 2rem;
        margin: 1rem;
        border-radius: 20px;
    }
    
    .input-grid {
        grid-template-columns: 1fr;
    }
    
    .result-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .yin-yang-symbol {
        width: 80px;
        height: 80px;
    }
    
    .score-circle {
        width: 120px;
        height: 120px;
    }
    
    .score-number {
        font-size: 2.5rem;
    }
}

@media (max-width: 480px) {
    .main-title {
        font-size: 2rem;
    }
    
    .subtitle {
        font-size: 1rem;
    }
    
    .form-container, .result-container {
        padding: 1.5rem;
    }
    
    .person-form {
        padding: 1.5rem;
    }
    
    .analyze-btn {
        padding: 1.2rem 2.5rem;
        font-size: 1.1rem;
    }
}
</style>
{% endblock %}