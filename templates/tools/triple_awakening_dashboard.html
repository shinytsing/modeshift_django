{% extends 'base.html' %}
{% load static %}

{% block tool_title_inner %}ä¸‰é‡è§‰é†’ä»ªè¡¨ç›˜{% endblock %}
{% block tool_title_display %}ä¸‰é‡è§‰é†’ä»ªè¡¨ç›˜{% endblock %}

{% block extra_css %}
<style>
.triple-awakening-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
  color: #ffffff;
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  padding: 2rem;
  position: relative;
  overflow-x: hidden;
}

.triple-awakening-container::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(255, 68, 68, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
  z-index: -1;
  animation: backgroundPulse 10s ease-in-out infinite;
}

@keyframes backgroundPulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

.header-section {
  text-align: center;
  margin-bottom: 3rem;
  padding: 2rem 0;
}

.main-title {
  font-size: 3rem;
  font-weight: 900;
  background: linear-gradient(135deg, #ff4444, #00ffff, #ffd700);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 1rem;
  text-shadow: 0 0 30px rgba(255, 68, 68, 0.3);
}

.subtitle {
  font-size: 1.2rem;
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 2rem;
}

.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 2rem;
  max-width: 1400px;
  margin: 0 auto;
}

.dashboard-card {
  background: rgba(26, 26, 26, 0.8);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 12px;
  padding: 2rem;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.dashboard-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(135deg, #ff4444, #00ffff, #ffd700);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.dashboard-card:hover::before {
  transform: scaleX(1);
}

.dashboard-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 40px rgba(255, 68, 68, 0.2);
  border-color: #ff4444;
}

.card-title {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1.5rem;
  color: #ff4444;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.card-icon {
  font-size: 1.8rem;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.stat-item {
  background: rgba(255, 68, 68, 0.1);
  padding: 1rem;
  border-radius: 8px;
  text-align: center;
  border: 1px solid rgba(255, 68, 68, 0.2);
}

.stat-value {
  font-size: 1.8rem;
  font-weight: 900;
  color: #ff4444;
  margin-bottom: 0.5rem;
}

.stat-label {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  margin: 1rem 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(135deg, #ff4444, #ff6b35);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.challenge-list {
  list-style: none;
  padding: 0;
  margin: 1rem 0;
}

.challenge-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.8rem;
  margin-bottom: 0.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 6px;
  border-left: 3px solid #ff4444;
}

.challenge-item.completed {
  border-left-color: #00ff00;
  background: rgba(0, 255, 0, 0.1);
}

.challenge-checkbox {
  width: 20px;
  height: 20px;
  border: 2px solid #ff4444;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.challenge-checkbox.checked {
  background: #ff4444;
  color: white;
}

.challenge-text {
  flex: 1;
  margin-left: 1rem;
  font-size: 0.9rem;
}

.challenge-points {
  color: #ffd700;
  font-weight: 600;
}

.currency-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin: 1rem 0;
}

.currency-item {
  background: linear-gradient(135deg, rgba(255, 68, 68, 0.1), rgba(0, 255, 255, 0.1));
  padding: 1rem;
  border-radius: 8px;
  text-align: center;
  border: 1px solid rgba(255, 68, 68, 0.3);
}

.currency-amount {
  font-size: 1.5rem;
  font-weight: 900;
  color: #ffd700;
  margin-bottom: 0.5rem;
}

.currency-name {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.7);
}

.action-buttons {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  flex-wrap: wrap;
}

.action-btn {
  background: linear-gradient(135deg, #ff4444, #ff6b35);
  color: white;
  border: none;
  padding: 0.8rem 1.5rem;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-size: 0.9rem;
}

.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(255, 68, 68, 0.3);
}

.action-btn.secondary {
  background: linear-gradient(135deg, #00ffff, #0080ff);
}

.action-btn.success {
  background: linear-gradient(135deg, #00ff00, #00cc00);
}

.chart-container {
  height: 200px;
  margin: 1rem 0;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  padding: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid rgba(255, 68, 68, 0.2);
}

.chart-placeholder {
  color: rgba(255, 255, 255, 0.5);
  font-style: italic;
}

.recent-activities {
  max-height: 300px;
  overflow-y: auto;
}

.activity-item {
  display: flex;
  align-items: center;
  padding: 0.8rem;
  margin-bottom: 0.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 6px;
  border-left: 3px solid #00ffff;
}

.activity-icon {
  font-size: 1.2rem;
  margin-right: 1rem;
  color: #00ffff;
}

.activity-details {
  flex: 1;
}

.activity-title {
  font-weight: 600;
  margin-bottom: 0.2rem;
}

.activity-time {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
}

@media (max-width: 768px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .currency-grid {
    grid-template-columns: 1fr;
  }
  
  .main-title {
    font-size: 2rem;
  }
  
  .triple-awakening-container {
    padding: 1rem;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="triple-awakening-container">
  <div class="header-section">
    <h1 class="main-title">
      <i class="fas fa-brain"></i> ä¸‰é‡è§‰é†’ä»ªè¡¨ç›˜
    </h1>
    <p class="subtitle">ğŸ”¥ ç‰©ç†çº§å­˜åœ¨æ„Ÿ | ğŸ’» ä»£ç å¥èº«æˆ¿ | ğŸ’° ç—›è‹¦è´§å¸åŒ–</p>
  </div>

  <div class="dashboard-grid">
    <!-- ç‰©ç†çº§å­˜åœ¨æ„Ÿ -->
    <div class="dashboard-card">
      <h2 class="card-title">
        <i class="fas fa-dumbbell card-icon"></i>
        ç‰©ç†çº§å­˜åœ¨æ„Ÿ
      </h2>
      
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value">{{ workout_data.dashboard.total_workouts }}</div>
          <div class="stat-label">æ€»è®­ç»ƒæ¬¡æ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ workout_data.dashboard.current_streak }}</div>
          <div class="stat-label">è¿ç»­å¤©æ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ workout_data.dashboard.total_duration }}</div>
          <div class="stat-label">æ€»æ—¶é•¿(åˆ†é’Ÿ)</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ workout_data.dashboard.total_calories }}</div>
          <div class="stat-label">æ¶ˆè€—å¡è·¯é‡Œ</div>
        </div>
      </div>
      
      <div class="chart-container">
        <div class="chart-placeholder">
          ğŸ“ˆ åŠ›é‡å¢é•¿æ›²çº¿å›¾<br>
          (å¯¹æ¯”ä»£ç æäº¤æ¬¡æ•°æ›²çº¿)
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="action-btn" onclick="startFitnessWorkout()">
          <i class="fas fa-play"></i> å¼€å§‹è®­ç»ƒ
        </button>
        <button class="action-btn secondary" onclick="recordExhaustion()">
          <i class="fas fa-microphone"></i> è®°å½•åŠ›ç«­
        </button>
      </div>
    </div>

    <!-- ä»£ç å¥èº«æˆ¿ -->
    <div class="dashboard-card">
      <h2 class="card-title">
        <i class="fas fa-code card-icon"></i>
        ä»£ç å¥èº«æˆ¿
      </h2>
      
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value">{{ ai_dependency_data.total_lines }}</div>
          <div class="stat-label">æ€»ä»£ç è¡Œæ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ ai_dependency_data.rejection_count }}</div>
          <div class="stat-label">æ‹’ç»AIæ¬¡æ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ ai_dependency_data.manual_lines }}</div>
          <div class="stat-label">æ‰‹å†™ä»£ç è¡Œæ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ ai_dependency_data.dependency_score|floatformat:1 }}%</div>
          <div class="stat-label">AIä¾èµ–åº¦</div>
        </div>
      </div>
      
      <div class="progress-bar">
        <div class="progress-fill" style="width: {{ ai_dependency_data.dependency_score }}%"></div>
      </div>
      
      <div class="action-buttons">
        <button class="action-btn" onclick="startCodeWorkout()">
          <i class="fas fa-keyboard"></i> ä»£ç è®­ç»ƒ
        </button>
        <button class="action-btn secondary" onclick="showAIDependency()">
          <i class="fas fa-chart-line"></i> ä¾èµ–åº¦åˆ†æ
        </button>
      </div>
    </div>

    <!-- ç—›è‹¦è´§å¸åŒ– -->
    <div class="dashboard-card">
      <h2 class="card-title">
        <i class="fas fa-coins card-icon"></i>
        ç—›è‹¦è´§å¸åŒ–
      </h2>
      
      <div class="currency-grid">
        {% for currency_type, currency_info in pain_currency_data.items %}
        <div class="currency-item">
          <div class="currency-amount">{{ currency_info.amount }}</div>
          <div class="currency-name">{{ currency_info.display_name }}</div>
        </div>
        {% empty %}
        <div class="currency-item">
          <div class="currency-amount">0</div>
          <div class="currency-name">åŠ›ç«­å¸</div>
        </div>
        <div class="currency-item">
          <div class="currency-amount">0</div>
          <div class="currency-name">æ‹’ç»å¸</div>
        </div>
        <div class="currency-item">
          <div class="currency-amount">0</div>
          <div class="currency-name">æ‰‹å†™å¸</div>
        </div>
        <div class="currency-item">
          <div class="currency-amount">0</div>
          <div class="currency-name">çªç ´å¸</div>
        </div>
        {% endfor %}
      </div>
      
      <div class="action-buttons">
        <button class="action-btn" onclick="showPainCurrency()">
          <i class="fas fa-wallet"></i> è´§å¸è¯¦æƒ…
        </button>
        <button class="action-btn secondary" onclick="createExhaustionProof()">
          <i class="fas fa-certificate"></i> åŠ›ç«­è¯æ˜
        </button>
      </div>
    </div>

    <!-- æ¯æ—¥æŒ‘æˆ˜ -->
    <div class="dashboard-card">
      <h2 class="card-title">
        <i class="fas fa-trophy card-icon"></i>
        æ¯æ—¥æŒ‘æˆ˜
      </h2>
      
      <div class="challenge-list">
        {% for task in daily_challenge.tasks %}
        <div class="challenge-item {% if task.completed %}completed{% endif %}">
          <div class="challenge-checkbox {% if task.completed %}checked{% endif %}" 
               onclick="completeTask({{ task.id }})">
            {% if task.completed %}<i class="fas fa-check"></i>{% endif %}
          </div>
          <div class="challenge-text">{{ task.title }}</div>
          <div class="challenge-points">+{{ task.points }}</div>
        </div>
        {% empty %}
        <div class="challenge-item">
          <div class="challenge-checkbox" onclick="completeTask(1)"></div>
          <div class="challenge-text">å†™1è¡ŒåŸç”ŸJS (1ä¸ªå¼•ä½“å‘ä¸Š)</div>
          <div class="challenge-points">+5</div>
        </div>
        <div class="challenge-item">
          <div class="challenge-checkbox" onclick="completeTask(2)"></div>
          <div class="challenge-text">æ‹’ç»1æ¬¡AIè¡¥å…¨ (10ç§’å¹³æ¿æ”¯æ’‘)</div>
          <div class="challenge-points">+10</div>
        </div>
        <div class="challenge-item">
          <div class="challenge-checkbox" onclick="completeTask(3)"></div>
          <div class="challenge-text">é‡æ„1ä¸ªå‡½æ•° (20ä¸ªæ·±è¹²)</div>
          <div class="challenge-points">+15</div>
        </div>
        <div class="challenge-item">
          <div class="challenge-checkbox" onclick="completeTask(4)"></div>
          <div class="challenge-text">æ‰‹å†™ä¸€ä¸ªç®—æ³• (30ä¸ªä¿¯å§æ’‘)</div>
          <div class="challenge-points">+20</div>
        </div>
        {% endfor %}
      </div>
      
      <div class="action-buttons">
        <button class="action-btn success" onclick="claimReward()">
          <i class="fas fa-gift"></i> é¢†å–å¥–åŠ±
        </button>
      </div>
    </div>

    <!-- æœ€è¿‘æ´»åŠ¨ -->
    <div class="dashboard-card">
      <h2 class="card-title">
        <i class="fas fa-history card-icon"></i>
        æœ€è¿‘æ´»åŠ¨
      </h2>
      
      <div class="recent-activities">
        {% for workout in workout_data.recent_workouts %}
        <div class="activity-item">
          <i class="fas fa-dumbbell activity-icon"></i>
          <div class="activity-details">
            <div class="activity-title">{{ workout.type }} - {{ workout.intensity }}</div>
            <div class="activity-time">{{ workout.date }}</div>
          </div>
        </div>
        {% empty %}
        <div class="activity-item">
          <i class="fas fa-info-circle activity-icon"></i>
          <div class="activity-details">
            <div class="activity-title">æš‚æ— æ´»åŠ¨è®°å½•</div>
            <div class="activity-time">å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡è®­ç»ƒå§ï¼</div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- AIåä½œå£°æ˜ -->
    <div class="dashboard-card">
      <h2 class="card-title">
        <i class="fas fa-robot card-icon"></i>
        AIåä½œå£°æ˜
      </h2>
      
      <div class="chart-container">
        <div class="chart-placeholder">
          ğŸ¤– 3Dæ¨¡å‹å±•ç¤º<br>
          éª¨æ¶ä»£ç  + AIè‚Œè‚‰ + ç¥ç»ç³»ç»Ÿ
        </div>
      </div>
      
      <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; margin: 1rem 0;">
        è¿™å°±æ˜¯æ•°å­—æ—¶ä»£çš„å¥èº«â€”â€”æˆ‘çš„å¤§è„‘è´Ÿè´£ä¸¾èµ·æ€æƒ³çš„æ é“ƒ
      </p>
      
      <div class="action-buttons">
        <button class="action-btn" onclick="window.location.href='{% url 'tools:copilot_page' %}'">
          <i class="fas fa-eye"></i> æŸ¥çœ‹åä½œ
        </button>
        <button class="action-btn secondary" onclick="createCollaboration()">
          <i class="fas fa-plus"></i> æ–°å»ºåä½œ
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// å¼€å§‹å¥èº«è®­ç»ƒ
function startFitnessWorkout() {
  const workoutData = {
    workout_type: 'strength',
    intensity: 'intense',
    duration_minutes: Math.floor(Math.random() * 60) + 30,
    calories_burned: Math.floor(Math.random() * 500) + 200,
    heart_rate_avg: Math.floor(Math.random() * 40) + 120,
    heart_rate_max: Math.floor(Math.random() * 30) + 160,
    exercises: ['æ·±è¹²', 'ä¿¯å§æ’‘', 'å¹³æ¿æ”¯æ’‘'],
    notes: 'çªç ´æé™è®­ç»ƒ',
    is_exhausted: Math.random() > 0.7
  };
  
  fetch('/tools/api/triple_awakening/fitness-workout/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify(workoutData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('å¥èº«è®­ç»ƒè®°å½•åˆ›å»ºæˆåŠŸï¼');
      location.reload();
    } else {
      alert('è®­ç»ƒè®°å½•å¤±è´¥: ' + data.message);
    }
  });
}

// è®°å½•åŠ›ç«­éŸ³é¢‘
function recordExhaustion() {
  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => {
        const mediaRecorder = new MediaRecorder(stream);
        const audioChunks = [];
        
        mediaRecorder.ondataavailable = event => {
          audioChunks.push(event.data);
        };
        
        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
          const formData = new FormData();
          formData.append('audio', audioBlob);
          formData.append('workout_session_id', '1');
          
          fetch('/tools/api/triple_awakening/record-audio/', {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('åŠ›ç«­éŸ³é¢‘è®°å½•æˆåŠŸï¼');
            } else {
              alert('éŸ³é¢‘è®°å½•å¤±è´¥: ' + data.message);
            }
          });
        };
        
        mediaRecorder.start();
        alert('å¼€å§‹å½•éŸ³5ç§’...');
        
        setTimeout(() => {
          mediaRecorder.stop();
          stream.getTracks().forEach(track => track.stop());
        }, 5000);
      })
      .catch(err => {
        alert('æ— æ³•è®¿é—®éº¦å…‹é£: ' + err.message);
      });
  } else {
    alert('æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å½•åˆ¶');
  }
}

// å¼€å§‹ä»£ç è®­ç»ƒ
function startCodeWorkout() {
  const workoutData = {
    workout_type: 'pull_up',
    duration_seconds: Math.floor(Math.random() * 300) + 60,
    difficulty_level: Math.floor(Math.random() * 5) + 1,
    code_snippet: '// åŸç”ŸJavaScriptä»£ç \nconst element = document.getElementById("myElement");\nelement.addEventListener("click", () => console.log("Hello World!"));',
    ai_rejection_count: Math.floor(Math.random() * 10),
    manual_code_lines: Math.floor(Math.random() * 50) + 10,
    refactored_functions: Math.floor(Math.random() * 5) + 1,
    is_exhausted: Math.random() > 0.7
  };
  
  fetch('/tools/api/triple_awakening/code-workout/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify(workoutData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('ä»£ç è®­ç»ƒè®°å½•åˆ›å»ºæˆåŠŸï¼');
      location.reload();
    } else {
      alert('è®­ç»ƒè®°å½•å¤±è´¥: ' + data.message);
    }
  });
}

// æ˜¾ç¤ºAIä¾èµ–åº¦
function showAIDependency() {
  fetch('/tools/api/triple_awakening/ai-dependency/')
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      const info = data.data;
      alert(`AIä¾èµ–åº¦åˆ†æ:\n\næ€»ä»£ç è¡Œæ•°: ${info.total_lines}\nAIç”Ÿæˆä»£ç : ${info.ai_lines}\næ‰‹å†™ä»£ç : ${info.manual_lines}\næ‹’ç»AIæ¬¡æ•°: ${info.rejection_count}\nä¾èµ–åº¦è¯„åˆ†: ${info.dependency_score}%\n\næœ€åæ›´æ–°: ${info.last_updated}`);
    }
  });
}

// æ˜¾ç¤ºç—›è‹¦è´§å¸
function showPainCurrency() {
  fetch('/tools/api/triple_awakening/pain-currency/')
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      let currencyInfo = 'ç—›è‹¦è´§å¸è¯¦æƒ…:\n\n';
      for (const [type, info] of Object.entries(data.data)) {
        currencyInfo += `${info.display_name}:\n  å½“å‰ä½™é¢: ${info.amount}\n  æ€»è·å¾—: ${info.total_earned}\n  æ€»æ¶ˆè´¹: ${info.total_spent}\n\n`;
      }
      currencyInfo += 'å¯ç”¨äºå…‘æ¢:\n- ç½‘ç«™ä¼šå‘˜ç§¯åˆ†\n- ç‰¹æ®ŠåŠŸèƒ½è§£é”\n- æˆå°±å¾½ç« \n- å¼€å‘è€…é£Ÿè°±';
      alert(currencyInfo);
    }
  });
}

// åˆ›å»ºåŠ›ç«­è¯æ˜
function createExhaustionProof() {
  const proofData = {
    proof_type: 'fitness',
    workout_session_id: 1
  };
  
  fetch('/tools/api/triple_awakening/exhaustion-proof/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify(proofData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert(`åŠ›ç«­è¯æ˜åˆ›å»ºæˆåŠŸï¼\n\næ¨ç‰¹å†…å®¹:\n${data.tweet_content}\n\nNFTå…ƒæ•°æ®å·²ç”Ÿæˆï¼Œå¯ä»¥é“¸é€ ä¸ºé“¾ä¸ŠNFTï¼`);
    } else {
      alert('åŠ›ç«­è¯æ˜åˆ›å»ºå¤±è´¥: ' + data.message);
    }
  });
}

// å®Œæˆä»»åŠ¡
function completeTask(taskId) {
  fetch('/tools/api/triple_awakening/complete-task/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify({ task_id: taskId })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert(`ä»»åŠ¡å®Œæˆï¼è·å¾— ${data.task.points} ç§¯åˆ†\næ€»ç§¯åˆ†: ${data.total_score}`);
      if (data.all_completed) {
        alert('ğŸ‰ æ­å–œå®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼è§£é”"å¼€å‘è€…å¢è‚Œé£Ÿè°±"å½©è›‹ï¼');
      }
      location.reload();
    } else {
      alert('ä»»åŠ¡å®Œæˆå¤±è´¥: ' + data.message);
    }
  });
}

// é¢†å–å¥–åŠ±
function claimReward() {
  alert('ğŸ å¼€å‘è€…å¢è‚Œé£Ÿè°±:\n\n1. è›‹ç™½è´¨: æ¯å…¬æ–¤ä½“é‡1.6-2.2å…‹\n2. ç¢³æ°´åŒ–åˆç‰©: è®­ç»ƒå‰åè¡¥å……\n3. å¥åº·è„‚è‚ª: åšæœã€é±¼æ²¹\n4. ç»´ç”Ÿç´ D: ä¿ƒè¿›è‚Œè‚‰ç”Ÿé•¿\n5. å……è¶³ç¡çœ : 8-9å°æ—¶\n6. æ°´åˆ†: æ¯å¤©2-3å‡\n\nğŸ’ª ç»§ç»­è®­ç»ƒï¼Œçªç ´æé™ï¼');
}

// åˆ›å»ºåä½œ
function createCollaboration() {
  const collaborationData = {
    collaboration_type: 'skeleton',
    original_code: '// éª¨æ¶ä»£ç \nfunction processData() {\n  // TODO: å®ç°æ•°æ®å¤„ç†é€»è¾‘\n}',
    ai_generated_code: '// AIç”Ÿæˆçš„è‚Œè‚‰ä»£ç \nfunction processData(data) {\n  return data.map(item => ({\n    id: item.id,\n    processed: item.value * 2\n  }));\n}',
    final_code: '// æœ€ç»ˆç¥ç»ç³»ç»Ÿä»£ç \nfunction processData(data) {\n  if (!Array.isArray(data)) {\n    throw new Error("æ•°æ®å¿…é¡»æ˜¯æ•°ç»„");\n  }\n  \n  return data\n    .filter(item => item && item.value)\n    .map(item => ({\n      id: item.id,\n      processed: item.value * 2,\n      timestamp: Date.now()\n    }));\n}',
    project_name: 'æ•°æ®å¤„ç†ç³»ç»Ÿ',
    description: 'å±•ç¤ºä»éª¨æ¶åˆ°è‚Œè‚‰åˆ°ç¥ç»ç³»ç»Ÿçš„å®Œæ•´åä½œè¿‡ç¨‹'
  };
  
  fetch('/tools/api/triple_awakening/copilot-collaboration/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify(collaborationData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('AIåä½œå£°æ˜åˆ›å»ºæˆåŠŸï¼');
      window.location.href = '{% url "tools:copilot_page" %}';
    } else {
      alert('åä½œå£°æ˜åˆ›å»ºå¤±è´¥: ' + data.message);
    }
  });
}

// è·å–CSRF Token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
</script>
{% endblock %} 