{% extends 'base.html' %}
{% load static %}

{% block title %}和平冥想 - QAToolBox{% endblock %}

{% block extra_css %}
<style>
.meditation-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.meditation-header {
    text-align: center;
    margin-bottom: 50px;
    color: white;
}

.meditation-header h1 {
    font-size: 3rem;
    margin-bottom: 15px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.meditation-header p {
    font-size: 1.2rem;
    opacity: 0.9;
    line-height: 1.6;
}

.meditation-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: start;
}

.meditation-player {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
}

.player-header {
    text-align: center;
    margin-bottom: 30px;
}

.player-header h2 {
    color: #333;
    font-size: 1.8rem;
    margin-bottom: 10px;
}

.player-header p {
    color: #666;
    font-size: 1rem;
}

.audio-player {
    width: 100%;
    margin-bottom: 30px;
}

.audio-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
}

.control-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    background: var(--primary-color, #667eea);
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.control-btn:hover {
    transform: scale(1.1);
    background: var(--primary-dark, #5a6fd8);
}

.control-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.playlist {
    max-height: 300px;
    overflow-y: auto;
}

.playlist-item {
    display: flex;
    align-items: center;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8f9fa;
}

.playlist-item:hover {
    background: #e9ecef;
    transform: translateX(5px);
}

.playlist-item.active {
    background: var(--primary-color, #667eea);
    color: white;
}

.playlist-item i {
    margin-right: 15px;
    font-size: 18px;
}

.playlist-info {
    flex: 1;
}

.playlist-title {
    font-weight: 600;
    margin-bottom: 5px;
}

.playlist-duration {
    font-size: 0.9rem;
    opacity: 0.7;
}

.meditation-guide {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
}

.guide-header {
    text-align: center;
    margin-bottom: 30px;
}

.guide-header h2 {
    color: #333;
    font-size: 1.8rem;
    margin-bottom: 10px;
}

.guide-header p {
    color: #666;
    font-size: 1rem;
}

.meditation-steps {
    list-style: none;
    padding: 0;
}

.meditation-steps li {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 20px 0;
    border-bottom: 1px solid #f0f0f0;
}

.meditation-steps li:last-child {
    border-bottom: none;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary-color, #667eea);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    flex-shrink: 0;
}

.step-content h3 {
    color: #333;
    margin-bottom: 8px;
    font-size: 1.1rem;
}

.step-content p {
    color: #666;
    line-height: 1.6;
    margin: 0;
}

.meditation-timer {
    text-align: center;
    margin: 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 15px;
}

.timer-display {
    font-size: 3rem;
    font-weight: bold;
    color: var(--primary-color, #667eea);
    margin-bottom: 15px;
    font-family: 'Courier New', monospace;
}

.timer-controls {
    display: flex;
    justify-content: center;
    gap: 15px;
}

.timer-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    background: var(--primary-color, #667eea);
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
}

.timer-btn:hover {
    background: var(--primary-dark, #5a6fd8);
    transform: translateY(-2px);
}

.timer-btn.secondary {
    background: #6c757d;
}

.timer-btn.secondary:hover {
    background: #5a6268;
}

.breathing-guide {
    text-align: center;
    margin: 30px 0;
    padding: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    color: white;
}

.breathing-circle {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    animation: breathe 4s ease-in-out infinite;
}

@keyframes breathe {
    0%, 100% {
        transform: scale(1);
        opacity: 0.7;
    }
    50% {
        transform: scale(1.2);
        opacity: 1;
    }
}

.breathing-text {
    font-size: 1.2rem;
    margin-bottom: 10px;
}

.breathing-instruction {
    font-size: 1rem;
    opacity: 0.9;
}

.meditation-tips {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 25px;
    margin-top: 30px;
}

.tips-header {
    color: #333;
    font-size: 1.2rem;
    margin-bottom: 15px;
    font-weight: 600;
}

.tips-list {
    list-style: none;
    padding: 0;
}

.tips-list li {
    padding: 8px 0;
    color: #666;
    display: flex;
    align-items: center;
    gap: 10px;
}

.tips-list li i {
    color: var(--primary-color, #667eea);
    font-size: 14px;
}

/* 移动端适配 */
@media (max-width: 768px) {
    .meditation-container {
        padding: 20px 15px;
    }
    
    .meditation-header h1 {
        font-size: 2rem;
    }
    
    .meditation-content {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .meditation-player,
    .meditation-guide {
        padding: 20px;
    }
    
    .control-btn {
        width: 50px;
        height: 50px;
        font-size: 16px;
    }
    
    .timer-display {
        font-size: 2rem;
    }
    
    .breathing-circle {
        width: 150px;
        height: 150px;
        font-size: 1.5rem;
    }
}

/* 深色主题适配 */
@media (prefers-color-scheme: dark) {
    .meditation-player,
    .meditation-guide {
        background: rgba(45, 55, 72, 0.95);
        color: #e2e8f0;
    }
    
    .player-header h2,
    .guide-header h2 {
        color: #e2e8f0;
    }
    
    .player-header p,
    .guide-header p {
        color: #a0aec0;
    }
    
    .playlist-item {
        background: #4a5568;
        color: #e2e8f0;
    }
    
    .playlist-item:hover {
        background: #2d3748;
    }
    
    .step-content h3 {
        color: #e2e8f0;
    }
    
    .step-content p {
        color: #a0aec0;
    }
    
    .meditation-steps li {
        border-bottom-color: #4a5568;
    }
    
    .meditation-timer {
        background: #4a5568;
    }
    
    .meditation-tips {
        background: #4a5568;
        color: #e2e8f0;
    }
    
    .tips-header {
        color: #e2e8f0;
    }
    
    .tips-list li {
        color: #a0aec0;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="meditation-container">
    <div class="meditation-header">
        <h1>和平冥想</h1>
        <p>在繁忙的生活中寻找内心的宁静，通过冥想获得身心的平衡与和谐</p>
    </div>
    
    <div class="meditation-content">
        <div class="meditation-player">
            <div class="player-header">
                <h2>冥想音乐</h2>
                <p>选择适合的冥想音乐，开始您的内心之旅</p>
            </div>
            
            <div class="audio-controls">
                <button class="control-btn" id="prevBtn" onclick="previousTrack()">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="control-btn" id="playBtn" onclick="togglePlay()">
                    <i class="fas fa-play" id="playIcon"></i>
                </button>
                <button class="control-btn" id="nextBtn" onclick="nextTrack()">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
            
            <audio id="audioPlayer" controls class="audio-player">
                <source src="{% static 'audio/meditation/ambient.mp3' %}" type="audio/mpeg">
                您的浏览器不支持音频播放。
            </audio>
            
            <div class="playlist">
                <div class="playlist-item active" onclick="playTrack(0)">
                    <i class="fas fa-music"></i>
                    <div class="playlist-info">
                        <div class="playlist-title">宁静氛围</div>
                        <div class="playlist-duration">10:00</div>
                    </div>
                </div>
                <div class="playlist-item" onclick="playTrack(1)">
                    <i class="fas fa-music"></i>
                    <div class="playlist-info">
                        <div class="playlist-title">自然之声</div>
                        <div class="playlist-duration">15:00</div>
                    </div>
                </div>
                <div class="playlist-item" onclick="playTrack(2)">
                    <i class="fas fa-music"></i>
                    <div class="playlist-info">
                        <div class="playlist-title">深度冥想</div>
                        <div class="playlist-duration">20:00</div>
                    </div>
                </div>
                <div class="playlist-item" onclick="playTrack(3)">
                    <i class="fas fa-music"></i>
                    <div class="playlist-info">
                        <div class="playlist-title">心灵治愈</div>
                        <div class="playlist-duration">12:00</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="meditation-guide">
            <div class="guide-header">
                <h2>冥想指南</h2>
                <p>跟随这些步骤，开始您的冥想练习</p>
            </div>
            
            <ul class="meditation-steps">
                <li>
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>准备环境</h3>
                        <p>选择一个安静、舒适的地方，关闭手机通知，确保不会被打扰。可以点燃香薰或播放轻柔的背景音乐。</p>
                    </div>
                </li>
                <li>
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>调整姿势</h3>
                        <p>坐在垫子或椅子上，保持背部挺直但不僵硬。双手自然放在膝盖上，闭上眼睛或保持柔和的目光。</p>
                    </div>
                </li>
                <li>
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>专注呼吸</h3>
                        <p>将注意力集中在呼吸上，感受空气进入和离开身体的感觉。不要刻意改变呼吸节奏，只是观察。</p>
                    </div>
                </li>
                <li>
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>释放思绪</h3>
                        <p>当思绪出现时，不要抗拒，也不要跟随。轻轻地将注意力重新带回到呼吸上，保持耐心和温和。</p>
                    </div>
                </li>
                <li>
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h3>结束练习</h3>
                        <p>冥想结束时，慢慢睁开眼睛，花几分钟时间感受内心的平静，然后逐渐回到日常活动中。</p>
                    </div>
                </li>
            </ul>
            
            <div class="meditation-timer">
                <div class="timer-display" id="timerDisplay">10:00</div>
                <div class="timer-controls">
                    <button class="timer-btn" onclick="setTimer(5)">5分钟</button>
                    <button class="timer-btn" onclick="setTimer(10)">10分钟</button>
                    <button class="timer-btn" onclick="setTimer(15)">15分钟</button>
                    <button class="timer-btn secondary" onclick="stopTimer()">停止</button>
                </div>
            </div>
            
            <div class="breathing-guide">
                <div class="breathing-circle" id="breathingCircle">
                    吸气
                </div>
                <div class="breathing-text" id="breathingText">深呼吸</div>
                <div class="breathing-instruction">跟随圆圈的大小调整呼吸节奏</div>
            </div>
            
            <div class="meditation-tips">
                <div class="tips-header">冥想小贴士</div>
                <ul class="tips-list">
                    <li><i class="fas fa-check"></i> 每天坚持练习，即使只有5分钟</li>
                    <li><i class="fas fa-check"></i> 不要对自己要求过高，冥想是一个渐进的过程</li>
                    <li><i class="fas fa-check"></i> 可以尝试不同的冥想技巧，找到适合自己的方式</li>
                    <li><i class="fas fa-check"></i> 记录冥想体验，观察自己的进步</li>
                    <li><i class="fas fa-check"></i> 在压力大时，冥想可以帮助恢复平静</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 音频播放器功能
let currentTrack = 0;
let isPlaying = false;
let timerInterval = null;
let breathingInterval = null;

const tracks = [
    { src: "{% static 'audio/meditation/ambient.mp3' %}", title: "宁静氛围", duration: "10:00" },
    { src: "{% static 'audio/meditation/binaural.mp3' %}", title: "自然之声", duration: "15:00" },
    { src: "{% static 'audio/meditation/instrumental.mp3' %}", title: "深度冥想", duration: "20:00" },
    { src: "{% static 'audio/meditation/ambient.mp3' %}", title: "心灵治愈", duration: "12:00" }
];

const audioPlayer = document.getElementById('audioPlayer');
const playBtn = document.getElementById('playBtn');
const playIcon = document.getElementById('playIcon');

// 播放/暂停
function togglePlay() {
    if (isPlaying) {
        audioPlayer.pause();
        playIcon.className = 'fas fa-play';
        isPlaying = false;
    } else {
        audioPlayer.play();
        playIcon.className = 'fas fa-pause';
        isPlaying = true;
    }
}

// 播放指定曲目
function playTrack(index) {
    currentTrack = index;
    audioPlayer.src = tracks[index].src;
    audioPlayer.play();
    playIcon.className = 'fas fa-pause';
    isPlaying = true;
    
    // 更新播放列表状态
    updatePlaylist();
}

// 上一曲
function previousTrack() {
    currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
    playTrack(currentTrack);
}

// 下一曲
function nextTrack() {
    currentTrack = (currentTrack + 1) % tracks.length;
    playTrack(currentTrack);
}

// 更新播放列表状态
function updatePlaylist() {
    const items = document.querySelectorAll('.playlist-item');
    items.forEach((item, index) => {
        if (index === currentTrack) {
            item.classList.add('active');
        } else {
            item.classList.remove('active');
        }
    });
}

// 音频播放结束事件
audioPlayer.addEventListener('ended', function() {
    nextTrack();
});

// 定时器功能
function setTimer(minutes) {
    stopTimer();
    
    let timeLeft = minutes * 60;
    const timerDisplay = document.getElementById('timerDisplay');
    
    timerInterval = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        // 将秒数格式化为小数点后两位
        const formattedSeconds = seconds.toFixed(2);
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${formattedSeconds}`;
        
        if (timeLeft <= 0) {
            stopTimer();
            alert('冥想时间结束！');
            return;
        }
        
        timeLeft--;
    }, 1000);
}

function stopTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
    document.getElementById('timerDisplay').textContent = '10:00';
}

// 呼吸引导功能
function startBreathingGuide() {
    const breathingCircle = document.getElementById('breathingCircle');
    const breathingText = document.getElementById('breathingText');
    let isInhaling = true;
    
    breathingInterval = setInterval(() => {
        if (isInhaling) {
            breathingCircle.textContent = '吸气';
            breathingText.textContent = '缓慢吸气...';
            breathingCircle.style.animation = 'breathe 4s ease-in-out infinite';
        } else {
            breathingCircle.textContent = '呼气';
            breathingText.textContent = '缓慢呼气...';
            breathingCircle.style.animation = 'breathe 4s ease-in-out infinite reverse';
        }
        
        isInhaling = !isInhaling;
    }, 4000);
}

function stopBreathingGuide() {
    if (breathingInterval) {
        clearInterval(breathingInterval);
        breathingInterval = null;
    }
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    // 开始呼吸引导
    startBreathingGuide();
    
    // 设置默认音量
    audioPlayer.volume = 0.5;

});

// 页面卸载时清理定时器
window.addEventListener('beforeunload', function() {
    stopTimer();
    stopBreathingGuide();
});
</script>
{% endblock %}

