{% extends 'base.html' %}
{% load static %}

{% block title %}Âêâ‰ªñËÆ≠ÁªÉÁ≥ªÁªü - ‰ªéÂàùÂ≠¶ËÄÖÂà∞ËøõÈò∂ËÄÖ{% endblock %}

{% block extra_css %}
<style>
    .guitar-dashboard {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }
    
    .dashboard-header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
    }
    
    .dashboard-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .dashboard-header p {
        font-size: 1.2rem;
        opacity: 0.9;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-card h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.1rem;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }
    
    .practice-types-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .practice-type-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .practice-type-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    
    .practice-type-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        display: block;
    }
    
    .practice-type-card h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.3rem;
    }
    
    .practice-type-card p {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.5;
    }
    
    .difficulty-badges {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .difficulty-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        color: white;
    }
    
    .difficulty-beginner { background-color: #4CAF50; }
    .difficulty-intermediate { background-color: #FF9800; }
    .difficulty-advanced { background-color: #F44336; }
    
    .recommendations-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 30px;
    }
    
    .recommendations-section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5rem;
    }
    
    .recommendation-item {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
    }
    
    .recommendation-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }
    
    .recommendation-item h4 {
        color: #333;
        margin-bottom: 5px;
        font-size: 1.1rem;
    }
    
    .recommendation-item p {
        color: #666;
        margin-bottom: 8px;
        font-size: 0.9rem;
    }
    
    .recommendation-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8rem;
        color: #888;
    }
    
    .start-practice-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .start-practice-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .achievements-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .achievements-section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5rem;
    }
    
    .achievements-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }
    
    .achievement-item {
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        background: #f8f9fa;
        transition: all 0.3s ease;
    }
    
    .achievement-item:hover {
        background: #e9ecef;
        transform: scale(1.05);
    }
    
    .achievement-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        display: block;
    }
    
    .achievement-item h4 {
        color: #333;
        margin-bottom: 5px;
        font-size: 1rem;
    }
    
    .achievement-item p {
        color: #666;
        font-size: 0.8rem;
        margin-bottom: 5px;
    }
    
    .achievement-points {
        color: #667eea;
        font-weight: bold;
        font-size: 0.9rem;
    }
    
    .navigation-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
        flex-wrap: wrap;
    }
    
    .nav-btn {
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .nav-btn:hover {
        background: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        text-decoration: none;
        color: #333;
    }
    
    .user-level-badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        color: white;
        font-weight: bold;
        margin-bottom: 20px;
    }
    
    .level-beginner { background-color: #4CAF50; }
    .level-intermediate { background-color: #FF9800; }
    .level-advanced { background-color: #F44336; }
    
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .practice-types-grid {
            grid-template-columns: 1fr;
        }
        
        .achievements-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
        
        .dashboard-header h1 {
            font-size: 2rem;
        }
    }
    
    /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
    .chord-trainer-content {
        text-align: center;
    }
    
    .chord-display {
        margin-bottom: 20px;
    }
    
    .current-chord {
        font-size: 3rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 10px;
    }
    
    .chord-progress {
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: center;
    }
    
    .progress-bar {
        width: 200px;
        height: 10px;
        background: #e9ecef;
        border-radius: 5px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(45deg, #667eea, #764ba2);
        transition: width 0.3s ease;
    }
    
    .chord-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px;
    }
    
    .practice-plan-content {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .plan-header {
        text-align: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e9ecef;
    }
    
    .plan-item {
        display: flex;
        gap: 15px;
        padding: 15px;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        margin-bottom: 10px;
        background: #f8f9fa;
    }
    
    .plan-day {
        font-weight: bold;
        color: #667eea;
        min-width: 60px;
    }
    
    .plan-content {
        flex: 1;
    }
    
    .plan-content h6 {
        margin-bottom: 5px;
        color: #333;
    }
    
    .plan-content p {
        margin-bottom: 10px;
        color: #666;
        font-size: 0.9rem;
    }
    
    .plan-progress {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .plan-progress .progress-bar {
        width: 150px;
        height: 8px;
    }
    
    .plan-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
        flex-wrap: wrap;
    }
    
    .fretboard-placeholder {
        text-align: center;
        padding: 40px;
        background: #f8f9fa;
        border-radius: 10px;
        color: #666;
    }
    
    .fretboard-placeholder p {
        margin: 5px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="guitar-dashboard">
    <div class="dashboard-header">
        <h1>üé∏ Âêâ‰ªñËÆ≠ÁªÉÁ≥ªÁªü</h1>
        <p>‰ªéÂàùÂ≠¶ËÄÖÂà∞ËøõÈò∂ËÄÖÁöÑÂÆåÊï¥Â≠¶‰π†Âπ≥Âè∞</p>
        <div class="user-level-badge level-{{ user_level }}">
            {{ difficulty_levels|get_item:user_level|get_item:"name" }}
        </div>
    </div>

    <!-- Áî®Êà∑ÁªüËÆ° -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>ÊÄªÁªÉ‰π†Êó∂Èó¥</h3>
            <div class="stat-value">{{ user_stats.total_practice_time }}</div>
            <div class="stat-label">Â∞èÊó∂</div>
        </div>
        <div class="stat-card">
            <h3>ÁªÉ‰π†Ê¨°Êï∞</h3>
            <div class="stat-value">{{ user_stats.total_sessions }}</div>
            <div class="stat-label">Ê¨°</div>
        </div>
        <div class="stat-card">
            <h3>ËøûÁª≠ÁªÉ‰π†</h3>
            <div class="stat-value">{{ user_stats.current_streak }}</div>
            <div class="stat-label">Â§©</div>
        </div>
        <div class="stat-card">
            <h3>Âπ≥ÂùáÂáÜÁ°ÆÁéá</h3>
            <div class="stat-value">{{ user_stats.accuracy_avg }}%</div>
            <div class="stat-label">ÊúÄËøëÁªÉ‰π†</div>
        </div>
        <div class="stat-card">
            <h3>Ëé∑ÂæóÁßØÂàÜ</h3>
            <div class="stat-value">{{ user_stats.points }}</div>
            <div class="stat-label">ÊÄªÂàÜ</div>
        </div>
        <div class="stat-card">
            <h3>ÊúÄÈïøËøûÁª≠</h3>
            <div class="stat-value">{{ user_stats.longest_streak }}</div>
            <div class="stat-label">Â§©</div>
        </div>
    </div>

    <!-- ÁªÉ‰π†Á±ªÂûã -->
    <div class="practice-types-grid">
        {% for type_key, type_data in practice_types.items %}
        <div class="practice-type-card" onclick="selectPracticeType('{{ type_key }}')">
            <span class="practice-type-icon">
                {% if type_key == 'chord_progression' %}üéº
                {% elif type_key == 'fingerpicking' %}üéµ
                {% elif type_key == 'scale_practice' %}üé∂
                {% elif type_key == 'song_learning' %}üé§
                {% elif type_key == 'theory_study' %}üìö
                {% else %}üé∏{% endif %}
            </span>
            <h3>{{ type_data.name }}</h3>
            <p>{{ type_data.description }}</p>
            <div class="difficulty-badges">
                {% for difficulty in type_data.difficulty %}
                <span class="difficulty-badge difficulty-{{ difficulty }}">
                    {{ difficulty_levels|get_item:difficulty|get_item:"name" }}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Êé®ËçêÁªÉ‰π† -->
    <div class="recommendations-section">
        <h2>üéØ Êé®ËçêÁªÉ‰π†</h2>
        {% for exercise in recommended_exercises %}
        <div class="recommendation-item">
            <h4>{{ exercise.name }}</h4>
            <p>{{ exercise.description }}</p>
            <div class="recommendation-meta">
                <span>Êó∂Èïø: {{ exercise.duration }} ÂàÜÈíü</span>
                <span>ÈöæÂ∫¶: {{ difficulty_levels|get_item:exercise.difficulty|get_item:"name" }}</span>
                <button class="start-practice-btn" onclick="startPractice('{{ exercise.type }}', '{{ exercise.difficulty }}', '{{ exercise.name }}')">
                    ÂºÄÂßãÁªÉ‰π†
                </button>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- ÊàêÂ∞±Á≥ªÁªü -->
    <div class="achievements-section">
        <h2>üèÜ ÊàêÂ∞±Á≥ªÁªü</h2>
        <div class="achievements-grid">
            {% for achievement_key, achievement_data in achievements.items %}
            <div class="achievement-item">
                <span class="achievement-icon">{{ achievement_data.icon }}</span>
                <h4>{{ achievement_data.name }}</h4>
                <p>{{ achievement_data.description }}</p>
                <div class="achievement-points">+{{ achievement_data.points }} ÁßØÂàÜ</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ÂØºËà™ÊåâÈíÆ -->
    <div class="navigation-buttons">
              <a href="{% url 'tools:guitar_progress_tracking' %}" class="nav-btn">üìä ËøõÂ∫¶Ë∑üË∏™</a>
      <a href="{% url 'tools:guitar_theory_guide' %}" class="nav-btn">üìö ‰πêÁêÜÂ≠¶‰π†</a>
      <a href="{% url 'tools:guitar_song_library' %}" class="nav-btn">üéµ Ê≠åÊõ≤Â∫ì</a>
      <a href="{% url 'tools:guitar_tab_generator' %}" class="nav-btn">üéº Ëá™Âä®ÊâíË∞±</a>
        <a href="#" class="nav-btn" onclick="showPracticeHistory()">üìù ÁªÉ‰π†ÂéÜÂè≤</a>
    </div>
</div>

<!-- ÁªÉ‰π†Á±ªÂûãÈÄâÊã©Ê®°ÊÄÅÊ°Ü -->
<div class="modal fade" id="practiceTypeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ÈÄâÊã©ÁªÉ‰π†Á±ªÂûã</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="difficulty-selection">
                    <h6>ÈÄâÊã©ÈöæÂ∫¶Á≠âÁ∫ßÔºö</h6>
                    <div class="btn-group" role="group">
                        {% for difficulty_key, difficulty_data in difficulty_levels.items %}
                        <input type="radio" class="btn-check" name="difficulty" id="difficulty_{{ difficulty_key }}" value="{{ difficulty_key }}">
                        <label class="btn btn-outline-primary" for="difficulty_{{ difficulty_key }}">
                            {{ difficulty_data.name }}
                        </label>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                <button type="button" class="btn btn-primary" onclick="confirmPracticeType()">ÂºÄÂßãÁªÉ‰π†</button>
            </div>
        </div>
    </div>
</div>

<!-- ÂíåÂº¶ËÆ≠ÁªÉÂô®Ê®°ÊÄÅÊ°Ü -->
<div class="modal fade" id="chordTrainerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üéº ÂíåÂº¶ËÆ≠ÁªÉÂô®</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="chord-trainer-content">
                    <div class="chord-display">
                        <div class="current-chord" id="currentChordDisplay">C</div>
                        <div class="chord-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="chordProgressFill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">ÂáÜÁ°ÆÁéá: <span id="chordAccuracy">0%</span></span>
                        </div>
                    </div>
                    <div class="fretboard-display" id="fretboardDisplay">
                        <!-- ÊåáÊùøÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                        <div class="fretboard-placeholder">
                            <p>3DÊåáÊùøÊºîÁ§∫Âå∫Âüü</p>
                            <p>ÁÇπÂáªÂºÄÂßãËÆ≠ÁªÉÊåâÈíÆÂºÄÂßãÁªÉ‰π†</p>
                        </div>
                    </div>
                    <div class="chord-controls">
                        <button class="btn btn-primary" onclick="startChordTraining()">ÂºÄÂßãËÆ≠ÁªÉ</button>
                        <button class="btn btn-secondary" onclick="nextChord()">‰∏ã‰∏Ä‰∏™ÂíåÂº¶</button>
                        <button class="btn btn-info" onclick="showChordHeatmap()">ÁÉ≠ÂäõÂõæ</button>
                        <button class="btn btn-warning" onclick="resetChordTraining()">ÈáçÁΩÆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ÁªÉ‰π†ËÆ°ÂàíÊ®°ÊÄÅÊ°Ü -->
<div class="modal fade" id="practicePlanModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üìÖ ‰∏™ÊÄßÂåñÁªÉ‰π†ËÆ°Âàí</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="practice-plan-content">
                    <div class="plan-header">
                        <h6>‰∏§Âë®ÁªÉ‰π†ËÆ°Âàí</h6>
                        <p>Âü∫‰∫éÊÇ®ÁöÑÊ∞¥Âπ≥ÂíåËøõÂ∫¶ÁîüÊàêÁöÑ‰∏™ÊÄßÂåñËÆ°Âàí</p>
                    </div>
                    <div class="plan-list" id="planList">
                        <!-- ÁªÉ‰π†ËÆ°ÂàíÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                        <div class="plan-item">
                            <div class="plan-day">Á¨¨1Â§©</div>
                            <div class="plan-content">
                                <h6>ÂíåÂº¶ËΩ¨Êç¢ÁªÉ‰π†</h6>
                                <p>ÁªÉ‰π†C„ÄÅG„ÄÅAm„ÄÅFÂíåÂº¶ÁöÑËΩ¨Êç¢ÔºåÊØè‰∏™ÂíåÂº¶ÁªÉ‰π†5ÂàÜÈíü</p>
                                <div class="plan-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 0%"></div>
                                    </div>
                                    <span>0% ÂÆåÊàê</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="plan-controls">
                        <button class="btn btn-primary" onclick="generatePracticePlan()">ÁîüÊàêÊñ∞ËÆ°Âàí</button>
                        <button class="btn btn-secondary" onclick="updateProgress()">Êõ¥Êñ∞ËøõÂ∫¶</button>
                        <button class="btn btn-info" onclick="showProgressChart()">ËøõÊ≠•Êõ≤Á∫ø</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let selectedPracticeType = '';
let selectedDifficulty = 'beginner';

function selectPracticeType(type) {
    selectedPracticeType = type;
    const modal = new bootstrap.Modal(document.getElementById('practiceTypeModal'));
    modal.show();
}

function confirmPracticeType() {
    if (selectedPracticeType && selectedDifficulty) {
        window.location.href = `/tools/guitar-practice/${selectedPracticeType}/${selectedDifficulty}/`;
    }
}

function startPractice(type, difficulty, exerciseName) {
    // Áõ¥Êé•ÂºÄÂßãÁªÉ‰π†
    window.location.href = `/tools/guitar-practice/${type}/${difficulty}/?exercise=${encodeURIComponent(exerciseName)}`;
}

function showPracticeHistory() {
    // ÊòæÁ§∫ÁªÉ‰π†ÂéÜÂè≤
    window.location.href = "{% url 'tools:guitar_progress_tracking' %}";
}

// ÁõëÂê¨ÈöæÂ∫¶ÈÄâÊã©
document.addEventListener('DOMContentLoaded', function() {
    const difficultyRadios = document.querySelectorAll('input[name="difficulty"]');
    difficultyRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            selectedDifficulty = this.value;
        });
    });
    
    // ÈªòËÆ§ÈÄâÊã©Áî®Êà∑ÂΩìÂâçÁ≠âÁ∫ß
    const userLevel = '{{ user_level }}';
    const defaultRadio = document.getElementById('difficulty_' + userLevel);
    if (defaultRadio) {
        defaultRadio.checked = true;
        selectedDifficulty = userLevel;
    }
});

// Ê∑ªÂä†‰∏Ä‰∫õÂä®ÁîªÊïàÊûú
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.stat-card, .practice-type-card, .recommendation-item');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});

// ÂíåÂº¶ËÆ≠ÁªÉÂô®ÂäüËÉΩ
function toggleChordTrainer() {
    // Ë∑≥ËΩ¨Âà∞ÂíåÂº¶ËÆ≠ÁªÉÈ°µÈù¢ÊàñÊòæÁ§∫ÂíåÂº¶ËÆ≠ÁªÉÊ®°ÊÄÅÊ°Ü
    const modal = new bootstrap.Modal(document.getElementById('chordTrainerModal'));
    modal.show();
}

// ÊûÅÁÆÄÊ®°ÂºèÂäüËÉΩ
function enterMinimalMode() {
    // ËøõÂÖ•ÂÖ®Â±èÁªÉ‰π†Ê®°Âºè
    if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
    }
    
    // ÊòæÁ§∫ÊûÅÁÆÄÊ®°ÂºèÁïåÈù¢
    showMinimalMode();
}

// ÁªÉ‰π†ËÆ°ÂàíÂäüËÉΩ
function togglePracticePlan() {
    // ÊòæÁ§∫ÁªÉ‰π†ËÆ°ÂàíÊ®°ÊÄÅÊ°Ü
    const modal = new bootstrap.Modal(document.getElementById('practicePlanModal'));
    modal.show();
}

// ÊòæÁ§∫ÊûÅÁÆÄÊ®°Âºè
function showMinimalMode() {
    // ÂàõÂª∫ÊûÅÁÆÄÊ®°ÂºèÁïåÈù¢
    const minimalMode = document.createElement('div');
    minimalMode.id = 'minimalMode';
    minimalMode.innerHTML = `
        <div class="minimal-mode-overlay">
            <div class="minimal-mode-content">
                <div class="minimal-fretboard" id="minimalFretboard">
                    <!-- ÊûÅÁÆÄÊåáÊùø -->
                </div>
                <div class="minimal-metronome">
                    <div class="bpm-display" id="minimalBPM">120</div>
                    <button class="minimal-btn" onclick="toggleMinimalMetronome()">ËäÇÊãçÂô®</button>
                </div>
                <button class="minimal-exit-btn" onclick="exitMinimalMode()">ÈÄÄÂá∫</button>
            </div>
        </div>
    `;
    
    // Ê∑ªÂä†ÊûÅÁÆÄÊ®°ÂºèÊ†∑Âºè
    const style = document.createElement('style');
    style.textContent = `
        .minimal-mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .minimal-mode-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .minimal-fretboard {
            width: 80%;
            height: 60%;
            background: #333;
            border: 2px solid #666;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .minimal-metronome {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .bpm-display {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .minimal-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .minimal-exit-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
    `;
    
    document.head.appendChild(style);
    document.body.appendChild(minimalMode);
}

// ÈÄÄÂá∫ÊûÅÁÆÄÊ®°Âºè
function exitMinimalMode() {
    const minimalMode = document.getElementById('minimalMode');
    if (minimalMode) {
        minimalMode.remove();
    }
    
    if (document.fullscreenElement) {
        document.exitFullscreen();
    }
}

// ÊûÅÁÆÄÊ®°ÂºèËäÇÊãçÂô®
let minimalMetronomeActive = false;
let minimalMetronomeInterval;

function toggleMinimalMetronome() {
    if (minimalMetronomeActive) {
        stopMinimalMetronome();
    } else {
        startMinimalMetronome();
    }
}

function startMinimalMetronome() {
    const bpmDisplay = document.getElementById('minimalBPM');
    const bpm = parseInt(bpmDisplay.textContent);
    const interval = 60000 / bpm;
    
    minimalMetronomeInterval = setInterval(() => {
        // Êí≠ÊîæËäÇÊãçÂ£∞Èü≥
        playMetronomeSound();
    }, interval);
    
    minimalMetronomeActive = true;
}

function stopMinimalMetronome() {
    if (minimalMetronomeInterval) {
        clearInterval(minimalMetronomeInterval);
        minimalMetronomeActive = false;
    }
}

function playMetronomeSound() {
    // ÂàõÂª∫Èü≥È¢ë‰∏ä‰∏ãÊñáÊí≠ÊîæËäÇÊãçÂ£∞Èü≥
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
}

// ÂíåÂº¶ËÆ≠ÁªÉÂô®Áõ∏ÂÖ≥ÂáΩÊï∞
let chordTrainingActive = false;
let currentChordIndex = 0;
let chordAccuracy = 0;
let chordAttempts = 0;

const chordLibrary = [
    { name: 'C', fingers: [[1, 1], [2, 2], [3, 3]], difficulty: 'beginner' },
    { name: 'G', fingers: [[1, 3], [2, 2], [3, 1], [6, 3]], difficulty: 'beginner' },
    { name: 'Am', fingers: [[1, 1], [2, 2], [3, 3]], difficulty: 'beginner' },
    { name: 'F', fingers: [[1, 1], [2, 1], [3, 2], [4, 3]], difficulty: 'intermediate' },
    { name: 'D', fingers: [[1, 2], [2, 3], [3, 2]], difficulty: 'beginner' },
    { name: 'Em', fingers: [[1, 2], [2, 3]], difficulty: 'beginner' },
    { name: 'Bm', fingers: [[1, 2], [2, 3], [3, 4], [4, 4]], difficulty: 'intermediate' },
    { name: 'A', fingers: [[1, 2], [2, 2], [3, 2]], difficulty: 'beginner' },
    { name: 'E', fingers: [[1, 1], [2, 1], [3, 2], [4, 2]], difficulty: 'beginner' },
    { name: 'Dm', fingers: [[1, 1], [2, 3], [3, 2]], difficulty: 'beginner' }
];

function startChordTraining() {
    chordTrainingActive = true;
    currentChordIndex = 0;
    chordAccuracy = 0;
    chordAttempts = 0;
    
    displayCurrentChord();
    updateChordProgress();
    
    // ÊòæÁ§∫ÊåáÊùø
    displayFretboard();
    
    // ÂºÄÂßãÈü≥È¢ëÊ£ÄÊµãÔºàÊ®°ÊãüÔºâ
    startAudioDetection();
}

function nextChord() {
    if (currentChordIndex < chordLibrary.length - 1) {
        currentChordIndex++;
        displayCurrentChord();
        updateChordProgress();
    } else {
        // ËÆ≠ÁªÉÂÆåÊàê
        completeChordTraining();
    }
}

function displayCurrentChord() {
    const chordDisplay = document.getElementById('currentChordDisplay');
    const currentChord = chordLibrary[currentChordIndex];
    chordDisplay.textContent = currentChord.name;
}

function displayFretboard() {
    const fretboardDisplay = document.getElementById('fretboardDisplay');
    const currentChord = chordLibrary[currentChordIndex];
    
    // ÂàõÂª∫ÊåáÊùøHTML
    let fretboardHTML = '<div class="fretboard">';
    fretboardHTML += '<div class="fretboard-strings">';
    for (let string = 1; string <= 6; string++) {
        fretboardHTML += `<div class="string string-${string}"></div>`;
    }
    fretboardHTML += '</div>';
    
    fretboardHTML += '<div class="fretboard-frets">';
    for (let fret = 0; fret <= 5; fret++) {
        fretboardHTML += `<div class="fret fret-${fret}">`;
        for (let string = 1; string <= 6; string++) {
            const finger = currentChord.fingers.find(f => f[0] === string);
            if (finger && finger[1] === fret) {
                fretboardHTML += `<div class="finger-position" data-string="${string}" data-fret="${fret}"></div>`;
            } else {
                fretboardHTML += `<div class="fret-position" data-string="${string}" data-fret="${fret}"></div>`;
            }
        }
        fretboardHTML += '</div>';
    }
    fretboardHTML += '</div></div>';
    
    fretboardDisplay.innerHTML = fretboardHTML;
    
    // Ê∑ªÂä†ÊåáÊùøÊ†∑Âºè
    const style = document.createElement('style');
    style.textContent = `
        .fretboard {
            width: 100%;
            height: 200px;
            background: #2c3e50;
            border-radius: 10px;
            position: relative;
            margin: 20px 0;
        }
        
        .fretboard-strings {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .string {
            flex: 1;
            border-bottom: 1px solid #34495e;
        }
        
        .fretboard-frets {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
        }
        
        .fret {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #34495e;
        }
        
        .fret-position {
            flex: 1;
            border-bottom: 1px solid #34495e;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .fret-position:hover {
            background: rgba(52, 152, 219, 0.3);
        }
        
        .finger-position {
            flex: 1;
            background: #3498db;
            border-radius: 50%;
            margin: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    `;
    
    if (!document.getElementById('fretboardStyle')) {
        style.id = 'fretboardStyle';
        document.head.appendChild(style);
    }
}

function startAudioDetection() {
    // Ê®°ÊãüÈü≥È¢ëÊ£ÄÊµã

    // ËøôÈáåÂ∫îËØ•ÈõÜÊàêÁúüÂÆûÁöÑÈü≥È¢ëÊ£ÄÊµãÂäüËÉΩ
}

function showChordHeatmap() {
    // ÊòæÁ§∫ÂíåÂº¶ÁÉ≠ÂäõÂõæ
    alert('ÁÉ≠ÂäõÂõæÂäüËÉΩÔºöÊòæÁ§∫ÊÇ®ÊúÄÂ∏∏ÁªÉ‰π†ÁöÑÂíåÂº¶‰ΩçÁΩÆ');
}

function resetChordTraining() {
    chordTrainingActive = false;
    currentChordIndex = 0;
    chordAccuracy = 0;
    chordAttempts = 0;
    
    updateChordProgress();
    displayCurrentChord();
}

function updateChordProgress() {
    const progressFill = document.getElementById('chordProgressFill');
    const accuracyDisplay = document.getElementById('chordAccuracy');
    
    const progress = (currentChordIndex / chordLibrary.length) * 100;
    progressFill.style.width = progress + '%';
    accuracyDisplay.textContent = chordAccuracy + '%';
}

function completeChordTraining() {
    chordTrainingActive = false;
    alert(`ÂíåÂº¶ËÆ≠ÁªÉÂÆåÊàêÔºÅ\nÂáÜÁ°ÆÁéá: ${chordAccuracy}%\nÁªÉ‰π†ÂíåÂº¶Êï∞: ${chordLibrary.length}`);
}

// ÁªÉ‰π†ËÆ°ÂàíÁõ∏ÂÖ≥ÂáΩÊï∞
function generatePracticePlan() {
    const planList = document.getElementById('planList');
    
    const plans = [
        { day: 'Á¨¨1Â§©', title: 'ÂíåÂº¶ËΩ¨Êç¢ÁªÉ‰π†', content: 'ÁªÉ‰π†C„ÄÅG„ÄÅAm„ÄÅFÂíåÂº¶ÁöÑËΩ¨Êç¢ÔºåÊØè‰∏™ÂíåÂº¶ÁªÉ‰π†5ÂàÜÈíü' },
        { day: 'Á¨¨2Â§©', title: 'ÊåáÂºπÁªÉ‰π†', content: 'ÁªÉ‰π†Âü∫Êú¨ÁöÑÊåáÂºπÊ®°ÂºèÔºåPIMAÊåáÊ≥ïÁªÉ‰π†' },
        { day: 'Á¨¨3Â§©', title: 'Èü≥Èò∂ÁªÉ‰π†', content: 'ÁªÉ‰π†CÂ§ßË∞ÉÈü≥Èò∂Ôºå‰∏ä‰∏ãË°åÂêÑ10ÈÅç' },
        { day: 'Á¨¨4Â§©', title: 'Ê≠åÊõ≤Â≠¶‰π†', content: 'Â≠¶‰π†‰∏ÄÈ¶ñÁÆÄÂçïÁöÑÊ≠åÊõ≤ÔºåÁªÉ‰π†ÂíåÂº¶ËøõË°å' },
        { day: 'Á¨¨5Â§©', title: 'ËäÇÂ•èËÆ≠ÁªÉ', content: '‰ΩøÁî®ËäÇÊãçÂô®ÁªÉ‰π†Âü∫Êú¨ËäÇÂ•èÂûã' },
        { day: 'Á¨¨6Â§©', title: '‰πêÁêÜÂ≠¶‰π†', content: 'Â≠¶‰π†Âü∫Êú¨‰πêÁêÜÁü•ËØÜÔºåÈü≥Á¨¶ÂíåËäÇÊãç' },
        { day: 'Á¨¨7Â§©', title: 'ÁªºÂêàÁªÉ‰π†', content: 'Â§ç‰π†Ââç6Â§©ÁöÑÂÜÖÂÆπÔºåÁªºÂêàÁªÉ‰π†' }
    ];
    
    let planHTML = '';
    plans.forEach(plan => {
        planHTML += `
            <div class="plan-item">
                <div class="plan-day">${plan.day}</div>
                <div class="plan-content">
                    <h6>${plan.title}</h6>
                    <p>${plan.content}</p>
                    <div class="plan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span>0% ÂÆåÊàê</span>
                    </div>
                </div>
            </div>
        `;
    });
    
    planList.innerHTML = planHTML;
}

function updateProgress() {
    // Êõ¥Êñ∞ÁªÉ‰π†ËøõÂ∫¶
    alert('ËøõÂ∫¶Êõ¥Êñ∞ÂäüËÉΩÔºöËÆ∞ÂΩïÊÇ®ÁöÑÁªÉ‰π†ËøõÂ∫¶');
}

function showProgressChart() {
    // ÊòæÁ§∫ËøõÊ≠•Êõ≤Á∫øÂõæ
    alert('ËøõÊ≠•Êõ≤Á∫øÂäüËÉΩÔºöÊòæÁ§∫ÊÇ®ÁöÑÂ≠¶‰π†ËøõÂ∫¶ÂõæË°®');
}
</script>
{% endblock %}
