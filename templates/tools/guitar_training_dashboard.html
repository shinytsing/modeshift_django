{% extends 'base.html' %}
{% load static %}

{% block title %}å‰ä»–è®­ç»ƒç³»ç»Ÿ - ä»åˆå­¦è€…åˆ°è¿›é˜¶è€…{% endblock %}

{% block extra_css %}
<style>
    .guitar-dashboard {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }
    
    .dashboard-header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
    }
    
    .dashboard-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .dashboard-header p {
        font-size: 1.2rem;
        opacity: 0.9;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-card h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.1rem;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }
    
    .practice-types-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .practice-type-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .practice-type-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    
    .practice-type-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        display: block;
    }
    
    .practice-type-card h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.3rem;
    }
    
    .practice-type-card p {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.5;
    }
    
    .difficulty-badges {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .difficulty-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        color: white;
    }
    
    .difficulty-beginner { background-color: #4CAF50; }
    .difficulty-intermediate { background-color: #FF9800; }
    .difficulty-advanced { background-color: #F44336; }
    
    .recommendations-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 30px;
    }
    
    .recommendations-section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5rem;
    }
    
    .recommendation-item {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
    }
    
    .recommendation-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }
    
    .recommendation-item h4 {
        color: #333;
        margin-bottom: 5px;
        font-size: 1.1rem;
    }
    
    .recommendation-item p {
        color: #666;
        margin-bottom: 8px;
        font-size: 0.9rem;
    }
    
    .recommendation-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8rem;
        color: #888;
    }
    
    .start-practice-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .start-practice-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .achievements-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .achievements-section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5rem;
    }
    
    .achievements-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }
    
    .achievement-item {
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        background: #f8f9fa;
        transition: all 0.3s ease;
    }
    
    .achievement-item:hover {
        background: #e9ecef;
        transform: scale(1.05);
    }
    
    .achievement-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        display: block;
    }
    
    .achievement-item h4 {
        color: #333;
        margin-bottom: 5px;
        font-size: 1rem;
    }
    
    .achievement-item p {
        color: #666;
        font-size: 0.8rem;
        margin-bottom: 5px;
    }
    
    .achievement-points {
        color: #667eea;
        font-weight: bold;
        font-size: 0.9rem;
    }
    
    .navigation-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
        flex-wrap: wrap;
    }
    
    .nav-btn {
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .nav-btn:hover {
        background: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        text-decoration: none;
        color: #333;
    }
    
    .user-level-badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        color: white;
        font-weight: bold;
        margin-bottom: 20px;
    }
    
    .level-beginner { background-color: #4CAF50; }
    .level-intermediate { background-color: #FF9800; }
    .level-advanced { background-color: #F44336; }
    
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .practice-types-grid {
            grid-template-columns: 1fr;
        }
        
        .achievements-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
        
        .dashboard-header h1 {
            font-size: 2rem;
        }
    }
    
    /* æ¨¡æ€æ¡†æ ·å¼ */
    .chord-trainer-content {
        text-align: center;
    }
    
    .chord-display {
        margin-bottom: 20px;
    }
    
    .current-chord {
        font-size: 3rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 10px;
    }
    
    .chord-progress {
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: center;
    }
    
    .progress-bar {
        width: 200px;
        height: 10px;
        background: #e9ecef;
        border-radius: 5px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(45deg, #667eea, #764ba2);
        transition: width 0.3s ease;
    }
    
    .chord-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px;
    }
    
    .practice-plan-content {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .plan-header {
        text-align: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e9ecef;
    }
    
    .plan-item {
        display: flex;
        gap: 15px;
        padding: 15px;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        margin-bottom: 10px;
        background: #f8f9fa;
    }
    
    .plan-day {
        font-weight: bold;
        color: #667eea;
        min-width: 60px;
    }
    
    .plan-content {
        flex: 1;
    }
    
    .plan-content h6 {
        margin-bottom: 5px;
        color: #333;
    }
    
    .plan-content p {
        margin-bottom: 10px;
        color: #666;
        font-size: 0.9rem;
    }
    
    .plan-progress {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .plan-progress .progress-bar {
        width: 150px;
        height: 8px;
    }
    
    .plan-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
        flex-wrap: wrap;
    }
    
    .fretboard-placeholder {
        text-align: center;
        padding: 40px;
        background: #f8f9fa;
        border-radius: 10px;
        color: #666;
    }
    
    .fretboard-placeholder p {
        margin: 5px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="guitar-dashboard">
    <div class="dashboard-header">
        <h1>ğŸ¸ å‰ä»–è®­ç»ƒç³»ç»Ÿ</h1>
        <p>ä»åˆå­¦è€…åˆ°è¿›é˜¶è€…çš„å®Œæ•´å­¦ä¹ å¹³å°</p>
        <div class="user-level-badge level-{{ user_level }}">
            {{ difficulty_levels|get_item:user_level|get_item:"name" }}
        </div>
    </div>

    <!-- ç”¨æˆ·ç»Ÿè®¡ -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>æ€»ç»ƒä¹ æ—¶é—´</h3>
            <div class="stat-value">{{ user_stats.total_practice_time }}</div>
            <div class="stat-label">å°æ—¶</div>
        </div>
        <div class="stat-card">
            <h3>ç»ƒä¹ æ¬¡æ•°</h3>
            <div class="stat-value">{{ user_stats.total_sessions }}</div>
            <div class="stat-label">æ¬¡</div>
        </div>
        <div class="stat-card">
            <h3>è¿ç»­ç»ƒä¹ </h3>
            <div class="stat-value">{{ user_stats.current_streak }}</div>
            <div class="stat-label">å¤©</div>
        </div>
        <div class="stat-card">
            <h3>å¹³å‡å‡†ç¡®ç‡</h3>
            <div class="stat-value">{{ user_stats.accuracy_avg }}%</div>
            <div class="stat-label">æœ€è¿‘ç»ƒä¹ </div>
        </div>
        <div class="stat-card">
            <h3>è·å¾—ç§¯åˆ†</h3>
            <div class="stat-value">{{ user_stats.points }}</div>
            <div class="stat-label">æ€»åˆ†</div>
        </div>
        <div class="stat-card">
            <h3>æœ€é•¿è¿ç»­</h3>
            <div class="stat-value">{{ user_stats.longest_streak }}</div>
            <div class="stat-label">å¤©</div>
        </div>
    </div>

    <!-- ç»ƒä¹ ç±»å‹ -->
    <div class="practice-types-grid">
        {% for type_key, type_data in practice_types.items %}
        <div class="practice-type-card" onclick="selectPracticeType('{{ type_key }}')">
            <span class="practice-type-icon">
                {% if type_key == 'chord_progression' %}ğŸ¼
                {% elif type_key == 'fingerpicking' %}ğŸµ
                {% elif type_key == 'scale_practice' %}ğŸ¶
                {% elif type_key == 'song_learning' %}ğŸ¤
                {% elif type_key == 'theory_study' %}ğŸ“š
                {% else %}ğŸ¸{% endif %}
            </span>
            <h3>{{ type_data.name }}</h3>
            <p>{{ type_data.description }}</p>
            <div class="difficulty-badges">
                {% for difficulty in type_data.difficulty %}
                <span class="difficulty-badge difficulty-{{ difficulty }}">
                    {{ difficulty_levels|get_item:difficulty|get_item:"name" }}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- æ¨èç»ƒä¹  -->
    <div class="recommendations-section">
        <h2>ğŸ¯ æ¨èç»ƒä¹ </h2>
        {% for exercise in recommended_exercises %}
        <div class="recommendation-item">
            <h4>{{ exercise.name }}</h4>
            <p>{{ exercise.description }}</p>
            <div class="recommendation-meta">
                <span>æ—¶é•¿: {{ exercise.duration }} åˆ†é’Ÿ</span>
                <span>éš¾åº¦: {{ difficulty_levels|get_item:exercise.difficulty|get_item:"name" }}</span>
                <button class="start-practice-btn" onclick="startPractice('{{ exercise.type }}', '{{ exercise.difficulty }}', '{{ exercise.name }}')">
                    å¼€å§‹ç»ƒä¹ 
                </button>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- æˆå°±ç³»ç»Ÿ -->
    <div class="achievements-section">
        <h2>ğŸ† æˆå°±ç³»ç»Ÿ</h2>
        <div class="achievements-grid">
            {% for achievement_key, achievement_data in achievements.items %}
            <div class="achievement-item">
                <span class="achievement-icon">{{ achievement_data.icon }}</span>
                <h4>{{ achievement_data.name }}</h4>
                <p>{{ achievement_data.description }}</p>
                <div class="achievement-points">+{{ achievement_data.points }} ç§¯åˆ†</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div class="navigation-buttons">
              <a href="{% url 'tools:guitar_progress_tracking' %}" class="nav-btn">ğŸ“Š è¿›åº¦è·Ÿè¸ª</a>
      <a href="{% url 'tools:guitar_theory_guide' %}" class="nav-btn">ğŸ“š ä¹ç†å­¦ä¹ </a>
      <a href="{% url 'tools:guitar_song_library' %}" class="nav-btn">ğŸµ æ­Œæ›²åº“</a>
      <a href="{% url 'tools:guitar_tab_generator' %}" class="nav-btn">ğŸ¼ è‡ªåŠ¨æ‰’è°±</a>
        <a href="#" class="nav-btn" onclick="showPracticeHistory()">ğŸ“ ç»ƒä¹ å†å²</a>
    </div>
</div>

<!-- ç»ƒä¹ ç±»å‹é€‰æ‹©æ¨¡æ€æ¡† -->
<div class="modal fade" id="practiceTypeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">é€‰æ‹©ç»ƒä¹ ç±»å‹</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="difficulty-selection">
                    <h6>é€‰æ‹©éš¾åº¦ç­‰çº§ï¼š</h6>
                    <div class="btn-group" role="group">
                        {% for difficulty_key, difficulty_data in difficulty_levels.items %}
                        <input type="radio" class="btn-check" name="difficulty" id="difficulty_{{ difficulty_key }}" value="{{ difficulty_key }}">
                        <label class="btn btn-outline-primary" for="difficulty_{{ difficulty_key }}">
                            {{ difficulty_data.name }}
                        </label>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" onclick="confirmPracticeType()">å¼€å§‹ç»ƒä¹ </button>
            </div>
        </div>
    </div>
</div>

<!-- å’Œå¼¦è®­ç»ƒå™¨æ¨¡æ€æ¡† -->
<div class="modal fade" id="chordTrainerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ğŸ¼ å’Œå¼¦è®­ç»ƒå™¨</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="chord-trainer-content">
                    <div class="chord-display">
                        <div class="current-chord" id="currentChordDisplay">C</div>
                        <div class="chord-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="chordProgressFill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">å‡†ç¡®ç‡: <span id="chordAccuracy">0%</span></span>
                        </div>
                    </div>
                    <div class="fretboard-display" id="fretboardDisplay">
                        <!-- æŒ‡æ¿å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        <div class="fretboard-placeholder">
                            <p>3DæŒ‡æ¿æ¼”ç¤ºåŒºåŸŸ</p>
                            <p>ç‚¹å‡»å¼€å§‹è®­ç»ƒæŒ‰é’®å¼€å§‹ç»ƒä¹ </p>
                        </div>
                    </div>
                    <div class="chord-controls">
                        <button class="btn btn-primary" onclick="startChordTraining()">å¼€å§‹è®­ç»ƒ</button>
                        <button class="btn btn-secondary" onclick="nextChord()">ä¸‹ä¸€ä¸ªå’Œå¼¦</button>
                        <button class="btn btn-info" onclick="showChordHeatmap()">çƒ­åŠ›å›¾</button>
                        <button class="btn btn-warning" onclick="resetChordTraining()">é‡ç½®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ç»ƒä¹ è®¡åˆ’æ¨¡æ€æ¡† -->
<div class="modal fade" id="practicePlanModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ğŸ“… ä¸ªæ€§åŒ–ç»ƒä¹ è®¡åˆ’</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="practice-plan-content">
                    <div class="plan-header">
                        <h6>ä¸¤å‘¨ç»ƒä¹ è®¡åˆ’</h6>
                        <p>åŸºäºæ‚¨çš„æ°´å¹³å’Œè¿›åº¦ç”Ÿæˆçš„ä¸ªæ€§åŒ–è®¡åˆ’</p>
                    </div>
                    <div class="plan-list" id="planList">
                        <!-- ç»ƒä¹ è®¡åˆ’å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        <div class="plan-item">
                            <div class="plan-day">ç¬¬1å¤©</div>
                            <div class="plan-content">
                                <h6>å’Œå¼¦è½¬æ¢ç»ƒä¹ </h6>
                                <p>ç»ƒä¹ Cã€Gã€Amã€Få’Œå¼¦çš„è½¬æ¢ï¼Œæ¯ä¸ªå’Œå¼¦ç»ƒä¹ 5åˆ†é’Ÿ</p>
                                <div class="plan-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 0%"></div>
                                    </div>
                                    <span>0% å®Œæˆ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="plan-controls">
                        <button class="btn btn-primary" onclick="generatePracticePlan()">ç”Ÿæˆæ–°è®¡åˆ’</button>
                        <button class="btn btn-secondary" onclick="updateProgress()">æ›´æ–°è¿›åº¦</button>
                        <button class="btn btn-info" onclick="showProgressChart()">è¿›æ­¥æ›²çº¿</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let selectedPracticeType = '';
let selectedDifficulty = 'beginner';

function selectPracticeType(type) {
    selectedPracticeType = type;
    const modal = new bootstrap.Modal(document.getElementById('practiceTypeModal'));
    modal.show();
}

function confirmPracticeType() {
    if (selectedPracticeType && selectedDifficulty) {
        window.location.href = `/tools/guitar-practice/${selectedPracticeType}/${selectedDifficulty}/`;
    }
}

function startPractice(type, difficulty, exerciseName) {
    // ç›´æ¥å¼€å§‹ç»ƒä¹ 
    window.location.href = `/tools/guitar-practice/${type}/${difficulty}/?exercise=${encodeURIComponent(exerciseName)}`;
}

function showPracticeHistory() {
    // æ˜¾ç¤ºç»ƒä¹ å†å²
    window.location.href = "{% url 'tools:guitar_progress_tracking' %}";
}

// ç›‘å¬éš¾åº¦é€‰æ‹©
document.addEventListener('DOMContentLoaded', function() {
    const difficultyRadios = document.querySelectorAll('input[name="difficulty"]');
    difficultyRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            selectedDifficulty = this.value;
        });
    });
    
    // é»˜è®¤é€‰æ‹©ç”¨æˆ·å½“å‰ç­‰çº§
    const userLevel = '{{ user_level }}';
    const defaultRadio = document.getElementById('difficulty_' + userLevel);
    if (defaultRadio) {
        defaultRadio.checked = true;
        selectedDifficulty = userLevel;
    }
});

// æ·»åŠ ä¸€äº›åŠ¨ç”»æ•ˆæœ
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.stat-card, .practice-type-card, .recommendation-item');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});

// å’Œå¼¦è®­ç»ƒå™¨åŠŸèƒ½
function toggleChordTrainer() {
    // è·³è½¬åˆ°å’Œå¼¦è®­ç»ƒé¡µé¢æˆ–æ˜¾ç¤ºå’Œå¼¦è®­ç»ƒæ¨¡æ€æ¡†
    const modal = new bootstrap.Modal(document.getElementById('chordTrainerModal'));
    modal.show();
}

// æç®€æ¨¡å¼åŠŸèƒ½
function enterMinimalMode() {
    // è¿›å…¥å…¨å±ç»ƒä¹ æ¨¡å¼
    if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
    }
    
    // æ˜¾ç¤ºæç®€æ¨¡å¼ç•Œé¢
    showMinimalMode();
}

// ç»ƒä¹ è®¡åˆ’åŠŸèƒ½
function togglePracticePlan() {
    // æ˜¾ç¤ºç»ƒä¹ è®¡åˆ’æ¨¡æ€æ¡†
    const modal = new bootstrap.Modal(document.getElementById('practicePlanModal'));
    modal.show();
}

// æ˜¾ç¤ºæç®€æ¨¡å¼
function showMinimalMode() {
    // åˆ›å»ºæç®€æ¨¡å¼ç•Œé¢
    const minimalMode = document.createElement('div');
    minimalMode.id = 'minimalMode';
    minimalMode.innerHTML = `
        <div class="minimal-mode-overlay">
            <div class="minimal-mode-content">
                <div class="minimal-fretboard" id="minimalFretboard">
                    <!-- æç®€æŒ‡æ¿ -->
                </div>
                <div class="minimal-metronome">
                    <div class="bpm-display" id="minimalBPM">120</div>
                    <button class="minimal-btn" onclick="toggleMinimalMetronome()">èŠ‚æ‹å™¨</button>
                </div>
                <button class="minimal-exit-btn" onclick="exitMinimalMode()">é€€å‡º</button>
            </div>
        </div>
    `;
    
    // æ·»åŠ æç®€æ¨¡å¼æ ·å¼
    const style = document.createElement('style');
    style.textContent = `
        .minimal-mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .minimal-mode-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .minimal-fretboard {
            width: 80%;
            height: 60%;
            background: #333;
            border: 2px solid #666;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .minimal-metronome {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .bpm-display {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .minimal-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .minimal-exit-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
    `;
    
    document.head.appendChild(style);
    document.body.appendChild(minimalMode);
}

// é€€å‡ºæç®€æ¨¡å¼
function exitMinimalMode() {
    const minimalMode = document.getElementById('minimalMode');
    if (minimalMode) {
        minimalMode.remove();
    }
    
    if (document.fullscreenElement) {
        document.exitFullscreen();
    }
}

// æç®€æ¨¡å¼èŠ‚æ‹å™¨
let minimalMetronomeActive = false;
let minimalMetronomeInterval;

function toggleMinimalMetronome() {
    if (minimalMetronomeActive) {
        stopMinimalMetronome();
    } else {
        startMinimalMetronome();
    }
}

function startMinimalMetronome() {
    const bpmDisplay = document.getElementById('minimalBPM');
    const bpm = parseInt(bpmDisplay.textContent);
    const interval = 60000 / bpm;
    
    minimalMetronomeInterval = setInterval(() => {
        // æ’­æ”¾èŠ‚æ‹å£°éŸ³
        playMetronomeSound();
    }, interval);
    
    minimalMetronomeActive = true;
}

function stopMinimalMetronome() {
    if (minimalMetronomeInterval) {
        clearInterval(minimalMetronomeInterval);
        minimalMetronomeActive = false;
    }
}

function playMetronomeSound() {
    // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡æ’­æ”¾èŠ‚æ‹å£°éŸ³
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
}

// å’Œå¼¦è®­ç»ƒå™¨ç›¸å…³å‡½æ•°
let chordTrainingActive = false;
let currentChordIndex = 0;
let chordAccuracy = 0;
let chordAttempts = 0;

const chordLibrary = [
    { name: 'C', fingers: [[1, 1], [2, 2], [3, 3]], difficulty: 'beginner' },
    { name: 'G', fingers: [[1, 3], [2, 2], [3, 1], [6, 3]], difficulty: 'beginner' },
    { name: 'Am', fingers: [[1, 1], [2, 2], [3, 3]], difficulty: 'beginner' },
    { name: 'F', fingers: [[1, 1], [2, 1], [3, 2], [4, 3]], difficulty: 'intermediate' },
    { name: 'D', fingers: [[1, 2], [2, 3], [3, 2]], difficulty: 'beginner' },
    { name: 'Em', fingers: [[1, 2], [2, 3]], difficulty: 'beginner' },
    { name: 'Bm', fingers: [[1, 2], [2, 3], [3, 4], [4, 4]], difficulty: 'intermediate' },
    { name: 'A', fingers: [[1, 2], [2, 2], [3, 2]], difficulty: 'beginner' },
    { name: 'E', fingers: [[1, 1], [2, 1], [3, 2], [4, 2]], difficulty: 'beginner' },
    { name: 'Dm', fingers: [[1, 1], [2, 3], [3, 2]], difficulty: 'beginner' }
];

function startChordTraining() {
    chordTrainingActive = true;
    currentChordIndex = 0;
    chordAccuracy = 0;
    chordAttempts = 0;
    
    displayCurrentChord();
    updateChordProgress();
    
    // æ˜¾ç¤ºæŒ‡æ¿
    displayFretboard();
    
    // å¼€å§‹éŸ³é¢‘æ£€æµ‹ï¼ˆæ¨¡æ‹Ÿï¼‰
    startAudioDetection();
}

function nextChord() {
    if (currentChordIndex < chordLibrary.length - 1) {
        currentChordIndex++;
        displayCurrentChord();
        updateChordProgress();
    } else {
        // è®­ç»ƒå®Œæˆ
        completeChordTraining();
    }
}

function displayCurrentChord() {
    const chordDisplay = document.getElementById('currentChordDisplay');
    const currentChord = chordLibrary[currentChordIndex];
    chordDisplay.textContent = currentChord.name;
}

function displayFretboard() {
    const fretboardDisplay = document.getElementById('fretboardDisplay');
    const currentChord = chordLibrary[currentChordIndex];
    
    // åˆ›å»ºæŒ‡æ¿HTML
    let fretboardHTML = '<div class="fretboard">';
    fretboardHTML += '<div class="fretboard-strings">';
    for (let string = 1; string <= 6; string++) {
        fretboardHTML += `<div class="string string-${string}"></div>`;
    }
    fretboardHTML += '</div>';
    
    fretboardHTML += '<div class="fretboard-frets">';
    for (let fret = 0; fret <= 5; fret++) {
        fretboardHTML += `<div class="fret fret-${fret}">`;
        for (let string = 1; string <= 6; string++) {
            const finger = currentChord.fingers.find(f => f[0] === string);
            if (finger && finger[1] === fret) {
                fretboardHTML += `<div class="finger-position" data-string="${string}" data-fret="${fret}"></div>`;
            } else {
                fretboardHTML += `<div class="fret-position" data-string="${string}" data-fret="${fret}"></div>`;
            }
        }
        fretboardHTML += '</div>';
    }
    fretboardHTML += '</div></div>';
    
    fretboardDisplay.innerHTML = fretboardHTML;
    
    // æ·»åŠ æŒ‡æ¿æ ·å¼
    const style = document.createElement('style');
    style.textContent = `
        .fretboard {
            width: 100%;
            height: 200px;
            background: #2c3e50;
            border-radius: 10px;
            position: relative;
            margin: 20px 0;
        }
        
        .fretboard-strings {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .string {
            flex: 1;
            border-bottom: 1px solid #34495e;
        }
        
        .fretboard-frets {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
        }
        
        .fret {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #34495e;
        }
        
        .fret-position {
            flex: 1;
            border-bottom: 1px solid #34495e;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .fret-position:hover {
            background: rgba(52, 152, 219, 0.3);
        }
        
        .finger-position {
            flex: 1;
            background: #3498db;
            border-radius: 50%;
            margin: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    `;
    
    if (!document.getElementById('fretboardStyle')) {
        style.id = 'fretboardStyle';
        document.head.appendChild(style);
    }
}

function startAudioDetection() {
    // æ¨¡æ‹ŸéŸ³é¢‘æ£€æµ‹

    // è¿™é‡Œåº”è¯¥é›†æˆçœŸå®çš„éŸ³é¢‘æ£€æµ‹åŠŸèƒ½
}

function showChordHeatmap() {
    // æ˜¾ç¤ºå’Œå¼¦çƒ­åŠ›å›¾
    alert('çƒ­åŠ›å›¾åŠŸèƒ½ï¼šæ˜¾ç¤ºæ‚¨æœ€å¸¸ç»ƒä¹ çš„å’Œå¼¦ä½ç½®');
}

function resetChordTraining() {
    chordTrainingActive = false;
    currentChordIndex = 0;
    chordAccuracy = 0;
    chordAttempts = 0;
    
    updateChordProgress();
    displayCurrentChord();
}

function updateChordProgress() {
    const progressFill = document.getElementById('chordProgressFill');
    const accuracyDisplay = document.getElementById('chordAccuracy');
    
    const progress = (currentChordIndex / chordLibrary.length) * 100;
    progressFill.style.width = progress + '%';
    accuracyDisplay.textContent = chordAccuracy + '%';
}

function completeChordTraining() {
    chordTrainingActive = false;
    alert(`å’Œå¼¦è®­ç»ƒå®Œæˆï¼\nå‡†ç¡®ç‡: ${chordAccuracy}%\nç»ƒä¹ å’Œå¼¦æ•°: ${chordLibrary.length}`);
}

// ç»ƒä¹ è®¡åˆ’ç›¸å…³å‡½æ•°
function generatePracticePlan() {
    const planList = document.getElementById('planList');
    
    const plans = [
        { day: 'ç¬¬1å¤©', title: 'å’Œå¼¦è½¬æ¢ç»ƒä¹ ', content: 'ç»ƒä¹ Cã€Gã€Amã€Få’Œå¼¦çš„è½¬æ¢ï¼Œæ¯ä¸ªå’Œå¼¦ç»ƒä¹ 5åˆ†é’Ÿ' },
        { day: 'ç¬¬2å¤©', title: 'æŒ‡å¼¹ç»ƒä¹ ', content: 'ç»ƒä¹ åŸºæœ¬çš„æŒ‡å¼¹æ¨¡å¼ï¼ŒPIMAæŒ‡æ³•ç»ƒä¹ ' },
        { day: 'ç¬¬3å¤©', title: 'éŸ³é˜¶ç»ƒä¹ ', content: 'ç»ƒä¹ Cå¤§è°ƒéŸ³é˜¶ï¼Œä¸Šä¸‹è¡Œå„10é' },
        { day: 'ç¬¬4å¤©', title: 'æ­Œæ›²å­¦ä¹ ', content: 'å­¦ä¹ ä¸€é¦–ç®€å•çš„æ­Œæ›²ï¼Œç»ƒä¹ å’Œå¼¦è¿›è¡Œ' },
        { day: 'ç¬¬5å¤©', title: 'èŠ‚å¥è®­ç»ƒ', content: 'ä½¿ç”¨èŠ‚æ‹å™¨ç»ƒä¹ åŸºæœ¬èŠ‚å¥å‹' },
        { day: 'ç¬¬6å¤©', title: 'ä¹ç†å­¦ä¹ ', content: 'å­¦ä¹ åŸºæœ¬ä¹ç†çŸ¥è¯†ï¼ŒéŸ³ç¬¦å’ŒèŠ‚æ‹' },
        { day: 'ç¬¬7å¤©', title: 'ç»¼åˆç»ƒä¹ ', content: 'å¤ä¹ å‰6å¤©çš„å†…å®¹ï¼Œç»¼åˆç»ƒä¹ ' }
    ];
    
    let planHTML = '';
    plans.forEach(plan => {
        planHTML += `
            <div class="plan-item">
                <div class="plan-day">${plan.day}</div>
                <div class="plan-content">
                    <h6>${plan.title}</h6>
                    <p>${plan.content}</p>
                    <div class="plan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span>0% å®Œæˆ</span>
                    </div>
                </div>
            </div>
        `;
    });
    
    planList.innerHTML = planHTML;
}

function updateProgress() {
    // æ›´æ–°ç»ƒä¹ è¿›åº¦
    alert('è¿›åº¦æ›´æ–°åŠŸèƒ½ï¼šè®°å½•æ‚¨çš„ç»ƒä¹ è¿›åº¦');
}

function showProgressChart() {
    // æ˜¾ç¤ºè¿›æ­¥æ›²çº¿å›¾
    alert('è¿›æ­¥æ›²çº¿åŠŸèƒ½ï¼šæ˜¾ç¤ºæ‚¨çš„å­¦ä¹ è¿›åº¦å›¾è¡¨');
}
</script>
{% endblock %}
