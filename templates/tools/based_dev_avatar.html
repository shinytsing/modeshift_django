{% extends 'base.html' %}
{% load static %}

{% block tool_title_inner %}反程序员形象{% endblock %}
{% block tool_title_display %}反程序员形象{% endblock %}

{% block extra_css %}
<style>
.based-dev-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
  color: #ffffff;
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  padding: 2rem;
  position: relative;
  overflow-x: hidden;
}

.based-dev-container::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(255, 68, 68, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
  z-index: -1;
  animation: basedPulse 8s ease-in-out infinite;
}

@keyframes basedPulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

.based-header {
  text-align: center;
  margin-bottom: 3rem;
  padding: 2rem 0;
}

.based-title {
  font-size: 3.5rem;
  font-weight: 900;
  background: linear-gradient(135deg, #ff4444, #ff6b35, #ffd700, #ff4444);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 1rem;
  text-shadow: 0 0 40px rgba(255, 68, 68, 0.5);
  animation: basedGlow 3s ease-in-out infinite alternate;
}

@keyframes basedGlow {
  from { filter: brightness(1) hue-rotate(0deg); }
  to { filter: brightness(1.2) hue-rotate(10deg); }
}

.based-subtitle {
  font-size: 1.3rem;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 1rem;
  font-weight: 600;
}

.based-motto {
  font-size: 1rem;
  color: rgba(255, 215, 0, 0.8);
  font-style: italic;
  margin-bottom: 2rem;
}

.based-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
  max-width: 1600px;
  margin: 0 auto;
}

.based-card {
  background: rgba(26, 26, 26, 0.9);
  border: 3px solid rgba(255, 68, 68, 0.4);
  border-radius: 15px;
  padding: 2rem;
  backdrop-filter: blur(15px);
  transition: all 0.4s ease;
  position: relative;
  overflow: hidden;
}

.based-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #ff4444, #ff6b35, #ffd700);
  animation: borderFlow 3s linear infinite;
}

@keyframes borderFlow {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.based-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(255, 68, 68, 0.3);
  border-color: rgba(255, 68, 68, 0.8);
}

.card-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #ff4444;
  margin-bottom: 1.5rem;
  text-align: center;
  text-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
}

/* 形象展示样式 */
.avatar-showcase {
  text-align: center;
  margin-bottom: 2rem;
}

.avatar-image {
  width: 150px;
  height: 150px;
  border-radius: 12px;
  border: 4px solid #ffd700;
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
  margin-bottom: 1rem;
  transition: all 0.3s ease;
}

.avatar-image:hover {
  transform: scale(1.1);
  box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
}

.avatar-name {
  font-size: 1.5rem;
  font-weight: 700;
  color: #ffd700;
  margin-bottom: 0.5rem;
}

.avatar-title {
  font-size: 1rem;
  color: #ff6b35;
  margin-bottom: 1rem;
}

.avatar-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.avatar-stat {
  text-align: center;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  border: 1px solid rgba(255, 68, 68, 0.3);
}

.stat-number {
  font-size: 1.5rem;
  font-weight: 700;
  color: #ffd700;
  margin-bottom: 0.3rem;
}

.stat-label {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.7);
}

/* 代码片段样式 */
.code-snippet {
  background: #1e1e1e;
  border: 2px solid #333;
  border-radius: 10px;
  padding: 1.5rem;
  margin: 1rem 0;
  position: relative;
  overflow: hidden;
}

.code-snippet::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #ff4444, #ff6b35, #ffd700);
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #333;
}

.code-title {
  font-weight: 600;
  color: #ffd700;
}

.code-language {
  font-size: 0.8rem;
  color: #ff6b35;
  background: rgba(255, 107, 53, 0.1);
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
}

.code-content {
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  font-size: 0.9rem;
  line-height: 1.6;
  color: #e0e0e0;
  white-space: pre-wrap;
  overflow-x: auto;
}

.code-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
}

.code-btn {
  background: rgba(255, 68, 68, 0.2);
  border: 1px solid rgba(255, 68, 68, 0.5);
  color: #ff4444;
  padding: 0.5rem 1rem;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.8rem;
}

.code-btn:hover {
  background: rgba(255, 68, 68, 0.3);
  border-color: rgba(255, 68, 68, 0.8);
}

/* 形象管理样式 */
.avatar-form {
  margin-top: 1.5rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-label {
  display: block;
  font-weight: 600;
  color: #ff4444;
  margin-bottom: 0.5rem;
}

.form-input, .form-textarea, .form-select {
  width: 100%;
  padding: 0.8rem;
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 8px;
  color: #ffffff;
  font-family: inherit;
  transition: all 0.3s ease;
}

.form-input:focus, .form-textarea:focus, .form-select:focus {
  outline: none;
  border-color: rgba(255, 68, 68, 0.8);
  background: rgba(255, 68, 68, 0.1);
}

.form-textarea {
  min-height: 100px;
  resize: vertical;
}

.submit-btn {
  background: linear-gradient(45deg, #ff4444, #ff6b35);
  color: #ffffff;
  border: none;
  padding: 1rem 2rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
}

/* 形象展示网格 */
.avatar-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.avatar-item {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 10px;
  padding: 1.5rem;
  transition: all 0.3s ease;
  cursor: pointer;
}

.avatar-item:hover {
  background: rgba(255, 68, 68, 0.1);
  border-color: rgba(255, 68, 68, 0.8);
  transform: translateY(-3px);
}

.avatar-item-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.avatar-item-image {
  width: 60px;
  height: 60px;
  border-radius: 12px;
  border: 2px solid #ffd700;
}

.avatar-item-info h4 {
  color: #ffd700;
  margin-bottom: 0.3rem;
}

.avatar-item-info p {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
}

.avatar-item-code {
  background: #1e1e1e;
  border-radius: 5px;
  padding: 1rem;
  margin-top: 1rem;
  font-size: 0.8rem;
  color: #e0e0e0;
  max-height: 100px;
  overflow: hidden;
  position: relative;
}

.avatar-item-code::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 20px;
  background: linear-gradient(transparent, #1e1e1e);
}

/* 等级和经验值样式 */
.level-display {
  text-align: center;
  margin: 1rem 0;
}

.level-badge {
  background: linear-gradient(45deg, #ffd700, #ff6b35);
  color: #000;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-weight: 700;
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  display: inline-block;
  animation: levelPulse 2s ease-in-out infinite;
}

@keyframes levelPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.experience-bar {
  width: 100%;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  margin: 0.5rem 0;
}

.experience-fill {
  height: 100%;
  background: linear-gradient(90deg, #ff4444, #ff6b35, #ffd700);
  border-radius: 4px;
  transition: width 0.5s ease;
}

.experience-text {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.7);
}

/* 成就系统样式 */
.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
}

.achievement-item {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 10px;
  padding: 1.5rem;
  text-align: center;
  transition: all 0.3s ease;
  opacity: 0.5;
}

.achievement-item.unlocked {
  background: rgba(255, 215, 0, 0.1);
  border-color: #ffd700;
  opacity: 1;
  animation: achievementGlow 2s ease-in-out infinite;
}

@keyframes achievementGlow {
  0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
  50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
}

.achievement-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.achievement-name {
  font-size: 1rem;
  font-weight: 600;
  color: #ffd700;
  margin-bottom: 0.3rem;
}

.achievement-desc {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.7);
}

/* 响应式设计 */
@media (max-width: 768px) {
  .based-dev-container {
    padding: 1rem;
  }
  
  .based-title {
    font-size: 2.5rem;
  }
  
  .based-grid {
    grid-template-columns: 1fr;
  }
  
  .avatar-stats {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .avatar-grid {
    grid-template-columns: 1fr;
  }
  
  .achievements-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* 动画效果 */
@keyframes codeGlow {
  0%, 100% { box-shadow: 0 0 10px rgba(255, 68, 68, 0.3); }
  50% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.6); }
}

.code-snippet:hover {
  animation: codeGlow 2s ease-in-out infinite;
}

/* 通知动画 */
@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="based-dev-container">
  <div class="based-header">
    <h1 class="based-title">反程序员形象</h1>
    <p class="based-subtitle">展示你的编程实力，拒绝AI依赖</p>
    <p class="based-motto">"真正的程序员用代码说话，而不是AI补全"</p>
  </div>

  <div class="based-grid">
    <!-- 当前形象 -->
    <div class="based-card">
      <h2 class="card-title">当前反程序员形象</h2>
      <div class="avatar-showcase">
        <img src="https://via.placeholder.com/150x150/ffd700/000000?text=头像" alt="反程序员头像" class="avatar-image" id="currentAvatar">
        <div class="avatar-name" id="currentName">代码工匠</div>
        <div class="avatar-title" id="currentTitle">手写代码大师</div>
        
        <!-- 等级和经验值显示 -->
        <div class="level-display">
          <div class="level-badge" id="levelBadge">LV.3</div>
          <div class="experience-bar">
            <div class="experience-fill" id="experienceFill" style="width: 65%;"></div>
          </div>
          <div class="experience-text" id="experienceText">650/1000 XP</div>
        </div>
        
        <div class="avatar-stats">
          <div class="avatar-stat">
            <div class="stat-number" id="codeLines">15,847</div>
            <div class="stat-label">手写代码行数</div>
          </div>
          <div class="avatar-stat">
            <div class="stat-number" id="aiRejections">234</div>
            <div class="stat-label">拒绝AI次数</div>
          </div>
          <div class="avatar-stat">
            <div class="stat-number" id="bugsFixed">156</div>
            <div class="stat-label">修复Bug数量</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 代码片段展示 -->
    <div class="based-card">
      <h2 class="card-title">精选代码片段</h2>
      <div class="code-snippet">
        <div class="code-header">
          <span class="code-title">快速排序算法</span>
          <span class="code-language">Python</span>
        </div>
        <div class="code-content">def quick_sort(arr):
    if len(arr) <= 1:
        return arr
    
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    
    return quick_sort(left) + middle + quick_sort(right)

# 手写实现，拒绝AI补全
# 时间复杂度: O(n log n)
# 空间复杂度: O(n)</div>
        <div class="code-actions">
          <button class="code-btn" onclick="likeCode(this)">👍 点赞</button>
          <button class="code-btn" onclick="shareCode(this)">📤 分享</button>
          <button class="code-btn" onclick="editCode(this)">✏️ 编辑</button>
        </div>
      </div>
      
      <div class="code-snippet">
        <div class="code-header">
          <span class="code-title">二叉树遍历</span>
          <span class="code-language">JavaScript</span>
        </div>
        <div class="code-content">class TreeNode {
    constructor(val) {
        this.val = val;
        this.left = null;
        this.right = null;
    }
}

// 中序遍历 - 手写实现
function inorderTraversal(root) {
    const result = [];
    
    function traverse(node) {
        if (!node) return;
        traverse(node.left);
        result.push(node.val);
        traverse(node.right);
    }
    
    traverse(root);
    return result;
}

// 拒绝AI补全，坚持手写代码</div>
        <div class="code-actions">
          <button class="code-btn" onclick="likeCode(this)">👍 点赞</button>
          <button class="code-btn" onclick="shareCode(this)">📤 分享</button>
          <button class="code-btn" onclick="editCode(this)">✏️ 编辑</button>
        </div>
      </div>
    </div>

    <!-- 形象管理 -->
    <div class="based-card">
      <h2 class="card-title">更新反程序员形象</h2>
      <form class="avatar-form" id="avatarForm">
        <div class="form-group">
          <label class="form-label">头像图片</label>
          <input type="file" class="form-input" id="avatarImage" accept="image/*">
        </div>
        
        <div class="form-group">
          <label class="form-label">反程序员称号</label>
          <input type="text" class="form-input" id="avatarName" placeholder="如：代码工匠、算法巫师等" value="代码工匠">
        </div>
        
        <div class="form-group">
          <label class="form-label">专业描述</label>
          <input type="text" class="form-input" id="avatarTitle" placeholder="如：手写代码大师、AI抵抗者等" value="手写代码大师">
        </div>
        
        <div class="form-group">
          <label class="form-label">代码片段</label>
          <textarea class="form-textarea" id="codeSnippet" placeholder="展示你的手写代码片段...">def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# 手写递归实现，拒绝AI补全
# 展示真正的编程实力</textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">编程语言</label>
          <select class="form-select" id="codeLanguage">
            <option value="python">Python</option>
            <option value="javascript">JavaScript</option>
            <option value="java">Java</option>
            <option value="cpp">C++</option>
            <option value="go">Go</option>
            <option value="rust">Rust</option>
          </select>
        </div>
        
        <button type="submit" class="submit-btn">更新形象</button>
      </form>
    </div>

    <!-- 成就系统 -->
    <div class="based-card">
      <h2 class="card-title">反程序员成就</h2>
      <div class="achievements-grid" id="achievementsGrid">
        <div class="achievement-item unlocked">
          <div class="achievement-icon">💻</div>
          <div class="achievement-name">代码工匠</div>
          <div class="achievement-desc">手写1000行代码</div>
        </div>
        <div class="achievement-item">
          <div class="achievement-icon">⭐</div>
          <div class="achievement-name">社区明星</div>
          <div class="achievement-desc">获得100个点赞</div>
        </div>
        <div class="achievement-item">
          <div class="achievement-icon">🎭</div>
          <div class="achievement-name">形象大师</div>
          <div class="achievement-desc">创建10个反程序员形象</div>
        </div>
        <div class="achievement-item">
          <div class="achievement-icon">🐛</div>
          <div class="achievement-name">Bug终结者</div>
          <div class="achievement-desc">修复100个bug</div>
        </div>
      </div>
    </div>

    <!-- 其他反程序员形象 -->
    <div class="based-card">
      <h2 class="card-title">反程序员社区</h2>
      <div class="avatar-grid">
        <div class="avatar-item" onclick="viewAvatar(this)">
          <div class="avatar-item-header">
            <img src="https://via.placeholder.com/60x60/ff4444/ffffff?text=A" alt="头像" class="avatar-item-image">
            <div class="avatar-item-info">
              <h4>算法巫师</h4>
              <p>手写复杂算法专家</p>
            </div>
          </div>
          <div class="avatar-item-code">def dijkstra(graph, start):
    # 手写Dijkstra算法
    # 拒绝AI补全，展示真功夫...</div>
        </div>
        
        <div class="avatar-item" onclick="viewAvatar(this)">
          <div class="avatar-item-header">
            <img src="https://via.placeholder.com/60x60/ff6b35/ffffff?text=B" alt="头像" class="avatar-item-image">
            <div class="avatar-item-info">
              <h4>调试大师</h4>
              <p>Bug终结者</p>
            </div>
          </div>
          <div class="avatar-item-code">// 手写调试工具
// 不依赖IDE自动补全
// 真正的调试技能...</div>
        </div>
        
        <div class="avatar-item" onclick="viewAvatar(this)">
          <div class="avatar-item-header">
            <img src="https://via.placeholder.com/60x60/ffd700/000000?text=C" alt="头像" class="avatar-item-image">
            <div class="avatar-item-info">
              <h4>代码诗人</h4>
              <p>优雅代码艺术家</p>
            </div>
          </div>
          <div class="avatar-item-code">// 手写优雅代码
// 追求代码美学
// 拒绝AI生成的垃圾代码...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 反程序员形象系统
class BasedDevAvatar {
  constructor() {
    this.currentAvatar = {
      name: '代码工匠',
      title: '手写代码大师',
      image: 'https://via.placeholder.com/150x150/ffd700/000000?text=头像',
      stats: {
        codeLines: 15847,
        aiRejections: 234,
        bugsFixed: 156
      },
      level: 3,
      experience: 650
    };
    
    this.init();
  }
  
  init() {
    this.bindEvents();
    this.updateDisplay();
    this.loadUserData();
  }
  
  bindEvents() {
    // 表单提交
    document.getElementById('avatarForm').addEventListener('submit', (e) => {
      e.preventDefault();
      this.updateAvatar();
    });
    
    // 头像图片预览
    document.getElementById('avatarImage').addEventListener('change', (e) => {
      this.previewAvatar(e.target.files[0]);
    });
  }
  
  async loadUserData() {
    try {
      const response = await fetch('/tools/api/based_dev_avatar/get/');
      const data = await response.json();
      
      if (data.success) {
        this.updateUserStats(data.user_stats);
        this.updateAchievements(data.achievements);
      }
    } catch (error) {

    }
  }
  
  updateUserStats(stats) {
    document.getElementById('levelBadge').textContent = `LV.${stats.level}`;
    document.getElementById('experienceFill').style.width = `${(stats.experience / 1000) * 100}%`;
    document.getElementById('experienceText').textContent = `${stats.experience}/1000 XP`;
    document.getElementById('currentName').textContent = stats.title;
    document.getElementById('codeLines').textContent = stats.total_code_lines.toLocaleString();
    document.getElementById('aiRejections').textContent = '234'; // 暂时固定
    document.getElementById('bugsFixed').textContent = '156'; // 暂时固定
  }
  
  updateAchievements(achievements) {
    const achievementsGrid = document.getElementById('achievementsGrid');
    achievementsGrid.innerHTML = '';
    
    achievements.forEach(achievement => {
      const achievementItem = document.createElement('div');
      achievementItem.className = `achievement-item ${achievement.unlocked ? 'unlocked' : ''}`;
      achievementItem.innerHTML = `
        <div class="achievement-icon">${achievement.icon}</div>
        <div class="achievement-name">${achievement.name}</div>
        <div class="achievement-desc">${achievement.description}</div>
      `;
      achievementsGrid.appendChild(achievementItem);
    });
  }
  
  updateDisplay() {
    document.getElementById('currentName').textContent = this.currentAvatar.name;
    document.getElementById('currentTitle').textContent = this.currentAvatar.title;
    document.getElementById('currentAvatar').src = this.currentAvatar.image;
    document.getElementById('codeLines').textContent = this.currentAvatar.stats.codeLines.toLocaleString();
    document.getElementById('aiRejections').textContent = this.currentAvatar.stats.aiRejections.toLocaleString();
    document.getElementById('bugsFixed').textContent = this.currentAvatar.stats.bugsFixed.toLocaleString();
    
    // 更新等级显示
    document.getElementById('levelBadge').textContent = `LV.${this.currentAvatar.level}`;
    document.getElementById('experienceFill').style.width = `${(this.currentAvatar.experience / 1000) * 100}%`;
    document.getElementById('experienceText').textContent = `${this.currentAvatar.experience}/1000 XP`;
  }
  
  previewAvatar(file) {
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        document.getElementById('currentAvatar').src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }
  
  async updateAvatar() {
    const name = document.getElementById('avatarName').value;
    const title = document.getElementById('avatarTitle').value;
    const codeSnippet = document.getElementById('codeSnippet').value;
    const language = document.getElementById('codeLanguage').value;
    
    try {
      const response = await fetch('/tools/api/based_dev_avatar/create/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': this.getCSRFToken()
        },
        body: JSON.stringify({
          code_snippet: codeSnippet,
          caption: `${name} - ${title}`
        })
      });
      
      const data = await response.json();
      
      if (data.success) {
        this.currentAvatar.name = name;
        this.currentAvatar.title = title;
        
        // 更新显示
        this.updateDisplay();
        
        // 显示成功消息
        this.showNotification('反程序员形象更新成功！', 'success');
        
        // 添加代码片段到展示区域
        this.addCodeSnippet(codeSnippet, language);
        
        // 重新加载用户数据
        this.loadUserData();
      } else {
        this.showNotification('更新失败: ' + data.error, 'error');
      }
    } catch (error) {
      this.showNotification('更新失败: ' + error.message, 'error');
    }
  }
  
  addCodeSnippet(code, language) {
    const codeContainer = document.querySelector('.based-card:nth-child(2)');
    const newSnippet = document.createElement('div');
    newSnippet.className = 'code-snippet';
    newSnippet.innerHTML = `
      <div class="code-header">
        <span class="code-title">新添加的代码片段</span>
        <span class="code-language">${language}</span>
      </div>
      <div class="code-content">${code}</div>
      <div class="code-actions">
        <button class="code-btn" onclick="likeCode(this)">👍 点赞</button>
        <button class="code-btn" onclick="shareCode(this)">📤 分享</button>
        <button class="code-btn" onclick="editCode(this)">✏️ 编辑</button>
      </div>
    `;
    
    codeContainer.appendChild(newSnippet);
  }
  
  getCSRFToken() {
    const token = document.querySelector('[name=csrfmiddlewaretoken]');
    return token ? token.value : '';
  }
  
  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 2rem;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
}

// 全局函数
function likeCode(btn) {
  btn.textContent = '👍 已点赞';
  btn.style.background = 'rgba(255, 215, 0, 0.3)';
  btn.style.borderColor = 'rgba(255, 215, 0, 0.8)';
  btn.disabled = true;
}

function shareCode(btn) {
  const codeSnippet = btn.closest('.code-snippet');
  const codeTitle = codeSnippet.querySelector('.code-title').textContent;
  const codeContent = codeSnippet.querySelector('.code-content').textContent;
  
  // 模拟分享功能
  alert(`分享代码片段：${codeTitle}\n\n代码内容：\n${codeContent.substring(0, 100)}...\n\n分享功能开发中...`);
}

function editCode(btn) {
  const codeSnippet = btn.closest('.code-snippet');
  const codeTitle = codeSnippet.querySelector('.code-title').textContent;
  
  alert(`编辑代码片段：${codeTitle}\n\n编辑功能开发中...`);
}

function viewAvatar(avatarItem) {
  const name = avatarItem.querySelector('h4').textContent;
  const title = avatarItem.querySelector('p').textContent;
  const code = avatarItem.querySelector('.avatar-item-code').textContent;
  
  alert(`查看反程序员形象：${name}\n\n专业描述：${title}\n\n代码片段：\n${code}\n\n查看详情功能开发中...`);
}

// 初始化反程序员形象系统
document.addEventListener('DOMContentLoaded', function() {
  const basedDevAvatar = new BasedDevAvatar();
  
  // 模拟一些交互
  setTimeout(() => {
    // 模拟更新统计数据
    basedDevAvatar.currentAvatar.stats.codeLines += 100;
    basedDevAvatar.currentAvatar.stats.aiRejections += 5;
    basedDevAvatar.updateDisplay();
  }, 3000);
});
</script>
{% endblock %} 