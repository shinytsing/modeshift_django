{% extends 'base.html' %}
{% load static %}

{% block tool_title_inner %}åç¨‹åºå‘˜å½¢è±¡{% endblock %}
{% block tool_title_display %}åç¨‹åºå‘˜å½¢è±¡{% endblock %}

{% block extra_css %}
<style>
.based-dev-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
  color: #ffffff;
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  padding: 2rem;
  position: relative;
  overflow-x: hidden;
}

.based-dev-container::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(255, 68, 68, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
  z-index: -1;
  animation: basedPulse 8s ease-in-out infinite;
}

@keyframes basedPulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

.based-header {
  text-align: center;
  margin-bottom: 3rem;
  padding: 2rem 0;
}

.based-title {
  font-size: 3.5rem;
  font-weight: 900;
  background: linear-gradient(135deg, #ff4444, #ff6b35, #ffd700, #ff4444);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 1rem;
  text-shadow: 0 0 40px rgba(255, 68, 68, 0.5);
  animation: basedGlow 3s ease-in-out infinite alternate;
}

@keyframes basedGlow {
  from { filter: brightness(1) hue-rotate(0deg); }
  to { filter: brightness(1.2) hue-rotate(10deg); }
}

.based-subtitle {
  font-size: 1.3rem;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 1rem;
  font-weight: 600;
}

.based-motto {
  font-size: 1rem;
  color: rgba(255, 215, 0, 0.8);
  font-style: italic;
  margin-bottom: 2rem;
}

.based-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
  max-width: 1600px;
  margin: 0 auto;
}

.based-card {
  background: rgba(26, 26, 26, 0.9);
  border: 3px solid rgba(255, 68, 68, 0.4);
  border-radius: 15px;
  padding: 2rem;
  backdrop-filter: blur(15px);
  transition: all 0.4s ease;
  position: relative;
  overflow: hidden;
}

.based-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #ff4444, #ff6b35, #ffd700);
  animation: borderFlow 3s linear infinite;
}

@keyframes borderFlow {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.based-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(255, 68, 68, 0.3);
  border-color: rgba(255, 68, 68, 0.8);
}

.card-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #ff4444;
  margin-bottom: 1.5rem;
  text-align: center;
  text-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
}

/* å½¢è±¡å±•ç¤ºæ ·å¼ */
.avatar-showcase {
  text-align: center;
  margin-bottom: 2rem;
}

.avatar-image {
  width: 150px;
  height: 150px;
  border-radius: 12px;
  border: 4px solid #ffd700;
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
  margin-bottom: 1rem;
  transition: all 0.3s ease;
}

.avatar-image:hover {
  transform: scale(1.1);
  box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
}

.avatar-name {
  font-size: 1.5rem;
  font-weight: 700;
  color: #ffd700;
  margin-bottom: 0.5rem;
}

.avatar-title {
  font-size: 1rem;
  color: #ff6b35;
  margin-bottom: 1rem;
}

.avatar-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.avatar-stat {
  text-align: center;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  border: 1px solid rgba(255, 68, 68, 0.3);
}

.stat-number {
  font-size: 1.5rem;
  font-weight: 700;
  color: #ffd700;
  margin-bottom: 0.3rem;
}

.stat-label {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.7);
}

/* ä»£ç ç‰‡æ®µæ ·å¼ */
.code-snippet {
  background: #1e1e1e;
  border: 2px solid #333;
  border-radius: 10px;
  padding: 1.5rem;
  margin: 1rem 0;
  position: relative;
  overflow: hidden;
}

.code-snippet::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #ff4444, #ff6b35, #ffd700);
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #333;
}

.code-title {
  font-weight: 600;
  color: #ffd700;
}

.code-language {
  font-size: 0.8rem;
  color: #ff6b35;
  background: rgba(255, 107, 53, 0.1);
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
}

.code-content {
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  font-size: 0.9rem;
  line-height: 1.6;
  color: #e0e0e0;
  white-space: pre-wrap;
  overflow-x: auto;
}

.code-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
}

.code-btn {
  background: rgba(255, 68, 68, 0.2);
  border: 1px solid rgba(255, 68, 68, 0.5);
  color: #ff4444;
  padding: 0.5rem 1rem;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.8rem;
}

.code-btn:hover {
  background: rgba(255, 68, 68, 0.3);
  border-color: rgba(255, 68, 68, 0.8);
}

/* å½¢è±¡ç®¡ç†æ ·å¼ */
.avatar-form {
  margin-top: 1.5rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-label {
  display: block;
  font-weight: 600;
  color: #ff4444;
  margin-bottom: 0.5rem;
}

.form-input, .form-textarea, .form-select {
  width: 100%;
  padding: 0.8rem;
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 8px;
  color: #ffffff;
  font-family: inherit;
  transition: all 0.3s ease;
}

.form-input:focus, .form-textarea:focus, .form-select:focus {
  outline: none;
  border-color: rgba(255, 68, 68, 0.8);
  background: rgba(255, 68, 68, 0.1);
}

.form-textarea {
  min-height: 100px;
  resize: vertical;
}

.submit-btn {
  background: linear-gradient(45deg, #ff4444, #ff6b35);
  color: #ffffff;
  border: none;
  padding: 1rem 2rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
}

/* å½¢è±¡å±•ç¤ºç½‘æ ¼ */
.avatar-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.avatar-item {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 10px;
  padding: 1.5rem;
  transition: all 0.3s ease;
  cursor: pointer;
}

.avatar-item:hover {
  background: rgba(255, 68, 68, 0.1);
  border-color: rgba(255, 68, 68, 0.8);
  transform: translateY(-3px);
}

.avatar-item-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.avatar-item-image {
  width: 60px;
  height: 60px;
  border-radius: 12px;
  border: 2px solid #ffd700;
}

.avatar-item-info h4 {
  color: #ffd700;
  margin-bottom: 0.3rem;
}

.avatar-item-info p {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
}

.avatar-item-code {
  background: #1e1e1e;
  border-radius: 5px;
  padding: 1rem;
  margin-top: 1rem;
  font-size: 0.8rem;
  color: #e0e0e0;
  max-height: 100px;
  overflow: hidden;
  position: relative;
}

.avatar-item-code::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 20px;
  background: linear-gradient(transparent, #1e1e1e);
}

/* ç­‰çº§å’Œç»éªŒå€¼æ ·å¼ */
.level-display {
  text-align: center;
  margin: 1rem 0;
}

.level-badge {
  background: linear-gradient(45deg, #ffd700, #ff6b35);
  color: #000;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-weight: 700;
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  display: inline-block;
  animation: levelPulse 2s ease-in-out infinite;
}

@keyframes levelPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.experience-bar {
  width: 100%;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  margin: 0.5rem 0;
}

.experience-fill {
  height: 100%;
  background: linear-gradient(90deg, #ff4444, #ff6b35, #ffd700);
  border-radius: 4px;
  transition: width 0.5s ease;
}

.experience-text {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.7);
}

/* æˆå°±ç³»ç»Ÿæ ·å¼ */
.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
}

.achievement-item {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 68, 68, 0.3);
  border-radius: 10px;
  padding: 1.5rem;
  text-align: center;
  transition: all 0.3s ease;
  opacity: 0.5;
}

.achievement-item.unlocked {
  background: rgba(255, 215, 0, 0.1);
  border-color: #ffd700;
  opacity: 1;
  animation: achievementGlow 2s ease-in-out infinite;
}

@keyframes achievementGlow {
  0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
  50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
}

.achievement-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.achievement-name {
  font-size: 1rem;
  font-weight: 600;
  color: #ffd700;
  margin-bottom: 0.3rem;
}

.achievement-desc {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.7);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .based-dev-container {
    padding: 1rem;
  }
  
  .based-title {
    font-size: 2.5rem;
  }
  
  .based-grid {
    grid-template-columns: 1fr;
  }
  
  .avatar-stats {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .avatar-grid {
    grid-template-columns: 1fr;
  }
  
  .achievements-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes codeGlow {
  0%, 100% { box-shadow: 0 0 10px rgba(255, 68, 68, 0.3); }
  50% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.6); }
}

.code-snippet:hover {
  animation: codeGlow 2s ease-in-out infinite;
}

/* é€šçŸ¥åŠ¨ç”» */
@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="based-dev-container">
  <div class="based-header">
    <h1 class="based-title">åç¨‹åºå‘˜å½¢è±¡</h1>
    <p class="based-subtitle">å±•ç¤ºä½ çš„ç¼–ç¨‹å®åŠ›ï¼Œæ‹’ç»AIä¾èµ–</p>
    <p class="based-motto">"çœŸæ­£çš„ç¨‹åºå‘˜ç”¨ä»£ç è¯´è¯ï¼Œè€Œä¸æ˜¯AIè¡¥å…¨"</p>
  </div>

  <div class="based-grid">
    <!-- å½“å‰å½¢è±¡ -->
    <div class="based-card">
      <h2 class="card-title">å½“å‰åç¨‹åºå‘˜å½¢è±¡</h2>
      <div class="avatar-showcase">
        <img src="https://via.placeholder.com/150x150/ffd700/000000?text=å¤´åƒ" alt="åç¨‹åºå‘˜å¤´åƒ" class="avatar-image" id="currentAvatar">
        <div class="avatar-name" id="currentName">ä»£ç å·¥åŒ </div>
        <div class="avatar-title" id="currentTitle">æ‰‹å†™ä»£ç å¤§å¸ˆ</div>
        
        <!-- ç­‰çº§å’Œç»éªŒå€¼æ˜¾ç¤º -->
        <div class="level-display">
          <div class="level-badge" id="levelBadge">LV.3</div>
          <div class="experience-bar">
            <div class="experience-fill" id="experienceFill" style="width: 65%;"></div>
          </div>
          <div class="experience-text" id="experienceText">650/1000 XP</div>
        </div>
        
        <div class="avatar-stats">
          <div class="avatar-stat">
            <div class="stat-number" id="codeLines">15,847</div>
            <div class="stat-label">æ‰‹å†™ä»£ç è¡Œæ•°</div>
          </div>
          <div class="avatar-stat">
            <div class="stat-number" id="aiRejections">234</div>
            <div class="stat-label">æ‹’ç»AIæ¬¡æ•°</div>
          </div>
          <div class="avatar-stat">
            <div class="stat-number" id="bugsFixed">156</div>
            <div class="stat-label">ä¿®å¤Bugæ•°é‡</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ä»£ç ç‰‡æ®µå±•ç¤º -->
    <div class="based-card">
      <h2 class="card-title">ç²¾é€‰ä»£ç ç‰‡æ®µ</h2>
      <div class="code-snippet">
        <div class="code-header">
          <span class="code-title">å¿«é€Ÿæ’åºç®—æ³•</span>
          <span class="code-language">Python</span>
        </div>
        <div class="code-content">def quick_sort(arr):
    if len(arr) <= 1:
        return arr
    
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    
    return quick_sort(left) + middle + quick_sort(right)

# æ‰‹å†™å®ç°ï¼Œæ‹’ç»AIè¡¥å…¨
# æ—¶é—´å¤æ‚åº¦: O(n log n)
# ç©ºé—´å¤æ‚åº¦: O(n)</div>
        <div class="code-actions">
          <button class="code-btn" onclick="likeCode(this)">ğŸ‘ ç‚¹èµ</button>
          <button class="code-btn" onclick="shareCode(this)">ğŸ“¤ åˆ†äº«</button>
          <button class="code-btn" onclick="editCode(this)">âœï¸ ç¼–è¾‘</button>
        </div>
      </div>
      
      <div class="code-snippet">
        <div class="code-header">
          <span class="code-title">äºŒå‰æ ‘éå†</span>
          <span class="code-language">JavaScript</span>
        </div>
        <div class="code-content">class TreeNode {
    constructor(val) {
        this.val = val;
        this.left = null;
        this.right = null;
    }
}

// ä¸­åºéå† - æ‰‹å†™å®ç°
function inorderTraversal(root) {
    const result = [];
    
    function traverse(node) {
        if (!node) return;
        traverse(node.left);
        result.push(node.val);
        traverse(node.right);
    }
    
    traverse(root);
    return result;
}

// æ‹’ç»AIè¡¥å…¨ï¼ŒåšæŒæ‰‹å†™ä»£ç </div>
        <div class="code-actions">
          <button class="code-btn" onclick="likeCode(this)">ğŸ‘ ç‚¹èµ</button>
          <button class="code-btn" onclick="shareCode(this)">ğŸ“¤ åˆ†äº«</button>
          <button class="code-btn" onclick="editCode(this)">âœï¸ ç¼–è¾‘</button>
        </div>
      </div>
    </div>

    <!-- å½¢è±¡ç®¡ç† -->
    <div class="based-card">
      <h2 class="card-title">æ›´æ–°åç¨‹åºå‘˜å½¢è±¡</h2>
      <form class="avatar-form" id="avatarForm">
        <div class="form-group">
          <label class="form-label">å¤´åƒå›¾ç‰‡</label>
          <input type="file" class="form-input" id="avatarImage" accept="image/*">
        </div>
        
        <div class="form-group">
          <label class="form-label">åç¨‹åºå‘˜ç§°å·</label>
          <input type="text" class="form-input" id="avatarName" placeholder="å¦‚ï¼šä»£ç å·¥åŒ ã€ç®—æ³•å·«å¸ˆç­‰" value="ä»£ç å·¥åŒ ">
        </div>
        
        <div class="form-group">
          <label class="form-label">ä¸“ä¸šæè¿°</label>
          <input type="text" class="form-input" id="avatarTitle" placeholder="å¦‚ï¼šæ‰‹å†™ä»£ç å¤§å¸ˆã€AIæŠµæŠ—è€…ç­‰" value="æ‰‹å†™ä»£ç å¤§å¸ˆ">
        </div>
        
        <div class="form-group">
          <label class="form-label">ä»£ç ç‰‡æ®µ</label>
          <textarea class="form-textarea" id="codeSnippet" placeholder="å±•ç¤ºä½ çš„æ‰‹å†™ä»£ç ç‰‡æ®µ...">def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# æ‰‹å†™é€’å½’å®ç°ï¼Œæ‹’ç»AIè¡¥å…¨
# å±•ç¤ºçœŸæ­£çš„ç¼–ç¨‹å®åŠ›</textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">ç¼–ç¨‹è¯­è¨€</label>
          <select class="form-select" id="codeLanguage">
            <option value="python">Python</option>
            <option value="javascript">JavaScript</option>
            <option value="java">Java</option>
            <option value="cpp">C++</option>
            <option value="go">Go</option>
            <option value="rust">Rust</option>
          </select>
        </div>
        
        <button type="submit" class="submit-btn">æ›´æ–°å½¢è±¡</button>
      </form>
    </div>

    <!-- æˆå°±ç³»ç»Ÿ -->
    <div class="based-card">
      <h2 class="card-title">åç¨‹åºå‘˜æˆå°±</h2>
      <div class="achievements-grid" id="achievementsGrid">
        <div class="achievement-item unlocked">
          <div class="achievement-icon">ğŸ’»</div>
          <div class="achievement-name">ä»£ç å·¥åŒ </div>
          <div class="achievement-desc">æ‰‹å†™1000è¡Œä»£ç </div>
        </div>
        <div class="achievement-item">
          <div class="achievement-icon">â­</div>
          <div class="achievement-name">ç¤¾åŒºæ˜æ˜Ÿ</div>
          <div class="achievement-desc">è·å¾—100ä¸ªç‚¹èµ</div>
        </div>
        <div class="achievement-item">
          <div class="achievement-icon">ğŸ­</div>
          <div class="achievement-name">å½¢è±¡å¤§å¸ˆ</div>
          <div class="achievement-desc">åˆ›å»º10ä¸ªåç¨‹åºå‘˜å½¢è±¡</div>
        </div>
        <div class="achievement-item">
          <div class="achievement-icon">ğŸ›</div>
          <div class="achievement-name">Bugç»ˆç»“è€…</div>
          <div class="achievement-desc">ä¿®å¤100ä¸ªbug</div>
        </div>
      </div>
    </div>

    <!-- å…¶ä»–åç¨‹åºå‘˜å½¢è±¡ -->
    <div class="based-card">
      <h2 class="card-title">åç¨‹åºå‘˜ç¤¾åŒº</h2>
      <div class="avatar-grid">
        <div class="avatar-item" onclick="viewAvatar(this)">
          <div class="avatar-item-header">
            <img src="https://via.placeholder.com/60x60/ff4444/ffffff?text=A" alt="å¤´åƒ" class="avatar-item-image">
            <div class="avatar-item-info">
              <h4>ç®—æ³•å·«å¸ˆ</h4>
              <p>æ‰‹å†™å¤æ‚ç®—æ³•ä¸“å®¶</p>
            </div>
          </div>
          <div class="avatar-item-code">def dijkstra(graph, start):
    # æ‰‹å†™Dijkstraç®—æ³•
    # æ‹’ç»AIè¡¥å…¨ï¼Œå±•ç¤ºçœŸåŠŸå¤«...</div>
        </div>
        
        <div class="avatar-item" onclick="viewAvatar(this)">
          <div class="avatar-item-header">
            <img src="https://via.placeholder.com/60x60/ff6b35/ffffff?text=B" alt="å¤´åƒ" class="avatar-item-image">
            <div class="avatar-item-info">
              <h4>è°ƒè¯•å¤§å¸ˆ</h4>
              <p>Bugç»ˆç»“è€…</p>
            </div>
          </div>
          <div class="avatar-item-code">// æ‰‹å†™è°ƒè¯•å·¥å…·
// ä¸ä¾èµ–IDEè‡ªåŠ¨è¡¥å…¨
// çœŸæ­£çš„è°ƒè¯•æŠ€èƒ½...</div>
        </div>
        
        <div class="avatar-item" onclick="viewAvatar(this)">
          <div class="avatar-item-header">
            <img src="https://via.placeholder.com/60x60/ffd700/000000?text=C" alt="å¤´åƒ" class="avatar-item-image">
            <div class="avatar-item-info">
              <h4>ä»£ç è¯—äºº</h4>
              <p>ä¼˜é›…ä»£ç è‰ºæœ¯å®¶</p>
            </div>
          </div>
          <div class="avatar-item-code">// æ‰‹å†™ä¼˜é›…ä»£ç 
// è¿½æ±‚ä»£ç ç¾å­¦
// æ‹’ç»AIç”Ÿæˆçš„åƒåœ¾ä»£ç ...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// åç¨‹åºå‘˜å½¢è±¡ç³»ç»Ÿ
class BasedDevAvatar {
  constructor() {
    this.currentAvatar = {
      name: 'ä»£ç å·¥åŒ ',
      title: 'æ‰‹å†™ä»£ç å¤§å¸ˆ',
      image: 'https://via.placeholder.com/150x150/ffd700/000000?text=å¤´åƒ',
      stats: {
        codeLines: 15847,
        aiRejections: 234,
        bugsFixed: 156
      },
      level: 3,
      experience: 650
    };
    
    this.init();
  }
  
  init() {
    this.bindEvents();
    this.updateDisplay();
    this.loadUserData();
  }
  
  bindEvents() {
    // è¡¨å•æäº¤
    document.getElementById('avatarForm').addEventListener('submit', (e) => {
      e.preventDefault();
      this.updateAvatar();
    });
    
    // å¤´åƒå›¾ç‰‡é¢„è§ˆ
    document.getElementById('avatarImage').addEventListener('change', (e) => {
      this.previewAvatar(e.target.files[0]);
    });
  }
  
  async loadUserData() {
    try {
      const response = await fetch('/tools/api/based_dev_avatar/get/');
      const data = await response.json();
      
      if (data.success) {
        this.updateUserStats(data.user_stats);
        this.updateAchievements(data.achievements);
      }
    } catch (error) {

    }
  }
  
  updateUserStats(stats) {
    document.getElementById('levelBadge').textContent = `LV.${stats.level}`;
    document.getElementById('experienceFill').style.width = `${(stats.experience / 1000) * 100}%`;
    document.getElementById('experienceText').textContent = `${stats.experience}/1000 XP`;
    document.getElementById('currentName').textContent = stats.title;
    document.getElementById('codeLines').textContent = stats.total_code_lines.toLocaleString();
    document.getElementById('aiRejections').textContent = '234'; // æš‚æ—¶å›ºå®š
    document.getElementById('bugsFixed').textContent = '156'; // æš‚æ—¶å›ºå®š
  }
  
  updateAchievements(achievements) {
    const achievementsGrid = document.getElementById('achievementsGrid');
    achievementsGrid.innerHTML = '';
    
    achievements.forEach(achievement => {
      const achievementItem = document.createElement('div');
      achievementItem.className = `achievement-item ${achievement.unlocked ? 'unlocked' : ''}`;
      achievementItem.innerHTML = `
        <div class="achievement-icon">${achievement.icon}</div>
        <div class="achievement-name">${achievement.name}</div>
        <div class="achievement-desc">${achievement.description}</div>
      `;
      achievementsGrid.appendChild(achievementItem);
    });
  }
  
  updateDisplay() {
    document.getElementById('currentName').textContent = this.currentAvatar.name;
    document.getElementById('currentTitle').textContent = this.currentAvatar.title;
    document.getElementById('currentAvatar').src = this.currentAvatar.image;
    document.getElementById('codeLines').textContent = this.currentAvatar.stats.codeLines.toLocaleString();
    document.getElementById('aiRejections').textContent = this.currentAvatar.stats.aiRejections.toLocaleString();
    document.getElementById('bugsFixed').textContent = this.currentAvatar.stats.bugsFixed.toLocaleString();
    
    // æ›´æ–°ç­‰çº§æ˜¾ç¤º
    document.getElementById('levelBadge').textContent = `LV.${this.currentAvatar.level}`;
    document.getElementById('experienceFill').style.width = `${(this.currentAvatar.experience / 1000) * 100}%`;
    document.getElementById('experienceText').textContent = `${this.currentAvatar.experience}/1000 XP`;
  }
  
  previewAvatar(file) {
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        document.getElementById('currentAvatar').src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }
  
  async updateAvatar() {
    const name = document.getElementById('avatarName').value;
    const title = document.getElementById('avatarTitle').value;
    const codeSnippet = document.getElementById('codeSnippet').value;
    const language = document.getElementById('codeLanguage').value;
    
    try {
      const response = await fetch('/tools/api/based_dev_avatar/create/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': this.getCSRFToken()
        },
        body: JSON.stringify({
          code_snippet: codeSnippet,
          caption: `${name} - ${title}`
        })
      });
      
      const data = await response.json();
      
      if (data.success) {
        this.currentAvatar.name = name;
        this.currentAvatar.title = title;
        
        // æ›´æ–°æ˜¾ç¤º
        this.updateDisplay();
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        this.showNotification('åç¨‹åºå‘˜å½¢è±¡æ›´æ–°æˆåŠŸï¼', 'success');
        
        // æ·»åŠ ä»£ç ç‰‡æ®µåˆ°å±•ç¤ºåŒºåŸŸ
        this.addCodeSnippet(codeSnippet, language);
        
        // é‡æ–°åŠ è½½ç”¨æˆ·æ•°æ®
        this.loadUserData();
      } else {
        this.showNotification('æ›´æ–°å¤±è´¥: ' + data.error, 'error');
      }
    } catch (error) {
      this.showNotification('æ›´æ–°å¤±è´¥: ' + error.message, 'error');
    }
  }
  
  addCodeSnippet(code, language) {
    const codeContainer = document.querySelector('.based-card:nth-child(2)');
    const newSnippet = document.createElement('div');
    newSnippet.className = 'code-snippet';
    newSnippet.innerHTML = `
      <div class="code-header">
        <span class="code-title">æ–°æ·»åŠ çš„ä»£ç ç‰‡æ®µ</span>
        <span class="code-language">${language}</span>
      </div>
      <div class="code-content">${code}</div>
      <div class="code-actions">
        <button class="code-btn" onclick="likeCode(this)">ğŸ‘ ç‚¹èµ</button>
        <button class="code-btn" onclick="shareCode(this)">ğŸ“¤ åˆ†äº«</button>
        <button class="code-btn" onclick="editCode(this)">âœï¸ ç¼–è¾‘</button>
      </div>
    `;
    
    codeContainer.appendChild(newSnippet);
  }
  
  getCSRFToken() {
    const token = document.querySelector('[name=csrfmiddlewaretoken]');
    return token ? token.value : '';
  }
  
  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 2rem;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
}

// å…¨å±€å‡½æ•°
function likeCode(btn) {
  btn.textContent = 'ğŸ‘ å·²ç‚¹èµ';
  btn.style.background = 'rgba(255, 215, 0, 0.3)';
  btn.style.borderColor = 'rgba(255, 215, 0, 0.8)';
  btn.disabled = true;
}

function shareCode(btn) {
  const codeSnippet = btn.closest('.code-snippet');
  const codeTitle = codeSnippet.querySelector('.code-title').textContent;
  const codeContent = codeSnippet.querySelector('.code-content').textContent;
  
  // æ¨¡æ‹Ÿåˆ†äº«åŠŸèƒ½
  alert(`åˆ†äº«ä»£ç ç‰‡æ®µï¼š${codeTitle}\n\nä»£ç å†…å®¹ï¼š\n${codeContent.substring(0, 100)}...\n\nåˆ†äº«åŠŸèƒ½å¼€å‘ä¸­...`);
}

function editCode(btn) {
  const codeSnippet = btn.closest('.code-snippet');
  const codeTitle = codeSnippet.querySelector('.code-title').textContent;
  
  alert(`ç¼–è¾‘ä»£ç ç‰‡æ®µï¼š${codeTitle}\n\nç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­...`);
}

function viewAvatar(avatarItem) {
  const name = avatarItem.querySelector('h4').textContent;
  const title = avatarItem.querySelector('p').textContent;
  const code = avatarItem.querySelector('.avatar-item-code').textContent;
  
  alert(`æŸ¥çœ‹åç¨‹åºå‘˜å½¢è±¡ï¼š${name}\n\nä¸“ä¸šæè¿°ï¼š${title}\n\nä»£ç ç‰‡æ®µï¼š\n${code}\n\næŸ¥çœ‹è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­...`);
}

// åˆå§‹åŒ–åç¨‹åºå‘˜å½¢è±¡ç³»ç»Ÿ
document.addEventListener('DOMContentLoaded', function() {
  const basedDevAvatar = new BasedDevAvatar();
  
  // æ¨¡æ‹Ÿä¸€äº›äº¤äº’
  setTimeout(() => {
    // æ¨¡æ‹Ÿæ›´æ–°ç»Ÿè®¡æ•°æ®
    basedDevAvatar.currentAvatar.stats.codeLines += 100;
    basedDevAvatar.currentAvatar.stats.aiRejections += 5;
    basedDevAvatar.updateDisplay();
  }, 3000);
});
</script>
{% endblock %} 